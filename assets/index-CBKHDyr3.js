import{t as Ue,ak as Ic,c as Ht,ab as Ns,x as hn,y as We,F as Le,M as pe,$ as sn,al as Gs,B as Mt,u as At,_ as an,z as pt,O as Li,P as eu,r as tt,g as tu,a2 as He,o as Xn,R as nu,E as Hs,f as dn,D as Nc,S as qa,I as Nt,v as Gc,q as ts,i as Ds,n as Hc,h as jc,s as Vc,a3 as Wc,am as zc,an as Uc,ao as Xc,ap as Kc}from"./vue-vendor-BgNlNIni.js";import{E as Yc,a as qc,g as Jc,c as Qc,b as Zc,d as $c,u as eh,e as th,f as nh,h as rh,i as js,j as ih,k as sh,l as ru,m as Vs,n as ah,o as Ja,p as oh,q as uh,r as lh,s as ch,t as hh}from"./element-plus-BEpOZisv.js";import{E as Qa,b as dh,j as fh}from"./codemirror-Ccbez8mr.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const mh=Ue({__name:"AppMenu",setup(n){const e=Ic(),t=Ht(()=>e.path==="/"?"/panel":e.path);return(r,i)=>{const s=Ns("RouterLink"),o=qc,u=Yc;return We(),hn(u,{mode:"horizontal","default-active":t.value},{default:Le(()=>[pe(o,{index:"/home"},{default:Le(()=>[pe(s,{to:"/home"},{default:Le(()=>[...i[0]||(i[0]=[sn("Home",-1)])]),_:1})]),_:1}),pe(o,{index:"/svg"},{default:Le(()=>[pe(s,{to:"/svg"},{default:Le(()=>[...i[1]||(i[1]=[sn("SVG",-1)])]),_:1})]),_:1}),pe(o,{index:"/panel"},{default:Le(()=>[pe(s,{to:"/panel"},{default:Le(()=>[...i[2]||(i[2]=[sn("Panel",-1)])]),_:1})]),_:1})]),_:1},8,["default-active"])}}});function Oi(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function ph(n,e){let t;const r=()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=Oi(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let ns;function Ws(){return ns||(ns=ph("keyval-store","keyval")),ns}function Fi(n,e=Ws()){return e("readonly",t=>Oi(t.get(n)))}function iu(n,e,t=Ws()){return t("readwrite",r=>(r.put(e,n),Oi(r.transaction)))}function su(n,e=Ws()){return e("readwrite",t=>(t.delete(n),Oi(t.transaction)))}class Ii{comboColors=[];sliderTrackColor;sliderBorderColor;clone(){const e=new Ii;return e.comboColors=this.comboColors.map(t=>t.clone()),this.sliderTrackColor&&(e.sliderTrackColor=this.sliderTrackColor),this.sliderBorderColor&&(e.sliderBorderColor=this.sliderBorderColor),e}}class or{static BASE_DIFFICULTY=5;_CS=or.BASE_DIFFICULTY;_HP=or.BASE_DIFFICULTY;_OD=or.BASE_DIFFICULTY;_AR;_multiplier=1;_tickRate=1;_rate=1;get circleSize(){return Math.fround(this._CS)}set circleSize(e){this._CS=e}get drainRate(){return Math.fround(this._HP)}set drainRate(e){this._HP=e}get overallDifficulty(){return Math.fround(this._OD)}set overallDifficulty(e){this._OD=e}get approachRate(){return Math.fround(this._AR??this._OD)}set approachRate(e){this._AR=e}get sliderMultiplier(){return this._multiplier}set sliderMultiplier(e){this._multiplier=e}get sliderTickRate(){return this._tickRate}set sliderTickRate(e){this._tickRate=e}get clockRate(){return this._rate}set clockRate(e){this._rate=e}clone(){const e=new or;return e.circleSize=this._CS,e.drainRate=this._HP,e.overallDifficulty=this._OD,typeof this._AR=="number"&&(e.approachRate=this._AR),e.sliderMultiplier=this._multiplier,e.sliderTickRate=this._tickRate,e.clockRate=this._rate,e}static range(e,t,r,i){return e>5?r+(i-r)*(e-5)/5:e<5?r-(r-t)*(5-e)/5:r}}class zs{bookmarks=[];distanceSpacing=1;beatDivisor=4;gridSize=1;timelineZoom=2;clone(){const e=new zs;return e.bookmarks=this.bookmarks.slice(),e.distanceSpacing=this.distanceSpacing,e.beatDivisor=this.beatDivisor,e.gridSize=this.gridSize,e.timelineZoom=this.timelineZoom,e}}let Za;(function(n){n[n.AdditiveBlending=0]="AdditiveBlending",n[n.AlphaBlending=1]="AlphaBlending"})(Za||(Za={}));class gt{source;destination;sourceAlpha;destinationAlpha;rgbEquation;alphaEquation;static None=new gt({source:5,destination:15,sourceAlpha:5,destinationAlpha:15,rgbEquation:1,alphaEquation:1});static Inherit=new gt({source:0,destination:0,sourceAlpha:0,destinationAlpha:0,rgbEquation:0,alphaEquation:0});static Mixture=new gt({source:12,destination:10,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1});static Additive=new gt({source:12,destination:5,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1});constructor(e){this.source=e.source||0,this.destination=e.destination||0,this.sourceAlpha=e.sourceAlpha||0,this.destinationAlpha=e.destinationAlpha||0,this.rgbEquation=e.rgbEquation||0,this.alphaEquation=e.alphaEquation||0}copyFromParent(e){this.source===0&&(this.source=e.source),this.destination===0&&(this.destination=e.destination),this.sourceAlpha===0&&(this.sourceAlpha=e.sourceAlpha),this.destinationAlpha===0&&(this.destinationAlpha=e.destinationAlpha),this.rgbEquation===0&&(this.rgbEquation=e.rgbEquation),this.alphaEquation===0&&(this.alphaEquation=e.alphaEquation)}applyDefaultToInherited(){this.source===0&&(this.source=12),this.destination===0&&(this.destination=10),this.sourceAlpha===0&&(this.sourceAlpha=5),this.destinationAlpha===0&&(this.destinationAlpha=5),this.rgbEquation===0&&(this.rgbEquation=1),this.alphaEquation===0&&(this.alphaEquation=1)}equals(e){return e.source===this.source&&e.destination===this.destination&&e.sourceAlpha===this.sourceAlpha&&e.destinationAlpha===this.destinationAlpha&&e.rgbEquation===this.rgbEquation&&e.alphaEquation===this.alphaEquation}get isDisabled(){return this.source===5&&this.destination===15&&this.sourceAlpha===5&&this.destinationAlpha===15&&this.rgbEquation===1&&this.alphaEquation===1}get rgbEquationMode(){return gt._translateEquation(this.rgbEquation)}get alphaEquationMode(){return gt._translateEquation(this.alphaEquation)}get sourceBlendingFactor(){return gt._translateBlendingFactorSrc(this.source)}get destinationBlendingFactor(){return gt._translateBlendingFactorDest(this.destination)}get sourceAlphaBlendingFactor(){return gt._translateBlendingFactorSrc(this.sourceAlpha)}get destinationAlphaBlendingFactor(){return gt._translateBlendingFactorDest(this.destinationAlpha)}static _translateBlendingFactorSrc(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateBlendingFactorDest(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 771;case 11:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateEquation(e){switch(e){default:case 0:case 1:return 32774;case 2:return 32775;case 3:return 32776;case 4:return 32778;case 5:return 32779}}}let wt;(function(n){n[n.y0=1]="y0",n[n.y1=2]="y1",n[n.y2=4]="y2",n[n.x0=8]="x0",n[n.x1=16]="x1",n[n.x2=32]="x2",n[n.Custom=64]="Custom",n[n.TopLeft=9]="TopLeft",n[n.TopCentre=17]="TopCentre",n[n.TopRight=33]="TopRight",n[n.CentreLeft=10]="CentreLeft",n[n.Centre=18]="Centre",n[n.CentreRight=34]="CentreRight",n[n.BottomLeft=12]="BottomLeft",n[n.BottomCentre=20]="BottomCentre",n[n.BottomRight=36]="BottomRight"})(wt||(wt={}));let Me;(function(n){n.None="",n.Movement="M",n.MovementX="MX",n.MovementY="MY",n.Fade="F",n.Scale="S",n.VectorScale="V",n.Rotation="R",n.Color="C",n.Parameter="P"})(Me||(Me={}));let fr;(function(n){n.None="",n.Loop="L",n.Trigger="T"})(fr||(fr={}));let ut;(function(n){n[n.Background=0]="Background",n[n.Video=1]="Video",n[n.Break=2]="Break",n[n.Colour=3]="Colour",n[n.Sprite=4]="Sprite",n[n.Sample=5]="Sample",n[n.Animation=6]="Animation",n[n.StoryboardCommand=7]="StoryboardCommand"})(ut||(ut={}));let Pt;(function(n){n[n.Background=0]="Background",n[n.Fail=1]="Fail",n[n.Pass=2]="Pass",n[n.Foreground=3]="Foreground",n[n.Overlay=4]="Overlay",n[n.Video=5]="Video"})(Pt||(Pt={}));let Vr;(function(n){n[n.LoopForever=0]="LoopForever",n[n.LoopOnce=1]="LoopOnce"})(Vr||(Vr={}));let dt;(function(n){n[n.TopLeft=0]="TopLeft",n[n.Centre=1]="Centre",n[n.CentreLeft=2]="CentreLeft",n[n.TopRight=3]="TopRight",n[n.BottomCentre=4]="BottomCentre",n[n.TopCentre=5]="TopCentre",n[n.Custom=6]="Custom",n[n.CentreRight=7]="CentreRight",n[n.BottomLeft=8]="BottomLeft",n[n.BottomRight=9]="BottomRight"})(dt||(dt={}));let on;(function(n){n.None="",n.HorizontalFlip="H",n.VerticalFlip="V",n.BlendingMode="A"})(on||(on={}));class En{red;green;blue;alpha;constructor(e,t,r,i){this.red=e??255,this.green=t??255,this.blue=r??255,this.alpha=i??1}get hex(){const e=Math.round(this.alpha*255);return"#"+this.red.toString(16).padStart(2,"0")+this.green.toString(16).padStart(2,"0")+this.blue.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")}equals(e){return this.red===e.red&&this.green===e.green&&this.blue===e.blue&&this.alpha===e.alpha}clone(){return new En(this.red,this.green,this.blue,this.alpha)}toString(){return`${this.red},${this.green},${this.blue},${this.alpha}`}}class he{x;y;constructor(e,t){this.x=e,this.y=isFinite(t)?t:e}get floatX(){return Math.fround(this.x)}get floatY(){return Math.fround(this.y)}add(e){return new he(this.x+e.x,this.y+e.y)}fadd(e){return new he(Math.fround(this.floatX+e.floatX),Math.fround(this.floatY+e.floatY))}subtract(e){return new he(this.x-e.x,this.y-e.y)}fsubtract(e){return new he(Math.fround(this.floatX-e.floatX),Math.fround(this.floatY-e.floatY))}scale(e){return new he(this.x*e,this.y*e)}fscale(e){const t=Math.fround(e);return new he(Math.fround(this.floatX*t),Math.fround(this.floatY*t))}divide(e){return new he(this.x/e,this.y/e)}fdivide(e){const t=Math.fround(e);return new he(Math.fround(this.floatX/t),Math.fround(this.floatY/t))}dot(e){return this.x*e.x+this.y*e.y}fdot(e){return Math.fround(Math.fround(Math.fround(this.floatX*e.floatX)+Math.fround(this.floatY*e.floatY)))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}flength(){return Math.fround(Math.sqrt(Math.fround(Math.fround(this.floatX*this.floatX)+Math.fround(this.floatY*this.floatY))))}distance(e){const t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)}fdistance(e){const t=Math.fround(this.floatX-e.floatX),r=Math.fround(this.floatY-e.floatY);return Math.fround(Math.sqrt(Math.fround(Math.fround(t*t)+Math.fround(r*r))))}normalize(){const e=1/this.length();return new he(this.x*e,this.y*e)}fnormalize(){const e=Math.fround(1/this.flength());return new he(Math.fround(this.floatX*e),Math.fround(this.floatY*e))}equals(e){return this.x===e.x&&this.y===e.y}clone(){return new he(this.x,this.y)}toString(){return`${this.x},${this.y}`}}function Jr(n,e,t){return Math.max(e,Math.min(t,n))}function ur(n){return Jr(n,0,1)}function gh(n,e,t,r,i){return n<e?r:n>=t?i:(n-e)/(t-e)*(i-r)+r}function _h(n,e,t){return gh(n,e,t,0,1)}let De;(function(n){n[n.None=0]="None",n[n.Out=1]="Out",n[n.In=2]="In",n[n.InQuad=3]="InQuad",n[n.OutQuad=4]="OutQuad",n[n.InOutQuad=5]="InOutQuad",n[n.InCubic=6]="InCubic",n[n.OutCubic=7]="OutCubic",n[n.InOutCubic=8]="InOutCubic",n[n.InQuart=9]="InQuart",n[n.OutQuart=10]="OutQuart",n[n.InOutQuart=11]="InOutQuart",n[n.InQuint=12]="InQuint",n[n.OutQuint=13]="OutQuint",n[n.InOutQuint=14]="InOutQuint",n[n.InSine=15]="InSine",n[n.OutSine=16]="OutSine",n[n.InOutSine=17]="InOutSine",n[n.InExpo=18]="InExpo",n[n.OutExpo=19]="OutExpo",n[n.InOutExpo=20]="InOutExpo",n[n.InCirc=21]="InCirc",n[n.OutCirc=22]="OutCirc",n[n.InOutCirc=23]="InOutCirc",n[n.InElastic=24]="InElastic",n[n.OutElastic=25]="OutElastic",n[n.OutElasticHalf=26]="OutElasticHalf",n[n.OutElasticQuarter=27]="OutElasticQuarter",n[n.InOutElastic=28]="InOutElastic",n[n.InBack=29]="InBack",n[n.OutBack=30]="OutBack",n[n.InOutBack=31]="InOutBack",n[n.InBounce=32]="InBounce",n[n.OutBounce=33]="OutBounce",n[n.InOutBounce=34]="InOutBounce",n[n.OutPow10=35]="OutPow10"})(De||(De={}));const fn=2*Math.PI/.3,mn=.3/4,Wr=1.70158,ci=Wr*1.525,Ct=1/2.75,Ti=Math.pow(2,-10),au=Math.pow(2,-11),Dh=Math.pow(2,-10)*Math.sin((.5-mn)*fn),bh=Math.pow(2,-10)*Math.sin((.25-mn)*fn),$a=Math.pow(2,-10)*Math.sin((1-mn*1.5)*fn/1.5),Ee=n=>e=>n(ur(e)),yh=Ee(n=>n),Sh=Ee(n=>n*n),vh=Ee(n=>n*(2-n)),wh=Ee(n=>n<.5?n*n*2:--n*n*-2+1),Eh=Ee(n=>n*n*n),Ah=Ee(n=>--n*n*n+1),Fh=Ee(n=>n<.5?n*n*n*4:--n*n*n*4+1),Th=Ee(n=>n*n*n*n),Ph=Ee(n=>1- --n*n*n*n),Ch=Ee(n=>n<.5?n*n*n*n*8:--n*n*n*n*-8+1),Mh=Ee(n=>n*n*n*n*n),xh=Ee(n=>--n*n*n*n*n+1),Bh=Ee(n=>n<.5?n*n*n*n*n*16:--n*n*n*n*n*16+1),kh=Ee(n=>1-Math.cos(n*Math.PI*.5)),Rh=Ee(n=>Math.sin(n*Math.PI*.5)),Lh=Ee(n=>.5-.5*Math.cos(Math.PI*n)),Oh=Ee(n=>Math.pow(2,10*(n-1))+Ti*(n-1)),Ih=Ee(n=>-Math.pow(2,-10*n)+1+Ti*n),Nh=Ee(n=>n<.5?.5*(Math.pow(2,20*n-10)+Ti*(2*n-1)):1-.5*(Math.pow(2,-20*n+10)+Ti*(-2*n+1))),Gh=Ee(n=>1-Math.sqrt(1-n*n)),Hh=Ee(n=>Math.sqrt(1- --n*n)),jh=Ee(n=>(n*=2)<1?.5-.5*Math.sqrt(1-n*n):.5*Math.sqrt(1-(n-=2)*n)+.5),Vh=Ee(n=>-Math.pow(2,-10+10*n)*Math.sin((1-mn-n)*fn)+au*(1-n)),Wh=Ee(n=>Math.pow(2,-10*n)*Math.sin((n-mn)*fn)+1-au*n),zh=Ee(n=>Math.pow(2,-10*n)*Math.sin((.5*n-mn)*fn)+1-Dh*n),Uh=Ee(n=>Math.pow(2,-10*n)*Math.sin((.25*n-mn)*fn)+1-bh*n),Xh=Ee(n=>(n*=2)<1?-.5*(Math.pow(2,-10+10*n)*Math.sin((1-mn*1.5-n)*fn/1.5)-$a*(1-n)):.5*(Math.pow(2,-10*--n)*Math.sin((n-mn*1.5)*fn/1.5)-$a*n)+1),Kh=Ee(n=>n*n*((Wr+1)*n-Wr)),Yh=Ee(n=>--n*n*((Wr+1)*n+Wr)+1),qh=Ee(n=>(n*=2)<1?.5*n*n*((ci+1)*n-ci):.5*((n-=2)*n*((ci+1)*n+ci)+2)),Jh=Ee(n=>(n=1-n,n<Ct?1-7.5625*n*n:n<2*Ct?1-(7.5625*(n-=1.5*Ct)*n+.75):n<2.5*Ct?1-(7.5625*(n-=2.25*Ct)*n+.9375):1-(7.5625*(n-=2.625*Ct)*n+.984375))),bs=Ee(n=>n<Ct?7.5625*n*n:n<2*Ct?7.5625*(n-=1.5*Ct)*n+.75:n<2.5*Ct?7.5625*(n-=2.25*Ct)*n+.9375:7.5625*(n-=2.625*Ct)*n+.984375),Qh=Ee(n=>n<.5?.5-.5*bs(1-n*2):bs((n-.5)*2)*.5+.5),Zh=Ee(n=>--n*Math.pow(n,10)+1);function $h(n){switch(n){case De.In:case De.InQuad:return Sh;case De.Out:case De.OutQuad:return vh;case De.InOutQuad:return wh;case De.InCubic:return Eh;case De.OutCubic:return Ah;case De.InOutCubic:return Fh;case De.InQuart:return Th;case De.OutQuart:return Ph;case De.InOutQuart:return Ch;case De.InQuint:return Mh;case De.OutQuint:return xh;case De.InOutQuint:return Bh;case De.InSine:return kh;case De.OutSine:return Rh;case De.InOutSine:return Lh;case De.InExpo:return Oh;case De.OutExpo:return Ih;case De.InOutExpo:return Nh;case De.InCirc:return Gh;case De.OutCirc:return Hh;case De.InOutCirc:return jh;case De.InElastic:return Vh;case De.OutElastic:return Wh;case De.OutElasticHalf:return zh;case De.OutElasticQuarter:return Uh;case De.InOutElastic:return Xh;case De.InBack:return Kh;case De.OutBack:return Yh;case De.InOutBack:return qh;case De.InBounce:return Jh;case De.OutBounce:return bs;case De.InOutBounce:return Qh;case De.OutPow10:return Zh}return yh}class Us{type;parameter;easing;startTime;endTime;constructor(e){this.type=e?.type??Me.None,this.parameter=e?.parameter??on.None,this.easing=e?.easing??De.None,this.startTime=e?.startTime??0,this.endTime=e?.endTime??0,this.startValue=e?.startValue??null,this.endValue=e?.endValue??null}get duration(){return this.endTime-this.startTime}getProgress(e){const t=_h(e,this.startTime,this.endTime);return $h(this.easing)(t)}getValueAtProgress(e){const t=(s,o,u)=>o+s*(u-o),r=(s,o,u)=>o===u||s>=o&&s<u;if(typeof this.startValue=="number"){const s=this.startValue,o=this.endValue;return t(e,s,o)}if(this.startValue instanceof he){const s=this.startValue,o=this.endValue;return new he(t(e,s.floatX,o.floatX),t(e,s.floatY,o.floatY))}if(this.startValue instanceof En){const s=this.startValue,o=this.endValue;return new En(t(e,s.red,o.red),t(e,s.green,o.green),t(e,s.blue,o.blue),t(e,s.alpha,o.alpha))}const i=this.startTime+this.duration*e;if(typeof this.startValue=="boolean")return r(i,this.startTime,this.endTime);if(this.startValue instanceof gt){const s=this.startValue,o=this.endValue;return r(i,this.startTime,this.endTime)?s:o}return this.endValue}getValueAtTime(e){return this.getValueAtProgress(this.getProgress(e))}equals(e){return this.type===e.type&&this.startTime===e.startTime&&this.endTime===e.endTime&&this.startValue===e.startValue&&this.endValue===e.endValue&&this.easing===e.easing&&this.parameter===e.parameter}}class Xt{_commands=[];startTime=1/0;endTime=-1/0;[Symbol.iterator](){const e=this.commands;let t=-1;return{next:()=>({value:e[++t],done:!(t in e)})}}get commands(){return this._commands.sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}add(e,t,r,i,s,o,u){i<r&&([r,i]=[i,r],[s,o]=[o,s]),this._commands.push(new Us({type:e,easing:t,startTime:r,endTime:i,startValue:s,endValue:o,parameter:u})),r<this.startTime&&(this.startValue=s,this.startTime=r),i>this.endTime&&(this.endValue=o,this.endTime=i)}get hasCommands(){return this._commands.length>0}}class Xs{x=new Xt;y=new Xt;scale=new Xt;vectorScale=new Xt;rotation=new Xt;color=new Xt;alpha=new Xt;blendingParameters=new Xt;flipH=new Xt;flipV=new Xt;_timelines;constructor(){this._timelines=[this.x,this.y,this.scale,this.vectorScale,this.rotation,this.color,this.alpha,this.blendingParameters,this.flipH,this.flipV]}get timelines(){return this._timelines}get totalCommands(){return this._timelines.reduce((e,t)=>e+t.commands.length,0)}get commands(){return this._timelines.flatMap(e=>e.commands).sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}get commandsStartTime(){let e=1/0;for(let t=0;t<this._timelines.length;++t)e=Math.min(e,this._timelines[t].startTime);return e}get commandsEndTime(){let e=-1/0;for(let t=0;t<this._timelines.length;++t)e=Math.max(e,this._timelines[t].endTime);return e}get commandsDuration(){return this.commandsEndTime-this.commandsStartTime}get startTime(){return this.commandsStartTime}get endTime(){return this.commandsEndTime}get duration(){return this.endTime-this.startTime}get hasCommands(){for(let e=0;e<this._timelines.length;++e)if(this._timelines[e].hasCommands)return!0;return!1}}class ou extends Xs{type=fr.Loop;loopStartTime;loopCount;constructor(e,t){super(),this.loopStartTime=e||0,this.loopCount=t||0}get totalIterations(){return this.loopCount+1}get startTime(){return this.loopStartTime+this.commandsStartTime}get endTime(){return this.startTime+this.commandsDuration*this.totalIterations}unrollCommands(){const e=this.commands;if(e.length===0)return[];const{commandsDuration:t,totalIterations:r,loopStartTime:i}=this,s=new Array(r*e.length);for(let o=0;o<r;o++){const u=i+o*t;for(let l=0;l<e.length;l++){const c=o*e.length+l,h=e[l];s[c]=new Us({...h,startTime:h.startTime+u,endTime:h.endTime+u})}}return s}}class uu extends Xs{type=fr.Trigger;triggerName;triggerStartTime;triggerEndTime;groupNumber;constructor(e,t,r,i){super(),this.triggerName=e||"",this.triggerStartTime=t||0,this.triggerEndTime=r||0,this.groupNumber=i||0}unrollCommands(){const e=this.commands;if(e.length===0)return[];const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=new Us({...e[r],startTime:e[r].startTime+this.triggerStartTime,endTime:e[r].endTime+this.triggerStartTime});return t}}class Ks{origin;anchor;startTime=1/0;endTime=-1/0;filePath;commands=[];timelineGroup=new Xs;loops=[];triggers=[];startPosition;scale=new he(1,1);color=new En;rotation=0;flipX=!1;flipY=!1;isAdditive=!1;constructor(e,t,r,i){this.filePath=e??"",this.origin=t??dt.TopLeft,this.anchor=r??wt.TopLeft,this.startPosition=i??new he(0,0)}get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}get duration(){return this.endTime-this.startTime}get hasCommands(){return this.timelineGroup.hasCommands||this.loops.some(e=>e.hasCommands)||this.triggers.some(e=>e.hasCommands)}get isDrawable(){return this.color.alpha>=.01&&this.hasCommands}addLoop(e,t){const r=new ou(e,t);return this.loops.push(r),r}addTrigger(e,t,r,i){const s=new uu(e,t,r,i);return this.triggers.push(s),s}updateCommands(){const e=[...this.timelineGroup.commands,...this.loops.flatMap(t=>t.unrollCommands())];return this.commands=e.sort((t,r)=>t.startTime-r.startTime),this.commands}adjustTimesToCommands(){let e=this.startTime,t=this.endTime;for(const r of this.commands)e=Math.min(e,r.startTime),t=Math.max(t,r.endTime);this.startTime=e,this.endTime=t}resetValuesToCommands(){const e={};for(const t of this.commands)e[t.type]||(this.setValueFromCommand(t,0),e[t.type]=!0)}setValueFromCommand(e,t){const r=e.getValueAtProgress(t);switch(e.type){case Me.Movement:this.startPosition.x=r.x,this.startPosition.y=r.y;break;case Me.MovementX:this.startPosition.x=r;break;case Me.MovementY:this.startPosition.y=r;break;case Me.Fade:this.color.alpha=r;break;case Me.Scale:this.scale.x=r,this.scale.y=r;break;case Me.VectorScale:this.scale.x=r.x,this.scale.y=r.y;break;case Me.Rotation:this.rotation=r;break;case Me.Color:this.color.red=r.red,this.color.green=r.green,this.color.blue=r.blue;break}if(e.type===Me.Parameter)switch(e.parameter){case on.BlendingMode:this.isAdditive=r.rgbEquation===1;break;case on.HorizontalFlip:this.flipX=r;break;case on.VerticalFlip:this.flipY=r}}}class lu extends Ks{frameCount;frameDelay;loopType;constructor(e,t,r,i,s,o,u){super(e,t,r,i),this.frameCount=s??0,this.frameDelay=o??0,this.loopType=u??Vr.LoopForever}}class cu{startTime;volume;filePath;get isDrawable(){return!0}constructor(e,t,r){this.filePath=e??"",this.startTime=t??0,this.volume=r??100}}class hu{startTime;filePath;get isDrawable(){return!0}constructor(e,t){this.filePath=e??"",this.startTime=t??0}}class On{name;depth;masking;visibleWhenPassing=!0;visibleWhenFailing=!0;elements=[];constructor(e){this.name=e.name,this.depth=e.depth,this.masking=e.masking??!0}}class e0{variables=new Map;colors=new Ii;useSkinSprites=!1;minimumLayerDepth=0;fileFormat=14;_layers=new Map;constructor(){this.addLayer(new On({name:"Video",depth:4,masking:!1})),this.addLayer(new On({name:"Background",depth:3})),this.addLayer(new On({name:"Fail",depth:2,visibleWhenPassing:!1})),this.addLayer(new On({name:"Pass",depth:1,visibleWhenFailing:!1})),this.addLayer(new On({name:"Foreground",depth:0})),this.addLayer(new On({name:"Overlay",depth:-2147483648}))}get layers(){return this._layers}get hasDrawable(){for(const e of this.layers.values())if(e.elements.find(t=>t.isDrawable))return!0;return!1}get hasVariables(){for(const e in this.variables)return!0;return!1}get earliestEventTime(){let e=1/0;return this._layers.forEach(t=>{const i=t.elements.reduce((s,o)=>Math.min(s,o.startTime),0);e=Math.min(i,e)}),e===1/0?null:e}get latestEventTime(){let e=-1/0;return this._layers.forEach(t=>{const i=t.elements.reduce((s,o)=>Math.max(s,o?.endTime??o.startTime),0);e=Math.max(i,e)}),e===-1/0?null:e}addLayer(e){this._layers.has(e.name)||this._layers.set(e.name,e)}getLayerByType(e){return this.getLayerByName(Pt[e]??"Background")}getLayerByName(e){const t=this._layers.get(e)??new On({name:e,depth:--this.minimumLayerDepth});return this._layers.has(e)||this._layers.set(e,t),t}}class Ys{backgroundPath=null;breaks=[];storyboard=null;get isBackgroundReplaced(){if(!this.backgroundPath||!this.storyboard)return!1;const e=this.backgroundPath.trim().toLowerCase();return this.storyboard.getLayerByType(Pt.Background).elements.some(r=>r.filePath.toLowerCase()===e)}clone(){const e=new Ys;return e.backgroundPath=this.backgroundPath,e.breaks=this.breaks,e.storyboard=this.storyboard,e}}let Re;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Soft=2]="Soft",n[n.Drum=3]="Drum"})(Re||(Re={}));class qs{audioFilename="";audioHash;overlayPosition="NoChange";skinPreference="";audioLeadIn=0;previewTime=-1;countdown=1;stackLeniency=.7;countdownOffset=0;sampleSet=Re.Normal;letterboxInBreaks=!1;storyFireInFront;useSkinSprites=!1;alwaysShowPlayfield;epilepsyWarning=!1;specialStyle=!1;widescreenStoryboard=!1;samplesMatchPlaybackRate=!1;clone(){const e=new qs;return e.audioFilename=this.audioFilename,this.audioHash&&(e.audioHash=this.audioHash),e.overlayPosition=this.overlayPosition,e.skinPreference=this.skinPreference,e.audioLeadIn=this.audioLeadIn,e.previewTime=this.previewTime,e.countdown=this.countdown,e.stackLeniency=this.stackLeniency,e.countdownOffset=this.countdownOffset,e.sampleSet=this.sampleSet,e.letterboxInBreaks=this.letterboxInBreaks,this.storyFireInFront&&(e.storyFireInFront=this.storyFireInFront),e.useSkinSprites=this.useSkinSprites,this.alwaysShowPlayfield&&(e.alwaysShowPlayfield=this.alwaysShowPlayfield),e.epilepsyWarning=this.epilepsyWarning,e.specialStyle=this.specialStyle,e.widescreenStoryboard=this.widescreenStoryboard,e.samplesMatchPlaybackRate=this.samplesMatchPlaybackRate,e}}class Js{title="Unknown Title";artist="Unknown Artist";creator="Unknown Creator";version="Normal";source="";tags=[];beatmapId=0;beatmapSetId=0;_titleUnicode="Unknown Title";get titleUnicode(){return this._titleUnicode!=="Unknown Title"?this._titleUnicode:this.title}set titleUnicode(e){this._titleUnicode=e}_artistUnicode="Unknown Artist";get artistUnicode(){return this._artistUnicode!=="Unknown Artist"?this._artistUnicode:this.artist}set artistUnicode(e){this._artistUnicode=e}clone(){const e=new Js;return e.title=this.title,e.titleUnicode=this.titleUnicode,e.artist=this.artist,e.artistUnicode=this.artistUnicode,e.creator=this.creator,e.version=this.version,e.source=this.source,e.tags=this.tags.slice(),e.beatmapId=this.beatmapId,e.beatmapSetId=this.beatmapSetId,e}}class Ni{group;constructor(e){this.group=e||null}attachGroup(e){this.group=e}dettachGroup(){this.group=null}get startTime(){return this.group?this.group.startTime:0}}class t0{controlPoints=[];startTime;constructor(e){this.startTime=e}add(e){const t=this.controlPoints.find(r=>r.pointType===e.pointType);t&&this.remove(t),e.attachGroup(this),this.controlPoints.push(e)}remove(e){const t=this.controlPoints.findIndex(r=>r.pointType===e.pointType);t!==-1&&(this.controlPoints.splice(t,1),e.dettachGroup())}}function n0(n,e){let t=0,r,i=n.length-1;for(;t<=i;){if(r=t+(i-t>>1),n[r]===e)return r;n[r]<e?t=r+1:i=r-1}return~t}function du(n,e){if(!n.length||e<n[0].startTime)return-1;if(e>=n[n.length-1].startTime)return n.length-1;let t=0,r=n.length-2;for(;t<=r;){const i=t+(r-t>>1);if(n[i].startTime<e)t=i+1;else if(n[i].startTime>e)r=i-1;else return i}return t-1}function ir(n,e){const t=du(n,e);return t===-1?null:n[t]}function r0(n){const e=n.length,t=[];for(let r=0;r<e;r++){t[r]=1;for(let i=0;i<e;i++)r!==i&&(t[r]*=n[r].floatX-n[i].floatX);t[r]=1/t[r]}return t}function i0(n,e,t){if(n===null||n.length===0)throw new Error("points must contain at least one point");if(n.length!==e.length)throw new Error("points must contain exactly as many items as weights");let r=0,i=0;for(let s=0,o=n.length;s<o;++s){if(t===n[s].floatX)return n[s].floatY;const u=e[s]/(t-n[s].floatX);r+=u*n[s].floatY,i+=u}return r/i}class nn{static MAX_INT32=2147483647;static MAX_UINT32=4294967295;static INT_MASK=2147483647;static INT_TO_REAL=1/(nn.MAX_INT32+1);_y=842502087;_z=3579807591;_w=273326509;_x=0;_bitBuffer=0;_bitIndex=32;constructor(e){this._x=e}_next(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y>>>0,this._y=this._z>>>0,this._z=this._w>>>0,this._w=(this._w^this._w>>>19)>>>0,this._w=(this._w^e)>>>0,this._w=(this._w^e>>>8)>>>0,this._w}next(){return(nn.INT_MASK&this._next())>>0}nextUInt(e=0,t=nn.MAX_INT32){return e===0&&t===nn.MAX_INT32?this._next():e+this.nextDouble()*(t-e)>>>0}nextInt(e=0,t=nn.MAX_INT32){return e+this.nextDouble()*(t-e)>>0}nextDouble(){return nn.INT_TO_REAL*this.next()}nextBool(){return this._bitIndex===32?(this._bitBuffer=this.nextUInt(),this._bitIndex=1,(this._bitBuffer&1)===1):(this._bitIndex=this._bitIndex+1>>0,((this._bitBuffer>>=1)&1)===1)}}class qt{static PRECISION_ERROR=1e-15;static round(e,t=1){return t?this.roundToEven(e):this.roundAwayFromZero(e)}static roundToEven(e){return this.isAtMidPoint(e)?2*Math.round(e/2):Math.round(e)}static roundAwayFromZero(e){return this.isAtMidPoint(e)?e>0?Math.ceil(e):Math.floor(e):Math.round(e)}static isAtMidPoint(e){return Math.abs(.5-Math.abs(e-(e>>0)))<=this.PRECISION_ERROR}}class Pi{static _QUICK_SORT_DEPTH_THRESHOLD=32;static _INTRO_SORT_SIZE_THRESHOLD=16;static depthSort(e,t){return!e||e.length===0||(t??=this.defaultCompare,this._depthLimitedQuickSort(e,0,e.length-1,t,this._QUICK_SORT_DEPTH_THRESHOLD)),e}static introSort(e,t){return!e||e.length<2||(t??=this.defaultCompare,this._introSort(e,0,e.length-1,t,2*this._floorLog2(e.length))),e}static _depthLimitedQuickSort(e,t,r,i,s){do{if(s===0)return this._heapsort(e,t,r,i);let o=t,u=r;const l=o+(u-o>>1);this._swapIfGreater(e,i,o,l),this._swapIfGreater(e,i,o,u),this._swapIfGreater(e,i,l,u);const c=e[l];do{for(;i(e[o],c)<0;)o++;for(;i(c,e[u])<0;)u--;if(o>u)break;o<u&&([e[o],e[u]]=[e[u],e[o]]),o++,u--}while(o<=u);if(s--,u-t<=r-o){t<u&&this._depthLimitedQuickSort(e,t,u,i,s),t=o;continue}o<r&&this._depthLimitedQuickSort(e,o,r,i,s),r=u}while(t<r)}static _introSort(e,t,r,i,s){for(;r>t;){const o=r-t+1;if(o<=this._INTRO_SORT_SIZE_THRESHOLD){if(o===1)return;if(o===2){this._swapIfGreater(e,i,t,r);return}if(o===3){this._swapIfGreater(e,i,t,r-1),this._swapIfGreater(e,i,t,r),this._swapIfGreater(e,i,r-1,r);return}this._insertionSort(e,t,r,i);return}if(s===0){this._heapsort(e,t,r,i);return}s--;const u=this._pickPivotAndPartition(e,t,r,i);this._introSort(e,u+1,r,i,s),r=u-1}}static _insertionSort(e,t,r,i){for(let s=t;s<r;++s){let o=s;const u=e[s+1];for(;o>=t&&i(u,e[o])<0;)e[o+1]=e[o],o--;e[o+1]=u}}static _pickPivotAndPartition(e,t,r,i){const s=t+(r-t)/2>>0;this._swapIfGreater(e,i,t,s),this._swapIfGreater(e,i,t,r),this._swapIfGreater(e,i,s,r);const o=e[s];this._swap(e,s,r-1);let u=t,l=r-1;for(;u<l;){for(;i(e[++u],o)<0;);for(;i(o,e[--l])<0;);if(u>=l)break;this._swap(e,u,l)}return this._swap(e,u,r-1),u}static _heapsort(e,t,r,i){const s=r-t+1;for(let o=s/2;o>=1;--o)this._downHeap(e,o,s,t,i);for(let o=s;o>1;--o)this._swap(e,t,t+o-1),this._downHeap(e,1,o-1,t,i)}static _downHeap(e,t,r,i,s){const o=e[i+t-1];for(;t<=r/2;){let u=2*t;if(u<r&&s(e[i+u-1],e[i+u])<0&&u++,s(o,e[i+u-1])>=0)break;e[i+t-1]=e[i+u-1],t=u}e[i+t-1]=o}static _swap(e,t,r){t!==r&&([e[t],e[r]]=[e[r],e[t]])}static _swapIfGreater(e,t,r,i){r!==i&&t(e[r],e[i])>0&&([e[r],e[i]]=[e[i],e[r]])}static _floorLog2(e){let t=0;for(;e>=1;)t++,e/=2;return t}static defaultCompare=(e,t)=>{if(e===void 0&&t===void 0)return 0;if(e===void 0)return 1;if(t===void 0)return-1;const r=Pi.toString(e),i=Pi.toString(t);return r<i?-1:r>i?1:0};static toString=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw new TypeError;return JSON.stringify(e)}}let Qe;(function(n){n[n.TimingPoint=0]="TimingPoint",n[n.DifficultyPoint=1]="DifficultyPoint",n[n.EffectPoint=2]="EffectPoint",n[n.SamplePoint=3]="SamplePoint"})(Qe||(Qe={}));class cr extends Ni{static default=new cr;pointType=Qe.DifficultyPoint;generateTicks=!0;isLegacy=!1;sliderVelocityUnlimited=1;get sliderVelocity(){return Jr(this.sliderVelocityUnlimited,.1,10)}set sliderVelocity(e){this.sliderVelocityUnlimited=e}bpmMultiplier=1;isRedundant(e){return e instanceof cr&&e.sliderVelocity===this.sliderVelocity&&e.generateTicks===this.generateTicks}equals(e){return e instanceof cr&&this.sliderVelocity===e.sliderVelocity}}class hr extends Ni{static default=new hr;pointType=Qe.EffectPoint;kiai=!1;omitFirstBarLine=!1;scrollSpeedUnlimited=1;get scrollSpeed(){return Jr(this.scrollSpeedUnlimited,.1,10)}set scrollSpeed(e){this.scrollSpeedUnlimited=e}isRedundant(e){return!this.omitFirstBarLine&&e instanceof hr&&this.kiai===e.kiai&&this.omitFirstBarLine===e.omitFirstBarLine&&this.scrollSpeed===e.scrollSpeed}equals(e){return e instanceof hr&&this.kiai===e.kiai&&this.omitFirstBarLine===e.omitFirstBarLine&&this.scrollSpeed===e.scrollSpeed}}class dr extends Ni{static default=new dr;pointType=Qe.SamplePoint;sampleSet=Re[Re.Normal];customIndex=0;volume=100;isRedundant(e){return e instanceof dr&&this.volume===e.volume&&this.customIndex===e.customIndex&&this.sampleSet===e.sampleSet}equals(e){return e instanceof dr&&this.volume===e.volume&&this.customIndex===e.customIndex&&this.sampleSet===e.sampleSet}}let zr;(function(n){n[n.SimpleTriple=3]="SimpleTriple",n[n.SimpleQuadruple=4]="SimpleQuadruple"})(zr||(zr={}));class un extends Ni{static default=new un;static DEFAULT_BEAT_LENGTH=1e3;pointType=Qe.TimingPoint;beatLengthUnlimited=un.DEFAULT_BEAT_LENGTH;get beatLength(){return Jr(this.beatLengthUnlimited,6,6e4)}set beatLength(e){this.beatLengthUnlimited=e}timeSignature=zr.SimpleQuadruple;get bpmUnlimited(){return 6e4/this.beatLengthUnlimited}get bpm(){return 6e4/this.beatLength}isRedundant(){return!1}equals(e){return e instanceof un&&this.timeSignature===e.timeSignature&&this.beatLength===e.beatLength}}class Qs{groups=[];difficultyPoints=[];effectPoints=[];samplePoints=[];timingPoints=[];get allPoints(){const e=[];return this.groups.forEach(t=>e.push(...t.controlPoints)),e}groupAt(e){let t=this.groups.find(r=>r.startTime===e);return t||(t=new t0(e),this.groups.push(t),this.groups.sort((r,i)=>r.startTime-i.startTime)),t}difficultyPointAt(e){const t=ir(this.difficultyPoints,e),r=cr.default;return t||r}effectPointAt(e){const t=ir(this.effectPoints,e),r=hr.default;return t||r}samplePointAt(e){const t=ir(this.samplePoints,e),r=dr.default;return t||r}timingPointAt(e){const t=ir(this.timingPoints,e),r=this.timingPoints[0]||un.default;return t||r}add(e,t){if(this.checkAlreadyExisting(t,e))return!1;const r=this.getCurrentList(e),i=du(r,t);return r.splice(i+1,0,e),this.groupAt(t).add(e),!0}getCurrentList(e){switch(e.pointType){case Qe.DifficultyPoint:return this.difficultyPoints;case Qe.EffectPoint:return this.effectPoints;case Qe.SamplePoint:return this.samplePoints;case Qe.TimingPoint:return this.timingPoints}throw new TypeError(`Unknown control point type: ${e.pointType}!`)}checkAlreadyExisting(e,t){let r=null;switch(t.pointType){case Qe.DifficultyPoint:r=this.difficultyPointAt(e);break;case Qe.EffectPoint:r=this.effectPointAt(e);break;case Qe.SamplePoint:r=ir(this.samplePoints,e);break;case Qe.TimingPoint:r=ir(this.timingPoints,e)}return t?.isRedundant(r)}remove(e,t){let r;switch(e.pointType){case Qe.DifficultyPoint:r=this.difficultyPoints;break;case Qe.EffectPoint:r=this.effectPoints;break;case Qe.SamplePoint:r=this.samplePoints;break;default:r=this.timingPoints}const i=r.findIndex(s=>s.startTime===e.startTime);return i===-1?!1:(r.splice(i,1),this.groupAt(t).remove(e),!0)}clear(){this.groups.length=0,this.difficultyPoints.length=0,this.effectPoints.length=0,this.samplePoints.length=0,this.timingPoints.length=0}clone(){const e=new Qs;return e.groups=this.groups,e.difficultyPoints=this.difficultyPoints,e.effectPoints=this.effectPoints,e.samplePoints=this.samplePoints,e.timingPoints=this.timingPoints,e}}let ce;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Whistle=2]="Whistle",n[n.Finish=4]="Finish",n[n.Clap=8]="Clap"})(ce||(ce={}));let fe;(function(n){n[n.Normal=1]="Normal",n[n.Slider=2]="Slider",n[n.NewCombo=4]="NewCombo",n[n.Spinner=8]="Spinner",n[n.ComboSkip1=16]="ComboSkip1",n[n.ComboSkip2=32]="ComboSkip2",n[n.ComboSkip3=64]="ComboSkip3",n[n.ComboOffset=112]="ComboOffset",n[n.Hold=128]="Hold"})(fe||(fe={}));let ft;(function(n){n.Catmull="C",n.Bezier="B",n.Linear="L",n.PerfectCurve="P"})(ft||(ft={}));let Hn;(function(n){n[n.Tick=1]="Tick",n[n.LegacyLastTick=2]="LegacyLastTick",n[n.Head=4]="Head",n[n.Tail=8]="Tail",n[n.Repeat=16]="Repeat"})(Hn||(Hn={}));class s0{static SLIDER_MAX_DISTANCE=1e5;static*generate(e){const t=Math.min(this.SLIDER_MAX_DISTANCE,e.path.distance),r=Jr(e.tickDistance||0,0,t),i=e.velocity*10;let s=e.startTime;if(yield{eventType:Hn.Head,startTime:s,spanStartTime:s,spanIndex:0,progress:0},r!==0&&r!==1/0)for(let d=0;d<e.spans;++d){const m=!!(d&1),D=[];let p=r;for(;p<t-i;){const v=p/t,F=m?1-v:v;D.push({eventType:Hn.Tick,startTime:s+F*e.spanDuration,spanStartTime:s,spanIndex:d,progress:v}),p+=r}m&&D.reverse();for(const v of D)yield v;d<e.repeats&&(yield{eventType:Hn.Repeat,startTime:s+e.spanDuration,spanStartTime:s,spanIndex:d,progress:d+1&1}),s+=e.spanDuration}const o=e.spans*e.spanDuration,u=e.spans-1,l=e.startTime+u*e.spanDuration,c=Math.max(e.startTime+o/2,l+e.spanDuration-(e.legacyLastTickOffset||0));let h=(c-l)/e.spanDuration;(e.spans&1)===0&&(h=1-h),yield{eventType:Hn.LegacyLastTick,startTime:c,spanStartTime:l,spanIndex:u,progress:h},yield{eventType:Hn.Tail,startTime:e.startTime+o,spanStartTime:l,spanIndex:u,progress:e.spans%2}}}class $t{result;min;average;max;constructor(e,t,r,i){this.result=e,this.min=t,this.average=r,this.max=i}static map(e,t,r,i){return e>5?r+(i-r)*(e-5)/5:e<5?r-(r-t)*(5-e)/5:r}}let R;(function(n){n[n.None=0]="None",n[n.Miss=1]="Miss",n[n.Meh=2]="Meh",n[n.Ok=3]="Ok",n[n.Good=4]="Good",n[n.Great=5]="Great",n[n.Perfect=6]="Perfect",n[n.SmallTickMiss=7]="SmallTickMiss",n[n.SmallTickHit=8]="SmallTickHit",n[n.LargeTickMiss=9]="LargeTickMiss",n[n.LargeTickHit=10]="LargeTickHit",n[n.SmallBonus=11]="SmallBonus",n[n.LargeBonus=12]="LargeBonus",n[n.IgnoreMiss=13]="IgnoreMiss",n[n.IgnoreHit=14]="IgnoreHit",n[n.ComboBreak=15]="ComboBreak",n[n.SliderTailHit=16]="SliderTailHit",n[n.LegacyComboIncrease=17]="LegacyComboIncrease"})(R||(R={}));class Lr{static _BASE_RANGES=[new $t(R.Perfect,22.4,19.4,13.9),new $t(R.Great,64,49,34),new $t(R.Good,97,82,67),new $t(R.Ok,127,112,97),new $t(R.Meh,151,136,121),new $t(R.Miss,188,173,158)];_perfect=0;_great=0;_good=0;_ok=0;_meh=0;_miss=0;_lowestSuccessfulHitResult(){for(let e=R.Meh;e<=R.Perfect;++e)if(this.isHitResultAllowed(e))return e;return R.None}*getAllAvailableWindows(){for(let e=R.Meh;e<=R.Perfect;++e)this.isHitResultAllowed(e)&&(yield[e,this.windowFor(e)])}isHitResultAllowed(e){return!0}setDifficulty(e){for(const t of this._getRanges()){const r=$t.map(e,t.min,t.average,t.max);switch(t.result){case R.Miss:this._miss=r;break;case R.Meh:this._meh=r;break;case R.Ok:this._ok=r;break;case R.Good:this._good=r;break;case R.Great:this._great=r;break;case R.Perfect:this._perfect=r;break}}}resultFor(e){e=Math.abs(e);for(let t=R.Perfect;t>=R.Miss;--t)if(this.isHitResultAllowed(t)&&e<=this.windowFor(t))return t;return R.None}windowFor(e){switch(e){case R.Perfect:return this._perfect;case R.Great:return this._great;case R.Good:return this._good;case R.Ok:return this._ok;case R.Meh:return this._meh;case R.Miss:return this._miss;default:throw new Error("Unknown enum member")}}canBeHit(e){return e<=this.windowFor(this._lowestSuccessfulHitResult())}_getRanges(){return Lr._BASE_RANGES}static EmptyHitWindows=class fu extends Lr{static _ranges=[new $t(R.Perfect,0,0,0),new $t(R.Miss,0,0,0)];isHitResultAllowed(t){switch(t){case R.Perfect:case R.Miss:return!0}return!1}_getRanges(){return fu._ranges}};static empty=new Lr.EmptyHitWindows}class Qr{kiai=!1;nestedHitObjects=[];startTime=0;hitType=fe.Normal;hitSound=ce.Normal;samples=[];startPosition=new he(0,0);hitWindows=new Lr;get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}createNestedHitObjects(){this.nestedHitObjects=[]}applyDefaultsToSelf(e,t){this.kiai=e.effectPointAt(this.startTime+1).kiai,this.hitWindows?.setDifficulty(t.overallDifficulty)}applyDefaultsToNested(e,t){this.nestedHitObjects.forEach(r=>{r.applyDefaults(e,t)})}applyDefaults(e,t){this.applyDefaultsToSelf(e,t),this.nestedHitObjects=[],this.createNestedHitObjects(),this.nestedHitObjects.sort((r,i)=>r.startTime-i.startTime),this.applyDefaultsToNested(e,t)}clone(){const e=this.constructor,t=new e;return t.startPosition=this.startPosition.clone(),t.startTime=this.startTime,t.hitType=this.hitType,t.hitSound=this.hitSound,t.samples=this.samples.map(r=>r.clone()),t.kiai=this.kiai,t}}class yt{static BEZIER_TOLERANCE=Math.fround(.25);static CIRCULAR_ARC_TOLERANCE=Math.fround(.1);static CATMULL_DETAIL=50;static approximateBezier(e){return this.approximateBSpline(e)}static approximateBSpline(e,t=0){const r=[],i=e.length-1;if(i<0)return r;const s=[],o=[],u=e.slice();if(t>0&&t<i){for(let d=0;d<i-t;++d){const m=[u[d]];for(let D=0;D<t-1;++D){m[D+1]=u[d+1];for(let p=1;p<t-D;++p){const v=Math.min(p,i-t-d);u[d+p]=u[d+p].fscale(v).fadd(u[d+p+1]).fdivide(v+1)}}m[t]=u[d+1],s.push(m)}s.push(u.slice(i-t)),s.reverse()}else t=i,s.push(u);const l=[],c=[],h=c;for(;s.length>0;){const d=s.pop()||[];if(this._bezierIsFlatEnough(d)){this._bezierApproximate(d,r,l,c,t+1),o.push(d);continue}const m=o.pop()||[];this._bezierSubdivide(d,h,m,l,t+1);for(let D=0;D<t+1;++D)d[D]=h[D];s.push(m),s.push(d)}return r.push(e[i]),r}static approximateCatmull(e){const t=[],r=e.length;for(let i=0;i<r-1;i++){const s=i>0?e[i-1]:e[i],o=e[i],u=i<r-1?e[i+1]:o.fadd(o).fsubtract(s),l=i<r-2?e[i+2]:u.fadd(u).fsubtract(o);for(let c=0;c<yt.CATMULL_DETAIL;c++)t.push(yt._catmullFindPoint(s,o,u,l,Math.fround(Math.fround(c)/yt.CATMULL_DETAIL))),t.push(yt._catmullFindPoint(s,o,u,l,Math.fround(Math.fround(c+1)/yt.CATMULL_DETAIL)))}return t}static approximateCircularArc(e){const t=this._circularArcProperties(e);if(!t.isValid)return this.approximateBezier(e);let r=2;if(2*t.radius>yt.CIRCULAR_ARC_TOLERANCE){let s=Math.fround(yt.CIRCULAR_ARC_TOLERANCE/t.radius);s=Math.fround(1-s),s=Math.fround(2*Math.fround(Math.acos(s)));const o=Math.ceil(Math.fround(t.thetaRange/s)),u=isFinite(o)?o:-2147483648;r=Math.max(2,u)}const i=[];for(let s=0;s<r;++s){const o=s/(r-1),u=t.thetaStart+t.direction*o*t.thetaRange,l=new he(Math.fround(Math.cos(u)),Math.fround(Math.sin(u)));i.push(l.fscale(t.radius).fadd(t.centre))}return i}static _circularArcProperties(e){const t=e[0],r=e[1],i=e[2],s=Math.fround(Math.fround(r.floatY-t.floatY)*Math.fround(i.floatX-t.floatX)-Math.fround(r.floatX-t.floatX)*Math.fround(i.floatY-t.floatY));if(Math.abs(s)<Math.fround(.001))return new eo;const o=Math.fround(2*Math.fround(Math.fround(t.floatX*r.fsubtract(i).floatY)+Math.fround(r.floatX*i.fsubtract(t).floatY)+Math.fround(i.floatX*t.fsubtract(r).floatY))),u=Math.fround(Math.fround(t.floatX*t.floatX)+Math.fround(t.floatY*t.floatY)),l=Math.fround(Math.fround(r.floatX*r.floatX)+Math.fround(r.floatY*r.floatY)),c=Math.fround(Math.fround(i.floatX*i.floatX)+Math.fround(i.floatY*i.floatY)),h=new he(Math.fround(Math.fround(Math.fround(u*r.fsubtract(i).floatY)+Math.fround(l*i.fsubtract(t).floatY))+Math.fround(c*t.fsubtract(r).floatY)),Math.fround(Math.fround(Math.fround(u*i.fsubtract(r).floatX)+Math.fround(l*t.fsubtract(i).floatX))+Math.fround(c*r.fsubtract(t).floatX))).fdivide(o),d=t.fsubtract(h),m=i.fsubtract(h),D=d.flength(),p=Math.atan2(d.floatY,d.floatX);let v=Math.atan2(m.floatY,m.floatX);for(;v<p;)v+=2*Math.PI;let F=1,S=v-p,C=i.fsubtract(t);return C=new he(C.floatY,-C.floatX),C.fdot(r.fsubtract(t))<0&&(F=-F,S=2*Math.PI-S),new eo(p,S,F,D,h)}static approximateLinear(e){return e.slice()}static approximateLagrangePolynomial(e){const r=[],i=r0(e);let s=e[0].floatX,o=e[0].floatX;for(let l=1,c=e.length;l<c;l++)s=Math.min(s,e[l].floatX),o=Math.max(o,e[l].floatX);const u=o-s;for(let l=0;l<51;l++){const c=s+u/50*l,h=Math.fround(i0(e,i,c));r.push(new he(c,h))}return r}static _bezierIsFlatEnough(e){let t;for(let r=1,i=e.length;r<i-1;r++)if(t=e[r-1].fsubtract(e[r].fscale(2)).fadd(e[r+1]),t.flength()**2>yt.BEZIER_TOLERANCE**2*4)return!1;return!0}static _bezierSubdivide(e,t,r,i,s){const o=i;for(let u=0;u<s;++u)o[u]=e[u];for(let u=0;u<s;++u){t[u]=o[0],r[s-u-1]=o[s-u-1];for(let l=0;l<s-u-1;l++)o[l]=o[l].fadd(o[l+1]).fdivide(2)}}static _bezierApproximate(e,t,r,i,s){const o=i,u=r;yt._bezierSubdivide(e,o,u,r,s);for(let l=0;l<s-1;++l)o[s+l]=u[l+1];t.push(e[0]);for(let l=1;l<s-1;++l){const c=2*l,h=o[c-1].fadd(o[c].fscale(2)).fadd(o[c+1]).fscale(Math.fround(.25));t.push(h)}}static _catmullFindPoint(e,t,r,i,s){const o=Math.fround(s*s),u=Math.fround(s*o),l=[];for(let c=0;c<=1;++c){const h=c===0?e.floatX:e.floatY,d=c===0?t.floatX:t.floatY,m=c===0?r.floatX:r.floatY,D=c===0?i.floatX:i.floatY,p=Math.fround(2*d),v=Math.fround(m-h),F=Math.fround(2*h),S=Math.fround(5*d),C=Math.fround(4*m),B=Math.fround(3*d),x=Math.fround(3*m),j=Math.fround(v*s),W=Math.fround(F-S),Z=Math.fround(W+C),J=Math.fround(Z-D),K=Math.fround(J),ae=Math.fround(B-h),le=Math.fround(ae-x),_=Math.fround(le+D),T=Math.fround(K*o),A=Math.fround(_*u),y=Math.fround(p+j),O=Math.fround(y+T),I=Math.fround(O+A);l.push(Math.fround(Math.fround(.5)*I))}return new he(l[0],l[1])}}class eo{isValid;thetaStart;thetaRange;direction;radius;centre;constructor(e,t,r,i,s){this.isValid=!!(e||t||r||i||s),this.thetaStart=e||0,this.thetaRange=t||0,this.direction=r||0,this.radius=i?Math.fround(i):0,this.centre=s||new he(0,0)}get thetaEnd(){return this.thetaStart+this.thetaRange*this.direction}}class ys{position;type;constructor(e,t){this.position=e||new he(0,0),this.type=t||null}}class Zs{_expectedDistance;_controlPoints;_curveType;_calculatedLength=0;_calculatedPath=[];_cumulativeLength=[];_isCached=!1;constructor(e,t,r){this._curveType=e||ft.Linear,this._controlPoints=t||[],this._expectedDistance=r||0}get curveType(){return this._curveType}set curveType(e){this._curveType=e,this.invalidate()}get controlPoints(){return this._controlPoints}set controlPoints(e){this._controlPoints=e,this.invalidate()}get expectedDistance(){return this._expectedDistance}set expectedDistance(e){this._expectedDistance=e,this.invalidate()}get distance(){return this._ensureValid(),this._cumulativeLength.length?this._cumulativeLength[this._cumulativeLength.length-1]:0}set distance(e){this.expectedDistance=e}get calculatedDistance(){return this._ensureValid(),this._calculatedLength}get path(){this._ensureValid();const e=[];for(let t=0;t<this._calculatedPath.length&&!(this._cumulativeLength[t]>=this.expectedDistance);t++)e.push(this._calculatedPath[t]);return e.push(this.positionAt(1)),e}get calculatedPath(){return this._ensureValid(),this._calculatedPath}invalidate(){this._calculatedLength=0,this._calculatedPath=[],this._cumulativeLength=[],this._isCached=!1}calculatePathToProgress(e,t,r){this._ensureValid();const i=this._progressToDistance(t),s=this._progressToDistance(r);let o=0;for(;o<this._calculatedPath.length&&this._cumulativeLength[o]<i;)++o;for(e=[this._interpolateVertices(o,i)];o<this._calculatedPath.length&&this._cumulativeLength[o++]<=s;)e.push(this._calculatedPath[o]);e.push(this._interpolateVertices(o,s))}progressAt(e,t){const r=e*t%1;return Math.trunc(e*t)%2?1-r:r}positionAt(e){this._ensureValid();const t=this._progressToDistance(e);return this._interpolateVertices(this._indexOfDistance(t),t)}curvePositionAt(e,t){return this.positionAt(this.progressAt(e,t))}clone(){const e=this._controlPoints.map(t=>new ys(t.position.clone(),t.type));return new Zs(this._curveType,e,this._expectedDistance)}_ensureValid(){this._isCached||(this._calculatePath(),this._calculateLength(),this._isCached=!0)}_calculatePath(){this._calculatedPath=[];const e=this.controlPoints.length;if(e===0)return;const t=[];for(let i=0;i<e;i++)t[i]=this.controlPoints[i].position;let r=0;for(let i=0;i<e;++i){if(!this.controlPoints[i].type&&i<e-1)continue;const s=t.slice(r,i+1),o=this.controlPoints[r].type||ft.Linear;for(const u of this._calculateSubPath(s,o)){const l=this._calculatedPath[this._calculatedPath.length-1];(this._calculatedPath.length===0||!l.equals(u))&&this._calculatedPath.push(u)}r=i}}_calculateSubPath(e,t){switch(t){case ft.Linear:return yt.approximateLinear(e);case ft.PerfectCurve:{if(e.length!==3)break;const r=yt.approximateCircularArc(e);if(r.length===0)break;return r}case ft.Catmull:return yt.approximateCatmull(e)}return yt.approximateBezier(e)}_calculateLength(){this._calculatedLength=0,this._cumulativeLength=[0];for(let e=0,t=this._calculatedPath.length-1;e<t;++e){const r=this._calculatedPath[e+1].fsubtract(this._calculatedPath[e]);this._calculatedLength+=r.flength(),this._cumulativeLength.push(this._calculatedLength)}if(this.expectedDistance&&this._calculatedLength!==this.expectedDistance){const e=this.controlPoints,t=e[e.length-1],r=e[e.length-2];if(e.length>=2&&t.position.equals(r.position)&&this.expectedDistance>this._calculatedLength){this._cumulativeLength.push(this._calculatedLength);return}this._cumulativeLength.pop();let s=this._calculatedPath.length-1;if(this._calculatedLength>this.expectedDistance)for(;this._cumulativeLength.length>0&&this._cumulativeLength[this._cumulativeLength.length-1]>=this.expectedDistance;)this._cumulativeLength.pop(),this._calculatedPath.splice(s--,1);if(s<=0){this._cumulativeLength.push(0);return}const o=this._calculatedPath[s].fsubtract(this._calculatedPath[s-1]).fnormalize(),u=Math.fround(this.expectedDistance-this._cumulativeLength[this._cumulativeLength.length-1]);this._calculatedPath[s]=this._calculatedPath[s-1].fadd(o.fscale(u)),this._cumulativeLength.push(this.expectedDistance)}}_indexOfDistance(e){let t=n0(this._cumulativeLength,e);return t<0&&(t=~t),t}_progressToDistance(e){return ur(e)*this.distance}_interpolateVertices(e,t){if(this._calculatedPath.length===0)return new he(0,0);if(e<=0)return this._calculatedPath[0];if(e>=this._calculatedPath.length)return this._calculatedPath[this._calculatedPath.length-1];const r=this._calculatedPath[e-1],i=this._calculatedPath[e],s=this._cumulativeLength[e-1],o=this._cumulativeLength[e];if(Math.abs(s-o)<.001)return r;const u=(t-s)/(o-s);return r.fadd(i.fsubtract(r).fscale(u))}}class jn{sampleSet=Re[Re.None];hitSound=ce[ce.Normal];customIndex=0;suffix="";volume=100;isLayered=!1;filename="";clone(){const e=new jn;return e.sampleSet=this.sampleSet,e.hitSound=this.hitSound,e.customIndex=this.customIndex,e.suffix=this.suffix,e.volume=this.volume,e.isLayered=this.isLayered,e.filename=this.filename,e}}class $s{filename="";volume=100;normalSet=Re.Normal;additionSet=Re.Normal;customIndex=0;clone(){const e=new $s;return e.filename=this.filename,e.volume=this.volume,e.normalSet=this.normalSet,e.additionSet=this.additionSet,e.customIndex=this.customIndex,e}}class mu{base;general=new qs;editor=new zs;difficulty=new or;metadata=new Js;colors=new Ii;events=new Ys;controlPoints=new Qs;hitObjects=[];fileFormat=14;fileUpdateDate=new Date;originalMode=0;get mode(){return this.originalMode}get length(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[0],t=this.hitObjects[this.hitObjects.length-1],r=t,i=e.startTime;return((r.endTime||t.startTime)-i)/this.difficulty.clockRate}get totalLength(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[this.hitObjects.length-1];return(e.endTime||e.startTime)/this.difficulty.clockRate}_getLongestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((r,i)=>{const s=e?i.beatLengthUnlimited:i.beatLength;return s>=0?Math.max(s,r):r},-1/0);return isFinite(t)?t:un.DEFAULT_BEAT_LENGTH}get bpmMin(){return 6e4/this._getLongestBeatLength(!1)*this.difficulty.clockRate}get bpmMinUnlimited(){return 6e4/this._getLongestBeatLength(!0)*this.difficulty.clockRate}_getShortestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((r,i)=>{const s=e?i.beatLengthUnlimited:i.beatLength;return s>=0?Math.min(s,r):r},1/0);return isFinite(t)?t:un.DEFAULT_BEAT_LENGTH}get bpmMax(){return 6e4/this._getShortestBeatLength(!1)*this.difficulty.clockRate}get bpmMaxUnlimited(){return 6e4/this._getShortestBeatLength(!0)*this.difficulty.clockRate}_getMostCommonBeatLength(e){if(!this.controlPoints.timingPoints.length)return un.DEFAULT_BEAT_LENGTH;const t=this.controlPoints.timingPoints,r=this.hitObjects.at(-1),i=r?.endTime??r?.startTime??t.at(-1)?.startTime??0,s=new Map;return t.forEach((o,u)=>{const l=e?o.beatLengthUnlimited:o.beatLength,c=qt.round(l*1e3)/1e3;if(s.has(c)||s.set(c,0),o.startTime>i)return;const h=u===0?0:o.startTime,d=u===t.length-1?i:t[u+1].startTime,m=s.get(c)??0;s.set(c,m+(d-h))}),s.size===0?this.bpmMax:[...s.entries()].sort((o,u)=>u[1]-o[1])[0][0]}get bpm(){return 6e4/this._getMostCommonBeatLength(!1)*this.difficulty.clockRate}get bpmUnlimited(){return 6e4/this._getMostCommonBeatLength(!0)*this.difficulty.clockRate}get totalBreakTime(){return(this.events.breaks||[]).reduce((e,t)=>e+t.duration,0)}get hittable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&fe.Normal?1:0),0)}get slidable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&fe.Slider?1:0),0)}get spinnable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&fe.Spinner?1:0),0)}get holdable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&fe.Hold?1:0),0)}clone(){const e=this.constructor,t=new e;return t.general=this.general.clone(),t.editor=this.editor.clone(),t.difficulty=this.difficulty.clone(),t.metadata=this.metadata.clone(),t.colors=this.colors.clone(),t.events=this.events.clone(),t.controlPoints=this.controlPoints.clone(),t.hitObjects=this.hitObjects.map(r=>r.clone()),t.originalMode=this.originalMode,t.fileFormat=this.fileFormat,this.base&&(t.base=this.base),t}}class a0{convertBeatmap(e){const t=this.createBeatmap();t.general=e.general,t.editor=e.editor,t.difficulty=e.difficulty.clone(),t.metadata=e.metadata,t.colors=e.colors,t.events=e.events,t.controlPoints=e.controlPoints,t.fileFormat=e.fileFormat,t.originalMode=e.originalMode,t.base=e.base??e;for(const r of this.convertHitObjects(t.base))t.hitObjects.push(r);return t.hitObjects.sort((r,i)=>r.startTime-i.startTime),t}}class ea{id=0;beatmapsetId=0;creatorId=0;creator="";favourites=0;passcount=0;playcount=0;status=-2;title="Unknown title";artist="Unknown artist";version="Normal";hittable=0;slidable=0;spinnable=0;holdable=0;length=0;bpmMin=0;bpmMax=0;bpm=0;circleSize=0;approachRate=0;overallDifficulty=0;drainRate=0;_ruleset=null;get ruleset(){return this._ruleset}set ruleset(e){this._ruleset=e,this._mods=this.ruleset?.createModCombination(this.rawMods)??null}_rulesetId=0;get rulesetId(){return this.ruleset?.id??this._rulesetId}set rulesetId(e){this._rulesetId=e}_mods=null;get mods(){return this._mods}set mods(e){this._mods=e,this._rawMods=e?.bitwise??0}_rawMods=0;get rawMods(){return this._rawMods}set rawMods(e){this._rawMods!==e&&(this._rawMods=e,this._mods=this.ruleset?.createModCombination(e)??null)}starRating=0;maxCombo=0;isConvert=!1;deletedAt=null;updatedAt=null;hashMD5="";constructor(e={}){Object.assign(this,e)}get totalHits(){return this.hittable+this.slidable+this.spinnable+this.holdable}clone(){const e=this.constructor,t=new e;return Object.assign(t,this),t}equals(e){return e&&this.id!==0&&e.id!==0?this.id===e.id:!1}toJSON(){const e={},t=["ruleset","rawMods","mods"];for(const r in this)r.startsWith("_")||t.includes(r)||(e[r]=this[r]);return{...e,mods:this.mods?.toString()??"NM",rulesetId:this.rulesetId,totalHits:this.totalHits,deletedAt:this.deletedAt?this.deletedAt.getTime()/1e3:null,updatedAt:this.updatedAt?this.updatedAt.getTime()/1e3:null}}static fromJSON(e){return new ea({...e,deletedAt:e.deletedAt?new Date(e.deletedAt*1e3):null,updatedAt:e.updatedAt?new Date(e.updatedAt*1e3):null,rawMods:e.mods})}}class o0{preProcess(e){const r=e.hitObjects.filter(s=>{const o=s;if(typeof o.comboIndex=="number")return o});let i=null;for(let s=0;s<r.length;s++){const o=r[s];s===0&&(r[s].hitType|=fe.NewCombo,r[s].isNewCombo=!0),o.comboIndex=i?.comboIndex??0,o.comboIndexWithOffsets=i?.comboIndexWithOffsets??0,o.currentComboIndex=(i?.currentComboIndex??-1)+1,o.isNewCombo&&(o.currentComboIndex=0,o.comboIndex++,o.comboIndexWithOffsets+=o.comboOffset+1,i!==null&&(i.lastInCombo=!0)),i=o}return e}postProcess(e){return e}}let Yt;(function(n){n[n.None=0]="None",n[n.Kiai=1]="Kiai",n[n.OmitFirstBarLine=8]="OmitFirstBarLine"})(Yt||(Yt={}));class u0{startTime;endTime;constructor(e,t){this.startTime=e,this.endTime=t}get duration(){return this.endTime-this.startTime}get hasEffect(){return this.duration>=650}contains(e){return this.startTime<=e&&e<=this.endTime}}class Ci{_baseBeatmap;constructor(e){this._baseBeatmap=e}hitObjects=[];get general(){return this._baseBeatmap.general}set general(e){this._baseBeatmap.general=e}get editor(){return this._baseBeatmap.editor}set editor(e){this._baseBeatmap.editor=e}get difficulty(){return this._baseBeatmap.difficulty}set difficulty(e){this._baseBeatmap.difficulty=e}get metadata(){return this._baseBeatmap.metadata}set metadata(e){this._baseBeatmap.metadata=e}get colors(){return this._baseBeatmap.colors}set colors(e){this._baseBeatmap.colors=e}get events(){return this._baseBeatmap.events}set events(e){this._baseBeatmap.events=e}get controlPoints(){return this._baseBeatmap.controlPoints}set controlPoints(e){this._baseBeatmap.controlPoints=e}get mode(){return this._baseBeatmap.mode}get originalMode(){return this._baseBeatmap.originalMode}get fileFormat(){return this._baseBeatmap.fileFormat}get length(){return this._baseBeatmap.length}get bpmMin(){return this._baseBeatmap.bpmMin}get bpmMax(){return this._baseBeatmap.bpmMax}get bpm(){return this._baseBeatmap.bpm}get totalBreakTime(){return this._baseBeatmap.totalBreakTime}clone(){return new Ci(this._baseBeatmap)}}class l0 extends mu{clone(){const e=super.clone();return e.mods=this.mods.clone(),e}}class c0{mods;starRating;maxCombo=0;constructor(e,t){this.mods=e,this.starRating=t}}class h0{mods;totalPerformance;constructor(e,t){this.mods=e,this.totalPerformance=t}}class d0{time;attributes;constructor(e,t){this.time=e,this.attributes=t}compareTo(e){return this.time<e.time?-1:this.time>e.time?1:this.time===e.time?0:Number.isFinite(this.time)?1:Number.isFinite(e.time)?-1:0}}class f0{_beatmap;_ruleset;_mods;constructor(e,t){this._beatmap=e,this._ruleset=t,this._mods=e?.mods??this._ruleset.createModCombination()}calculate(e){return this.calculateWithMods(this._mods,e)}*calculateAll(e){for(const t of this._createDifficultyModCombinations())yield this.calculateWithMods(t,e)}calculateWithMods(e,t){const r=this._getWorkingBeatmap(e);t??=r.difficulty.clockRate;const i=this._createSkills(r,e,t);if(!r.hitObjects.length)return this._createDifficultyAttributes(r,e,i,t);for(const s of this._getDifficultyHitObjects(r,t))for(const o of i)o.process(s);return this._createDifficultyAttributes(r,e,i,t)}calculateAt(e,t){return this.calculateWithModsAt(this._mods,e,t)}calculateWithModsAt(e,t,r){if(!t)return this.calculateWithMods(e);const i=this._getWorkingBeatmap(e);r??=i.difficulty.clockRate;const s=this._createSkills(i,e,r);if(!i.hitObjects.length||t<=0)return this._createDifficultyAttributes(i,e,s,r);const o=new Ci(i);o.hitObjects=i.hitObjects.slice(0,t);for(const u of this._getDifficultyHitObjects(o,r))for(const l of s)l.process(u);return this._createDifficultyAttributes(o,e,s,r)}calculateTimed(e){return this.calculateTimedWithMods(this._mods,e)}*calculateTimedWithMods(e,t){const r=this._getWorkingBeatmap(e);if(!r.hitObjects.length)return;t??=r.difficulty.clockRate;const i=this._createSkills(r,e,t),s=new Ci(r);for(const o of this._getDifficultyHitObjects(r,t)){s.hitObjects.push(o.baseObject);for(const c of i)c.process(o);const u=o.endTime*t,l=this._createDifficultyAttributes(s,e,i,t);yield new d0(u,l)}}_getWorkingBeatmap(e){const t=this._beatmap,r=this._beatmap.mode===this._ruleset.id,i=t.mods?.equals(e)??!1;if(r&&i)return t;const s=this._beatmap.base??this._beatmap;return this._ruleset.applyToBeatmapWithMods(s,e)}_getDifficultyHitObjects(e,t){return this._sortObjects(this._createDifficultyHitObjects(e,t))}_sortObjects(e){return e.sort((t,r)=>t.startTime-r.startTime)}_createDifficultyModCombinations(){const e=this._ruleset;function*t(r,i){const s=i.reduce((o,u)=>o+u.bitwise,0);yield e.createModCombination(s);for(let o=0;o<r.length;++o){const u=r[o];if(i.find(d=>d.incompatibles&u.bitwise)||i.find(d=>d.bitwise&u.bitwise))continue;const l=r.slice(o+1),c=[...i,u],h=t(l,c);for(const d of h)yield d}}return t(this.difficultyMods,[])}get difficultyMods(){return[]}}class m0{attributes;_ruleset;_score;constructor(e,t,r){this._ruleset=e,this._score=r,this.attributes=t}calculate(e,t){return this.calculateAttributes(e,t).totalPerformance}}class p0{index;baseObject;lastObject;deltaTime;startTime;endTime;_difficultyHitObjects;constructor(e,t,r,i,s){this._difficultyHitObjects=i,this.index=s,this.baseObject=e,this.lastObject=t,this.deltaTime=(e.startTime-t.startTime)/r,this.startTime=e.startTime/r;const o=e;this.endTime=(o?.endTime??e.startTime)/r}previous(e){const t=this.index-(e+1);return this._difficultyHitObjects[t]??null}next(e){const t=this.index+(e+1);return this._difficultyHitObjects[t]??null}}class g0{_mods;constructor(e){this._mods=e}}class _0 extends g0{_decayWeight=.9;_sectionLength=400;_currentSectionPeak=0;_currentSectionEnd=0;_strainPeaks=[];process(e){for(e.index===0&&(this._currentSectionEnd=Math.ceil(e.startTime/this._sectionLength),this._currentSectionEnd*=this._sectionLength);e.startTime>this._currentSectionEnd;)this._saveCurrentPeak(),this._startNewSectionFrom(this._currentSectionEnd,e),this._currentSectionEnd+=this._sectionLength;this._currentSectionPeak=Math.max(this._strainValueAt(e),this._currentSectionPeak)}_saveCurrentPeak(){this._strainPeaks.push(this._currentSectionPeak)}_startNewSectionFrom(e,t){this._currentSectionPeak=this._calculateInitialStrain(e,t)}*getCurrentStrainPeaks(){for(const e of this._strainPeaks)yield e;yield this._currentSectionPeak}get difficultyValue(){let e=0,t=1;const r=[...this.getCurrentStrainPeaks()].filter(i=>i>0);r.sort((i,s)=>s-i);for(const i of r)e+=i*t,t*=this._decayWeight;return e}}class D0 extends _0{_currentStrain=0;_calculateInitialStrain(e,t){const r=t.previous(0)?.startTime??0,i=this._strainDecay(e-r);return this._currentStrain*i}_strainValueAt(e){return this._currentStrain*=this._strainDecay(e.deltaTime),this._currentStrain+=this._strainValueOf(e)*this._skillMultiplier,this._currentStrain}_strainDecay(e){return Math.pow(this._strainDecayBase,e/1e3)}}let N;(function(n){n[n.None=0]="None",n[n.NoFail=1]="NoFail",n[n.Easy=2]="Easy",n[n.TouchDevice=4]="TouchDevice",n[n.Hidden=8]="Hidden",n[n.HardRock=16]="HardRock",n[n.SuddenDeath=32]="SuddenDeath",n[n.DoubleTime=64]="DoubleTime",n[n.Relax=128]="Relax",n[n.HalfTime=256]="HalfTime",n[n.Nightcore=512]="Nightcore",n[n.Flashlight=1024]="Flashlight",n[n.Autoplay=2048]="Autoplay",n[n.SpunOut=4096]="SpunOut",n[n.Relax2=8192]="Relax2",n[n.Perfect=16384]="Perfect",n[n.Key4=32768]="Key4",n[n.Key5=65536]="Key5",n[n.Key6=131072]="Key6",n[n.Key7=262144]="Key7",n[n.Key8=524288]="Key8",n[n.FadeIn=1048576]="FadeIn",n[n.Random=2097152]="Random",n[n.Cinema=4194304]="Cinema",n[n.Target=8388608]="Target",n[n.Key9=16777216]="Key9",n[n.KeyCoop=33554432]="KeyCoop",n[n.Key1=67108864]="Key1",n[n.Key3=134217728]="Key3",n[n.Key2=268435456]="Key2",n[n.ScoreV2=536870912]="ScoreV2",n[n.Mirror=1073741824]="Mirror",n[n.KeyMod=487555072]="KeyMod",n[n.DifficultyDecrease=258]="DifficultyDecrease",n[n.DifficultyIncrease=1616]="DifficultyIncrease"})(N||(N={}));let Ze;(function(n){n[n.DifficultyReduction=0]="DifficultyReduction",n[n.DifficultyIncrease=1]="DifficultyIncrease",n[n.Conversion=2]="Conversion",n[n.Automation=3]="Automation",n[n.Fun=4]="Fun",n[n.System=5]="System"})(Ze||(Ze={}));class Bt{bitwise=N.None;type=Ze.Fun;multiplier=1;isRanked=!0;isUserPlayable=!0;incompatibles=N.None;incompatibleMods=[]}class b0 extends Bt{name="Autoplay";acronym="AT";bitwise=N.Autoplay;type=Ze.Automation;multiplier=1;isRanked=!1;isUserPlayable=!1;incompatibles=N.NoFail|N.SuddenDeath|N.Perfect|N.Relax|N.Relax2|N.SpunOut|N.Cinema}class y0 extends Bt{name="Cinema";acronym="CN";bitwise=N.Cinema;type=Ze.Fun;multiplier=1;isRanked=!1;isUserPlayable=!1;incompatibles=N.NoFail|N.SuddenDeath|N.Perfect|N.Relax|N.Relax2|N.SpunOut|N.Autoplay}class pu extends Bt{name="Double Time";acronym="DT";bitwise=N.DoubleTime;type=Ze.DifficultyIncrease;multiplier=1.12;isRanked=!0;incompatibles=N.HalfTime|N.Nightcore;applyToDifficulty(e){e.clockRate=1.5}}class S0 extends Bt{name="Easy";acronym="EZ";bitwise=N.Easy;type=Ze.DifficultyReduction;multiplier=.5;isRanked=!0;incompatibles=N.HardRock;applyToDifficulty(e){e.circleSize=Math.fround(e.circleSize*.5),e.approachRate=Math.fround(e.approachRate*.5),e.drainRate=Math.fround(e.drainRate*.5),e.overallDifficulty=Math.fround(e.overallDifficulty*.5)}}class v0 extends Bt{name="Flashlight";acronym="FL";bitwise=N.Flashlight;type=Ze.DifficultyIncrease;multiplier=1.12;isRanked=!0;incompatibles=N.None}class w0 extends Bt{name="Half Time";acronym="HT";bitwise=N.HalfTime;type=Ze.DifficultyReduction;multiplier=.3;isRanked=!0;incompatibles=N.DoubleTime|N.Nightcore;applyToDifficulty(e){e.clockRate=.75}}class E0 extends Bt{name="Hard Rock";acronym="HR";bitwise=N.HardRock;type=Ze.DifficultyIncrease;multiplier=1.06;isRanked=!0;incompatibles=N.Easy;applyToDifficulty(e){const t=Math.fround(1.4),r=Math.fround(e.circleSize*Math.fround(1.3)),i=Math.fround(e.approachRate*t),s=Math.fround(e.drainRate*t),o=Math.fround(e.overallDifficulty*t);e.circleSize=Math.min(r,10),e.approachRate=Math.min(i,10),e.drainRate=Math.min(s,10),e.overallDifficulty=Math.min(o,10)}}class A0 extends Bt{name="Hidden";acronym="HD";bitwise=N.Hidden;type=Ze.DifficultyIncrease;multiplier=1.06;isRanked=!0;incompatibles=N.None}class F0 extends pu{name="Nightcore";acronym="NC";bitwise=N.Nightcore;incompatibles=N.HalfTime|N.DoubleTime}class T0 extends Bt{name="No Fail";acronym="NF";bitwise=N.NoFail;type=Ze.DifficultyReduction;multiplier=.5;isRanked=!0;incompatibles=N.SuddenDeath|N.Perfect|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class P0 extends Bt{name="No Mod";acronym="NM";bitwise=N.None;type=Ze.System;multiplier=1;isRanked=!0;incompatibles=N.None}class C0 extends Bt{name="Perfect";acronym="PF";bitwise=N.Perfect;type=Ze.DifficultyIncrease;multiplier=1;isRanked=!0;incompatibles=N.NoFail|N.SuddenDeath|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class M0 extends Bt{name="Sudden Death";acronym="SD";bitwise=N.SuddenDeath;type=Ze.DifficultyIncrease;multiplier=1;isRanked=!0;incompatibles=N.NoFail|N.Perfect|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class Ur{acronym;constructor(e){this.acronym=e?.acronym??""}static fromMod(e){return new Ur({acronym:e.acronym})}static fromJSON(e){return new Ur({acronym:e.acronym})}toString(){return this.acronym}toJSON(){return{acronym:this.acronym}}}class x0{_mods=[];constructor(e){const t=this._availableMods;if(typeof e=="number"||typeof e=="string"){let r=this.toBitwise(e),i=1<<30;for(;i>0;){const s=t.find(o=>o.bitwise&r&i);s&&!(this.bitwise&s.incompatibles)&&this._mods.push(s),r&=~i,i>>=1}}if(!this._mods.length){const r=t.find(i=>i.bitwise===0);r&&this._mods.push(r)}this._mods.sort((r,i)=>r.bitwise-i.bitwise)}get all(){return this._mods}get beatmapMods(){return this.all.filter(t=>t.applyToBeatmap)}get hitObjectMods(){return this.all.filter(t=>t.applyToHitObjects)}get difficultyMods(){return this.all.filter(t=>t.applyToDifficulty)}get converterMods(){return this.all.filter(t=>t.applyToConverter)}get names(){return this.all.map(e=>e.name)}get acronyms(){return this.all.map(e=>e.acronym)}get bitwise(){return this.all.reduce((e,t)=>(e|=t.bitwise,t.bitwise===N.Nightcore&&(e|=N.DoubleTime),t.bitwise===N.Perfect&&(e|=N.SuddenDeath),e),0)}get multiplier(){return this.all.reduce((e,t)=>e*t.multiplier,1)}get isRanked(){return this.all.reduce((e,t)=>e&&t.isRanked,!0)}get incompatibles(){return this.all.reduce((e,t)=>e|t.incompatibles,0)}has(e){const t=this.toBitwise(e);return(this.bitwise&t)===t||this.bitwise===t}any(e){return this._mods.some(t=>t instanceof e)}beatmapModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToBeatmap)}beatmapModAt(e){const t=this.toBitwise(e);return this.beatmapModsAt(t)[0]||null}hitObjectModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToHitObjects)}hitObjectModAt(e){const t=this.toBitwise(e);return this.hitObjectModsAt(t)[0]||null}difficultyModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToDifficulty)}difficultyModAt(e){const t=this.toBitwise(e);return this.difficultyModsAt(t)[0]||null}converterModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToConverter)}converterModAt(e){const t=this.toBitwise(e);return this.converterModsAt(t)[0]||null}modsAt(e){const t=this.toBitwise(e);return this.all.filter(r=>r.bitwise&t)}modAt(e){const t=this.toBitwise(e);return this.modsAt(t)[0]||null}toString(){return this.acronyms.join("")}toJSON(){return this.toString()}toBitwise(e){return typeof e=="number"?Math.max(0,e):typeof e!="string"||!e||e.length%2?0:(e.match(/.{1,2}/g)?.map(r=>r.toUpperCase())??[]).reduce((r,i)=>{const s=this._availableMods.find(o=>o.acronym===i);return r|(s?.bitwise??0)},0)}clone(){const e=this.constructor;return new e(this.bitwise)}equals(e){return this.bitwise===e.bitwise&&this.mode===e.mode}get _availableMods(){return[]}}let Kt;(function(n){n[n.None=0]="None",n[n.Left1=1]="Left1",n[n.Right1=2]="Right1",n[n.Left2=4]="Left2",n[n.Right2=8]="Right2",n[n.Smoke=16]="Smoke"})(Kt||(Kt={}));class gu{startTime;interval;constructor(e,t){this.startTime=e??0,this.interval=t??0}clone(){const e=this.constructor,t=new e;return t.startTime=this.startTime,t.interval=this.interval,t}}class Gi extends gu{buttonState;position;constructor(e,t,r,i){super(e,t),this.position=r??new he(0,0),this.buttonState=i??Kt.None}get mouseX(){return this.position.x}get mouseY(){return this.position.y}get mousePosition(){return new he(this.mouseX??0,this.mouseY??0)}get mouseLeft(){return this.mouseLeft1||this.mouseLeft2}get mouseRight(){return this.mouseRight1||this.mouseRight2}get mouseLeft1(){return(this.buttonState&Kt.Left1)>0}get mouseRight1(){return(this.buttonState&Kt.Right1)>0}get mouseLeft2(){return(this.buttonState&Kt.Left2)>0}get mouseRight2(){return(this.buttonState&Kt.Right2)>0}get smoke(){return(this.buttonState&Kt.Smoke)>0}clone(){const e=super.clone();return e.buttonState=this.buttonState,e.position=this.position.clone(),e}}class B0{startTime;health;constructor(e,t){this.startTime=e??0,this.health=t??0}clone(){const e=this.constructor,t=new e;return t.startTime=this.startTime,t.health=this.health,t}}class _u{gameVersion=0;mode=0;hashMD5="";frames=[];lifeBar=[];constructor(e={}){Object.assign(this,e)}get length(){if(!this.frames?.length)return 0;const e=this.frames[0].startTime;return this.frames[this.frames.length-1].startTime-e}clone(){const e=this.constructor,t=new e;return t.gameVersion=this.gameVersion,t.mode=this.mode,t.hashMD5=this.hashMD5,t.frames=this.frames.map(r=>r.clone()),t}equals(e){return this.hashMD5===e.hashMD5}}class k0{convertReplay(e,t){const r=this.createReplay();r.gameVersion=e.gameVersion,r.mode=e.mode,r.hashMD5=e.hashMD5,r.lifeBar=e.lifeBar;for(const i of this.convertFrames(e.frames,t))r.frames.push(i);return r}createReplay(){return new _u}*convertFrames(e,t){let r=null;for(const i of e){const s=this._convertFrame(i,r,t);yield s,r=s}}_convertFrame(e,t,r){if(this._isConvertedReplayFrame(e))return e;const i=this._createConvertibleReplayFrame();if(i&&e instanceof Gi)return i.fromLegacy(e,t,r);throw new Error("Replay can not be converted to this ruleset!")}}class R0{applyToBeatmap(e){const t=e.mods,r=t?t.bitwise:0,i=this.createModCombination(r);return this.applyToBeatmapWithMods(e,i)}applyToBeatmapWithMods(e,t){t||(t=this.createModCombination(0)),this.id!==t.mode&&(t=this.createModCombination(t.bitwise));const r=this._createBeatmapConverter();if(e.hitObjects.length>0&&!r.canConvert(e))throw new Error("Beatmap can not be converted to this ruleset!");t.converterMods.forEach(o=>o.applyToConverter(r));const i=r.convertBeatmap(e);i.mods=t,t.difficultyMods.forEach(o=>{o.applyToDifficulty(i.difficulty)});const s=this._createBeatmapProcessor();return s.preProcess(i),i.hitObjects.forEach(o=>{o.applyDefaults(i.controlPoints,i.difficulty)}),t.hitObjectMods.forEach(o=>{o.applyToHitObjects(i.hitObjects)}),s.postProcess(i),t.beatmapMods.forEach(o=>o.applyToBeatmap(i)),i}applyToReplay(e,t){if(t&&e.mode!==t.mode)throw new Error("Replay and beatmap mode does not match!");return this._createReplayConverter().convertReplay(e,t)}resetMods(e){const t=this.createModCombination(0);return this.applyToBeatmapWithMods(e,t)}}let to;(function(n){n[n.F=-1]="F",n[n.D=0]="D",n[n.C=1]="C",n[n.B=2]="B",n[n.A=3]="A",n[n.S=4]="S",n[n.SH=5]="SH",n[n.X=6]="X",n[n.XH=7]="XH"})(to||(to={}));class Gt extends Map{static increasesCombo(e){return this.affectsCombo(e)&&this.isHit(e)}static breaksCombo(e){return this.affectsCombo(e)&&!this.isHit(e)}static affectsCombo(e){switch(e){case R.Miss:case R.Meh:case R.Ok:case R.Good:case R.Great:case R.Perfect:case R.LargeTickHit:case R.LargeTickMiss:case R.LegacyComboIncrease:case R.ComboBreak:case R.SliderTailHit:return!0;default:return!1}}static affectsAccuracy(e){switch(e){case R.LegacyComboIncrease:return!1;case R.ComboBreak:return!1;default:return this.isScorable(e)&&!this.isBonus(e)}}static isBasic(e){switch(e){case R.LegacyComboIncrease:return!1;case R.ComboBreak:return!1;default:return this.isScorable(e)&&!this.isTick(e)&&!this.isBonus(e)}}static isTick(e){switch(e){case R.LargeTickHit:case R.LargeTickMiss:case R.SmallTickHit:case R.SmallTickMiss:case R.SliderTailHit:return!0;default:return!1}}static isBonus(e){switch(e){case R.SmallBonus:case R.LargeBonus:return!0;default:return!1}}static isMiss(e){switch(e){case R.IgnoreMiss:case R.Miss:case R.SmallTickMiss:case R.LargeTickMiss:case R.ComboBreak:return!0;default:return!1}}static isHit(e){switch(e){case R.None:case R.IgnoreMiss:case R.Miss:case R.SmallTickMiss:case R.LargeTickMiss:case R.ComboBreak:return!1;default:return!0}}static isScorable(e){switch(e){case R.LegacyComboIncrease:return!0;case R.ComboBreak:return!0;case R.SliderTailHit:return!0;default:return e>=R.Miss&&e<R.IgnoreMiss}}static isValidHitResult(e,t,r){return e===R.None?!1:e===t||e===r?!0:e>t&&e<r}get(e){return super.has(e)||super.set(e,0),super.get(e)}toJSON(){const e={};return this.forEach((t,r)=>{e[Gt._getJsonableKeyFromHitResult(r)]=t}),e}static fromJSON(e){const t=new Gt;return Object.entries(e).forEach(i=>{const s=i[0],o=i[1];t.set(this._getHitResultFromJsonableKey(s),o)}),t}static _getJsonableKeyFromHitResult(e){switch(e){case R.None:return"none";case R.Miss:return"miss";case R.Meh:return"meh";case R.Ok:return"ok";case R.Good:return"good";case R.Great:return"great";case R.Perfect:return"perfect";case R.SmallTickMiss:return"small_tick_miss";case R.SmallTickHit:return"small_tick_hit";case R.LargeTickMiss:return"large_tick_miss";case R.LargeTickHit:return"large_tick_hit";case R.SmallBonus:return"small_bonus";case R.LargeBonus:return"large_bonus";case R.IgnoreMiss:return"ignore_miss";case R.IgnoreHit:return"ignore_hit";case R.ComboBreak:return"combo_break";case R.SliderTailHit:return"slider_tail_hit";case R.LegacyComboIncrease:return"legacy_combo_increase"}}static _getHitResultFromJsonableKey(e){switch(e){case"none":return R.None;case"miss":return R.Miss;case"meh":return R.Meh;case"ok":return R.Ok;case"good":return R.Good;case"great":return R.Great;case"perfect":return R.Perfect;case"small_tick_miss":return R.SmallTickMiss;case"small_tick_hit":return R.SmallTickHit;case"large_tick_miss":return R.LargeTickMiss;case"large_tick_hit":return R.LargeTickHit;case"small_bonus":return R.SmallBonus;case"large_bonus":return R.LargeBonus;case"ignore_miss":return R.IgnoreMiss;case"ignore_hit":return R.IgnoreHit;case"combo_break":return R.ComboBreak;case"slider_tail_hit":return R.SliderTailHit;case"legacy_combo_increase":return R.LegacyComboIncrease}}}class Xr{onlineId;mods;statistics;maximumStatistics;clientVersion;rank;userId;totalScoreWithoutMods;constructor(e){this.onlineId=e?.onlineId??-1,this.mods=e?.mods??[],this.statistics=e?.statistics??new Gt,this.maximumStatistics=e?.maximumStatistics??new Gt,this.clientVersion=e?.clientVersion??"",this.rank=e?.rank??"F",this.userId=e?.userId??-1,this.totalScoreWithoutMods=e?.totalScoreWithoutMods??0}static fromScore(e){return new Xr({onlineId:e.id,mods:e.apiMods,statistics:e.statistics,maximumStatistics:e.maximumStatistics,clientVersion:e.clientVersion,rank:e.rank,userId:e.userId,totalScoreWithoutMods:0})}static fromJSON(e){return new Xr({onlineId:e.online_id,mods:e.mods.map(t=>Ur.fromJSON(t)),statistics:Gt.fromJSON(e.statistics),maximumStatistics:Gt.fromJSON(e.maximum_statistics),clientVersion:e.client_version,rank:e.rank,userId:e.user_id,totalScoreWithoutMods:e.total_score_without_mods})}toJSON(){return{online_id:this.onlineId,mods:this.mods,statistics:this.statistics.toJSON(),maximum_statistics:this.maximumStatistics.toJSON(),client_version:this.clientVersion,rank:this.rank,user_id:this.userId,total_score_without_mods:this.totalScoreWithoutMods}}}class L0{statistics=new Gt;maximumStatistics=new Gt;_legacyCountGeki=0;_legacyCountKatu=0;get countGeki(){return this.rulesetId===3?this.statistics.has(R.Perfect)?this.statistics.get(R.Perfect):this._legacyCountGeki:this._legacyCountGeki}set countGeki(e){this.statistics&&(this.rulesetId===3&&this.statistics.set(R.Perfect,e),this._legacyCountGeki=e)}get count300(){return this.statistics.get(R.Great)}set count300(e){this.statistics&&this.statistics.set(R.Great,e)}get countKatu(){return this.rulesetId===2?this.statistics.has(R.SmallTickMiss)?this.statistics.get(R.SmallTickMiss):this._legacyCountKatu:this.rulesetId===3?this.statistics.has(R.Good)?this.statistics.get(R.Good):this._legacyCountKatu:this._legacyCountKatu}set countKatu(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(R.SmallTickMiss,e),this.rulesetId===3&&this.statistics.set(R.Good,e),this._legacyCountKatu=e)}get count100(){return this.rulesetId===2?this.statistics.get(R.LargeTickHit):this.statistics.get(R.Ok)}set count100(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(R.LargeTickHit,e),this.statistics.set(R.Ok,e))}get count50(){return this.rulesetId===2?this.statistics.get(R.SmallTickHit):this.statistics.get(R.Meh)}set count50(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(R.SmallTickHit,e),this.statistics.set(R.Meh,e))}get countMiss(){return this.statistics.get(R.Miss)}set countMiss(e){this.statistics&&this.statistics.set(R.Miss,e)}get totalHits(){const e=this.countGeki,t=this.countKatu,r=this.count300,i=this.count100,s=this.count50,o=this.countMiss;switch(this.rulesetId){case 0:return r+i+s+o;case 1:return r+i+s+o;case 2:return r+t+i+s+o;case 3:return e+r+t+i+s+o}return e+r+t+i+s+o}}function O0(n){const e=n.countGeki,t=n.countKatu,r=n.count300,i=n.count100,s=n.count50,o=n.totalHits;if(o<=0)return 1;switch(n.rulesetId){case 0:return ur((s/6+i/3+r)/o);case 1:return ur((i/2+r)/o);case 2:return ur((s+i+r)/o);case 3:return ur((s/6+i/3+t/1.5+(r+e))/o)}return 1}function I0(n){if(!n.passed)return"F";switch(n.rulesetId){case 0:return N0(n);case 1:return G0(n);case 2:return H0(n);case 3:return j0(n)}return"F"}function N0(n){const{count300:e,count50:t,countMiss:r,totalHits:i}=n,s=Math.fround(e/i),o=Math.fround(t/i);return s===1?An(n)?"XH":"X":s>.9&&o<=.01&&r===0?An(n)?"SH":"S":s>.8&&r===0||s>.9?"A":s>.7&&r===0||s>.8?"B":s>.6?"C":"D"}function G0(n){const{count300:e,count50:t,countMiss:r,totalHits:i}=n,s=Math.fround(e/i),o=Math.fround(t/i);return s===1?An(n)?"XH":"X":s>.9&&o<=.01&&r===0?An(n)?"SH":"S":s>.8&&r===0||s>.9?"A":s>.7&&r===0||s>.8?"B":s>.6?"C":"D"}function H0(n){const e=n.accuracy;return e===1?An(n)?"XH":"X":e>.98?An(n)?"SH":"S":e>.94?"A":e>.9?"B":e>.85?"C":"D"}function j0(n){const e=n.accuracy;return e===1?An(n)?"XH":"X":e>.95?An(n)?"SH":"S":e>.9?"A":e>.8?"B":e>.7?"C":"D"}function An(n){if(n.mods)return n.mods.has("HD")||n.mods.has("FL");if(typeof n.rawMods=="number"){const e=(n.rawMods&N.Hidden)>0,t=(n.rawMods&N.Flashlight)>0;return e||t}if(typeof n.rawMods=="string"){const e=n.rawMods.match(/.{1,2}/g)?.map(t=>t.toUpperCase())??[];return e.includes("HD")||e.includes("FL")}return!1}class Hi extends L0{id=-1;totalScore=0;totalScoreVersion=0;totalPerformance=null;maxCombo=0;passed=!1;perfect=!1;clientVersion="";isLegacyScore=!1;_ruleset=null;_rulesetId=0;_mods=null;_apiMods=null;_rawMods=0;_accuracy=null;_rank=null;get accuracy(){return this._accuracy??O0(this)}set accuracy(e){this._accuracy=e}get rank(){return this._rank??I0(this)}set rank(e){this._rank=e,this.passed=e!=="F"}get ruleset(){return this._ruleset}set ruleset(e){this._ruleset=e,this._mods=this.ruleset?.createModCombination(this.rawMods)??null}get rulesetId(){return this.ruleset?.id??this._rulesetId}set rulesetId(e){this._rulesetId=e}get apiMods(){return this._apiMods!==null?this._apiMods:this._mods!==null?this._mods.acronyms.map(e=>new Ur({acronym:e})):[]}set apiMods(e){this._apiMods=e}get mods(){return this._mods}set mods(e){this._mods=e,this._rawMods=e?.bitwise??0}get rawMods(){return this._rawMods}set rawMods(e){this._rawMods!==e&&(this._rawMods=e,this._mods=this.ruleset?.createModCombination(e)??null)}username="";userId=0;beatmap=null;beatmapId=0;date=new Date;beatmapHashMD5="";constructor(e={}){super(),Object.assign(this,e)}clone(){const e=this.constructor,t=new e;return Object.assign(t,this),t.statistics=new Gt(this.statistics),t}equals(e){return e&&this.id!==0&&e.id!==0?this.id===e.id:!1}toJSON(){const e={},t=["beatmap","ruleset","rawMods","mods"];for(const r in this)r.startsWith("_")||t.includes(r)||(e[r]=this[r]);return{...e,statistics:this.statistics.toJSON(),beatmap:this.beatmap?.toJSON()??null,mods:this.mods?.toString()??"NM",date:this.date.getTime()/1e3,accuracy:this.accuracy,rank:this.rank,rulesetId:this.rulesetId,countGeki:this.countGeki,count300:this.count300,countKatu:this.countKatu,count100:this.count100,count50:this.count50,countMiss:this.countMiss,totalHits:this.totalHits}}static fromJSON(e){return new Hi({...e,rawMods:e.mods,beatmap:e.beatmap?ea.fromJSON(e.beatmap):null,statistics:Gt.fromJSON(e.statistics),date:new Date(e.date*1e3)})}}class no{info=new Hi;replay=null;constructor(e,t){e&&(this.info=e),t&&(this.replay=t)}clone(){const e=this.constructor,t=new e;return t.info=this.info.clone(),t.replay=this.replay?.clone()??null,t}equals(e){if(!e)return!1;const t=this.info.equals(e.info);return this.replay===null&&e.replay===null?t:this.replay!==null&&e.replay!==null?t&&this.replay.equals(e.replay):!1}}let ro;(function(n){n[n.Unknown=0]="Unknown",n[n.BD=1]="BD",n[n.BE=2]="BE",n[n.BF=3]="BF",n[n.BG=4]="BG",n[n.BA=5]="BA",n[n.BB=6]="BB",n[n.WF=7]="WF",n[n.BL=8]="BL",n[n.BM=9]="BM",n[n.BN=10]="BN",n[n.BO=11]="BO",n[n.BH=12]="BH",n[n.BI=13]="BI",n[n.BJ=14]="BJ",n[n.BT=15]="BT",n[n.JM=16]="JM",n[n.BV=17]="BV",n[n.BW=18]="BW",n[n.WS=19]="WS",n[n.BQ=20]="BQ",n[n.BR=21]="BR",n[n.BS=22]="BS",n[n.JE=23]="JE",n[n.BY=24]="BY",n[n.BZ=25]="BZ",n[n.RU=26]="RU",n[n.RW=27]="RW",n[n.RS=28]="RS",n[n.TL=29]="TL",n[n.RE=30]="RE",n[n.TM=31]="TM",n[n.TJ=32]="TJ",n[n.RO=33]="RO",n[n.TK=34]="TK",n[n.GW=35]="GW",n[n.GU=36]="GU",n[n.GT=37]="GT",n[n.GS=38]="GS",n[n.GR=39]="GR",n[n.GQ=40]="GQ",n[n.GP=41]="GP",n[n.JP=42]="JP",n[n.GY=43]="GY",n[n.GG=44]="GG",n[n.GF=45]="GF",n[n.GE=46]="GE",n[n.GD=47]="GD",n[n.GB=48]="GB",n[n.GA=49]="GA",n[n.SV=50]="SV",n[n.GN=51]="GN",n[n.GM=52]="GM",n[n.GL=53]="GL",n[n.GI=54]="GI",n[n.GH=55]="GH",n[n.OM=56]="OM",n[n.TN=57]="TN",n[n.JO=58]="JO",n[n.HR=59]="HR",n[n.HT=60]="HT",n[n.HU=61]="HU",n[n.HK=62]="HK",n[n.HN=63]="HN",n[n.HM=64]="HM",n[n.VE=65]="VE",n[n.PR=66]="PR",n[n.PS=67]="PS",n[n.PW=68]="PW",n[n.PT=69]="PT",n[n.SJ=70]="SJ",n[n.PY=71]="PY",n[n.IQ=72]="IQ",n[n.PA=73]="PA",n[n.PF=74]="PF",n[n.PG=75]="PG",n[n.PE=76]="PE",n[n.PK=77]="PK",n[n.PH=78]="PH",n[n.PN=79]="PN",n[n.PL=80]="PL",n[n.PM=81]="PM",n[n.ZM=82]="ZM",n[n.EH=83]="EH",n[n.EE=84]="EE",n[n.EG=85]="EG",n[n.ZA=86]="ZA",n[n.EC=87]="EC",n[n.IT=88]="IT",n[n.VN=89]="VN",n[n.SB=90]="SB",n[n.ET=91]="ET",n[n.SO=92]="SO",n[n.ZW=93]="ZW",n[n.SA=94]="SA",n[n.ES=95]="ES",n[n.ER=96]="ER",n[n.ME=97]="ME",n[n.MD=98]="MD",n[n.MG=99]="MG",n[n.MF=100]="MF",n[n.MA=101]="MA",n[n.MC=102]="MC",n[n.UZ=103]="UZ",n[n.MM=104]="MM",n[n.ML=105]="ML",n[n.MO=106]="MO",n[n.MN=107]="MN",n[n.MH=108]="MH",n[n.MK=109]="MK",n[n.MU=110]="MU",n[n.MT=111]="MT",n[n.MW=112]="MW",n[n.MV=113]="MV",n[n.MQ=114]="MQ",n[n.MP=115]="MP",n[n.MS=116]="MS",n[n.MR=117]="MR",n[n.IM=118]="IM",n[n.UG=119]="UG",n[n.TZ=120]="TZ",n[n.MY=121]="MY",n[n.MX=122]="MX",n[n.IL=123]="IL",n[n.FR=124]="FR",n[n.IO=125]="IO",n[n.SH=126]="SH",n[n.FI=127]="FI",n[n.FJ=128]="FJ",n[n.FK=129]="FK",n[n.FM=130]="FM",n[n.FO=131]="FO",n[n.NI=132]="NI",n[n.NL=133]="NL",n[n.NO=134]="NO",n[n.NA=135]="NA",n[n.VU=136]="VU",n[n.NC=137]="NC",n[n.NE=138]="NE",n[n.NF=139]="NF",n[n.NG=140]="NG",n[n.NZ=141]="NZ",n[n.NP=142]="NP",n[n.NR=143]="NR",n[n.NU=144]="NU",n[n.CK=145]="CK",n[n.XK=146]="XK",n[n.CI=147]="CI",n[n.CH=148]="CH",n[n.CO=149]="CO",n[n.CN=150]="CN",n[n.CM=151]="CM",n[n.CL=152]="CL",n[n.CC=153]="CC",n[n.CA=154]="CA",n[n.CG=155]="CG",n[n.CF=156]="CF",n[n.CD=157]="CD",n[n.CZ=158]="CZ",n[n.CY=159]="CY",n[n.CX=160]="CX",n[n.CR=161]="CR",n[n.CW=162]="CW",n[n.CV=163]="CV",n[n.CU=164]="CU",n[n.SZ=165]="SZ",n[n.SY=166]="SY",n[n.SX=167]="SX",n[n.KG=168]="KG",n[n.KE=169]="KE",n[n.SS=170]="SS",n[n.SR=171]="SR",n[n.KI=172]="KI",n[n.KH=173]="KH",n[n.KN=174]="KN",n[n.KM=175]="KM",n[n.ST=176]="ST",n[n.SK=177]="SK",n[n.KR=178]="KR",n[n.SI=179]="SI",n[n.KP=180]="KP",n[n.KW=181]="KW",n[n.SN=182]="SN",n[n.SM=183]="SM",n[n.SL=184]="SL",n[n.SC=185]="SC",n[n.KZ=186]="KZ",n[n.KY=187]="KY",n[n.SG=188]="SG",n[n.SE=189]="SE",n[n.SD=190]="SD",n[n.DO=191]="DO",n[n.DM=192]="DM",n[n.DJ=193]="DJ",n[n.DK=194]="DK",n[n.VG=195]="VG",n[n.DE=196]="DE",n[n.YE=197]="YE",n[n.DZ=198]="DZ",n[n.US=199]="US",n[n.UY=200]="UY",n[n.YT=201]="YT",n[n.UM=202]="UM",n[n.LB=203]="LB",n[n.LC=204]="LC",n[n.LA=205]="LA",n[n.TV=206]="TV",n[n.TW=207]="TW",n[n.TT=208]="TT",n[n.TR=209]="TR",n[n.LK=210]="LK",n[n.LI=211]="LI",n[n.LV=212]="LV",n[n.TO=213]="TO",n[n.LT=214]="LT",n[n.LU=215]="LU",n[n.LR=216]="LR",n[n.LS=217]="LS",n[n.TH=218]="TH",n[n.TF=219]="TF",n[n.TG=220]="TG",n[n.TD=221]="TD",n[n.TC=222]="TC",n[n.LY=223]="LY",n[n.VA=224]="VA",n[n.VC=225]="VC",n[n.AE=226]="AE",n[n.AD=227]="AD",n[n.AG=228]="AG",n[n.AF=229]="AF",n[n.AI=230]="AI",n[n.VI=231]="VI",n[n.IS=232]="IS",n[n.IR=233]="IR",n[n.AM=234]="AM",n[n.AL=235]="AL",n[n.AO=236]="AO",n[n.AQ=237]="AQ",n[n.AS=238]="AS",n[n.AR=239]="AR",n[n.AU=240]="AU",n[n.AT=241]="AT",n[n.AW=242]="AW",n[n.IN=243]="IN",n[n.AX=244]="AX",n[n.AZ=245]="AZ",n[n.IE=246]="IE",n[n.ID=247]="ID",n[n.UA=248]="UA",n[n.QA=249]="QA",n[n.MZ=250]="MZ"})(ro||(ro={}));var ta=(function(){var n=1,e=2,t=3,r=typeof setImmediate=="function"?setImmediate:setTimeout,i=4294967296,s=[4294967295,-i],o=[0,-9223372036854776e3],u=[0,0],l=[1,0];function c(a,f){postMessage({action:t,cbn:f,result:a})}function h(a){var f=[];return f[a-1]=void 0,f}function d(a,f){return p(a[0]+f[0],a[1]+f[1])}function m(a,f){return C(~~Math.max(Math.min(a[1]/i,2147483647),-2147483648)&~~Math.max(Math.min(f[1]/i,2147483647),-2147483648),S(a)&S(f))}function D(a,f){var g,b;return a[0]==f[0]&&a[1]==f[1]?0:(g=a[1]<0,b=f[1]<0,g&&!b?-1:!g&&b?1:Z(a,f)[1]<0?-1:1)}function p(a,f){var g,b;for(f%=18446744073709552e3,a%=18446744073709552e3,g=f%i,b=Math.floor(a/i)*i,f=f-g+b,a=a-b+g;a<0;)a+=i,f-=i;for(;a>4294967295;)a-=i,f+=i;for(f=f%18446744073709552e3;f>9223372032559809e3;)f-=18446744073709552e3;for(;f<-9223372036854776e3;)f+=18446744073709552e3;return[a,f]}function v(a,f){return a[0]==f[0]&&a[1]==f[1]}function F(a){return a>=0?[a,0]:[a+i,-i]}function S(a){return a[0]>=2147483648?~~Math.max(Math.min(a[0]-i,2147483647),-2147483648):~~Math.max(Math.min(a[0],2147483647),-2147483648)}function C(a,f){var g,b;return g=a*i,b=f,f<0&&(b+=i),[b,g]}function B(a){return a<=30?1<<a:B(30)*B(a-30)}function x(a,f){var g,b,E,P;if(f&=63,v(a,o))return f?u:a;if(a[1]<0)throw new Error("Neg");return P=B(f),b=a[1]*P%18446744073709552e3,E=a[0]*P,g=E-E%i,b+=g,E-=g,b>=9223372036854776e3&&(b-=18446744073709552e3),[E,b]}function j(a,f){var g;return f&=63,g=B(f),p(Math.floor(a[0]/g),a[1]/g)}function W(a,f){var g;return f&=63,g=j(a,f),a[1]<0&&(g=d(g,x([2,0],63-f))),g}function Z(a,f){return p(a[0]-f[0],a[1]-f[1])}function J(a,f){return a.buf=f,a.pos=0,a.count=f.length,a}function K(a){return a.pos>=a.count?-1:a.buf[a.pos++]&255}function ae(a,f,g,b){return a.pos>=a.count?-1:(b=Math.min(b,a.count-a.pos),O(a.buf,a.pos,f,g,b),a.pos+=b,b)}function le(a){return a.buf=h(32),a.count=0,a}function _(a){var f=a.buf;return f.length=a.count,f}function T(a,f){a.buf[a.count++]=f<<24>>24}function A(a,f,g,b){O(f,g,a.buf,a.count,b),a.count+=b}function y(a,f,g,b,E){var P;for(P=f;P<g;++P)b[E++]=a.charCodeAt(P)}function O(a,f,g,b,E){for(var P=0;P<E;++P)g[b+P]=a[f+P]}function I(a,f){mc(f,1<<a.s),f._numFastBytes=a.f,pc(f,a.m),f._numLiteralPosStateBits=0,f._numLiteralContextBits=3,f._posStateBits=2,f._posStateMask=3}function k(a,f,g,b,E){var P,L;if(D(b,s)<0)throw new Error("invalid length "+b);for(a.length_0=b,P=lc({}),I(E,P),P._writeEndMark=typeof ta.disableEndMark>"u",gc(P,g),L=0;L<64;L+=8)T(g,S(j(b,L))&255);a.chunker=(P._needReleaseMFStream=0,P._inStream=f,P._finished=0,uc(P),P._rangeEncoder.Stream=g,dc(P),Pa(P),Ta(P),P._lenEncoder._tableSize=P._numFastBytes+1-2,La(P._lenEncoder,1<<P._posStateBits),P._repMatchLenEncoder._tableSize=P._numFastBytes+1-2,La(P._repMatchLenEncoder,1<<P._posStateBits),P.nowPos64=u,Wl({},P))}function q(a,f,g){return a.output=le({}),k(a,J({},f),a.output,F(f.length),g),a}function ge(a,f,g){var b,E="",P,L=[],$,ne;for(P=0;P<5;++P){if($=K(f),$==-1)throw new Error("truncated input");L[P]=$<<24>>24}if(b=ql({}),!Ql(b,L))throw new Error("corrupted input");for(P=0;P<64;P+=8){if($=K(f),$==-1)throw new Error("truncated input");$=$.toString(16),$.length==1&&($="0"+$),E=$+""+E}/^0+$|^f+$/i.test(E)?a.length_0=s:(ne=parseInt(E,16),ne>4294967295?a.length_0=s:a.length_0=F(ne)),a.chunker=Kl(b,f,g,a.length_0)}function be(a,f){return a.output=le({}),ge(a,J({},f),a.output),a}function Q(a,f,g,b){var E;a._keepSizeBefore=f,a._keepSizeAfter=g,E=f+g+b,(a._bufferBase==null||a._blockSize!=E)&&(a._bufferBase=null,a._blockSize=E,a._bufferBase=h(a._blockSize)),a._pointerToLastSafePosition=a._blockSize-g}function X(a,f){return a._bufferBase[a._bufferOffset+a._pos+f]}function oe(a,f,g,b){var E,P;for(a._streamEndWasReached&&a._pos+f+b>a._streamPos&&(b=a._streamPos-(a._pos+f)),++g,P=a._bufferOffset+a._pos+f,E=0;E<b&&a._bufferBase[P+E]==a._bufferBase[P+E-g];++E);return E}function te(a){return a._streamPos-a._pos}function Ae(a){var f,g,b;for(b=a._bufferOffset+a._pos-a._keepSizeBefore,b>0&&--b,g=a._bufferOffset+a._streamPos-b,f=0;f<g;++f)a._bufferBase[f]=a._bufferBase[b+f];a._bufferOffset-=b}function rt(a){var f;++a._pos,a._pos>a._posLimit&&(f=a._bufferOffset+a._pos,f>a._pointerToLastSafePosition&&Ae(a),Bn(a))}function Bn(a){var f,g,b;if(!a._streamEndWasReached)for(;;){if(b=-a._bufferOffset+a._blockSize-a._streamPos,!b)return;if(f=ae(a._stream,a._bufferBase,a._bufferOffset+a._streamPos,b),f==-1){a._posLimit=a._streamPos,g=a._bufferOffset+a._posLimit,g>a._pointerToLastSafePosition&&(a._posLimit=a._pointerToLastSafePosition-a._bufferOffset),a._streamEndWasReached=1;return}a._streamPos+=f,a._streamPos>=a._pos+a._keepSizeAfter&&(a._posLimit=a._streamPos-a._keepSizeAfter)}}function Da(a,f){a._bufferOffset+=f,a._posLimit-=f,a._pos-=f,a._streamPos-=f}var ei=(function(){var a,f,g,b=[];for(a=0;a<256;++a){for(g=a,f=0;f<8;++f)(g&1)!=0?g=g>>>1^-306674912:g>>>=1;b[a]=g}return b})();function Ll(a,f,g,b,E){var P,L,$;f<1073741567&&(a._cutValue=16+(b>>1),$=~~((f+g+b+E)/2)+256,Q(a,f+g,b+E,$),a._matchMaxLen=b,P=f+1,a._cyclicBufferSize!=P&&(a._son=h((a._cyclicBufferSize=P)*2)),L=65536,a.HASH_ARRAY&&(L=f-1,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L>>=1,L|=65535,L>16777216&&(L>>=1),a._hashMask=L,++L,L+=a.kFixHashSize),L!=a._hashSizeSum&&(a._hash=h(a._hashSizeSum=L)))}function Ol(a,f){var g,b,E,P,L,$,ne,ee,re,Be,_e,ye,it,ie,Fe,$e,Te,kt,lt,Rt,Wt;if(a._pos+a._matchMaxLen<=a._streamPos)ie=a._matchMaxLen;else if(ie=a._streamPos-a._pos,ie<a.kMinMatchCheck)return ti(a),0;for(Te=0,Fe=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,b=a._bufferOffset+a._pos,$e=1,ee=0,re=0,a.HASH_ARRAY?(Wt=ei[a._bufferBase[b]&255]^a._bufferBase[b+1]&255,ee=Wt&1023,Wt^=(a._bufferBase[b+2]&255)<<8,re=Wt&65535,Be=(Wt^ei[a._bufferBase[b+3]&255]<<5)&a._hashMask):Be=a._bufferBase[b]&255^(a._bufferBase[b+1]&255)<<8,E=a._hash[a.kFixHashSize+Be]||0,a.HASH_ARRAY&&(P=a._hash[ee]||0,L=a._hash[1024+re]||0,a._hash[ee]=a._pos,a._hash[1024+re]=a._pos,P>Fe&&a._bufferBase[a._bufferOffset+P]==a._bufferBase[b]&&(f[Te++]=$e=2,f[Te++]=a._pos-P-1),L>Fe&&a._bufferBase[a._bufferOffset+L]==a._bufferBase[b]&&(L==P&&(Te-=2),f[Te++]=$e=3,f[Te++]=a._pos-L-1,P=L),Te!=0&&P==E&&(Te-=2,$e=1)),a._hash[a.kFixHashSize+Be]=a._pos,lt=(a._cyclicBufferPos<<1)+1,Rt=a._cyclicBufferPos<<1,ye=it=a.kNumHashDirectBytes,a.kNumHashDirectBytes!=0&&E>Fe&&a._bufferBase[a._bufferOffset+E+a.kNumHashDirectBytes]!=a._bufferBase[b+a.kNumHashDirectBytes]&&(f[Te++]=$e=a.kNumHashDirectBytes,f[Te++]=a._pos-E-1),g=a._cutValue;;){if(E<=Fe||g--==0){a._son[lt]=a._son[Rt]=0;break}if(ne=a._pos-E,$=(ne<=a._cyclicBufferPos?a._cyclicBufferPos-ne:a._cyclicBufferPos-ne+a._cyclicBufferSize)<<1,kt=a._bufferOffset+E,_e=ye<it?ye:it,a._bufferBase[kt+_e]==a._bufferBase[b+_e]){for(;++_e!=ie&&a._bufferBase[kt+_e]==a._bufferBase[b+_e];);if($e<_e&&(f[Te++]=$e=_e,f[Te++]=ne-1,_e==ie)){a._son[Rt]=a._son[$],a._son[lt]=a._son[$+1];break}}(a._bufferBase[kt+_e]&255)<(a._bufferBase[b+_e]&255)?(a._son[Rt]=E,Rt=$+1,E=a._son[Rt],it=_e):(a._son[lt]=E,lt=$,E=a._son[lt],ye=_e)}return ti(a),Te}function Il(a){a._bufferOffset=0,a._pos=0,a._streamPos=0,a._streamEndWasReached=0,Bn(a),a._cyclicBufferPos=0,Da(a,-1)}function ti(a){var f;++a._cyclicBufferPos>=a._cyclicBufferSize&&(a._cyclicBufferPos=0),rt(a),a._pos==1073741823&&(f=a._pos-a._cyclicBufferSize,ba(a._son,a._cyclicBufferSize*2,f),ba(a._hash,a._hashSizeSum,f),Da(a,f))}function ba(a,f,g){var b,E;for(b=0;b<f;++b)E=a[b]||0,E<=g?E=0:E-=g,a[b]=E}function Nl(a,f){a.HASH_ARRAY=f>2,a.HASH_ARRAY?(a.kNumHashDirectBytes=0,a.kMinMatchCheck=4,a.kFixHashSize=66560):(a.kNumHashDirectBytes=2,a.kMinMatchCheck=3,a.kFixHashSize=0)}function Gl(a,f){var g,b,E,P,L,$,ne,ee,re,Be,_e,ye,it,ie,Fe,$e,Te;do{if(a._pos+a._matchMaxLen<=a._streamPos)ye=a._matchMaxLen;else if(ye=a._streamPos-a._pos,ye<a.kMinMatchCheck){ti(a);continue}for(it=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,b=a._bufferOffset+a._pos,a.HASH_ARRAY?(Te=ei[a._bufferBase[b]&255]^a._bufferBase[b+1]&255,$=Te&1023,a._hash[$]=a._pos,Te^=(a._bufferBase[b+2]&255)<<8,ne=Te&65535,a._hash[1024+ne]=a._pos,ee=(Te^ei[a._bufferBase[b+3]&255]<<5)&a._hashMask):ee=a._bufferBase[b]&255^(a._bufferBase[b+1]&255)<<8,E=a._hash[a.kFixHashSize+ee],a._hash[a.kFixHashSize+ee]=a._pos,Fe=(a._cyclicBufferPos<<1)+1,$e=a._cyclicBufferPos<<1,Be=_e=a.kNumHashDirectBytes,g=a._cutValue;;){if(E<=it||g--==0){a._son[Fe]=a._son[$e]=0;break}if(L=a._pos-E,P=(L<=a._cyclicBufferPos?a._cyclicBufferPos-L:a._cyclicBufferPos-L+a._cyclicBufferSize)<<1,ie=a._bufferOffset+E,re=Be<_e?Be:_e,a._bufferBase[ie+re]==a._bufferBase[b+re]){for(;++re!=ye&&a._bufferBase[ie+re]==a._bufferBase[b+re];);if(re==ye){a._son[$e]=a._son[P],a._son[Fe]=a._son[P+1];break}}(a._bufferBase[ie+re]&255)<(a._bufferBase[b+re]&255)?(a._son[$e]=E,$e=P+1,E=a._son[$e],_e=re):(a._son[Fe]=E,Fe=P,E=a._son[Fe],Be=re)}ti(a)}while(--f!=0)}function Hl(a,f,g){var b=a._pos-f-1;for(b<0&&(b+=a._windowSize);g!=0;--g)b>=a._windowSize&&(b=0),a._buffer[a._pos++]=a._buffer[b++],a._pos>=a._windowSize&&ni(a)}function jl(a,f){(a._buffer==null||a._windowSize!=f)&&(a._buffer=h(f)),a._windowSize=f,a._pos=0,a._streamPos=0}function ni(a){var f=a._pos-a._streamPos;f&&(A(a._stream,a._buffer,a._streamPos,f),a._pos>=a._windowSize&&(a._pos=0),a._streamPos=a._pos)}function ya(a,f){var g=a._pos-f-1;return g<0&&(g+=a._windowSize),a._buffer[g]}function Vl(a,f){a._buffer[a._pos++]=f,a._pos>=a._windowSize&&ni(a)}function Sa(a){ni(a),a._stream=null}function ri(a){return a-=2,a<4?a:3}function bn(a){return a<4?0:a<10?a-3:a-6}function Wl(a,f){return a.encoder=f,a.decoder=null,a.alive=1,a}function zl(a,f){return a.decoder=f,a.encoder=null,a.alive=1,a}function ii(a){if(!a.alive)throw new Error("bad state");return a.encoder?Xl(a):Ul(a),a.alive}function Ul(a){var f=Yl(a.decoder);if(f==-1)throw new Error("corrupted input");a.inBytesProcessed=s,a.outBytesProcessed=a.decoder.nowPos64,(f||D(a.decoder.outSize,u)>=0&&D(a.decoder.nowPos64,a.decoder.outSize)>=0)&&(ni(a.decoder.m_OutWindow),Sa(a.decoder.m_OutWindow),a.decoder.m_RangeDecoder.Stream=null,a.alive=0)}function Xl(a){oc(a.encoder,a.encoder.processedInSize,a.encoder.processedOutSize,a.encoder.finished),a.inBytesProcessed=a.encoder.processedInSize[0],a.encoder.finished[0]&&(fc(a.encoder),a.alive=0)}function Kl(a,f,g,b){return a.m_RangeDecoder.Stream=f,Sa(a.m_OutWindow),a.m_OutWindow._stream=g,Jl(a),a.state=0,a.rep0=0,a.rep1=0,a.rep2=0,a.rep3=0,a.outSize=b,a.nowPos64=u,a.prevByte=0,zl({},a)}function Yl(a){var f,g,b,E,P,L;if(L=S(a.nowPos64)&a.m_PosStateMask,!Dt(a.m_RangeDecoder,a.m_IsMatchDecoders,(a.state<<4)+L))f=tc(a.m_LiteralDecoder,S(a.nowPos64),a.prevByte),a.state<7?a.prevByte=rc(f,a.m_RangeDecoder):a.prevByte=ic(f,a.m_RangeDecoder,ya(a.m_OutWindow,a.rep0)),Vl(a.m_OutWindow,a.prevByte),a.state=bn(a.state),a.nowPos64=d(a.nowPos64,l);else{if(Dt(a.m_RangeDecoder,a.m_IsRepDecoders,a.state))b=0,Dt(a.m_RangeDecoder,a.m_IsRepG0Decoders,a.state)?(Dt(a.m_RangeDecoder,a.m_IsRepG1Decoders,a.state)?(Dt(a.m_RangeDecoder,a.m_IsRepG2Decoders,a.state)?(g=a.rep3,a.rep3=a.rep2):g=a.rep2,a.rep2=a.rep1):g=a.rep1,a.rep1=a.rep0,a.rep0=g):Dt(a.m_RangeDecoder,a.m_IsRep0LongDecoders,(a.state<<4)+L)||(a.state=a.state<7?9:11,b=1),b||(b=wa(a.m_RepLenDecoder,a.m_RangeDecoder,L)+2,a.state=a.state<7?8:11);else if(a.rep3=a.rep2,a.rep2=a.rep1,a.rep1=a.rep0,b=2+wa(a.m_LenDecoder,a.m_RangeDecoder,L),a.state=a.state<7?7:10,P=ai(a.m_PosSlotDecoder[ri(b)],a.m_RangeDecoder),P>=4){if(E=(P>>1)-1,a.rep0=(2|P&1)<<E,P<14)a.rep0+=Tc(a.m_PosDecoders,a.rep0-P-1,a.m_RangeDecoder,E);else if(a.rep0+=xc(a.m_RangeDecoder,E-4)<<4,a.rep0+=Fc(a.m_PosAlignDecoder,a.m_RangeDecoder),a.rep0<0)return a.rep0==-1?1:-1}else a.rep0=P;if(D(F(a.rep0),a.nowPos64)>=0||a.rep0>=a.m_DictionarySizeCheck)return-1;Hl(a.m_OutWindow,a.rep0,b),a.nowPos64=d(a.nowPos64,F(b)),a.prevByte=ya(a.m_OutWindow,0)}return 0}function ql(a){a.m_OutWindow={},a.m_RangeDecoder={},a.m_IsMatchDecoders=h(192),a.m_IsRepDecoders=h(12),a.m_IsRepG0Decoders=h(12),a.m_IsRepG1Decoders=h(12),a.m_IsRepG2Decoders=h(12),a.m_IsRep0LongDecoders=h(192),a.m_PosSlotDecoder=h(4),a.m_PosDecoders=h(114),a.m_PosAlignDecoder=_r({},4),a.m_LenDecoder=Ea({}),a.m_RepLenDecoder=Ea({}),a.m_LiteralDecoder={};for(var f=0;f<4;++f)a.m_PosSlotDecoder[f]=_r({},6);return a}function Jl(a){a.m_OutWindow._streamPos=0,a.m_OutWindow._pos=0,ke(a.m_IsMatchDecoders),ke(a.m_IsRep0LongDecoders),ke(a.m_IsRepDecoders),ke(a.m_IsRepG0Decoders),ke(a.m_IsRepG1Decoders),ke(a.m_IsRepG2Decoders),ke(a.m_PosDecoders),nc(a.m_LiteralDecoder);for(var f=0;f<4;++f)ke(a.m_PosSlotDecoder[f].Models);Aa(a.m_LenDecoder),Aa(a.m_RepLenDecoder),ke(a.m_PosAlignDecoder.Models),Bc(a.m_RangeDecoder)}function Ql(a,f){var g,b,E,P,L,$,ne;if(f.length<5)return 0;for(ne=f[0]&255,E=ne%9,$=~~(ne/9),P=$%5,L=~~($/5),g=0,b=0;b<4;++b)g+=(f[1+b]&255)<<b*8;return g>99999999||!$l(a,E,P,L)?0:Zl(a,g)}function Zl(a,f){return f<0?0:(a.m_DictionarySize!=f&&(a.m_DictionarySize=f,a.m_DictionarySizeCheck=Math.max(a.m_DictionarySize,1),jl(a.m_OutWindow,Math.max(a.m_DictionarySizeCheck,4096))),1)}function $l(a,f,g,b){if(f>8||g>4||b>4)return 0;ec(a.m_LiteralDecoder,g,f);var E=1<<b;return va(a.m_LenDecoder,E),va(a.m_RepLenDecoder,E),a.m_PosStateMask=E-1,1}function va(a,f){for(;a.m_NumPosStates<f;++a.m_NumPosStates)a.m_LowCoder[a.m_NumPosStates]=_r({},3),a.m_MidCoder[a.m_NumPosStates]=_r({},3)}function wa(a,f,g){if(!Dt(f,a.m_Choice,0))return ai(a.m_LowCoder[g],f);var b=8;return Dt(f,a.m_Choice,1)?b+=8+ai(a.m_HighCoder,f):b+=ai(a.m_MidCoder[g],f),b}function Ea(a){return a.m_Choice=h(2),a.m_LowCoder=h(16),a.m_MidCoder=h(16),a.m_HighCoder=_r({},8),a.m_NumPosStates=0,a}function Aa(a){ke(a.m_Choice);for(var f=0;f<a.m_NumPosStates;++f)ke(a.m_LowCoder[f].Models),ke(a.m_MidCoder[f].Models);ke(a.m_HighCoder.Models)}function ec(a,f,g){var b,E;if(!(a.m_Coders!=null&&a.m_NumPrevBits==g&&a.m_NumPosBits==f))for(a.m_NumPosBits=f,a.m_PosMask=(1<<f)-1,a.m_NumPrevBits=g,E=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=h(E),b=0;b<E;++b)a.m_Coders[b]=sc({})}function tc(a,f,g){return a.m_Coders[((f&a.m_PosMask)<<a.m_NumPrevBits)+((g&255)>>>8-a.m_NumPrevBits)]}function nc(a){var f,g;for(g=1<<a.m_NumPrevBits+a.m_NumPosBits,f=0;f<g;++f)ke(a.m_Coders[f].m_Decoders)}function rc(a,f){var g=1;do g=g<<1|Dt(f,a.m_Decoders,g);while(g<256);return g<<24>>24}function ic(a,f,g){var b,E,P=1;do if(E=g>>7&1,g<<=1,b=Dt(f,a.m_Decoders,(1+E<<8)+P),P=P<<1|b,E!=b){for(;P<256;)P=P<<1|Dt(f,a.m_Decoders,P);break}while(P<256);return P<<24>>24}function sc(a){return a.m_Decoders=h(768),a}var Zn=(function(){var a,f,g,b=2,E=[0,1];for(g=2;g<22;++g)for(f=1<<(g>>1)-1,a=0;a<f;++a,++b)E[b]=g<<24>>24;return E})();function Fa(a,f){var g,b,E,P;a._optimumEndIndex=f,E=a._optimum[f].PosPrev,b=a._optimum[f].BackPrev;do a._optimum[f].Prev1IsChar&&(Ia(a._optimum[E]),a._optimum[E].PosPrev=E-1,a._optimum[f].Prev2&&(a._optimum[E-1].Prev1IsChar=0,a._optimum[E-1].PosPrev=a._optimum[f].PosPrev2,a._optimum[E-1].BackPrev=a._optimum[f].BackPrev2)),P=E,g=b,b=a._optimum[P].BackPrev,E=a._optimum[P].PosPrev,a._optimum[P].BackPrev=g,a._optimum[P].PosPrev=f,f=P;while(f>0);return a.backRes=a._optimum[0].BackPrev,a._optimumCurrentIndex=a._optimum[0].PosPrev,a._optimumCurrentIndex}function ac(a){a._state=0,a._previousByte=0;for(var f=0;f<4;++f)a._repDistances[f]=0}function oc(a,f,g,b){var E,P,L,$,ne,ee,re,Be,_e,ye,it,ie,Fe,$e,Te;if(f[0]=u,g[0]=u,b[0]=1,a._inStream&&(a._matchFinder._stream=a._inStream,Il(a._matchFinder),a._needReleaseMFStream=1,a._inStream=null),!a._finished){if(a._finished=1,$e=a.nowPos64,v(a.nowPos64,u)){if(!te(a._matchFinder)){Ji(a,S(a.nowPos64));return}Qi(a),Fe=S(a.nowPos64)&a._posStateMask,Xe(a._rangeEncoder,a._isMatch,(a._state<<4)+Fe,0),a._state=bn(a._state),L=X(a._matchFinder,-a._additionalOffset),Oa(er(a._literalEncoder,S(a.nowPos64),a._previousByte),a._rangeEncoder,L),a._previousByte=L,--a._additionalOffset,a.nowPos64=d(a.nowPos64,l)}if(!te(a._matchFinder)){Ji(a,S(a.nowPos64));return}for(;;){if(re=cc(a,S(a.nowPos64)),ye=a.backRes,Fe=S(a.nowPos64)&a._posStateMask,P=(a._state<<4)+Fe,re==1&&ye==-1)Xe(a._rangeEncoder,a._isMatch,P,0),L=X(a._matchFinder,-a._additionalOffset),Te=er(a._literalEncoder,S(a.nowPos64),a._previousByte),a._state<7?Oa(Te,a._rangeEncoder,L):(_e=X(a._matchFinder,-a._repDistances[0]-1-a._additionalOffset),wc(Te,a._rangeEncoder,_e,L)),a._previousByte=L,a._state=bn(a._state);else{if(Xe(a._rangeEncoder,a._isMatch,P,1),ye<4){if(Xe(a._rangeEncoder,a._isRep,a._state,1),ye?(Xe(a._rangeEncoder,a._isRepG0,a._state,1),ye==1?Xe(a._rangeEncoder,a._isRepG1,a._state,0):(Xe(a._rangeEncoder,a._isRepG1,a._state,1),Xe(a._rangeEncoder,a._isRepG2,a._state,ye-2))):(Xe(a._rangeEncoder,a._isRepG0,a._state,0),re==1?Xe(a._rangeEncoder,a._isRep0Long,P,0):Xe(a._rangeEncoder,a._isRep0Long,P,1)),re==1?a._state=a._state<7?9:11:($i(a._repMatchLenEncoder,a._rangeEncoder,re-2,Fe),a._state=a._state<7?8:11),$=a._repDistances[ye],ye!=0){for(ee=ye;ee>=1;--ee)a._repDistances[ee]=a._repDistances[ee-1];a._repDistances[0]=$}}else{for(Xe(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,$i(a._lenEncoder,a._rangeEncoder,re-2,Fe),ye-=4,ie=Zi(ye),Be=ri(re),br(a._posSlotEncoder[Be],a._rangeEncoder,ie),ie>=4&&(ne=(ie>>1)-1,E=(2|ie&1)<<ne,it=ye-E,ie<14?Cc(a._posEncoders,E-ie-1,a._rangeEncoder,ne,it):(Ga(a._rangeEncoder,it>>4,ne-4),Na(a._posAlignEncoder,a._rangeEncoder,it&15),++a._alignPriceCount)),$=ye,ee=3;ee>=1;--ee)a._repDistances[ee]=a._repDistances[ee-1];a._repDistances[0]=$,++a._matchPriceCount}a._previousByte=X(a._matchFinder,re-1-a._additionalOffset)}if(a._additionalOffset-=re,a.nowPos64=d(a.nowPos64,F(re)),!a._additionalOffset){if(a._matchPriceCount>=128&&Pa(a),a._alignPriceCount>=16&&Ta(a),f[0]=a.nowPos64,g[0]=kc(a._rangeEncoder),!te(a._matchFinder)){Ji(a,S(a.nowPos64));return}if(D(Z(a.nowPos64,$e),[4096,0])>=0){a._finished=0,b[0]=0;return}}}}}function uc(a){var f,g;a._matchFinder||(f={},g=4,a._matchFinderType||(g=2),Nl(f,g),a._matchFinder=f),Sc(a._literalEncoder,a._numLiteralPosStateBits,a._numLiteralContextBits),!(a._dictionarySize==a._dictionarySizePrev&&a._numFastBytesPrev==a._numFastBytes)&&(Ll(a._matchFinder,a._dictionarySize,4096,a._numFastBytes,274),a._dictionarySizePrev=a._dictionarySize,a._numFastBytesPrev=a._numFastBytes)}function lc(a){var f;for(a._repDistances=h(4),a._optimum=[],a._rangeEncoder={},a._isMatch=h(192),a._isRep=h(12),a._isRepG0=h(12),a._isRepG1=h(12),a._isRepG2=h(12),a._isRep0Long=h(192),a._posSlotEncoder=[],a._posEncoders=h(114),a._posAlignEncoder=Dr({},4),a._lenEncoder=Ra({}),a._repMatchLenEncoder=Ra({}),a._literalEncoder={},a._matchDistances=[],a._posSlotPrices=[],a._distancesPrices=[],a._alignPrices=h(16),a.reps=h(4),a.repLens=h(4),a.processedInSize=[u],a.processedOutSize=[u],a.finished=[0],a.properties=h(5),a.tempPrices=h(128),a._longestMatchLength=0,a._matchFinderType=1,a._numDistancePairs=0,a._numFastBytesPrev=-1,a.backRes=0,f=0;f<4096;++f)a._optimum[f]={};for(f=0;f<4;++f)a._posSlotEncoder[f]=Dr({},6);return a}function Ta(a){for(var f=0;f<16;++f)a._alignPrices[f]=Pc(a._posAlignEncoder,f);a._alignPriceCount=0}function Pa(a){var f,g,b,E,P,L,$,ne;for(E=4;E<128;++E)L=Zi(E),b=(L>>1)-1,f=(2|L&1)<<b,a.tempPrices[E]=Mc(a._posEncoders,f-L-1,b,E-f);for(P=0;P<4;++P){for(g=a._posSlotEncoder[P],$=P<<6,L=0;L<a._distTableSize;++L)a._posSlotPrices[$+L]=oi(g,L);for(L=14;L<a._distTableSize;++L)a._posSlotPrices[$+L]+=(L>>1)-1-4<<6;for(ne=P*128,E=0;E<4;++E)a._distancesPrices[ne+E]=a._posSlotPrices[$+E];for(;E<128;++E)a._distancesPrices[ne+E]=a._posSlotPrices[$+Zi(E)]+a.tempPrices[E]}a._matchPriceCount=0}function Ji(a,f){xa(a),_c(a,f&a._posStateMask);for(var g=0;g<5;++g)es(a._rangeEncoder)}function cc(a,f){var g,b,E,P,L,$,ne,ee,re,Be,_e,ye,it,ie,Fe,$e,Te,kt,lt,Rt,Wt,vt,tr,li,Lt,zt,Ut,bt,Qt,et,ue,yn,Rn,ct,ht,Wa,Ot,Sr,Ln,Zt,nr,vr,Pe,st,rr,za,Ua,Xa,Ka,Ya;if(a._optimumEndIndex!=a._optimumCurrentIndex)return it=a._optimum[a._optimumCurrentIndex].PosPrev-a._optimumCurrentIndex,a.backRes=a._optimum[a._optimumCurrentIndex].BackPrev,a._optimumCurrentIndex=a._optimum[a._optimumCurrentIndex].PosPrev,it;if(a._optimumCurrentIndex=a._optimumEndIndex=0,a._longestMatchWasFound?(ye=a._longestMatchLength,a._longestMatchWasFound=0):ye=Qi(a),Ut=a._numDistancePairs,Lt=te(a._matchFinder)+1,Lt<2)return a.backRes=-1,1;for(Lt>273&&(Lt=273),Zt=0,re=0;re<4;++re)a.reps[re]=a._repDistances[re],a.repLens[re]=oe(a._matchFinder,-1,a.reps[re],273),a.repLens[re]>a.repLens[Zt]&&(Zt=re);if(a.repLens[Zt]>=a._numFastBytes)return a.backRes=Zt,it=a.repLens[Zt],Ma(a,it-1),it;if(ye>=a._numFastBytes)return a.backRes=a._matchDistances[Ut-1]+4,Ma(a,ye-1),ye;if(ne=X(a._matchFinder,-1),Te=X(a._matchFinder,-a._repDistances[0]-1-1),ye<2&&ne!=Te&&a.repLens[Zt]<2)return a.backRes=-1,1;if(a._optimum[0].State=a._state,ct=f&a._posStateMask,a._optimum[1].Price=Ce[a._isMatch[(a._state<<4)+ct]>>>2]+si(er(a._literalEncoder,f,a._previousByte),a._state>=7,Te,ne),Ia(a._optimum[1]),kt=Ce[2048-a._isMatch[(a._state<<4)+ct]>>>2],Ln=kt+Ce[2048-a._isRep[a._state]>>>2],Te==ne&&(nr=Ln+hc(a,a._state,ct),nr<a._optimum[1].Price&&(a._optimum[1].Price=nr,Ac(a._optimum[1]))),_e=ye>=a.repLens[Zt]?ye:a.repLens[Zt],_e<2)return a.backRes=a._optimum[1].BackPrev,1;a._optimum[1].PosPrev=0,a._optimum[0].Backs0=a.reps[0],a._optimum[0].Backs1=a.reps[1],a._optimum[0].Backs2=a.reps[2],a._optimum[0].Backs3=a.reps[3],Be=_e;do a._optimum[Be--].Price=268435455;while(Be>=2);for(re=0;re<4;++re)if(Sr=a.repLens[re],!(Sr<2)){Wa=Ln+$n(a,re,a._state,ct);do P=Wa+kn(a._repMatchLenEncoder,Sr-2,ct),ue=a._optimum[Sr],P<ue.Price&&(ue.Price=P,ue.PosPrev=0,ue.BackPrev=re,ue.Prev1IsChar=0);while(--Sr>=2)}if(li=kt+Ce[a._isRep[a._state]>>>2],Be=a.repLens[0]>=2?a.repLens[0]+1:2,Be<=ye){for(bt=0;Be>a._matchDistances[bt];)bt+=2;for(;ee=a._matchDistances[bt+1],P=li+Ca(a,ee,Be,ct),ue=a._optimum[Be],P<ue.Price&&(ue.Price=P,ue.PosPrev=0,ue.BackPrev=ee+4,ue.Prev1IsChar=0),!(Be==a._matchDistances[bt]&&(bt+=2,bt==Ut));++Be);}for(g=0;;){if(++g,g==_e)return Fa(a,g);if(lt=Qi(a),Ut=a._numDistancePairs,lt>=a._numFastBytes)return a._longestMatchLength=lt,a._longestMatchWasFound=1,Fa(a,g);if(++f,Rn=a._optimum[g].PosPrev,a._optimum[g].Prev1IsChar?(--Rn,a._optimum[g].Prev2?(Pe=a._optimum[a._optimum[g].PosPrev2].State,a._optimum[g].BackPrev2<4?Pe=Pe<7?8:11:Pe=Pe<7?7:10):Pe=a._optimum[Rn].State,Pe=bn(Pe)):Pe=a._optimum[Rn].State,Rn==g-1?a._optimum[g].BackPrev?Pe=bn(Pe):Pe=Pe<7?9:11:(a._optimum[g].Prev1IsChar&&a._optimum[g].Prev2?(Rn=a._optimum[g].PosPrev2,yn=a._optimum[g].BackPrev2,Pe=Pe<7?8:11):(yn=a._optimum[g].BackPrev,yn<4?Pe=Pe<7?8:11:Pe=Pe<7?7:10),et=a._optimum[Rn],yn<4?yn?yn==1?(a.reps[0]=et.Backs1,a.reps[1]=et.Backs0,a.reps[2]=et.Backs2,a.reps[3]=et.Backs3):yn==2?(a.reps[0]=et.Backs2,a.reps[1]=et.Backs0,a.reps[2]=et.Backs1,a.reps[3]=et.Backs3):(a.reps[0]=et.Backs3,a.reps[1]=et.Backs0,a.reps[2]=et.Backs1,a.reps[3]=et.Backs2):(a.reps[0]=et.Backs0,a.reps[1]=et.Backs1,a.reps[2]=et.Backs2,a.reps[3]=et.Backs3):(a.reps[0]=yn-4,a.reps[1]=et.Backs0,a.reps[2]=et.Backs1,a.reps[3]=et.Backs2)),a._optimum[g].State=Pe,a._optimum[g].Backs0=a.reps[0],a._optimum[g].Backs1=a.reps[1],a._optimum[g].Backs2=a.reps[2],a._optimum[g].Backs3=a.reps[3],$=a._optimum[g].Price,ne=X(a._matchFinder,-1),Te=X(a._matchFinder,-a.reps[0]-1-1),ct=f&a._posStateMask,b=$+Ce[a._isMatch[(Pe<<4)+ct]>>>2]+si(er(a._literalEncoder,f,X(a._matchFinder,-2)),Pe>=7,Te,ne),vt=a._optimum[g+1],Rt=0,b<vt.Price&&(vt.Price=b,vt.PosPrev=g,vt.BackPrev=-1,vt.Prev1IsChar=0,Rt=1),kt=$+Ce[2048-a._isMatch[(Pe<<4)+ct]>>>2],Ln=kt+Ce[2048-a._isRep[Pe]>>>2],Te==ne&&!(vt.PosPrev<g&&!vt.BackPrev)&&(nr=Ln+(Ce[a._isRepG0[Pe]>>>2]+Ce[a._isRep0Long[(Pe<<4)+ct]>>>2]),nr<=vt.Price&&(vt.Price=nr,vt.PosPrev=g,vt.BackPrev=0,vt.Prev1IsChar=0,Rt=1)),zt=te(a._matchFinder)+1,zt=4095-g<zt?4095-g:zt,Lt=zt,!(Lt<2)){if(Lt>a._numFastBytes&&(Lt=a._numFastBytes),!Rt&&Te!=ne&&(rr=Math.min(zt-1,a._numFastBytes),Fe=oe(a._matchFinder,0,a.reps[0],rr),Fe>=2)){for(st=bn(Pe),ht=f+1&a._posStateMask,tr=b+Ce[2048-a._isMatch[(st<<4)+ht]>>>2]+Ce[2048-a._isRep[st]>>>2],Qt=g+1+Fe;_e<Qt;)a._optimum[++_e].Price=268435455;P=tr+(za=kn(a._repMatchLenEncoder,Fe-2,ht),za+$n(a,0,st,ht)),ue=a._optimum[Qt],P<ue.Price&&(ue.Price=P,ue.PosPrev=g+1,ue.BackPrev=0,ue.Prev1IsChar=1,ue.Prev2=0)}for(vr=2,Ot=0;Ot<4;++Ot)if(ie=oe(a._matchFinder,-1,a.reps[Ot],Lt),!(ie<2)){$e=ie;do{for(;_e<g+ie;)a._optimum[++_e].Price=268435455;P=Ln+(Ua=kn(a._repMatchLenEncoder,ie-2,ct),Ua+$n(a,Ot,Pe,ct)),ue=a._optimum[g+ie],P<ue.Price&&(ue.Price=P,ue.PosPrev=g,ue.BackPrev=Ot,ue.Prev1IsChar=0)}while(--ie>=2);if(ie=$e,Ot||(vr=ie+1),ie<zt&&(rr=Math.min(zt-1-ie,a._numFastBytes),Fe=oe(a._matchFinder,ie,a.reps[Ot],rr),Fe>=2)){for(st=Pe<7?8:11,ht=f+ie&a._posStateMask,E=Ln+(Xa=kn(a._repMatchLenEncoder,ie-2,ct),Xa+$n(a,Ot,Pe,ct))+Ce[a._isMatch[(st<<4)+ht]>>>2]+si(er(a._literalEncoder,f+ie,X(a._matchFinder,ie-1-1)),1,X(a._matchFinder,ie-1-(a.reps[Ot]+1)),X(a._matchFinder,ie-1)),st=bn(st),ht=f+ie+1&a._posStateMask,Wt=E+Ce[2048-a._isMatch[(st<<4)+ht]>>>2],tr=Wt+Ce[2048-a._isRep[st]>>>2],Qt=ie+1+Fe;_e<g+Qt;)a._optimum[++_e].Price=268435455;P=tr+(Ka=kn(a._repMatchLenEncoder,Fe-2,ht),Ka+$n(a,0,st,ht)),ue=a._optimum[g+Qt],P<ue.Price&&(ue.Price=P,ue.PosPrev=g+ie+1,ue.BackPrev=0,ue.Prev1IsChar=1,ue.Prev2=1,ue.PosPrev2=g,ue.BackPrev2=Ot)}}if(lt>Lt){for(lt=Lt,Ut=0;lt>a._matchDistances[Ut];Ut+=2);a._matchDistances[Ut]=lt,Ut+=2}if(lt>=vr){for(li=kt+Ce[a._isRep[Pe]>>>2];_e<g+lt;)a._optimum[++_e].Price=268435455;for(bt=0;vr>a._matchDistances[bt];)bt+=2;for(ie=vr;;++ie)if(L=a._matchDistances[bt+1],P=li+Ca(a,L,ie,ct),ue=a._optimum[g+ie],P<ue.Price&&(ue.Price=P,ue.PosPrev=g,ue.BackPrev=L+4,ue.Prev1IsChar=0),ie==a._matchDistances[bt]){if(ie<zt&&(rr=Math.min(zt-1-ie,a._numFastBytes),Fe=oe(a._matchFinder,ie,L,rr),Fe>=2)){for(st=Pe<7?7:10,ht=f+ie&a._posStateMask,E=P+Ce[a._isMatch[(st<<4)+ht]>>>2]+si(er(a._literalEncoder,f+ie,X(a._matchFinder,ie-1-1)),1,X(a._matchFinder,ie-(L+1)-1),X(a._matchFinder,ie-1)),st=bn(st),ht=f+ie+1&a._posStateMask,Wt=E+Ce[2048-a._isMatch[(st<<4)+ht]>>>2],tr=Wt+Ce[2048-a._isRep[st]>>>2],Qt=ie+1+Fe;_e<g+Qt;)a._optimum[++_e].Price=268435455;P=tr+(Ya=kn(a._repMatchLenEncoder,Fe-2,ht),Ya+$n(a,0,st,ht)),ue=a._optimum[g+Qt],P<ue.Price&&(ue.Price=P,ue.PosPrev=g+ie+1,ue.BackPrev=0,ue.Prev1IsChar=1,ue.Prev2=1,ue.PosPrev2=g,ue.BackPrev2=L+4)}if(bt+=2,bt==Ut)break}}}}}function Ca(a,f,g,b){var E,P=ri(g);return f<128?E=a._distancesPrices[P*128+f]:E=a._posSlotPrices[(P<<6)+Dc(f)]+a._alignPrices[f&15],E+kn(a._lenEncoder,g-2,b)}function $n(a,f,g,b){var E;return f?(E=Ce[2048-a._isRepG0[g]>>>2],f==1?E+=Ce[a._isRepG1[g]>>>2]:(E+=Ce[2048-a._isRepG1[g]>>>2],E+=yr(a._isRepG2[g],f-2))):(E=Ce[a._isRepG0[g]>>>2],E+=Ce[2048-a._isRep0Long[(g<<4)+b]>>>2]),E}function hc(a,f,g){return Ce[a._isRepG0[f]>>>2]+Ce[a._isRep0Long[(f<<4)+g]>>>2]}function dc(a){ac(a),Rc(a._rangeEncoder),ke(a._isMatch),ke(a._isRep0Long),ke(a._isRep),ke(a._isRepG0),ke(a._isRepG1),ke(a._isRepG2),ke(a._posEncoders),vc(a._literalEncoder);for(var f=0;f<4;++f)ke(a._posSlotEncoder[f].Models);Ba(a._lenEncoder,1<<a._posStateBits),Ba(a._repMatchLenEncoder,1<<a._posStateBits),ke(a._posAlignEncoder.Models),a._longestMatchWasFound=0,a._optimumEndIndex=0,a._optimumCurrentIndex=0,a._additionalOffset=0}function Ma(a,f){f>0&&(Gl(a._matchFinder,f),a._additionalOffset+=f)}function Qi(a){var f=0;return a._numDistancePairs=Ol(a._matchFinder,a._matchDistances),a._numDistancePairs>0&&(f=a._matchDistances[a._numDistancePairs-2],f==a._numFastBytes&&(f+=oe(a._matchFinder,f-1,a._matchDistances[a._numDistancePairs-1],273-f))),++a._additionalOffset,f}function xa(a){a._matchFinder&&a._needReleaseMFStream&&(a._matchFinder._stream=null,a._needReleaseMFStream=0)}function fc(a){xa(a),a._rangeEncoder.Stream=null}function mc(a,f){a._dictionarySize=f;for(var g=0;f>1<<g;++g);a._distTableSize=g*2}function pc(a,f){var g=a._matchFinderType;a._matchFinderType=f,a._matchFinder&&g!=a._matchFinderType&&(a._dictionarySizePrev=-1,a._matchFinder=null)}function gc(a,f){a.properties[0]=(a._posStateBits*5+a._numLiteralPosStateBits)*9+a._numLiteralContextBits<<24>>24;for(var g=0;g<4;++g)a.properties[1+g]=a._dictionarySize>>8*g<<24>>24;A(f,a.properties,0,5)}function _c(a,f){if(a._writeEndMark){Xe(a._rangeEncoder,a._isMatch,(a._state<<4)+f,1),Xe(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,$i(a._lenEncoder,a._rangeEncoder,0,f);var g=ri(2);br(a._posSlotEncoder[g],a._rangeEncoder,63),Ga(a._rangeEncoder,67108863,26),Na(a._posAlignEncoder,a._rangeEncoder,15)}}function Zi(a){return a<2048?Zn[a]:a<2097152?Zn[a>>10]+20:Zn[a>>20]+40}function Dc(a){return a<131072?Zn[a>>6]+12:a<134217728?Zn[a>>16]+32:Zn[a>>26]+52}function bc(a,f,g,b){g<8?(Xe(f,a._choice,0,0),br(a._lowCoder[b],f,g)):(g-=8,Xe(f,a._choice,0,1),g<8?(Xe(f,a._choice,1,0),br(a._midCoder[b],f,g)):(Xe(f,a._choice,1,1),br(a._highCoder,f,g-8)))}function yc(a){a._choice=h(2),a._lowCoder=h(16),a._midCoder=h(16),a._highCoder=Dr({},8);for(var f=0;f<16;++f)a._lowCoder[f]=Dr({},3),a._midCoder[f]=Dr({},3);return a}function Ba(a,f){ke(a._choice);for(var g=0;g<f;++g)ke(a._lowCoder[g].Models),ke(a._midCoder[g].Models);ke(a._highCoder.Models)}function ka(a,f,g,b,E){var P,L,$,ne,ee;for(P=Ce[a._choice[0]>>>2],L=Ce[2048-a._choice[0]>>>2],$=L+Ce[a._choice[1]>>>2],ne=L+Ce[2048-a._choice[1]>>>2],ee=0,ee=0;ee<8;++ee){if(ee>=g)return;b[E+ee]=P+oi(a._lowCoder[f],ee)}for(;ee<16;++ee){if(ee>=g)return;b[E+ee]=$+oi(a._midCoder[f],ee-8)}for(;ee<g;++ee)b[E+ee]=ne+oi(a._highCoder,ee-8-8)}function $i(a,f,g,b){bc(a,f,g,b),--a._counters[b]==0&&(ka(a,b,a._tableSize,a._prices,b*272),a._counters[b]=a._tableSize)}function Ra(a){return yc(a),a._prices=[],a._counters=[],a}function kn(a,f,g){return a._prices[g*272+f]}function La(a,f){for(var g=0;g<f;++g)ka(a,g,a._tableSize,a._prices,g*272),a._counters[g]=a._tableSize}function Sc(a,f,g){var b,E;if(!(a.m_Coders!=null&&a.m_NumPrevBits==g&&a.m_NumPosBits==f))for(a.m_NumPosBits=f,a.m_PosMask=(1<<f)-1,a.m_NumPrevBits=g,E=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=h(E),b=0;b<E;++b)a.m_Coders[b]=Ec({})}function er(a,f,g){return a.m_Coders[((f&a.m_PosMask)<<a.m_NumPrevBits)+((g&255)>>>8-a.m_NumPrevBits)]}function vc(a){var f,g=1<<a.m_NumPrevBits+a.m_NumPosBits;for(f=0;f<g;++f)ke(a.m_Coders[f].m_Encoders)}function Oa(a,f,g){var b,E,P=1;for(E=7;E>=0;--E)b=g>>E&1,Xe(f,a.m_Encoders,P,b),P=P<<1|b}function wc(a,f,g,b){var E,P,L,$,ne=1,ee=1;for(P=7;P>=0;--P)E=b>>P&1,$=ee,ne&&(L=g>>P&1,$+=1+L<<8,ne=L==E),Xe(f,a.m_Encoders,$,E),ee=ee<<1|E}function Ec(a){return a.m_Encoders=h(768),a}function si(a,f,g,b){var E,P=1,L=7,$,ne=0;if(f){for(;L>=0;--L)if($=g>>L&1,E=b>>L&1,ne+=yr(a.m_Encoders[(1+$<<8)+P],E),P=P<<1|E,$!=E){--L;break}}for(;L>=0;--L)E=b>>L&1,ne+=yr(a.m_Encoders[P],E),P=P<<1|E;return ne}function Ia(a){a.BackPrev=-1,a.Prev1IsChar=0}function Ac(a){a.BackPrev=0,a.Prev1IsChar=0}function _r(a,f){return a.NumBitLevels=f,a.Models=h(1<<f),a}function ai(a,f){var g,b=1;for(g=a.NumBitLevels;g!=0;--g)b=(b<<1)+Dt(f,a.Models,b);return b-(1<<a.NumBitLevels)}function Fc(a,f){var g,b,E=1,P=0;for(b=0;b<a.NumBitLevels;++b)g=Dt(f,a.Models,E),E<<=1,E+=g,P|=g<<b;return P}function Tc(a,f,g,b){var E,P,L=1,$=0;for(P=0;P<b;++P)E=Dt(g,a,f+L),L<<=1,L+=E,$|=E<<P;return $}function Dr(a,f){return a.NumBitLevels=f,a.Models=h(1<<f),a}function br(a,f,g){var b,E,P=1;for(E=a.NumBitLevels;E!=0;)--E,b=g>>>E&1,Xe(f,a.Models,P,b),P=P<<1|b}function oi(a,f){var g,b,E=1,P=0;for(b=a.NumBitLevels;b!=0;)--b,g=f>>>b&1,P+=yr(a.Models[E],g),E=(E<<1)+g;return P}function Na(a,f,g){var b,E,P=1;for(E=0;E<a.NumBitLevels;++E)b=g&1,Xe(f,a.Models,P,b),P=P<<1|b,g>>=1}function Pc(a,f){var g,b,E=1,P=0;for(b=a.NumBitLevels;b!=0;--b)g=f&1,f>>>=1,P+=yr(a.Models[E],g),E=E<<1|g;return P}function Cc(a,f,g,b,E){var P,L,$=1;for(L=0;L<b;++L)P=E&1,Xe(g,a,f+$,P),$=$<<1|P,E>>=1}function Mc(a,f,g,b){var E,P,L=1,$=0;for(P=g;P!=0;--P)E=b&1,b>>>=1,$+=Ce[((a[f+L]-E^-E)&2047)>>>2],L=L<<1|E;return $}function Dt(a,f,g){var b,E=f[g];return b=(a.Range>>>11)*E,(a.Code^-2147483648)<(b^-2147483648)?(a.Range=b,f[g]=E+(2048-E>>>5)<<16>>16,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8),0):(a.Range-=b,a.Code-=b,f[g]=E-(E>>>5)<<16>>16,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8),1)}function xc(a,f){var g,b,E=0;for(g=f;g!=0;--g)a.Range>>>=1,b=a.Code-a.Range>>>31,a.Code-=a.Range&b-1,E=E<<1|1-b,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8);return E}function Bc(a){a.Code=0,a.Range=-1;for(var f=0;f<5;++f)a.Code=a.Code<<8|K(a.Stream)}function ke(a){for(var f=a.length-1;f>=0;--f)a[f]=1024}var Ce=(function(){var a,f,g,b,E=[];for(f=8;f>=0;--f)for(b=1<<9-f-1,a=1<<9-f,g=b;g<a;++g)E[g]=(f<<6)+(a-g<<6>>>9-f-1);return E})();function Xe(a,f,g,b){var E,P=f[g];E=(a.Range>>>11)*P,b?(a.Low=d(a.Low,m(F(E),[4294967295,0])),a.Range-=E,f[g]=P-(P>>>5)<<16>>16):(a.Range=E,f[g]=P+(2048-P>>>5)<<16>>16),a.Range&-16777216||(a.Range<<=8,es(a))}function Ga(a,f,g){for(var b=g-1;b>=0;--b)a.Range>>>=1,(f>>>b&1)==1&&(a.Low=d(a.Low,F(a.Range))),a.Range&-16777216||(a.Range<<=8,es(a))}function kc(a){return d(d(F(a._cacheSize),a._position),[4,0])}function Rc(a){a._position=u,a.Low=u,a.Range=-1,a._cacheSize=1,a._cache=0}function es(a){var f,g=S(W(a.Low,32));if(g!=0||D(a.Low,[4278190080,0])<0){a._position=d(a._position,F(a._cacheSize)),f=a._cache;do T(a.Stream,f+g),f=255;while(--a._cacheSize!=0);a._cache=S(a.Low)>>>24}++a._cacheSize,a.Low=x(m(a.Low,[16777215,0]),8)}function yr(a,f){return Ce[((a-f^-f)&2047)>>>2]}function Ha(a){for(var f=0,g=0,b,E,P,L=a.length,$=[],ne=[];f<L;++f,++g){if(b=a[f]&255,b&128)if((b&224)==192){if(f+1>=L||(E=a[++f]&255,(E&192)!=128))return a;ne[g]=(b&31)<<6|E&63}else if((b&240)==224){if(f+2>=L||(E=a[++f]&255,(E&192)!=128)||(P=a[++f]&255,(P&192)!=128))return a;ne[g]=(b&15)<<12|(E&63)<<6|P&63}else return a;else{if(!b)return a;ne[g]=b}g==16383&&($.push(String.fromCharCode.apply(String,ne)),g=-1)}return g>0&&(ne.length=g,$.push(String.fromCharCode.apply(String,ne))),$.join("")}function ja(a){var f,g=[],b,E=0,P,L=a.length;if(typeof a=="object")return a;for(y(a,0,L,g,0),P=0;P<L;++P)f=g[P],f>=1&&f<=127?++E:!f||f>=128&&f<=2047?E+=2:E+=3;for(b=[],E=0,P=0;P<L;++P)f=g[P],f>=1&&f<=127?b[E++]=f<<24>>24:!f||f>=128&&f<=2047?(b[E++]=(192|f>>6&31)<<24>>24,b[E++]=(128|f&63)<<24>>24):(b[E++]=(224|f>>12&15)<<24>>24,b[E++]=(128|f>>6&63)<<24>>24,b[E++]=(128|f&63)<<24>>24);return b}function ui(a){return a[1]+a[0]}function Lc(a,f,g,b){var E={},P,L,$=typeof g>"u"&&typeof b>"u";if(typeof g!="function"&&(L=g,g=b=0),b=b||function(ee){if(!(typeof L>"u"))return c(ee,L)},g=g||function(ee,re){if(!(typeof L>"u"))return postMessage({action:n,cbn:L,result:ee,error:re})},$){for(E.c=q({},ja(a),Va(f));ii(E.c.chunker););return _(E.c.output)}try{E.c=q({},ja(a),Va(f)),b(0)}catch(ee){return g(null,ee)}function ne(){try{for(var ee,re=new Date().getTime();ii(E.c.chunker);)if(P=ui(E.c.chunker.inBytesProcessed)/ui(E.c.length_0),new Date().getTime()-re>200)return b(P),r(ne,0),0;b(1),ee=_(E.c.output),r(g.bind(null,ee),0)}catch(Be){g(null,Be)}}r(ne,0)}function Oc(a,f,g){var b={},E,P,L,$,ne=typeof f>"u"&&typeof g>"u";if(typeof f!="function"&&(P=f,f=g=0),g=g||function(re){if(!(typeof P>"u"))return c(L?re:-1,P)},f=f||function(re,Be){if(!(typeof P>"u"))return postMessage({action:e,cbn:P,result:re,error:Be})},ne){for(b.d=be({},a);ii(b.d.chunker););return Ha(_(b.d.output))}try{b.d=be({},a),$=ui(b.d.length_0),L=$>-1,g(0)}catch(re){return f(null,re)}function ee(){try{for(var re,Be=0,_e=new Date().getTime();ii(b.d.chunker);)if(++Be%1e3==0&&new Date().getTime()-_e>200)return L&&(E=ui(b.d.chunker.decoder.nowPos64)/$,g(E)),r(ee,0),0;g(1),re=Ha(_(b.d.output)),r(f.bind(null,re),0)}catch(ye){f(null,ye)}}r(ee,0)}var Va=(function(){var a=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}];return function(f){return a[f-1]||a[6]}})();return{compress:Lc,decompress:Oc}})();const V0=ta.compress,W0=ta.decompress;class H{static MAX_COORDINATE_VALUE=131072;static MAX_PARSE_VALUE=2147483647;static parseInt(e,t=this.MAX_PARSE_VALUE,r=!1){return this._getValue(parseInt(e),t,r)}static parseFloat(e,t=this.MAX_PARSE_VALUE,r=!1){return this._getValue(parseFloat(e),t,r)}static parseEnum(e,t){const r=t.trim(),i=parseInt(r);if(i in e)return i;if(r in e)return e[r];throw new Error("Unknown enum value!")}static parseByte(e){const t=parseInt(e);if(t<0)throw new Error("Value must be greater than 0!");if(t>255)throw new Error("Value must be less than 255!");return this._getValue(t)}static _getValue(e,t=this.MAX_PARSE_VALUE,r=!1){if(e<-t)throw new Error("Value is too low!");if(e>t)throw new Error("Value is too high!");if(!r&&Number.isNaN(e))throw new Error("Not a number");return e}}class z0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim().split(",").map(u=>H.parseByte(u));if(s.length!==3&&s.length!==4)throw new Error(`Color specified in incorrect format (should be R,G,B or R,G,B,A): ${s.join(",")}`);const o=new En(s[0],s[1],s[2],s[3]);this.addColor(o,t,r.trim())}static addColor(e,t,r){if(r==="SliderTrackOverride"){t.colors.sliderTrackColor=e;return}if(r==="SliderBorder"){t.colors.sliderBorderColor=e;return}r.startsWith("Combo")&&t.colors.comboColors.push(e)}}class U0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"CircleSize":t.difficulty.circleSize=H.parseFloat(s);break;case"HPDrainRate":t.difficulty.drainRate=H.parseFloat(s);break;case"OverallDifficulty":t.difficulty.overallDifficulty=H.parseFloat(s);break;case"ApproachRate":t.difficulty.approachRate=H.parseFloat(s);break;case"SliderMultiplier":t.difficulty.sliderMultiplier=H.parseFloat(s);break;case"SliderTickRate":t.difficulty.sliderTickRate=H.parseFloat(s)}}}class X0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"Bookmarks":t.editor.bookmarks=s.split(",").map(o=>+o);break;case"DistanceSpacing":t.editor.distanceSpacing=Math.max(0,H.parseFloat(s));break;case"BeatDivisor":t.editor.beatDivisor=H.parseInt(s);break;case"GridSize":t.editor.gridSize=H.parseInt(s);break;case"TimelineZoom":t.editor.timelineZoom=Math.max(0,H.parseFloat(s))}}}class Du{static handleLine(e,t){const r=this._getDepth(e);switch(r>0&&(e=e.substring(r)),r<2&&this._storyboardSprite&&(this._timelineGroup=this._storyboardSprite.timelineGroup),r){case 0:return this._handleElement(e,t);case 1:return this._handleCompoundOrCommand(e);case 2:return this._handleCommand(e)}}static _handleElement(e,t){const r=e.split(","),i=this.parseEventType(r[0]);switch(this._storyboardSprite?.hasCommands&&(this._storyboardSprite.updateCommands(),this._storyboardSprite.adjustTimesToCommands(),this._storyboardSprite.resetValuesToCommands()),i){case ut.Video:{const s=t.getLayerByType(Pt.Video),o=H.parseInt(r[1]),u=r[2].replace(/"/g,"");s.elements.push(new hu(u,o));return}case ut.Sprite:{const s=t.getLayerByType(this.parseLayerType(r[1])),o=this.parseOrigin(r[2]),u=this.convertOrigin(o),l=r[3].replace(/"/g,""),c=H.parseFloat(r[4],H.MAX_COORDINATE_VALUE),h=H.parseFloat(r[5],H.MAX_COORDINATE_VALUE);this._storyboardSprite=new Ks(l,o,u,new he(c,h)),s.elements.push(this._storyboardSprite);return}case ut.Animation:{const s=t.getLayerByType(this.parseLayerType(r[1])),o=this.parseOrigin(r[2]),u=this.convertOrigin(o),l=r[3].replace(/"/g,""),c=H.parseFloat(r[4],H.MAX_COORDINATE_VALUE),h=H.parseFloat(r[5],H.MAX_COORDINATE_VALUE),d=H.parseInt(r[6]);let m=H.parseFloat(r[7]);t.fileFormat<6&&(m=Math.round(.015*m)*1.186*(1e3/60));const D=this.parseLoopType(r[8]);this._storyboardSprite=new lu(l,o,u,new he(c,h),d,m,D),s.elements.push(this._storyboardSprite);return}case ut.Sample:{const s=H.parseFloat(r[1]),o=t.getLayerByType(this.parseLayerType(r[2])),u=r[3].replace(/"/g,""),l=r.length>4?H.parseInt(r[4]):100,c=new cu(u,s,l);o.elements.push(c)}}}static _handleCompoundOrCommand(e){const t=e.split(",");switch(t[0]){case fr.Trigger:{this._timelineGroup=this._storyboardSprite?.addTrigger(t[1],t.length>2?H.parseFloat(t[2]):-1/0,t.length>3?H.parseFloat(t[3]):1/0,t.length>4?H.parseInt(t[4]):0);return}case fr.Loop:{this._timelineGroup=this._storyboardSprite?.addLoop(H.parseFloat(t[1]),Math.max(0,H.parseInt(t[2])-1));return}default:this._handleCommand(e)}}static _handleCommand(e){const t=e.split(","),r=t[0],i=H.parseInt(t[1]),s=H.parseInt(t[2]),o=H.parseInt(t[3]||t[2]);switch(r){case Me.Fade:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.alpha.add(r,i,s,o,u,l);return}case Me.Scale:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.scale.add(r,i,s,o,u,l);return}case Me.VectorScale:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=t.length>6?H.parseFloat(t[6]):u,h=t.length>7?H.parseFloat(t[7]):l;this._timelineGroup?.vectorScale.add(r,i,s,o,new he(u,l),new he(c,h));return}case Me.Rotation:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.rotation.add(r,i,s,o,u,l);return}case Me.Movement:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=t.length>6?H.parseFloat(t[6]):u,h=t.length>7?H.parseFloat(t[7]):l;this._timelineGroup?.x.add(Me.MovementX,i,s,o,u,c),this._timelineGroup?.y.add(Me.MovementY,i,s,o,l,h);return}case Me.MovementX:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.x.add(r,i,s,o,u,l);return}case Me.MovementY:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.y.add(r,i,s,o,u,l);return}case Me.Color:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=H.parseFloat(t[6]),h=t.length>7?H.parseFloat(t[7]):u,d=t.length>8?H.parseFloat(t[8]):l,m=t.length>9?H.parseFloat(t[9]):c;this._timelineGroup?.color.add(r,i,s,o,new En(u,l,c,1),new En(h,d,m,1));return}case Me.Parameter:return this._handleParameterCommand(t)}throw new Error(`Unknown command type: ${r}`)}static _handleParameterCommand(e){const t=Me.Parameter,r=H.parseInt(e[1]),i=H.parseInt(e[2]),s=H.parseInt(e[3]||e[2]),o=e[4];switch(o){case on.BlendingMode:{const u=gt.Additive,l=i===s?gt.Additive:gt.Inherit;this._timelineGroup?.blendingParameters.add(t,r,i,s,u,l,o);return}case on.HorizontalFlip:this._timelineGroup?.flipH.add(t,r,i,s,!0,i===s,o);return;case on.VerticalFlip:{this._timelineGroup?.flipV.add(t,r,i,s,!0,i===s,o);return}}throw new Error(`Unknown parameter type: ${o}`)}static parseEventType(e){if(e.startsWith(" ")||e.startsWith("_"))return ut.StoryboardCommand;try{return H.parseEnum(ut,e)}catch{throw new Error(`Unknown event type: ${e}`)}}static parseLayerType(e){try{return H.parseEnum(Pt,e)}catch{throw new Error(`Unknown layer type: ${e}`)}}static parseOrigin(e){try{return H.parseEnum(dt,e)}catch{return dt.TopLeft}}static convertOrigin(e){switch(e){case dt.TopLeft:return wt.TopLeft;case dt.TopCentre:return wt.TopCentre;case dt.TopRight:return wt.TopRight;case dt.CentreLeft:return wt.CentreLeft;case dt.Centre:return wt.Centre;case dt.CentreRight:return wt.CentreRight;case dt.BottomLeft:return wt.BottomLeft;case dt.BottomCentre:return wt.BottomCentre;case dt.BottomRight:return wt.BottomRight}return wt.TopLeft}static parseLoopType(e){try{return H.parseEnum(Vr,e)}catch{return Vr.LoopForever}}static _getDepth(e){let t=0;for(const r of e){if(r!==" "&&r!=="_")break;++t}return t}}class K0{static handleLine(e,t,r,i){const s=e.split(",").map((u,l)=>l?u.trim():u);switch(Du.parseEventType(s[0])){case ut.Background:t.events.backgroundPath=s[2].replace(/"/g,"");break;case ut.Break:{const u=H.parseFloat(s[1])+i,l=Math.max(u,H.parseFloat(s[2])+i),c=new u0(u,l);t.events.breaks||(t.events.breaks=[]),t.events.breaks.push(c);break}case ut.Video:case ut.Sample:case ut.Sprite:case ut.Animation:case ut.StoryboardCommand:r&&r.push(e)}}}class Y0{static handleLine(e,t,r){const[i,...s]=e.split(":"),o=s.join(":").trim();switch(i.trim()){case"AudioFilename":t.general.audioFilename=o;break;case"AudioHash":t.general.audioHash=o;break;case"OverlayPosition":t.general.overlayPosition=o;break;case"SkinPreference":t.general.skinPreference=o;break;case"AudioLeadIn":t.general.audioLeadIn=H.parseInt(o);break;case"PreviewTime":t.general.previewTime=H.parseInt(o)+r;break;case"Countdown":t.general.countdown=H.parseInt(o);break;case"StackLeniency":t.general.stackLeniency=H.parseFloat(o);break;case"Mode":t.originalMode=H.parseInt(o);break;case"CountdownOffset":t.general.countdownOffset=H.parseInt(o);break;case"SampleSet":t.general.sampleSet=Re[o];break;case"LetterboxInBreaks":t.general.letterboxInBreaks=o==="1";break;case"StoryFireInFront":t.general.storyFireInFront=o==="1";break;case"UseSkinSprites":t.general.useSkinSprites=o==="1";break;case"AlwaysShowPlayfield":t.general.alwaysShowPlayfield=o==="1";break;case"EpilepsyWarning":t.general.epilepsyWarning=o==="1";break;case"SpecialStyle":t.general.specialStyle=o==="1";break;case"WidescreenStoryboard":t.general.widescreenStoryboard=o==="1";break;case"SamplesMatchPlaybackRate":t.general.samplesMatchPlaybackRate=o==="1"}}}class q0 extends Qr{isNewCombo=!1;comboOffset=0;clone(){const e=super.clone();return e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}class J0 extends Qr{endTime=0;nodeSamples=[];get duration(){return this.endTime-this.startTime}clone(){const e=super.clone();return e.endTime=this.endTime,e.nestedHitObjects=this.nestedHitObjects.map(t=>t.clone()),e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e}}class na extends Qr{static BASE_SCORING_DISTANCE=100;get duration(){return this.spans*this.spanDuration}get endTime(){return this.startTime+this.duration}get spans(){return this.repeats+1}set spans(e){this.repeats=e-1}get spanDuration(){return this.distance/this.velocity}get distance(){return this.path.distance}set distance(e){this.path.distance=e}repeats=0;velocity=1;path=new Zs;legacyLastTickOffset=36;nodeSamples=[];isNewCombo=!1;comboOffset=0;applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const r=e.timingPointAt(this.startTime),i=e.difficultyPointAt(this.startTime),s=na.BASE_SCORING_DISTANCE*t.sliderMultiplier*i.sliderVelocity;this.velocity=s/r.beatLength}clone(){const e=super.clone();return e.legacyLastTickOffset=this.legacyLastTickOffset,e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e.velocity=this.velocity,e.repeats=this.repeats,e.path=this.path.clone(),e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}class Q0 extends Qr{endTime=0;isNewCombo=!1;comboOffset=0;get duration(){return this.endTime-this.startTime}clone(){const e=super.clone();return e.endTime=this.endTime,e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}let mt;(function(n){n.Beatmap=".osu",n.Storyboard=".osb",n.Replay=".osr"})(mt||(mt={}));let It;(function(n){n[n.FileFormat=0]="FileFormat",n[n.Section=1]="Section",n[n.Empty=2]="Empty",n[n.Data=3]="Data",n[n.Break=4]="Break"})(It||(It={}));let Oe;(function(n){n.General="General",n.Editor="Editor",n.Metadata="Metadata",n.Difficulty="Difficulty",n.Events="Events",n.TimingPoints="TimingPoints",n.Colours="Colours",n.HitObjects="HitObjects",n.Variables="Variables",n.Fonts="Fonts",n.CatchTheBeat="CatchTheBeat",n.Mania="Mania"})(Oe||(Oe={}));const ln=function(){throw new Error("Filesystem operations are not available in a browser environment")};class Z0{static encodeColors(e){const t=e.colors;if(Object.keys(t).length===1&&!t.comboColors.length)return"";const r=["[Colours]"];return t.comboColors.forEach((i,s)=>{r.push(`Combo${s+1}:${i}`)}),t.sliderTrackColor&&r.push(`SliderTrackOverride:${t.sliderTrackColor}`),t.sliderBorderColor&&r.push(`SliderBorder:${t.sliderBorderColor}`),r.join(`
`)}}class $0{static encodeDifficultySection(e){const t=["[Difficulty]"],r=e.difficulty;return t.push(`HPDrainRate:${r.drainRate}`),t.push(`CircleSize:${r.circleSize}`),t.push(`OverallDifficulty:${r.overallDifficulty}`),t.push(`ApproachRate:${r.approachRate}`),t.push(`SliderMultiplier:${r.sliderMultiplier}`),t.push(`SliderTickRate:${r.sliderTickRate}`),t.join(`
`)}}class ed{static encodeEditorSection(e){const t=["[Editor]"],r=e.editor;return t.push(`Bookmarks:${r.bookmarks.join(",")}`),t.push(`DistanceSpacing:${r.distanceSpacing}`),t.push(`BeatDivisor:${r.beatDivisor}`),t.push(`GridSize:${r.gridSize}`),t.push(`TimelineZoom:${r.timelineZoom}`),t.join(`
`)}}class io{static encodeEventSection(e){const t=[];return t.push("[Events]"),t.push("//Background and Video events"),t.push(this.encodeVideos(e)),t.push(this.encodeStoryboard(e)),t.join(`
`)}static encodeVideos(e){const t=[],r=e.getLayerByType(Pt.Video);return r.elements.length>0&&t.push(this.encodeStoryboardLayer(r)),t.join(`
`)}static encodeStoryboard(e){const t=[];t.push("//Storyboard Layer 0 (Background)");const r=e.getLayerByType(Pt.Background);r.elements.length>0&&t.push(this.encodeStoryboardLayer(r)),t.push("//Storyboard Layer 1 (Fail)");const i=e.getLayerByType(Pt.Fail);i.elements.length>0&&t.push(this.encodeStoryboardLayer(i)),t.push("//Storyboard Layer 2 (Pass)");const s=e.getLayerByType(Pt.Pass);s.elements.length>0&&t.push(this.encodeStoryboardLayer(s)),t.push("//Storyboard Layer 3 (Foreground)");const o=e.getLayerByType(Pt.Foreground);o.elements.length>0&&t.push(this.encodeStoryboardLayer(o)),t.push("//Storyboard Layer 4 (Overlay)");const u=e.getLayerByType(Pt.Overlay);return u.elements.length>0&&t.push(this.encodeStoryboardLayer(u)),t.join(`
`)}static encodeStoryboardLayer(e){const t=[];return e.elements.forEach(r=>{t.push(this.encodeStoryboardElement(r,e.name));const i=r;i?.loops?.forEach(s=>{s.commands.length>0&&(t.push(this.encodeCompound(s)),t.push(this.encodeTimelineGroup(s,2)))}),i?.timelineGroup?.commands.length>0&&t.push(this.encodeTimelineGroup(i.timelineGroup)),i?.triggers?.forEach(s=>{s.commands.length>0&&(t.push(this.encodeCompound(s)),t.push(this.encodeTimelineGroup(s,2)))})}),t.join(`
`)}static encodeStoryboardElement(e,t){return e instanceof lu?["Animation",t,dt[e.origin],`"${e.filePath}"`,e.startPosition,e.frameCount,e.frameDelay,e.loopType].join(","):e instanceof Ks?["Sprite",t,dt[e.origin],`"${e.filePath}"`,e.startPosition].join(","):e instanceof cu?["Sample",e.startTime,t,`"${e.filePath}"`,e.volume].join(","):e instanceof hu?["Video",e.startTime,e.filePath,"0,0"].join(","):""}static encodeCompound(e,t=1){const r="".padStart(t," ");return e instanceof ou?r+[e.type,e.loopStartTime,e.totalIterations].join(","):e instanceof uu?r+[e.type,e.triggerName,e.triggerStartTime,e.triggerEndTime,e.groupNumber].join(","):""}static encodeTimelineGroup(e,t=1){const r="".padStart(t," "),i=[],s=e.commands;let o=!1;for(let u=0;u<s.length;++u){if(o){o=!1;continue}if(u<s.length-1){const l=s[u],c=s[u+1],h=l.type===Me.MovementX,d=c.type===Me.MovementY,m=l.easing===c.easing,D=l.startTime===c.startTime,p=l.endTime===c.endTime;if(h&&d&&(m&&D&&p)){i.push(r+this.encodeMoveCommand(l,c)),o=!0;continue}}i.push(r+this.encodeCommand(s[u]))}return i.join(`
`)}static encodeMoveCommand(e,t){const r=[Me.Movement,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",e.startValue,t.startValue],i=e.startValue===e.endValue,s=t.startValue===t.endValue;return(!i||!s)&&r.push(`${e.endValue},${t.endValue}`),r.join(",")}static encodeCommand(e){return[e.type,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",this._encodeCommandParams(e)].join(",")}static _encodeCommandParams(e){if(e.type===Me.Parameter)return e.parameter;if(e.type===Me.Color){const t=o=>`${o.red},${o.green},${o.blue}`,r=e,i=r.startValue,s=r.endValue;return this._areValuesEqual(e)?t(i):t(i)+","+t(s)}return this._areValuesEqual(e)?`${e.startValue}`:`${e.startValue},${e.endValue}`}static _areValuesEqual(e){if(e.type===Me.VectorScale){const t=e;return t.startValue.equals(t.endValue)}if(e.type===Me.Color){const t=e;return t.startValue.equals(t.endValue)}return e.startValue===e.endValue}}class td{static encodeEventSection(e){const t=[],r=e.events;return t.push("[Events]"),t.push("//Background and Video events"),r.backgroundPath&&t.push(`0,0,"${r.backgroundPath}",0,0`),r.storyboard&&t.push(io.encodeVideos(r.storyboard)),t.push("//Break Periods"),r.breaks&&r.breaks.length>0&&r.breaks.forEach(i=>{t.push(`${ut[ut.Break]},${i.startTime},${i.endTime}`)}),r.storyboard&&t.push(io.encodeStoryboard(r.storyboard)),t.join(`
`)}}class nd{static encodeGeneralSection(e){const t=["[General]"],r=e.general;return t.push(`AudioFilename:${r.audioFilename}`),t.push(`AudioLeadIn:${r.audioLeadIn}`),r.audioHash&&t.push(`AudioHash:${r.audioHash}`),t.push(`PreviewTime:${r.previewTime}`),t.push(`Countdown:${r.countdown}`),t.push(`SampleSet:${Re[r.sampleSet]}`),t.push(`StackLeniency:${r.stackLeniency}`),t.push(`Mode:${e.mode}`),t.push(`LetterboxInBreaks:${+r.letterboxInBreaks}`),r.storyFireInFront&&t.push(`StoryFireInFront:${+r.storyFireInFront}`),t.push(`UseSkinSprites:${+r.useSkinSprites}`),r.alwaysShowPlayfield&&t.push(`AlwaysShowPlayfield:${+r.alwaysShowPlayfield}`),t.push(`OverlayPosition:${r.overlayPosition}`),t.push(`SkinPreference:${r.skinPreference}`),t.push(`EpilepsyWarning:${+r.epilepsyWarning}`),t.push(`CountdownOffset:${r.countdownOffset}`),t.push(`SpecialStyle:${+r.specialStyle}`),t.push(`WidescreenStoryboard:${+r.widescreenStoryboard}`),t.push(`SamplesMatchPlaybackRate:${+r.samplesMatchPlaybackRate}`),t.join(`
`)}}class rd{static encodeHitObjects(e){const t=["[HitObjects]"];return e.difficulty,e.hitObjects.forEach(i=>{const s=[],u=i.startPosition,l=new he(u?u.x:256,u?u.y:192);s.push(l.toString()),s.push(i.startTime.toString()),s.push(i.hitType.toString()),s.push(i.hitSound.toString());const c=[];if(i.hitType&fe.Slider){const S=i;c.push(this.encodePathData(S,l))}else if(i.hitType&fe.Spinner){const S=i;c.push(this.encodeEndTimeData(S))}else if(i.hitType&fe.Hold){const S=i;c.push(this.encodeEndTimeData(S))}const h=[],d=i.samples.find(S=>S.hitSound===ce[ce.Normal]),m=i.samples.find(S=>S.hitSound!==ce[ce.Normal]);let D=Re.None,p=Re.None;d&&(D=Re[d.sampleSet]),m&&(p=Re[m.sampleSet]),h[0]=D.toString(),h[1]=p.toString(),h[2]=i.samples[0].customIndex.toString(),h[3]=i.samples[0].volume.toString(),h[4]=i.samples[0].filename,c.push(h.join(":"));const v=s.join(","),F=i.hitType&fe.Hold?c.join(":"):c.join(",");t.push([v,F].join(","))}),t.join(`
`)}static encodePathData(e,t){const r=[];let i;e.path.controlPoints.forEach((l,c)=>{if(l.type!==null){let h=l.type!==i||l.type===ft.PerfectCurve;if(c>1){const d=t.add(e.path.controlPoints[c-1].position),m=t.add(e.path.controlPoints[c-2].position);~~d.x===~~m.x&&~~d.y===~~m.y&&(h=!0)}h?(r.push(e.path.curveType),i=l.type):r.push(`${t.x+l.position.x}:${t.y+l.position.y}`)}c!==0&&r.push(`${t.x+l.position.x}:${t.y+l.position.y}`)});const s=[];s.push(r.join("|")),s.push((e.repeats+1).toString()),s.push(e.distance.toString());const o=[],u=[];return e.nodeSamples.forEach((l,c)=>{o[c]=ce.None,u[c]=[Re.None,Re.None],l.forEach((h,d)=>{d===0?u[c][0]=Re[h.sampleSet]:(o[c]|=ce[h.hitSound],u[c][1]=Re[h.sampleSet])})}),s.push(o.join("|")),s.push(u.map(l=>l.join(":")).join("|")),s.join(",")}static encodeEndTimeData(e){return e.endTime.toString()}}class id{static encodeMetadataSection(e){const t=["[Metadata]"],r=e.metadata;return t.push(`Title:${r.title}`),t.push(`TitleUnicode:${r.titleUnicode}`),t.push(`Artist:${r.artist}`),t.push(`ArtistUnicode:${r.artistUnicode}`),t.push(`Creator:${r.creator}`),t.push(`Version:${r.version}`),t.push(`Source:${r.source}`),t.push(`Tags:${r.tags.join(" ")}`),t.push(`BeatmapID:${r.beatmapId}`),t.push(`BeatmapSetID:${r.beatmapSetId}`),t.join(`
`)}}class sd{static lastDifficultyPoint=null;static lastEffectPoint=null;static lastSamplePoint=null;static encodeControlPoints(e){const t=["[TimingPoints]"];return e.controlPoints.groups.forEach(r=>{r.controlPoints.find(o=>o.beatLength)&&t.push(this.encodeGroup(r,!0)),t.push(this.encodeGroup(r))}),t.join(`
`)}static encodeGroup(e,t=!1){const{difficultyPoint:r,effectPoint:i,samplePoint:s,timingPoint:o}=this.updateActualPoints(e),u=e.startTime;let l=-100;r!==null&&(l/=r.sliderVelocity);let c=Re.None,h=0,d=100;s!==null&&(c=Re[s.sampleSet],h=s.customIndex,d=s.volume);let m=Yt.None;if(i!==null){const v=i.kiai?Yt.Kiai:Yt.None,F=i.omitFirstBarLine?Yt.OmitFirstBarLine:Yt.None;m|=v|F}let D=zr.SimpleQuadruple,p=0;return t&&o!==null&&(l=o.beatLength,D=o.timeSignature,p=1),[u,l,D,c,h,d,p,m].join(",")}static updateActualPoints(e){let t=null;return e.controlPoints.forEach(r=>{r.pointType===Qe.DifficultyPoint&&!r.isRedundant(this.lastDifficultyPoint)&&(this.lastDifficultyPoint=r),r.pointType===Qe.EffectPoint&&!r.isRedundant(this.lastEffectPoint)&&(this.lastEffectPoint=r),r.pointType===Qe.SamplePoint&&!r.isRedundant(this.lastSamplePoint)&&(this.lastSamplePoint=r),r.pointType===Qe.TimingPoint&&(t=r)}),{timingPoint:t,difficultyPoint:this.lastDifficultyPoint,effectPoint:this.lastEffectPoint,samplePoint:this.lastSamplePoint}}}class so{static encodeLifeBar(e){return e.length?e.map(t=>`${t.startTime}|${t.health}`).join(","):""}static encodeReplayFrames(e,t){const r=[];if(e){let i=0;e.forEach(s=>{const o=Math.round(s.startTime),u=this._getLegacyFrame(s,t),l=[o-i,u?.mouseX??0,u?.mouseY??0,u?.buttonState??Kt.None];r.push(l.join("|")),i=o})}return r.push("-12345|0|0|0"),r.join(",")}static _getLegacyFrame(e,t){if(e instanceof Gi)return e;const r=e;if(r.toLegacy)return r.toLegacy(t);throw new Error("Some of the replay frames can not be converted to the legacy format!")}}const ad=new TextDecoder;function od(n){if(n.length<=0)return new Uint8Array(0);const e=n.reduce((r,i)=>r+i.byteLength,0),t=new Uint8Array(e);return n.reduce((r,i)=>(t.set(new Uint8Array(i.buffer),r),r+i.byteLength),0),t}function Kr(n){return typeof n=="string"?n:ad.decode(n)}class bu{static _lzma=ud();static async decompress(e){try{return await this._lzma.decompress(e)}catch{return""}}static async compress(e){try{return await this._lzma.compress(e,1)}catch{return new Uint8Array([])}}}function ud(){return{decompress(n){return new Promise((e,t)=>{W0(n,(r,i)=>{i?t(i):e(typeof r=="string"?r:new Uint8Array(r).toString())})})},compress(n){return new Promise((e,t)=>{V0(n,1,(r,i)=>{i?t(i):e(new Uint8Array(r))})})}}}class ld{_bytesWritten=0;_views=[];get bytesWritten(){return this._bytesWritten}finish(){return od(this._views)}async compressData(e){return bu.compress(e)}writeByte(e){return this._update(1,new Uint8Array([e]))}writeBytes(e){return this.writeInteger(e.byteLength),this._bytesWritten+=e.byteLength,this._views.push(e),e.byteLength}writeShort(e){return this._update(2,new Uint16Array([e]))}writeInteger(e){return this._update(4,new Int32Array([e]))}writeLong(e){return this._update(8,new BigInt64Array([e]))}writeDate(e){const t=BigInt(621355968e5),r=BigInt(e.getTime());return this.writeLong((r+t)*BigInt(1e4))}writeString(e){if(e.length===0)return this.writeByte(0);let t=this.writeByte(11);t+=this.writeULEB128(e.length);const r=new Uint8Array(e.length);for(let i=0;i<e.length;++i)r[i]=e.charCodeAt(i),t++;return this._update(t,r),t}writeULEB128(e){let t=0,r=0;do t=e&127,e>>=7,e!==0&&(t|=128),r+=this.writeByte(t);while(e!==0);return r}_update(e,t){return this._bytesWritten+=e,this._views.push(t),e}}class ra{static FIRST_LAZER_VERSION=128;async encodeToPath(e,t){e.endsWith(mt.Beatmap)||(e+=mt.Beatmap);try{await ln(ln(e),{recursive:!0}),await ln(e,await this.encodeToString(t))}catch(r){const i=r.message||r;throw new Error(`Failed to encode a beatmap: ${i}`)}}encodeToString(e){return e?.fileFormat?[`osu file format v${e.fileFormat??ra.FIRST_LAZER_VERSION}`,nd.encodeGeneralSection(e),ed.encodeEditorSection(e),id.encodeMetadataSection(e),$0.encodeDifficultySection(e),td.encodeEventSection(e),sd.encodeControlPoints(e),Z0.encodeColors(e),rd.encodeHitObjects(e)].join(`

`)+`
`:""}}class Yr{static LATEST_VERSION=30000016;static DEFAULT_GAME_VERSION=Yr.LATEST_VERSION;static FIRST_LAZER_VERSION=3e7;async encodeToPath(e,t,r){e.endsWith(mt.Replay)||(e+=mt.Replay);const i=await this.encodeToBuffer(t,r);try{await ln(ln(e),{recursive:!0}),await ln(e,new Uint8Array(i))}catch(s){const o=s.message||s;throw new Error(`Failed to encode a score: ${o}`)}}async encodeToBuffer(e,t){if(typeof e?.info?.id!="number")return new Uint8Array;const r=new ld;try{if(r.writeByte(e.info.rulesetId),r.writeInteger(Yr.LATEST_VERSION),r.writeString(e.info.beatmapHashMD5??""),r.writeString(e.info.username),r.writeString(e.replay?.hashMD5??""),r.writeShort(e.info.count300),r.writeShort(e.info.count100),r.writeShort(e.info.count50),r.writeShort(e.info.countGeki),r.writeShort(e.info.countKatu),r.writeShort(e.info.countMiss),r.writeInteger(e.info.totalScore),r.writeShort(e.info.maxCombo),r.writeByte(Number(e.info.perfect)),r.writeInteger((e.info.mods?.bitwise??Number(e.info.rawMods))||0),r.writeString(so.encodeLifeBar(e.replay?.lifeBar??[])),r.writeDate(e.info.date),e.replay){const s=so.encodeReplayFrames(e.replay.frames,t);r.writeBytes(await r.compressData(s))}else r.writeInteger(0);r.writeLong(BigInt(e.info.id));const i=JSON.stringify(Xr.fromScore(e.info));return r.writeBytes(await r.compressData(i)),r.finish()}catch(i){const s=i.message||i;throw new Error(`Failed to encode a score: '${s}'`)}}}class cd{static _forceNewCombo=!1;static _extraComboOffset=0;static handleLine(e,t,r){const i=e.split(",").map(l=>l.trim()),s=H.parseInt(i[3]),o=this.createHitObject(s);o.startX=H.parseInt(i[0],H.MAX_COORDINATE_VALUE),o.startY=H.parseInt(i[1],H.MAX_COORDINATE_VALUE),o.startTime=H.parseFloat(i[2])+r,o.hitType=s,o.hitSound=H.parseInt(i[4]);const u=new $s;this.addExtras(i.slice(5),o,u,r,t.fileFormat),this.addComboOffset(o,t),o.samples.length===0&&(o.samples=this.convertSoundType(o.hitSound,u)),t.hitObjects.push(o)}static addComboOffset(e,t){const r=t.originalMode===0,i=t.originalMode===2;if(!r&&!i)return;const s=e,o=Math.trunc((e.hitType&fe.ComboOffset)>>4),u=!!(e.hitType&fe.NewCombo);(e.hitType&fe.Normal||e.hitType&fe.Slider)&&(s.isNewCombo=u||this._forceNewCombo,s.comboOffset=o+this._extraComboOffset,this._forceNewCombo=!1,this._extraComboOffset=0),e.hitType&fe.Spinner&&(this._forceNewCombo=t.fileFormat<=8||u||!1,this._extraComboOffset+=o)}static addExtras(e,t,r,i,s){if(t.hitType&fe.Normal&&e.length>0&&this.readCustomSampleBanks(e[0],r),t.hitType&fe.Slider)return this.addSliderExtras(e,t,r,s);if(t.hitType&fe.Spinner)return this.addSpinnerExtras(e,t,r,i);if(t.hitType&fe.Hold)return this.addHoldExtras(e,t,r,i)}static addSliderExtras(e,t,r,i){const s=e[0],o=t.startPosition,u=H.parseInt(e[1]);if(t.repeats>9e3)throw new Error("Repeat count is way too high");if(t.repeats=Math.max(0,u-1),t.path.controlPoints=this.convertPathString(s,o,i),t.path.curveType=t.path.controlPoints[0].type,e.length>2){const l=H.parseFloat(e[2],H.MAX_COORDINATE_VALUE);t.path.expectedDistance=Math.max(0,l)}e.length>5&&this.readCustomSampleBanks(e[5],r),t.samples=this.convertSoundType(t.hitSound,r),t.nodeSamples=this.getSliderNodeSamples(e,t,r)}static addSpinnerExtras(e,t,r,i){t.endTime=H.parseInt(e[0])+i,e.length>1&&this.readCustomSampleBanks(e[1],r)}static addHoldExtras(e,t,r,i){if(t.endTime=t.startTime,e.length>0&&e[0]){const s=e[0].split(":");t.endTime=Math.max(t.endTime,H.parseFloat(s[0]))+i,this.readCustomSampleBanks(s.slice(1).join(":"),r)}}static getSliderNodeSamples(e,t,r){const i=t.repeats+2,s=[];for(let l=0;l<i;++l)s.push(r.clone());if(e.length>4&&e[4].length>0){const l=e[4].split("|");for(let c=0;c<i&&!(c>=l.length);++c)this.readCustomSampleBanks(l[c],s[c])}const o=[];for(let l=0;l<i;++l)o.push(t.hitSound);if(e.length>3&&e[3].length>0){const l=e[3].split("|");for(let c=0;c<i&&!(c>=l.length);++c)o[c]=parseInt(l[c])||ce.None}const u=[];for(let l=0;l<i;l++)u.push(this.convertSoundType(o[l],s[l]));return u}static convertPathString(e,t,r){const i=e.split("|").map(c=>c.trim()),s=[];let o=0,u=0,l=!0;for(;++u<i.length;){if(i[u].length>1)continue;const c=i.slice(o,u),h=u<i.length-1?i[u+1]:null,d=this.convertPoints(c,h,l,t,r);for(const m of d)s.push(...m);o=u,l=!1}if(u>o){const c=i.slice(o,u),h=this.convertPoints(c,null,l,t,r);for(const d of h)s.push(...d)}return s}static*convertPoints(e,t,r,i,s){const o=r?1:0,u=t!==null?1:0,l=[];o===1&&(l[0]=new ys);for(let p=1;p<e.length;++p)l[o+p-1]=m(e[p],i);t!==null&&(l[l.length-1]=m(t,i));let c=this.convertPathType(e[0]);c===ft.PerfectCurve&&(l.length!==3?c=ft.Bezier:D(l)&&(c=ft.Linear)),l[0].type=c;let h=0,d=0;for(;++d<l.length-u;){if(!l[d].position.equals(l[d-1].position))continue;const p=s<ra.FIRST_LAZER_VERSION;c===ft.Catmull&&d>1&&p||d!==l.length-u-1&&(l[d-1].type=c,yield l.slice(h,d),h=d+1)}d>h&&(yield l.slice(h,d));function m(p,v){const F=p.split(":").map(C=>Math.trunc(H.parseFloat(C,H.MAX_COORDINATE_VALUE))),S=new he(F[0],F[1]).fsubtract(v);return new ys(S)}function D(p){const v=(p[1].position.y-p[0].position.y)*(p[2].position.x-p[0].position.x),F=(p[1].position.x-p[0].position.x)*(p[2].position.y-p[0].position.y);return Math.abs(v-F)<.001}}static convertPathType(e){switch(e){default:case"C":return ft.Catmull;case"B":return ft.Bezier;case"L":return ft.Linear;case"P":return ft.PerfectCurve}}static readCustomSampleBanks(e,t){if(!e)return;const r=e.split(":");t.normalSet=H.parseInt(r[0]),t.additionSet=H.parseInt(r[1]),t.additionSet===Re.None&&(t.additionSet=t.normalSet),r.length>2&&(t.customIndex=H.parseInt(r[2])),r.length>3&&(t.volume=Math.max(0,H.parseInt(r[3]))),t.filename=r.length>4?r[4]:""}static convertSoundType(e,t){if(t.filename){const i=new jn;return i.filename=t.filename,i.volume=t.volume,[i]}const r=[new jn];if(r[0].hitSound=ce[ce.Normal],r[0].sampleSet=Re[t.normalSet],r[0].isLayered=e!==ce.None&&!(e&ce.Normal),e&ce.Finish){const i=new jn;i.hitSound=ce[ce.Finish],r.push(i)}if(e&ce.Whistle){const i=new jn;i.hitSound=ce[ce.Whistle],r.push(i)}if(e&ce.Clap){const i=new jn;i.hitSound=ce[ce.Clap],r.push(i)}return r.forEach((i,s)=>{i.sampleSet=s!==0?Re[t.additionSet]:Re[t.normalSet],i.volume=t.volume,i.customIndex=0,t.customIndex>=2&&(i.customIndex=t.customIndex)}),r}static createHitObject(e){if(e&fe.Normal)return new q0;if(e&fe.Slider)return new na;if(e&fe.Spinner)return new Q0;if(e&fe.Hold)return new J0;throw new Error(`Unknown hit object type: ${e}!`)}}class hd{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"Title":t.metadata.title=s;break;case"TitleUnicode":t.metadata.titleUnicode=s;break;case"Artist":t.metadata.artist=s;break;case"ArtistUnicode":t.metadata.artistUnicode=s;break;case"Creator":t.metadata.creator=s;break;case"Version":t.metadata.version=s;break;case"Source":t.metadata.source=s;break;case"Tags":t.metadata.tags=s.split(" ");break;case"BeatmapID":t.metadata.beatmapId=H.parseInt(s);break;case"BeatmapSetID":t.metadata.beatmapSetId=H.parseInt(s)}}}class ao{static pendingTime=0;static pendingTypes=[];static pendingPoints=[];static controlPoints;static handleLine(e,t,r){this.controlPoints=t.controlPoints;const i=e.split(",");let s=zr.SimpleQuadruple,o=Re[Re.None],u=0,l=100,c=!0,h=Yt.None;if(i.length>2)switch(i.length){default:case 8:h=H.parseInt(i[7]);case 7:c=i[6]==="1";case 6:l=H.parseInt(i[5]);case 5:u=H.parseInt(i[4]);case 4:o=Re[H.parseInt(i[3])];case 3:s=H.parseInt(i[2])}if(s<1)throw new Error("The numerator of a time signature must be positive.");const d=H.parseFloat(i[0])+r,m=H.parseFloat(i[1],H.MAX_PARSE_VALUE,!0);let D=1,p=1;if(m<0&&(p=100/-m,D=Math.min(Math.fround(-m),1e4),D=Math.max(10,D)/100),c&&Number.isNaN(m))throw new Error("Beat length cannot be NaN in a timing control point");if(c){const C=new un;C.beatLength=m,C.timeSignature=s,this.addControlPoint(C,d,!0)}const v=new cr;v.bpmMultiplier=D,v.sliderVelocity=p,v.generateTicks=!Number.isNaN(m),v.isLegacy=!0,this.addControlPoint(v,d,c);const F=new hr;F.kiai=(h&Yt.Kiai)>0,F.omitFirstBarLine=(h&Yt.OmitFirstBarLine)>0,(t.originalMode===1||t.originalMode===3)&&(F.scrollSpeed=p),this.addControlPoint(F,d,c);const S=new dr;S.sampleSet=o,S.customIndex=u,S.volume=l,this.addControlPoint(S,d,c)}static addControlPoint(e,t,r){t!==this.pendingTime&&this.flushPendingPoints(),r?this.pendingPoints.unshift(e):this.pendingPoints.push(e),this.pendingTime=t}static flushPendingPoints(){const e=this.pendingTime,t=this.pendingPoints,r=this.controlPoints,i=this.pendingTypes;let s=t.length;for(;--s>=0;)i.includes(t[s].pointType)||(i.push(t[s].pointType),r.add(t[s],e));this.pendingPoints=[],this.pendingTypes=[]}}class oo{static decodeLifeBar(e){if(!e)return[];const t=[],r=e.split(",");for(let i=0;i<r.length;++i){if(!r[i])continue;const s=r[i].split("|");if(s.length<2)continue;const o=this.handleLifeBarFrame(s);t.push(o)}return t}static handleLifeBarFrame(e){return new B0(H.parseInt(e[0]),H.parseFloat(e[1]))}static decodeReplayFrames(e){if(!e)return[];let t=0;const r=[],i=e.split(",");for(let s=0;s<i.length;++s){if(!i[s])continue;const o=i[s].split("|");if(o.length<4||o[0]==="-12345")continue;const u=this.handleReplayFrame(o);t+=u.interval,!(s<2&&u.mouseX===256&&u.mouseY===-500)&&(u.interval<0||(u.startTime=t,r.push(u)))}return r}static handleReplayFrame(e){return new Gi(0,H.parseFloat(e[0]),new he(H.parseFloat(e[1],H.MAX_COORDINATE_VALUE),H.parseFloat(e[2],H.MAX_COORDINATE_VALUE)),H.parseInt(e[3]))}}class dd{view;_bytesRead=0;get bytesRead(){return this._bytesRead}constructor(e){this.view=new DataView(new Uint8Array(e).buffer)}get remainingBytes(){return this.view.byteLength-this._bytesRead}async readCompressedData(e){return Kr(await bu.decompress(e))}readByte(){return this.view.getUint8(this._bytesRead++)}readBytes(e){e??=this.readInteger();const t=this.view.buffer.slice(this._bytesRead,this._bytesRead+e);return this._bytesRead+=e,new Uint8Array(t)}readShort(){const e=this.view.getUint16(this._bytesRead,!0);return this._bytesRead+=2,e}readInteger(){const e=this.view.getInt32(this._bytesRead,!0);return this._bytesRead+=4,e}readLong(){const e=this.view.getBigInt64(this._bytesRead,!0);return this._bytesRead+=8,e}readDate(){return new Date(Number(this.readLong()/BigInt(1e4))-621355968e5)}readULEB128(){let e=0,t=0,r=0;do r=this.readByte(),e|=(r&127)<<t,t+=7;while((r&128)!==0);return e}readString(){if(this.readByte()!==11)return"";const e=this.readULEB128();return e>0?Kr(this.readBytes(e)):""}}class fd{static handleLine(e,t){const[r,...i]=e.split(":").map(o=>o.trim()),s=i.join(" ");r==="UseSkinSprites"&&(t.useSkinSprites=s==="1")}}class uo{static handleLine(e,t){if(!e.startsWith("$"))return;const r=e.split("=");r.length===2&&t.set(r[0],r[1].trimEnd())}static decodeVariables(e,t){return!e.includes("$")||!t.size||t.forEach((r,i)=>{e=e.replace(i,r)}),e}}class yu{async _getFileBuffer(e){try{await ln(e)}catch{throw new Error("File doesn't exist!")}try{return await ln(e)}catch{throw new Error("File can't be read!")}}async _getFileUpdateDate(e){try{return(await ln(e)).mtime}catch{throw new Error("Failed to get last file update date!")}}}class md extends Map{currentSection=null;get(e){return super.get(e)??!1}set(e,t=!0){return super.set(e,t)}reset(){return this.forEach((e,t,r)=>{r.set(t,!0)}),this.currentSection=null,this}get hasEnabledSections(){for(const e of this.values())if(e)return!0;return!1}get isSectionEnabled(){return this.currentSection?this.get(this.currentSection):!1}}class Su extends yu{_lines=null;_foundFirstNonEmptyLine=!1;_sectionMap=new md;_getLines(e){let t=null;if(e.constructor===Array&&(t=e),!t||!t.length)throw new Error("Data not found!");return t}_parseLine(e,t){if(!this._foundFirstNonEmptyLine&&e.includes("osu file format v")){const r=e.trim();try{return r.startsWith("osu file format v")&&(t.fileFormat=H.parseInt(r.split("v")[1])),It.FileFormat}catch{throw new Error("Wrong file format version!")}}if(!this._foundFirstNonEmptyLine&&!this._isEmptyLine(e)&&(this._foundFirstNonEmptyLine=!0),this._shouldSkipLine(e))return It.Empty;if(e=this._preprocessLine(e),e.startsWith("[")&&e.endsWith("]")){const r=e.slice(1,-1);return this._sectionMap.currentSection&&(this._sectionMap.set(this._sectionMap.currentSection,!1),this._sectionMap.currentSection=null),this._sectionMap.hasEnabledSections?(r in Oe&&(this._sectionMap.currentSection=r),It.Section):It.Break}if(!this._sectionMap.isSectionEnabled)return It.Empty;try{return this._parseSectionData(e,t),It.Data}catch{return It.Empty}}_parseSectionData(e,t){const r=t;this._sectionMap.currentSection===Oe.Colours&&r?.colors&&z0.handleLine(e,r)}_preprocessLine(e){return this._sectionMap.currentSection!==Oe.Metadata&&(e=this._stripComments(e)),e.trimEnd()}_shouldSkipLine(e){return this._isEmptyLine(e)||e.startsWith("//")}_isEmptyLine(e){return typeof e!="string"||!e}_stripComments(e){const t=e.indexOf("//");return t>0?e.substring(0,t):e}_reset(){this._sectionMap.reset(),this._lines=null,this._foundFirstNonEmptyLine=!1}_setEnabledSections(e){this._sectionMap.set(Oe.Colours,e?.parseColours)}}class pd extends Su{_variables=new Map;async decodeFromPath(e,t){if(!e.endsWith(mt.Beatmap)&&!e.endsWith(mt.Storyboard))throw new Error(`Wrong format of the first file! Only ${mt.Beatmap} and ${mt.Storyboard} files are supported!`);if(typeof t=="string"&&!t.endsWith(mt.Storyboard))throw new Error(`Wrong format of the second file! Only ${mt.Storyboard} files are supported as a second argument!`);try{const r=await this._getFileBuffer(e),i=typeof t=="string"?await this._getFileBuffer(e):void 0;return this.decodeFromBuffer(r,i)}catch(r){const i=r.message||r;throw new Error(`Failed to decode a storyboard: '${i}'`)}}decodeFromBuffer(e,t){const r=Kr(e),i=t?Kr(t):void 0;return this.decodeFromString(r,i)}decodeFromString(e,t){typeof e!="string"&&(e=String(e)),typeof t!="string"&&typeof t<"u"&&(t=String(t));const r=e.split(/\r?\n/),i=t?.split(/\r?\n/);return this.decodeFromLines(r,i)}decodeFromLines(e,t){const r=new e0;this._reset(),this._setEnabledSections(),this._lines=[...this._getLines(e),...t?this._getLines(t):[]];for(let i=0;i<this._lines.length&&this._parseLine(this._lines[i],r)!==It.Break;++i);return r.variables=this._variables,r}_parseSectionData(e,t){switch(this._sectionMap.currentSection){case Oe.General:return fd.handleLine(e,t);case Oe.Events:return Du.handleLine(e,t);case Oe.Variables:return uo.handleLine(e,this._variables)}super._parseSectionData(e,t)}_setEnabledSections(){super._setEnabledSections(),this._sectionMap.set(Oe.General),this._sectionMap.set(Oe.Variables),this._sectionMap.set(Oe.Events)}_preprocessLine(e){return e=uo.decodeVariables(e,this._variables),super._preprocessLine(e)}_reset(){super._reset(),this._sectionMap.currentSection=Oe.Events}}class gd extends Su{static EARLY_VERSION_TIMING_OFFSET=24;_offset=0;_sbLines=null;async decodeFromPath(e,t){if(!e.endsWith(mt.Beatmap))throw new Error(`Wrong file format! Only ${mt.Beatmap} files are supported!`);try{const r=await this._getFileBuffer(e),i=this.decodeFromBuffer(r,t);return i.fileUpdateDate=await this._getFileUpdateDate(e),i}catch(r){const i=r.message||r;throw new Error(`Failed to decode a beatmap: ${i}`)}}decodeFromBuffer(e,t){return this.decodeFromString(Kr(e),t)}decodeFromString(e,t){return e=typeof e!="string"?String(e):e,this.decodeFromLines(e.split(/\r?\n/),t)}decodeFromLines(e,t){const r=new mu;this._reset(),this._lines=this._getLines(e),this._setEnabledSections(typeof t!="boolean"?t:{}),this._sbLines=this._shouldParseStoryboard(t)?[]:null;for(let i=0;i<this._lines.length&&this._parseLine(this._lines[i],r)!==It.Break;++i);ao.flushPendingPoints();for(let i=0;i<r.hitObjects.length;++i)r.hitObjects[i].applyDefaults(r.controlPoints,r.difficulty);if(r.hitObjects.sort((i,s)=>i.startTime-s.startTime),this._sbLines&&this._sbLines.length){const i=new pd;r.events.storyboard=i.decodeFromLines(this._sbLines),r.events.storyboard.useSkinSprites=r.general.useSkinSprites,r.events.storyboard.colors=r.colors,r.events.storyboard.fileFormat=r.fileFormat}return r}_parseSectionData(e,t){switch(this._sectionMap.currentSection){case Oe.General:return Y0.handleLine(e,t,this._offset);case Oe.Editor:return X0.handleLine(e,t);case Oe.Metadata:return hd.handleLine(e,t);case Oe.Difficulty:return U0.handleLine(e,t);case Oe.Events:return K0.handleLine(e,t,this._sbLines,this._offset);case Oe.TimingPoints:return ao.handleLine(e,t,this._offset);case Oe.HitObjects:return cd.handleLine(e,t,this._offset)}super._parseSectionData(e,t)}_setEnabledSections(e){super._setEnabledSections(e),this._sectionMap.set(Oe.General,e?.parseGeneral),this._sectionMap.set(Oe.Editor,e?.parseEditor),this._sectionMap.set(Oe.Metadata,e?.parseMetadata),this._sectionMap.set(Oe.Difficulty,e?.parseDifficulty),this._sectionMap.set(Oe.Events,e?.parseEvents),this._sectionMap.set(Oe.TimingPoints,e?.parseTimingPoints),this._sectionMap.set(Oe.HitObjects,e?.parseHitObjects)}_shouldParseStoryboard(e){const t=e,r=t?.parseStoryboard??e,i=typeof r=="boolean"?r:!0;return(t?.parseEvents??!0)&&i}}class _d extends yu{async decodeFromPath(e,t=!0){if(!e.endsWith(mt.Replay))throw new Error(`Wrong file format! Only ${mt.Replay} files are supported!`);try{const r=await this._getFileBuffer(e);return await this.decodeFromBuffer(r,t)}catch(r){const i=r.message||r;throw new Error(`Failed to decode a score: '${i}'`)}}async decodeFromBuffer(e,t=!0){const r=new dd(e),i=new Hi;let s=null;try{i.rulesetId=r.readByte();const o=r.readInteger();i.isLegacyScore=o<Yr.FIRST_LAZER_VERSION,i.totalScoreVersion=o<30000002?30000001:Yr.LATEST_VERSION,i.beatmapHashMD5=r.readString(),i.username=r.readString();const u=r.readString();i.count300=r.readShort(),i.count100=r.readShort(),i.count50=r.readShort(),i.countGeki=r.readShort(),i.countKatu=r.readShort(),i.countMiss=r.readShort(),i.totalScore=r.readInteger(),i.maxCombo=r.readShort(),i.perfect=!!r.readByte(),i.rawMods=r.readInteger();const l=r.readString();i.date=r.readDate();const c=r.readBytes();if(t&&c.length>0){s=new _u;const d=await r.readCompressedData(c);s.mode=i.rulesetId,s.gameVersion=o,s.hashMD5=u,s.frames=oo.decodeReplayFrames(d),s.lifeBar=oo.decodeLifeBar(l)}o>=20140721?i.id=Number(r.readLong()):o>=20121008&&(i.id=r.readInteger());const h=o>=30000001?r.readBytes():new Uint8Array;if(h.length>0){const d=await r.readCompressedData(h),m=JSON.parse(d),D=Xr.fromJSON(m);i.id=D.onlineId,i.apiMods=D.mods,i.statistics=D.statistics,i.maximumStatistics=D.maximumStatistics,i.clientVersion=D.clientVersion,i.rank=D.rank,D.userId>1&&(i.userId=D.userId)}return new no(i,s)}catch{return new no(i,null)}}}class ji extends Qr{constructor(){super(...arguments),this._originalColumn=0,this._column=0}get originalColumn(){return this._originalColumn}set originalColumn(e){this._originalColumn=e,this._column=e}get column(){return this._column}set column(e){this._column=e}get startX(){return this._column}get endX(){return this.startX}clone(){const e=super.clone();return e.originalColumn=this.originalColumn,e.column=this.column,e}}class Fn extends ji{}class vu extends Fn{}class wu extends Fn{}class Dd extends ji{}class bd extends s0{static*generateHoldTicks(e){if(e.tickInterval===0)return;const t=new vu;t.startTime=e.startTime,t.column=e.column,yield t;const r=e.tickInterval;let i=e.startTime+r;const s=e.endTime-r;for(;i<=s;){const u=new Dd;u.startTime=i,yield u,i+=r}const o=new wu;o.startTime=e.endTime,o.column=e.column,yield o}}class zn extends ji{constructor(){super(...arguments),this.tickInterval=50,this.nodeSamples=[],this.endTime=0,this.hitType=fe.Hold}get duration(){return this.endTime-this.startTime}get head(){const e=this.nestedHitObjects.find(t=>t instanceof vu);return e&&(e.startTime=this.startTime),e||null}get tail(){const e=this.nestedHitObjects.find(t=>t instanceof wu);return e&&(e.startTime=this.endTime),e||null}get column(){return this._column}set column(e){this._column=e,this.head&&(this.head.column=e),this.tail&&(this.tail.column=e)}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const r=e.timingPointAt(this.startTime);this.tickInterval=r.beatLength/t.sliderTickRate}createNestedHitObjects(){this.nestedHitObjects=[];for(const e of bd.generateHoldTicks(this))this.nestedHitObjects.push(e)}clone(){const e=super.clone();return e.endTime=this.endTime,e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e.tickInterval=this.tickInterval,e}}class yd extends b0{}class Sd extends y0{}class Eu extends pu{constructor(){super(...arguments),this.multiplier=1}}class Au{constructor(){this.name="Dual Stages",this.acronym="DS",this.bitwise=N.KeyCoop,this.type=Ze.Conversion,this.multiplier=1,this.isRanked=!1,this.incompatibles=N.None}applyToConverter(e){e.isDual=!0}}class ia extends S0{}class vd{constructor(){this.name="Fade In",this.acronym="FI",this.bitwise=N.FadeIn,this.type=Ze.DifficultyIncrease,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.Hidden|N.Flashlight}}class wd extends v0{constructor(){super(...arguments),this.multiplier=1,this.incompatibles=N.Hidden|N.FadeIn}}class Fu extends w0{constructor(){super(...arguments),this.multiplier=.5}}class Tu extends E0{constructor(){super(...arguments),this.multiplier=1}}class Ed extends A0{constructor(){super(...arguments),this.multiplier=1,this.incompatibles=N.FadeIn|N.Flashlight}}class pn{constructor(){this.type=Ze.Conversion,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.KeyMod}applyToConverter(e){e.targetColumns=this.keyCount}}class Pu extends pn{constructor(){super(...arguments),this.name="One Key",this.acronym="1K",this.bitwise=N.Key1,this.keyCount=1,this.incompatibles=N.KeyMod^N.Key1}}class Cu extends pn{constructor(){super(...arguments),this.name="Two Keys",this.acronym="2K",this.bitwise=N.Key2,this.keyCount=2,this.incompatibles=N.KeyMod^N.Key2}}class Mu extends pn{constructor(){super(...arguments),this.name="Three Keys",this.acronym="3K",this.bitwise=N.Key3,this.keyCount=3,this.incompatibles=N.KeyMod^N.Key3}}class xu extends pn{constructor(){super(...arguments),this.name="Four Keys",this.acronym="4K",this.bitwise=N.Key4,this.keyCount=4,this.incompatibles=N.KeyMod^N.Key4}}class Bu extends pn{constructor(){super(...arguments),this.name="Five Keys",this.acronym="5K",this.bitwise=N.Key5,this.keyCount=5,this.incompatibles=N.KeyMod^N.Key5}}class ku extends pn{constructor(){super(...arguments),this.name="Six Keys",this.acronym="6K",this.bitwise=N.Key6,this.keyCount=6,this.incompatibles=N.KeyMod^N.Key6}}class Ru extends pn{constructor(){super(...arguments),this.name="Seven Keys",this.acronym="7K",this.bitwise=N.Key7,this.keyCount=7,this.incompatibles=N.KeyMod^N.Key7}}class Lu extends pn{constructor(){super(...arguments),this.name="Eight Keys",this.acronym="8K",this.bitwise=N.Key8,this.keyCount=8,this.incompatibles=N.KeyMod^N.Key8}}class Ou extends pn{constructor(){super(...arguments),this.name="Nine Keys",this.acronym="9K",this.bitwise=N.Key9,this.keyCount=9,this.incompatibles=N.KeyMod^N.Key9}}class Ad{constructor(){this.name="Mirror",this.acronym="MR",this.bitwise=N.Mirror,this.type=Ze.Conversion,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.None}applyToBeatmap(e){e.hitObjects.forEach(t=>{t.column=e.totalColumns-1-t.column})}}class Fd extends P0{}class Iu extends T0{}class Td extends M0{}class Pd extends F0{}class Cd extends C0{}class Md{constructor(){this.name="Random",this.acronym="RD",this.bitwise=N.Random,this.type=Ze.Conversion,this.multiplier=1,this.isRanked=!1,this.incompatibles=N.None}applyToBeatmap(e){const t=[],r=[];for(let i=0;i<e.totalColumns;++i)t.push(Math.random()),r.push(i);r.sort((i,s)=>t[r.indexOf(i)]-t[r.indexOf(s)]),e.hitObjects.forEach(i=>i.column=r[i.column])}}class Vi extends x0{get mode(){return 3}get _availableMods(){return[new Fd,new Iu,new ia,new Ed,new vd,new Tu,new Td,new Eu,new Fu,new Pd,new wd,new yd,new Cd,new Sd,new Pu,new Cu,new Mu,new xu,new Bu,new ku,new Ru,new Lu,new Ou,new Md,new Au,new Ad]}}class xd extends l0{constructor(e,t){super(),this.mods=new Vi,this.stages=[],this.originalTotalColumns=0,this.hitObjects=[],this.stages.push(e),this.originalTotalColumns=t||e.columns}get mode(){return 3}get totalColumns(){return this.stages.reduce((e,t)=>e+t.columns,0)}get maxCombo(){return this.hitObjects.reduce((e,t)=>t instanceof Fn?e+1:t instanceof zn?e+1+Math.trunc((t.endTime-t.startTime)/100):e,0)}get notes(){return this.hitObjects.filter(e=>e instanceof Fn)}get holds(){return this.hitObjects.filter(e=>e instanceof zn)}}class Wi{constructor(e,t,r,i,s){this._conversionDiff=null,this.hitObject=e,this.beatmap=t,this.originalBeatmap=r,this.previousPattern=i,this.totalColumns=t.totalColumns,this.randomStart=t.totalColumns===8?1:0,this.rng=s}getColumn(e,t=!1){if(t&&this.totalColumns===8){const s=Math.round(7314285714285714e-9)/1e5,o=Math.floor(e/s);return Math.max(0,Math.min(o,6))+1}const r=Math.round(512/this.totalColumns*1e5)/1e5,i=Math.floor(e/r);return Math.max(0,Math.min(i,this.totalColumns-1))}getRandomNoteCount(e,t,r=0,i=0,s=0){if(e<0||e>1)throw new Error("p2 is not in range 0-1");if(t<0||t>1)throw new Error("p3 is not in range 0-1");if(r<0||r>1)throw new Error("p4 is not in range 0-1");if(i<0||i>1)throw new Error("p5 is not in range 0-1");if(s<0||s>1)throw new Error("p6 is not in range 0-1");const o=this.rng.nextDouble();return o>=1-s?6:o>=1-i?5:o>=1-r?4:o>=1-t?3:o>=1-e?2:1}get conversionDifficulty(){if(this._conversionDiff!==null)return this._conversionDiff;const e=this.originalBeatmap.hitObjects,t=e[0],r=e[e.length-1],i=t.startTime||0,o=(r.startTime||0)-i-this.originalBeatmap.totalBreakTime;let u=Math.trunc(o/1e3);u===0&&(u=1e4);const l=this.originalBeatmap.difficulty;return this._conversionDiff=Math.max(4,Math.min(l.approachRate,7)),this._conversionDiff+=l.drainRate,this._conversionDiff/=1.5,this._conversionDiff+=e.length/u*Math.fround(9),this._conversionDiff=Math.fround(this._conversionDiff/38*5)/1.15,this._conversionDiff=Math.min(this._conversionDiff,12),this._conversionDiff}findAvailableColumn(e,t){const r=t.patterns||[],i=t.lowerBound||this.randomStart,s=t.upperBound||this.totalColumns,o=t.nextColumn||(()=>this.getRandomColumn(i,s)),u=t.validate||(()=>!0),l=h=>u(h)!==!1&&!r.find(d=>d.columnHasObject(h));if(l(e))return e;let c=!1;for(let h=i;h<s&&(c=l(h),!c);++h);if(!c)throw new Error("There were not enough columns to complete conversion.");do e=o(e);while(!l(e));return e}getRandomColumn(e,t){return e=e||this.randomStart,t=t||this.totalColumns,this.rng.nextInt(e,t)}}var se;(function(n){n[n.None=0]="None",n[n.ForceStack=1]="ForceStack",n[n.ForceNotStack=2]="ForceNotStack",n[n.KeepSingle=4]="KeepSingle",n[n.LowProbability=8]="LowProbability",n[n.Alternate=16]="Alternate",n[n.ForceSigSlider=32]="ForceSigSlider",n[n.ForceNotSlider=64]="ForceNotSlider",n[n.Gathered=128]="Gathered",n[n.Mirror=256]="Mirror",n[n.Reverse=512]="Reverse",n[n.Cycle=1024]="Cycle",n[n.Stair=2048]="Stair",n[n.ReverseStair=4096]="ReverseStair"})(se||(se={}));class ot{constructor(){this.hitObjects=[],this.containedColumns=new Set}columnHasObject(e){return this.containedColumns.has(e)}get columnsWithObjects(){return this.containedColumns.size}addHitObject(e){this.hitObjects.push(e),this.containedColumns.add(e.column)}addPatternHitObjects(e){this.hitObjects.push(...e.hitObjects),e.hitObjects.forEach(t=>{this.containedColumns.add(t.column)})}clear(){this.hitObjects.length=0,this.containedColumns.clear()}}class Nu extends Wi{constructor(e,t,r,i,s){super(e,t,r,i,s),this.convertType=se.None,t.controlPoints.effectPointAt(e.startTime).kiai||(this.convertType=se.LowProbability);const o=e,u=t.controlPoints.timingPointAt(e.startTime),l=t.controlPoints.difficultyPointAt(e.startTime),c=u.beatLength*l.bpmMultiplier;this.spanCount=o.repeats+1||1,this.startTime=qt.round(e.startTime);const h=t.difficulty.sliderMultiplier;this.endTime=(o.path.distance||0)*c*this.spanCount*.01/h,this.endTime=Math.trunc(Math.floor(this.startTime+this.endTime));const d=this.endTime-this.startTime;this.segmentDuration=d/this.spanCount>>0}*generate(){const e=this.generatePattern();if(e.hitObjects.length===1)return yield e;const t=new ot,r=new ot;for(const i of e.hitObjects){let s=i.endTime;s=s||i.startTime,this.endTime!==qt.round(s)?t.addHitObject(i):r.addHitObject(i)}yield t,yield r}generatePattern(){if(this.totalColumns===1){const e=new ot;return this.addToPattern(e,0,this.startTime,this.endTime),e}if(this.spanCount>1){if(this.segmentDuration<=90)return this.generateRandomHoldNotes(this.startTime,1);if(this.segmentDuration<=120)return this.convertType|=se.ForceNotStack,this.generateRandomNotes(this.startTime,this.spanCount+1);if(this.segmentDuration<=160)return this.generateStair(this.startTime);if(this.segmentDuration<=200&&this.conversionDifficulty>3)return this.generateRandomMultipleNotes(this.startTime);if(this.endTime-this.startTime>=4e3)return this.generateNRandomNotes(this.startTime,.23,0,0);const e=this.totalColumns-1-this.randomStart;return this.segmentDuration>400&&this.spanCount<e?this.generateTiledHoldNotes(this.startTime):this.generateHoldAndNormalNotes(this.startTime)}if(this.segmentDuration<=110){this.previousPattern.columnsWithObjects<this.totalColumns?this.convertType|=se.ForceNotStack:this.convertType&=~se.ForceNotStack;const e=this.segmentDuration<80?1:2;return this.generateRandomNotes(this.startTime,e)}return this.conversionDifficulty>6.5?this.convertType&se.LowProbability?this.generateNRandomNotes(this.startTime,.78,.3,0):this.generateNRandomNotes(this.startTime,.85,.36,.03):this.conversionDifficulty>4?this.convertType&se.LowProbability?this.generateNRandomNotes(this.startTime,.43,.08,0):this.generateNRandomNotes(this.startTime,.56,.18,0):this.conversionDifficulty>2.5?this.convertType&se.LowProbability?this.generateNRandomNotes(this.startTime,.3,0,0):this.generateNRandomNotes(this.startTime,.37,.08,0):this.convertType&se.LowProbability?this.generateNRandomNotes(this.startTime,.17,0,0):this.generateNRandomNotes(this.startTime,.27,0,0)}generateRandomHoldNotes(e,t){const r=new ot,i=this.totalColumns-this.randomStart-this.previousPattern.columnsWithObjects;let s=this.getRandomColumn();for(let o=0,u=Math.min(i,t);o<u;++o){const l={patterns:[r,this.previousPattern]};s=this.findAvailableColumn(s,l),this.addToPattern(r,s,e,this.endTime)}for(let o=0,u=t-i;o<u;++o){const l={patterns:[r]};s=this.findAvailableColumn(s,l),this.addToPattern(r,s,e,this.endTime)}return r}generateRandomNotes(e,t){const r=new ot,i=this.hitObject.startX;let s=this.getColumn(i||0,!0);const o=!!(this.convertType&se.ForceNotStack),u=this.previousPattern.columnsWithObjects<this.totalColumns;if(o&&u){const c={patterns:[this.previousPattern]};s=this.findAvailableColumn(s,c)}let l=s;for(let c=0;c<t;++c){this.addToPattern(r,s,e,e);const h={validate:d=>d!==l};e+=this.segmentDuration,s=this.findAvailableColumn(s,h),l=s}return r}generateStair(e){const t=new ot,r=this.hitObject.startX;let i=this.getColumn(r||0,!0),s=this.rng.nextDouble()>.5;for(let o=0;o<=this.spanCount;++o)this.addToPattern(t,i,e,e),e+=this.segmentDuration,s?i>=this.totalColumns-1?(s=!1,--i):++i:i<=this.randomStart?(s=!0,++i):--i;return t}generateRandomMultipleNotes(e){const t=new ot,r=this.totalColumns>=4&&this.totalColumns<=8,i=this.rng.nextInt(1,this.totalColumns-(r?1:0)),s=this.hitObject.startX;let o=this.getColumn(s||0,!0);for(let u=0;u<=this.spanCount;++u)this.addToPattern(t,o,e,e),o+=i,o>=this.totalColumns-this.randomStart&&(o=o-this.totalColumns-this.randomStart+(r?1:0)),o+=this.randomStart,this.totalColumns>2&&this.addToPattern(t,o,e,e),o=this.getRandomColumn(),e+=this.segmentDuration;return t}generateNRandomNotes(e,t,r,i){switch(this.totalColumns){case 2:t=0,r=0,i=0;break;case 3:t=Math.min(t,.1),r=0,i=0;break;case 4:t=Math.min(t,.3),r=Math.min(r,.04),i=0;break;case 5:t=Math.min(t,.34),r=Math.min(r,.1),i=Math.min(i,.03);break}const s=!!this.hitObject.samples.find(h),o=!!this.hitSamplesAt(this.startTime).find(h);!(this.convertType&se.LowProbability)&&(s||o)&&(t=1);const c=this.getRandomNoteCount(t,r,i);return this.generateRandomHoldNotes(e,c);function h(d){return d.hitSound===ce[ce.Clap]||d.hitSound===ce[ce.Finish]}}generateTiledHoldNotes(e){const t=new ot,r=Math.min(this.spanCount,this.totalColumns),i=e+this.segmentDuration*this.spanCount,s=this.hitObject.startX;let o=this.getColumn(s||0,!0);const u=!!(this.convertType&se.ForceNotStack),l=this.previousPattern.columnsWithObjects<this.totalColumns;if(u&&l){const c={patterns:[this.previousPattern]};o=this.findAvailableColumn(o,c)}for(let c=0;c<r;++c){const h={patterns:[t]};o=this.findAvailableColumn(o,h),this.addToPattern(t,o,e,i),e+=this.segmentDuration}return t}generateHoldAndNormalNotes(e){const t=new ot,r=this.hitObject.startX;let i=this.getColumn(r||0,!0);const s=!!(this.convertType&se.ForceNotStack),o=this.previousPattern.columnsWithObjects<this.totalColumns;if(s&&o){const d={patterns:[this.previousPattern]};i=this.findAvailableColumn(i,d)}this.addToPattern(t,i,e,this.endTime);let u=this.getRandomColumn(),l=0;if(this.conversionDifficulty>6.5)l=this.getRandomNoteCount(.63,0);else if(this.conversionDifficulty>4){const d=this.totalColumns<6?.12:.45;l=this.getRandomNoteCount(d,0)}else if(this.conversionDifficulty>2.5){const d=this.totalColumns<6?0:.24;l=this.getRandomNoteCount(d,0)}l=Math.min(this.totalColumns-1,l);const c=!this.hitSamplesAt(e).find(d=>d.hitSound===ce[ce.Whistle]||d.hitSound===ce[ce.Finish]||d.hitSound===ce[ce.Clap]),h=new ot;for(let d=0;d<=this.spanCount;++d){if(!(c&&e===this.startTime))for(let m=0;m<l;++m){const D={validate:p=>p!==i,patterns:[h]};u=this.findAvailableColumn(u,D),this.addToPattern(h,u,e,e)}t.addPatternHitObjects(h),h.clear(),e+=this.segmentDuration}return t}hitSamplesAt(e){return this.nodeSamplesAt(e)[0]||this.hitObject.samples}nodeSamplesAt(e){if(!(this.hitObject.hitType&fe.Slider))return[];const t=this.hitObject;let r=0;return this.segmentDuration&&(r=(e-this.startTime)/this.segmentDuration),r?t.nodeSamples.slice(r):t.nodeSamples}addToPattern(e,t,r,i){var s,o;if(r===i){const u=new Fn,l=this.hitObject;u.startTime=r,u.originalColumn=t,u.hitType=fe.Normal|this.hitObject.hitType&fe.NewCombo,u.samples=this.hitSamplesAt(r),u.startPosition=(s=l?.startPosition)!==null&&s!==void 0?s:new he(256,192),e.addHitObject(u)}else{const u=new zn,l=this.hitObject;u.startTime=r,u.endTime=i,u.originalColumn=t,u.hitType=fe.Hold|this.hitObject.hitType&fe.NewCombo,u.samples=this.hitSamplesAt(r),u.nodeSamples=this.nodeSamplesAt(r),u.startPosition=(o=l?.startPosition)!==null&&o!==void 0?o:new he(256,192),e.addHitObject(u)}}}Nu.BASE_SCORING_DISTANCE=100;class lo extends Wi{constructor(e,t,r,i,s){super(e,t,r,i,s),this.endTime=Math.trunc(e.endTime||0),this.convertType=i.columnsWithObjects===this.totalColumns?se.None:se.ForceNotStack}*generate(){const e=new ot,t=this.endTime-this.hitObject.startTime>=100;switch(this.totalColumns){case 8:{const r=s=>s.hitSound===ce[ce.Finish];if(!!this.hitObject.samples.find(r)&&this.endTime-this.hitObject.startTime<1e3){this.addToPattern(e,0,t);break}this.addToPattern(e,this.getRandomColumn(),t);break}default:this.addToPattern(e,this.getRandomColumn(0),t);break}yield e}getRandomColumn(e){const t=super.getRandomColumn(e);if(this.convertType&se.ForceNotStack){const r={lowerBound:e,patterns:[this.previousPattern]};return this.findAvailableColumn(t,r)}return this.findAvailableColumn(t,{lowerBound:e})}addToPattern(e,t,r){var i,s,o;if(r){const u=new zn,l=this.hitObject;u.startTime=this.hitObject.startTime,u.endTime=this.endTime,u.originalColumn=t,u.hitType=fe.Hold|this.hitObject.hitType&fe.NewCombo,u.samples=this.hitObject.samples,u.nodeSamples=(i=this.hitObject.nodeSamples)!==null&&i!==void 0?i:[],u.startPosition=(s=l?.startPosition)!==null&&s!==void 0?s:new he(256,192),e.addHitObject(u)}else{const u=new Fn,l=this.hitObject;u.startTime=this.hitObject.startTime,u.originalColumn=t,u.hitType=fe.Normal|this.hitObject.hitType&fe.NewCombo,u.samples=this.hitObject.samples,u.startPosition=(o=l?.startPosition)!==null&&o!==void 0?o:new he(256,192),e.addHitObject(u)}}}class co extends Wi{constructor(e,t,r,i,s,o,u,l,c){super(e,t,r,i,s),this.stairType=se.None,this.convertType=se.None,this.stairType=c;const h=t.controlPoints.timingPointAt(e.startTime),d=t.controlPoints.effectPointAt(e.startTime),D=(e.startPosition||new he(0,0)).fsubtract(u).flength(),p=e.startTime-o;if(p<=80?this.convertType|=se.ForceNotStack|se.KeepSingle:p<=95?this.convertType|=se.ForceNotStack|se.KeepSingle|c:p<=105?this.convertType|=se.ForceNotStack|se.LowProbability:p<=125?this.convertType|=se.ForceNotStack:p<=135&&D<20?this.convertType|=se.Cycle|se.KeepSingle:p<=150&&D<20?this.convertType|=se.ForceStack|se.LowProbability:D<20&&l>=h.beatLength/2.5?this.convertType|=se.Reverse|se.LowProbability:l<h.beatLength/2.5||d.kiai||(this.convertType|=se.LowProbability),!(this.convertType&se.KeepSingle)){const v=!!e.samples.find(S=>S.hitSound===ce[ce.Finish]),F=!!e.samples.find(S=>S.hitSound===ce[ce.Clap]);v&&this.totalColumns!==8?this.convertType|=se.Mirror:F&&(this.convertType|=se.Gathered)}}*generate(){const e=this._generateCore(),t=!!(this.convertType&se.Stair),r=!!(this.convertType&se.ReverseStair);for(const i of e.hitObjects)t&&i.column===this.totalColumns-1&&(this.stairType=se.ReverseStair),r&&i.column===this.randomStart&&(this.stairType=se.Stair);yield e}_generateCore(){const e=new ot;if(this.totalColumns===1)return this.addToPattern(e,0),e;const t=this.previousPattern.hitObjects.length?this.previousPattern.hitObjects[0].column:0;if(!!(this.convertType&se.Reverse)&&this.previousPattern.hitObjects.length){for(let c=this.randomStart;c<this.totalColumns;++c)if(this.previousPattern.columnHasObject(c)){const h=this.randomStart+this.totalColumns-c-1;this.addToPattern(e,h)}return e}const i=!!(this.convertType&se.Cycle),s=this.previousPattern.hitObjects.length===1,o=this.totalColumns!==8||t!==0,u=this.totalColumns%2===0||t!==this.totalColumns/2;if(i&&s&&o&&u){const c=this.randomStart+this.totalColumns-t-1;return this.addToPattern(e,c),e}if(!!(this.convertType&se.ForceStack)&&this.previousPattern.hitObjects.length){for(let c=this.randomStart;c<this.totalColumns;++c)this.previousPattern.columnHasObject(c)&&this.addToPattern(e,c);return e}if(this.previousPattern.hitObjects.length===1){if(this.convertType&se.Stair){let c=t+1;return c===this.totalColumns&&(c=this.randomStart),this.addToPattern(e,c),e}if(this.convertType&se.ReverseStair){let c=t-1;return c===this.randomStart-1&&(c=this.totalColumns-1),this.addToPattern(e,c),e}}return this.convertType&se.KeepSingle?this.generateRandomNotes(1):this.convertType&se.Mirror?this.conversionDifficulty>6.5?this.generateRandomPatternWithMirrored(.12,.38,.12):this.conversionDifficulty>4?this.generateRandomPatternWithMirrored(.12,.17,0):this.generateRandomPatternWithMirrored(.12,0,0):this.conversionDifficulty>6.5?this.convertType&se.LowProbability?this.generateRandomPattern(.78,.42,0,0):this.generateRandomPattern(1,.62,0,0):this.conversionDifficulty>4?this.convertType&se.LowProbability?this.generateRandomPattern(.35,.08,0,0):this.generateRandomPattern(.52,.15,0,0):this.conversionDifficulty>2?this.convertType&se.LowProbability?this.generateRandomPattern(.18,0,0,0):this.generateRandomPattern(.45,0,0,0):this.generateRandomPattern(0,0,0,0)}generateRandomNotes(e){const t=u=>(this.convertType&se.Gathered?++u===this.totalColumns&&(u=this.randomStart):u=this.getRandomColumn(),u),r=new ot,i=!(this.convertType&se.ForceNotStack);if(!i){const u=this.totalColumns-this.randomStart-this.previousPattern.columnsWithObjects;e=Math.min(e,u)}const s=this.hitObject.startX;let o=this.getColumn(s||0,!0);for(let u=0;u<e;++u){if(i){const l={nextColumn:t,patterns:[r]};o=this.findAvailableColumn(o,l)}else{const l={nextColumn:t,patterns:[r,this.previousPattern]};o=this.findAvailableColumn(o,l)}this.addToPattern(r,o)}return r}hasSpecialColumn(){const e=r=>r.hitSound===ce[ce.Clap],t=r=>r.hitSound===ce[ce.Finish];return!!this.hitObject.samples.find(e)&&!!this.hitObject.samples.find(t)}generateRandomPattern(e,t,r,i){const s=new ot,o=this.getRandomNoteCount(e,t,r,i),u=this.generateRandomNotes(o);return s.addPatternHitObjects(u),this.randomStart>0&&this.hasSpecialColumn()&&this.addToPattern(s,0),s}generateRandomPatternWithMirrored(e,t,r){if(this.convertType&se.ForceNotStack)return this.generateRandomPattern(1/Math.fround(2)+t/2,t,(t+r)/2,r);const i=new ot,[s,o]=this.getRandomNoteCountMirrored(e,t,r),u=Math.trunc((this.totalColumns%2?this.totalColumns-1:this.totalColumns)/2);let l=this.getRandomColumn(this.randomStart,u);const c={upperBound:u,patterns:[i]};for(let h=0;h<s;++h){l=this.findAvailableColumn(l,c);const d=this.randomStart+this.totalColumns-l-1;this.addToPattern(i,l),this.addToPattern(i,d)}return o&&this.addToPattern(i,Math.trunc(this.totalColumns/2)),this.randomStart>0&&this.hasSpecialColumn()&&this.addToPattern(i,0),i}getRandomNoteCount(e,t,r,i){switch(this.totalColumns){case 2:e=0,t=0,r=0,i=0;break;case 3:e=Math.min(e,.1),t=0,r=0,i=0;break;case 4:e=Math.min(e,.23),t=Math.min(t,.04),r=0,i=0;break;case 5:t=Math.min(t,.15),r=Math.min(r,.03),i=0;break}const s=o=>o.hitSound===ce[ce.Clap];return this.hitObject.samples.find(s)&&(e=1),super.getRandomNoteCount(e,t,r,i)}getRandomNoteCountMirrored(e,t,r){switch(this.totalColumns){case 2:e=0,t=0,r=0;break;case 3:e=Math.min(e,.03),t=0,r=0;break;case 4:e=0,t=1-Math.max((1-t)*2,.8),r=0;break;case 5:e=Math.min(e,.03),r=0;break;case 6:e=0,t=1-Math.max((1-t)*2,.5),r=1-Math.max((1-r)*2,.85);break}t=Math.max(0,Math.min(t,1)),r=Math.max(0,Math.min(r,1));const i=this.rng.nextDouble(),s=super.getRandomNoteCount(t,r),o=this.totalColumns%2===1&&s!==3&&i>1-e;return[s,o]}addToPattern(e,t){var r;const i=new Fn,s=this.hitObject;i.startTime=this.hitObject.startTime,i.originalColumn=t,i.hitType=fe.Normal|this.hitObject.hitType&fe.NewCombo,i.samples=this.hitObject.samples,i.startPosition=(r=s?.startPosition)!==null&&r!==void 0?r:new he(256,192),e.addHitObject(i)}}class Bd extends Wi{*generate(){var e,t,r;const i=this.hitObject.startX,s=this.getColumn(i||0),o=new ot,u=[this.hitObject.samples,[]];if(this.hitObject.hitType&fe.Hold){const l=new zn,c=this.hitObject;l.startTime=this.hitObject.startTime,l.endTime=(e=this.hitObject.endTime)!==null&&e!==void 0?e:l.startTime,l.originalColumn=s,l.samples=this.hitObject.samples,l.hitType=fe.Hold|this.hitObject.hitType&fe.NewCombo,l.nodeSamples=l.nodeSamples||u,l.startPosition=(t=c?.startPosition)!==null&&t!==void 0?t:new he(256,192),o.addHitObject(l)}else{const l=new Fn,c=this.hitObject;l.startTime=this.hitObject.startTime,l.originalColumn=s,l.hitType=fe.Normal|this.hitObject.hitType&fe.NewCombo,l.samples=this.hitObject.samples,l.startPosition=(r=c?.startPosition)!==null&&r!==void 0?r:new he(256,192),o.addHitObject(l)}yield o}}var Or;(function(n){n[n.Even=0]="Even",n[n.Odd=1]="Odd",n[n.Special=2]="Special"})(Or||(Or={}));class Mi{constructor(e){this.columns=e??0}isSpecialColumn(e){return this.columns%2===1&&this.columns/2===e}getTypeOfColumn(e){return this.isSpecialColumn(e)?Or.Special:Math.min(e,this.columns-1-e)%2?Or.Even:Or.Odd}clone(){return new Mi(this.columns)}}class mr extends a0{constructor(){super(...arguments),this.originalRuleset=3,this.originalTargetColumns=0,this.targetColumns=0,this.isDual=!1,this._rng=null,this._prevNoteTimes=[],this._density=nn.MAX_INT32,this._lastTime=0,this._lastPosition=new he(0,0),this._lastPattern=new ot,this._lastStair=se.Stair}canConvert(e){return e.hitObjects.every(t=>Number.isFinite(t.startX))}convertBeatmap(e){var t;e=(t=e.base)!==null&&t!==void 0?t:e,this.originalRuleset=e.originalMode,this._updateTargetColumns(e);const r=e.difficulty;let i=qt.round(r.approachRate);i+=qt.round(r.drainRate+r.circleSize)*20,i+=Math.trunc(r.overallDifficulty*41.2),this._rng=new nn(Math.trunc(i)),this._converted=this.createBeatmap(),this._converted.general=e.general,this._converted.editor=e.editor,this._converted.difficulty=e.difficulty.clone(),this._converted.metadata=e.metadata,this._converted.events=e.events,this._converted.controlPoints=e.controlPoints,this._converted.fileFormat=e.fileFormat,this._converted.originalMode=e.originalMode,this._converted.base=e;for(const s of this.convertHitObjects(e))this._converted.hitObjects.push(s);return this._converted.hitObjects.forEach(s=>s.originalColumn=s.column),this._converted.hitObjects.sort((s,o)=>s.startTime-o.startTime),this._converted.difficulty.circleSize=this._converted.totalColumns,this._converted}*convertHitObjects(e){const t=e.hitObjects;for(const r of t){if(r instanceof ji){yield r;continue}const i=this.originalRuleset===3?this._generateSpecific(r,e):this._generateConverted(r,e);for(const s of i)yield s}}*_generateSpecific(e,t){const r=this._rng,i=this._converted,s=this._lastPattern,o=new Bd(e,i,t,s,r);for(const u of o.generate()){this._lastPattern=u;for(const l of u.hitObjects)yield l}}*_generateConverted(e,t){const r=this._rng,i=this._converted,s=this._lastPattern;let o=null;if(e.path){const u=new Nu(e,i,t,s,r),l=e.startPosition;for(let c=0;c<=u.spanCount;++c){const h=e.startTime+u.segmentDuration*c;this._recordNote(h,l||new he(0,0)),this._computeDensity(h)}o=u}else if(typeof e.endTime=="number"){const u=new lo(e,i,t,s,r),l=e;this._recordNote(l.endTime,new he(256,192)),this._computeDensity(l.endTime),o=u}else if(e.startPosition){this._computeDensity(e.startTime);const u=this._lastTime,l=this._lastPosition,c=this._density,h=this._lastStair,d=new co(e,i,t,s,r,u,l,c,h),m=e.startPosition;this._recordNote(e.startTime,m),o=d}if(o!==null)for(const u of o.generate()){o instanceof lo||(this._lastPattern=u),o instanceof co&&(this._lastStair=o.stairType);for(const l of u.hitObjects)yield l}}_updateTargetColumns(e){const t=e.difficulty,r=e.hitObjects,i=qt.round(t.circleSize),s=qt.round(t.overallDifficulty);if(this.targetColumns){this.originalTargetColumns||(this.originalTargetColumns=this.targetColumns);return}if(this.originalRuleset===3)this.targetColumns=Math.trunc(Math.max(1,i)),this.targetColumns>mr.MAX_STAGE_KEYS&&(this.targetColumns/=2,this.isDual=!0);else{const l=r.filter(c=>c.endTime||c.path).length/r.length;l<.2?this.targetColumns=7:l<.3||i>=5?this.targetColumns=s>5?7:6:l>.6?this.targetColumns=s>4?5:4:this.targetColumns=Math.max(4,Math.min(s+1,7))}this.originalTargetColumns=this.targetColumns}_computeDensity(e){const t=mr.MAX_NOTES_FOR_DENSITY;this._prevNoteTimes.length===t&&this._prevNoteTimes.shift(),this._prevNoteTimes.push(e),this._prevNoteTimes.length>=2&&(this._density=(e-this._prevNoteTimes[0])/this._prevNoteTimes.length)}_recordNote(e,t){this._lastTime=e,this._lastPosition=t}createBeatmap(){const e=new Mi(this.targetColumns),t=new xd(e,this.originalTargetColumns);if(this.isDual){const r=new Mi;r.columns=this.targetColumns,t.stages.push(r)}return t}}mr.MAX_NOTES_FOR_DENSITY=7;mr.MAX_STAGE_KEYS=10;class kd extends o0{}class ho extends c0{constructor(){super(...arguments),this.greatHitWindow=0}}class fo extends h0{constructor(e,t){super(e,t),this.difficultyPerformance=0,this.mods=e}}class Rd extends p0{constructor(e,t,r,i,s){super(e,t,r,i,s),this.baseObject=e}}class St extends D0{constructor(e,t){super(e),this._skillMultiplier=1,this._strainDecayBase=1,this._individualStrain=0,this._overallStrain=1,this._startTimes=new Array(t).fill(0),this._endTimes=new Array(t).fill(0),this._individualStrains=new Array(t).fill(0)}_strainValueOf(e){const t=e,r=t.startTime,i=t.endTime,s=t.baseObject.column;let o=!1,u=Math.abs(i-r),l=1,c=0;const h=1;for(let d=0;d<this._endTimes.length;++d){const m=this._endTimes[d]-h>r,D=i-h>this._endTimes[d],p=this._endTimes[d]-h>i;o||(o=m&&D),p&&(l=1.25),u=Math.min(u,Math.abs(i-this._endTimes[d]))}return o&&(c=1/(1+Math.exp(.5*(St.RELEASE_THRESHOLD-u)))),this._individualStrains[s]=St._applyDecay(this._individualStrains[s],r-this._startTimes[s],St.INDIVIDUAL_DECAY_BASE),this._individualStrains[s]+=2*l,this._individualStrain=t.deltaTime<=1?Math.max(this._individualStrain,this._individualStrains[s]):this._individualStrains[s],this._overallStrain=St._applyDecay(this._overallStrain,e.deltaTime,St.OVERALL_DECAY_BASE),this._overallStrain+=(1+c)*l,this._startTimes[s]=r,this._endTimes[s]=i,this._individualStrain+this._overallStrain-this._currentStrain}_calculateInitialStrain(e,t){var r,i,s,o;const u=St._applyDecay(this._individualStrain,e-((i=(r=t.previous(0))===null||r===void 0?void 0:r.startTime)!==null&&i!==void 0?i:0),St.INDIVIDUAL_DECAY_BASE),l=St._applyDecay(this._overallStrain,e-((o=(s=t.previous(0))===null||s===void 0?void 0:s.startTime)!==null&&o!==void 0?o:0),St.OVERALL_DECAY_BASE);return u+l}static _applyDecay(e,t,r){return e*Math.pow(r,t/1e3)}}St.INDIVIDUAL_DECAY_BASE=.125;St.OVERALL_DECAY_BASE=.3;St.RELEASE_THRESHOLD=24;class zi extends f0{constructor(e,t){var r;super(e,t),this._isForCurrentRuleset=e.originalMode===t.id,this._originalOverallDifficulty=((r=e.base)!==null&&r!==void 0?r:e).difficulty.overallDifficulty}_createDifficultyAttributes(e,t,r,i){if(e.hitObjects.length===0)return new ho(t,0);const s=r[0].difficultyValue*zi.STAR_SCALING_FACTOR,o=new ho(t,s);return o.mods=t,o.maxCombo=e.hitObjects.reduce((u,l)=>l instanceof zn?u+1+Math.trunc((l.endTime-l.startTime)/100):u+1,0),o.greatHitWindow=Math.ceil(Math.trunc(this._getHitWindow300(t)*i)/i),o}_createDifficultyHitObjects(e,t){const r=e.hitObjects.slice(),i=(u,l)=>qt.round(u.startTime)-qt.round(l.startTime),s=Pi.depthSort(r,i),o=[];for(let u=1;u<s.length;++u){const l=new Rd(s[u],s[u-1],t,o,o.length);o.push(l)}return o}_sortObjects(e){return e}_createSkills(e,t){var r;return[new St(t,(r=e?.totalColumns)!==null&&r!==void 0?r:0)]}get difficultyMods(){const e=[new Eu,new Fu,new ia,new Tu];return this._isForCurrentRuleset?e:[...e,new Pu,new Cu,new Mu,new xu,new Bu,new ku,new Ru,new Lu,new Ou,new Au]}_getHitWindow300(e){const t=r=>e.has(N.HardRock)?r/1.4:e.has(N.Easy)?r*1.4:r;if(this._isForCurrentRuleset){const r=Math.min(10,Math.max(0,10-this._originalOverallDifficulty));return t(34+3*r)}return qt.round(this._originalOverallDifficulty)>4?t(34):t(47)}}zi.STAR_SCALING_FACTOR=.018;class Ld extends m0{constructor(e,t,r){super(e,t,r),this._mods=new Vi,this._countPerfect=0,this._countGreat=0,this._countGood=0,this._countOk=0,this._countMeh=0,this._countMiss=0,this.attributes=t,this._addParams(t,r)}calculateAttributes(e,t){if(this._addParams(e,t),!this.attributes)return new fo(this._mods,0);let r=8;this._mods.any(Iu)&&(r*=.75),this._mods.any(ia)&&(r*=.5);const i=this._computeDifficultyValue(),s=i*r,o=new fo(this._mods,s);return o.difficultyPerformance=i,o}_computeDifficultyValue(){let e=Math.pow(Math.max(this.attributes.starRating-.15,.05),2.2);return e*=Math.max(0,5*this._customAccuracy-4),e*=1+.1*Math.min(1,this._totalHits/1500),e}_addParams(e,t){var r,i,s,o,u,l,c;t&&(this._mods=(r=t?.mods)!==null&&r!==void 0?r:this._mods,this._countPerfect=(i=t.statistics.get(R.Perfect))!==null&&i!==void 0?i:0,this._countGreat=(s=t.statistics.get(R.Great))!==null&&s!==void 0?s:0,this._countGood=(o=t.statistics.get(R.Good))!==null&&o!==void 0?o:0,this._countOk=(u=t.statistics.get(R.Ok))!==null&&u!==void 0?u:0,this._countMeh=(l=t.statistics.get(R.Meh))!==null&&l!==void 0?l:0,this._countMiss=(c=t.statistics.get(R.Miss))!==null&&c!==void 0?c:0),e&&(this.attributes=e)}get _totalHits(){return this._countPerfect+this._countOk+this._countGreat+this._countGood+this._countMeh+this._countMiss}get _customAccuracy(){const e=this._countPerfect,t=this._countGreat,r=this._countGood,i=this._countOk,s=this._countMeh,o=this._totalHits;return o?(e*320+t*300+r*200+i*100+s*50)/(o*320):0}}var Vn;(function(n){n[n.Special1=1]="Special1",n[n.Special2=2]="Special2",n[n.Key1=10]="Key1",n[n.Key2=11]="Key2",n[n.Key3=12]="Key3",n[n.Key4=13]="Key4",n[n.Key5=14]="Key5",n[n.Key6=15]="Key6",n[n.Key7=16]="Key7",n[n.Key8=17]="Key8",n[n.Key9=18]="Key9",n[n.Key10=19]="Key10",n[n.Key11=20]="Key11",n[n.Key12=21]="Key12",n[n.Key13=22]="Key13",n[n.Key14=23]="Key14",n[n.Key15=24]="Key15",n[n.Key16=25]="Key16",n[n.Key17=26]="Key17",n[n.Key18=27]="Key18",n[n.Key19=28]="Key19",n[n.Key20=29]="Key20"})(Vn||(Vn={}));class mo extends gu{constructor(){super(...arguments),this.actions=new Set}fromLegacy(e,t,r){var i;if(!r)throw new Error("Beatmap must be provided to convert osu!mania replay frames.");this.startTime=e.startTime,this.interval=e.interval;const s=r;let o=Vn.Key1,u=Vn.Special1,l=Math.trunc((i=e.mouseX)!==null&&i!==void 0?i:0),c=0;for(;l>0;){const h=this._isColumnAtIndexSpecial(s,c);(l&1)>0&&this.actions.add(h?u:o),h?u++:o++,c++,l>>=1}return this}toLegacy(e){if(!e)throw new Error("Beatmap must be provided to convert osu!mania replay frames.");const t=e;let r=0;for(const i of this.actions){if(i===Vn.Special1){r|=1<<this._getSpecialColumnIndex(t,0);continue}if(i===Vn.Special2){r|=1<<this._getSpecialColumnIndex(t,1);continue}let s=i-Vn.Key1,o=0;for(;o<t.totalColumns;)if(!this._isColumnAtIndexSpecial(t,o)){if(s===0)break;s--,o++}r|=1<<o}return new Gi(this.startTime,this.interval,new he(r,0),Kt.None)}_getSpecialColumnIndex(e,t){for(let r=0;r<e.totalColumns;++r)if(this._isColumnAtIndexSpecial(e,r)){if(t===0)return r;t--}throw new Error("Special key index is too high.")}_isColumnAtIndexSpecial(e,t){for(const r of e.stages){if(t>=r.columns){t-=r.columns;continue}return r.isSpecialColumn(t)}throw new Error("Column index is too high.")}}class Od extends k0{_createConvertibleReplayFrame(){return new mo}_isConvertedReplayFrame(e){return e instanceof mo}}class sa extends R0{get id(){return 3}applyToBeatmap(e){return super.applyToBeatmap(e)}applyToBeatmapWithMods(e,t){return super.applyToBeatmapWithMods(e,t)}resetMods(e){return super.resetMods(e)}createModCombination(e){return new Vi(e)}_createBeatmapProcessor(){return new kd}_createBeatmapConverter(){return new mr}_createReplayConverter(){return new Od}createDifficultyCalculator(e){return new zi(e,this)}createPerformanceCalculator(e,t){return new Ld(this,e,t)}}var rs={exports:{}};const Id={},Nd=Object.freeze(Object.defineProperty({__proto__:null,default:Id},Symbol.toStringTag,{value:"Module"})),po=Jc(Nd);var go;function Gd(){return go||(go=1,(function(n){(function(){var e="input is invalid type",t="finalize already called",r=typeof window=="object",i=r?window:{};i.JS_MD5_NO_WINDOW&&(r=!1);var s=!r&&typeof self=="object",o=!i.JS_MD5_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;o?i=Qc:s&&(i=self);var u=!i.JS_MD5_NO_COMMON_JS&&!0&&n.exports,l=!i.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),h=[128,32768,8388608,-2147483648],d=[0,8,16,24],m=["hex","array","digest","buffer","arrayBuffer","base64"],D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),p=[],v;if(l){var F=new ArrayBuffer(68);v=new Uint8Array(F),p=new Uint32Array(F)}var S=Array.isArray;(i.JS_MD5_NO_NODE_JS||!S)&&(S=function(_){return Object.prototype.toString.call(_)==="[object Array]"});var C=ArrayBuffer.isView;l&&(i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!C)&&(C=function(_){return typeof _=="object"&&_.buffer&&_.buffer.constructor===ArrayBuffer});var B=function(_){var T=typeof _;if(T==="string")return[_,!0];if(T!=="object"||_===null)throw new Error(e);if(l&&_.constructor===ArrayBuffer)return[new Uint8Array(_),!1];if(!S(_)&&!C(_))throw new Error(e);return[_,!1]},x=function(_){return function(T){return new K(!0).update(T)[_]()}},j=function(){var _=x("hex");o&&(_=W(_)),_.create=function(){return new K},_.update=function(y){return _.create().update(y)};for(var T=0;T<m.length;++T){var A=m[T];_[A]=x(A)}return _},W=function(_){var T=po,A=po.Buffer,y;A.from&&!i.JS_MD5_NO_BUFFER_FROM?y=A.from:y=function(I){return new A(I)};var O=function(I){if(typeof I=="string")return T.createHash("md5").update(I,"utf8").digest("hex");if(I==null)throw new Error(e);return I.constructor===ArrayBuffer&&(I=new Uint8Array(I)),S(I)||C(I)||I.constructor===A?T.createHash("md5").update(y(I)).digest("hex"):_(I)};return O},Z=function(_){return function(T,A){return new ae(T,!0).update(A)[_]()}},J=function(){var _=Z("hex");_.create=function(y){return new ae(y)},_.update=function(y,O){return _.create(y).update(O)};for(var T=0;T<m.length;++T){var A=m[T];_[A]=Z(A)}return _};function K(_){if(_)p[0]=p[16]=p[1]=p[2]=p[3]=p[4]=p[5]=p[6]=p[7]=p[8]=p[9]=p[10]=p[11]=p[12]=p[13]=p[14]=p[15]=0,this.blocks=p,this.buffer8=v;else if(l){var T=new ArrayBuffer(68);this.buffer8=new Uint8Array(T),this.blocks=new Uint32Array(T)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}K.prototype.update=function(_){if(this.finalized)throw new Error(t);var T=B(_);_=T[0];for(var A=T[1],y,O=0,I,k=_.length,q=this.blocks,ge=this.buffer8;O<k;){if(this.hashed&&(this.hashed=!1,q[0]=q[16],q[16]=q[1]=q[2]=q[3]=q[4]=q[5]=q[6]=q[7]=q[8]=q[9]=q[10]=q[11]=q[12]=q[13]=q[14]=q[15]=0),A)if(l)for(I=this.start;O<k&&I<64;++O)y=_.charCodeAt(O),y<128?ge[I++]=y:y<2048?(ge[I++]=192|y>>>6,ge[I++]=128|y&63):y<55296||y>=57344?(ge[I++]=224|y>>>12,ge[I++]=128|y>>>6&63,ge[I++]=128|y&63):(y=65536+((y&1023)<<10|_.charCodeAt(++O)&1023),ge[I++]=240|y>>>18,ge[I++]=128|y>>>12&63,ge[I++]=128|y>>>6&63,ge[I++]=128|y&63);else for(I=this.start;O<k&&I<64;++O)y=_.charCodeAt(O),y<128?q[I>>>2]|=y<<d[I++&3]:y<2048?(q[I>>>2]|=(192|y>>>6)<<d[I++&3],q[I>>>2]|=(128|y&63)<<d[I++&3]):y<55296||y>=57344?(q[I>>>2]|=(224|y>>>12)<<d[I++&3],q[I>>>2]|=(128|y>>>6&63)<<d[I++&3],q[I>>>2]|=(128|y&63)<<d[I++&3]):(y=65536+((y&1023)<<10|_.charCodeAt(++O)&1023),q[I>>>2]|=(240|y>>>18)<<d[I++&3],q[I>>>2]|=(128|y>>>12&63)<<d[I++&3],q[I>>>2]|=(128|y>>>6&63)<<d[I++&3],q[I>>>2]|=(128|y&63)<<d[I++&3]);else if(l)for(I=this.start;O<k&&I<64;++O)ge[I++]=_[O];else for(I=this.start;O<k&&I<64;++O)q[I>>>2]|=_[O]<<d[I++&3];this.lastByteIndex=I,this.bytes+=I-this.start,I>=64?(this.start=I-64,this.hash(),this.hashed=!0):this.start=I}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},K.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var _=this.blocks,T=this.lastByteIndex;_[T>>>2]|=h[T&3],T>=56&&(this.hashed||this.hash(),_[0]=_[16],_[16]=_[1]=_[2]=_[3]=_[4]=_[5]=_[6]=_[7]=_[8]=_[9]=_[10]=_[11]=_[12]=_[13]=_[14]=_[15]=0),_[14]=this.bytes<<3,_[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},K.prototype.hash=function(){var _,T,A,y,O,I,k=this.blocks;this.first?(_=k[0]-680876937,_=(_<<7|_>>>25)-271733879<<0,y=(-1732584194^_&2004318071)+k[1]-117830708,y=(y<<12|y>>>20)+_<<0,A=(-271733879^y&(_^-271733879))+k[2]-1126478375,A=(A<<17|A>>>15)+y<<0,T=(_^A&(y^_))+k[3]-1316259209,T=(T<<22|T>>>10)+A<<0):(_=this.h0,T=this.h1,A=this.h2,y=this.h3,_+=(y^T&(A^y))+k[0]-680876936,_=(_<<7|_>>>25)+T<<0,y+=(A^_&(T^A))+k[1]-389564586,y=(y<<12|y>>>20)+_<<0,A+=(T^y&(_^T))+k[2]+606105819,A=(A<<17|A>>>15)+y<<0,T+=(_^A&(y^_))+k[3]-1044525330,T=(T<<22|T>>>10)+A<<0),_+=(y^T&(A^y))+k[4]-176418897,_=(_<<7|_>>>25)+T<<0,y+=(A^_&(T^A))+k[5]+1200080426,y=(y<<12|y>>>20)+_<<0,A+=(T^y&(_^T))+k[6]-1473231341,A=(A<<17|A>>>15)+y<<0,T+=(_^A&(y^_))+k[7]-45705983,T=(T<<22|T>>>10)+A<<0,_+=(y^T&(A^y))+k[8]+1770035416,_=(_<<7|_>>>25)+T<<0,y+=(A^_&(T^A))+k[9]-1958414417,y=(y<<12|y>>>20)+_<<0,A+=(T^y&(_^T))+k[10]-42063,A=(A<<17|A>>>15)+y<<0,T+=(_^A&(y^_))+k[11]-1990404162,T=(T<<22|T>>>10)+A<<0,_+=(y^T&(A^y))+k[12]+1804603682,_=(_<<7|_>>>25)+T<<0,y+=(A^_&(T^A))+k[13]-40341101,y=(y<<12|y>>>20)+_<<0,A+=(T^y&(_^T))+k[14]-1502002290,A=(A<<17|A>>>15)+y<<0,T+=(_^A&(y^_))+k[15]+1236535329,T=(T<<22|T>>>10)+A<<0,_+=(A^y&(T^A))+k[1]-165796510,_=(_<<5|_>>>27)+T<<0,y+=(T^A&(_^T))+k[6]-1069501632,y=(y<<9|y>>>23)+_<<0,A+=(_^T&(y^_))+k[11]+643717713,A=(A<<14|A>>>18)+y<<0,T+=(y^_&(A^y))+k[0]-373897302,T=(T<<20|T>>>12)+A<<0,_+=(A^y&(T^A))+k[5]-701558691,_=(_<<5|_>>>27)+T<<0,y+=(T^A&(_^T))+k[10]+38016083,y=(y<<9|y>>>23)+_<<0,A+=(_^T&(y^_))+k[15]-660478335,A=(A<<14|A>>>18)+y<<0,T+=(y^_&(A^y))+k[4]-405537848,T=(T<<20|T>>>12)+A<<0,_+=(A^y&(T^A))+k[9]+568446438,_=(_<<5|_>>>27)+T<<0,y+=(T^A&(_^T))+k[14]-1019803690,y=(y<<9|y>>>23)+_<<0,A+=(_^T&(y^_))+k[3]-187363961,A=(A<<14|A>>>18)+y<<0,T+=(y^_&(A^y))+k[8]+1163531501,T=(T<<20|T>>>12)+A<<0,_+=(A^y&(T^A))+k[13]-1444681467,_=(_<<5|_>>>27)+T<<0,y+=(T^A&(_^T))+k[2]-51403784,y=(y<<9|y>>>23)+_<<0,A+=(_^T&(y^_))+k[7]+1735328473,A=(A<<14|A>>>18)+y<<0,T+=(y^_&(A^y))+k[12]-1926607734,T=(T<<20|T>>>12)+A<<0,O=T^A,_+=(O^y)+k[5]-378558,_=(_<<4|_>>>28)+T<<0,y+=(O^_)+k[8]-2022574463,y=(y<<11|y>>>21)+_<<0,I=y^_,A+=(I^T)+k[11]+1839030562,A=(A<<16|A>>>16)+y<<0,T+=(I^A)+k[14]-35309556,T=(T<<23|T>>>9)+A<<0,O=T^A,_+=(O^y)+k[1]-1530992060,_=(_<<4|_>>>28)+T<<0,y+=(O^_)+k[4]+1272893353,y=(y<<11|y>>>21)+_<<0,I=y^_,A+=(I^T)+k[7]-155497632,A=(A<<16|A>>>16)+y<<0,T+=(I^A)+k[10]-1094730640,T=(T<<23|T>>>9)+A<<0,O=T^A,_+=(O^y)+k[13]+681279174,_=(_<<4|_>>>28)+T<<0,y+=(O^_)+k[0]-358537222,y=(y<<11|y>>>21)+_<<0,I=y^_,A+=(I^T)+k[3]-722521979,A=(A<<16|A>>>16)+y<<0,T+=(I^A)+k[6]+76029189,T=(T<<23|T>>>9)+A<<0,O=T^A,_+=(O^y)+k[9]-640364487,_=(_<<4|_>>>28)+T<<0,y+=(O^_)+k[12]-421815835,y=(y<<11|y>>>21)+_<<0,I=y^_,A+=(I^T)+k[15]+530742520,A=(A<<16|A>>>16)+y<<0,T+=(I^A)+k[2]-995338651,T=(T<<23|T>>>9)+A<<0,_+=(A^(T|~y))+k[0]-198630844,_=(_<<6|_>>>26)+T<<0,y+=(T^(_|~A))+k[7]+1126891415,y=(y<<10|y>>>22)+_<<0,A+=(_^(y|~T))+k[14]-1416354905,A=(A<<15|A>>>17)+y<<0,T+=(y^(A|~_))+k[5]-57434055,T=(T<<21|T>>>11)+A<<0,_+=(A^(T|~y))+k[12]+1700485571,_=(_<<6|_>>>26)+T<<0,y+=(T^(_|~A))+k[3]-1894986606,y=(y<<10|y>>>22)+_<<0,A+=(_^(y|~T))+k[10]-1051523,A=(A<<15|A>>>17)+y<<0,T+=(y^(A|~_))+k[1]-2054922799,T=(T<<21|T>>>11)+A<<0,_+=(A^(T|~y))+k[8]+1873313359,_=(_<<6|_>>>26)+T<<0,y+=(T^(_|~A))+k[15]-30611744,y=(y<<10|y>>>22)+_<<0,A+=(_^(y|~T))+k[6]-1560198380,A=(A<<15|A>>>17)+y<<0,T+=(y^(A|~_))+k[13]+1309151649,T=(T<<21|T>>>11)+A<<0,_+=(A^(T|~y))+k[4]-145523070,_=(_<<6|_>>>26)+T<<0,y+=(T^(_|~A))+k[11]-1120210379,y=(y<<10|y>>>22)+_<<0,A+=(_^(y|~T))+k[2]+718787259,A=(A<<15|A>>>17)+y<<0,T+=(y^(A|~_))+k[9]-343485551,T=(T<<21|T>>>11)+A<<0,this.first?(this.h0=_+1732584193<<0,this.h1=T-271733879<<0,this.h2=A-1732584194<<0,this.h3=y+271733878<<0,this.first=!1):(this.h0=this.h0+_<<0,this.h1=this.h1+T<<0,this.h2=this.h2+A<<0,this.h3=this.h3+y<<0)},K.prototype.hex=function(){this.finalize();var _=this.h0,T=this.h1,A=this.h2,y=this.h3;return c[_>>>4&15]+c[_&15]+c[_>>>12&15]+c[_>>>8&15]+c[_>>>20&15]+c[_>>>16&15]+c[_>>>28&15]+c[_>>>24&15]+c[T>>>4&15]+c[T&15]+c[T>>>12&15]+c[T>>>8&15]+c[T>>>20&15]+c[T>>>16&15]+c[T>>>28&15]+c[T>>>24&15]+c[A>>>4&15]+c[A&15]+c[A>>>12&15]+c[A>>>8&15]+c[A>>>20&15]+c[A>>>16&15]+c[A>>>28&15]+c[A>>>24&15]+c[y>>>4&15]+c[y&15]+c[y>>>12&15]+c[y>>>8&15]+c[y>>>20&15]+c[y>>>16&15]+c[y>>>28&15]+c[y>>>24&15]},K.prototype.toString=K.prototype.hex,K.prototype.digest=function(){this.finalize();var _=this.h0,T=this.h1,A=this.h2,y=this.h3;return[_&255,_>>>8&255,_>>>16&255,_>>>24&255,T&255,T>>>8&255,T>>>16&255,T>>>24&255,A&255,A>>>8&255,A>>>16&255,A>>>24&255,y&255,y>>>8&255,y>>>16&255,y>>>24&255]},K.prototype.array=K.prototype.digest,K.prototype.arrayBuffer=function(){this.finalize();var _=new ArrayBuffer(16),T=new Uint32Array(_);return T[0]=this.h0,T[1]=this.h1,T[2]=this.h2,T[3]=this.h3,_},K.prototype.buffer=K.prototype.arrayBuffer,K.prototype.base64=function(){for(var _,T,A,y="",O=this.array(),I=0;I<15;)_=O[I++],T=O[I++],A=O[I++],y+=D[_>>>2]+D[(_<<4|T>>>4)&63]+D[(T<<2|A>>>6)&63]+D[A&63];return _=O[I],y+=D[_>>>2]+D[_<<4&63]+"==",y};function ae(_,T){var A,y=B(_);if(_=y[0],y[1]){var O=[],I=_.length,k=0,q;for(A=0;A<I;++A)q=_.charCodeAt(A),q<128?O[k++]=q:q<2048?(O[k++]=192|q>>>6,O[k++]=128|q&63):q<55296||q>=57344?(O[k++]=224|q>>>12,O[k++]=128|q>>>6&63,O[k++]=128|q&63):(q=65536+((q&1023)<<10|_.charCodeAt(++A)&1023),O[k++]=240|q>>>18,O[k++]=128|q>>>12&63,O[k++]=128|q>>>6&63,O[k++]=128|q&63);_=O}_.length>64&&(_=new K(!0).update(_).array());var ge=[],be=[];for(A=0;A<64;++A){var Q=_[A]||0;ge[A]=92^Q,be[A]=54^Q}K.call(this,T),this.update(be),this.oKeyPad=ge,this.inner=!0,this.sharedMemory=T}ae.prototype=new K,ae.prototype.finalize=function(){if(K.prototype.finalize.call(this),this.inner){this.inner=!1;var _=this.array();K.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(_),K.prototype.finalize.call(this)}};var le=j();le.md5=le,le.md5.hmac=J(),u?n.exports=le:i.md5=le})()})(rs)),rs.exports}var Gu=Gd();const Hd=new sa,_o=new gd,Ui=Gs("beatmapStore",{state:()=>({items:[]}),actions:{async addBeatmap(n){const e=Gu.md5(n);if(await Fi(e)||await iu(e,n),!this.items.find(t=>t.md5===e)){const t=_o.decodeFromString(n,{parseHitObjects:!1,parseStoryboard:!1});this.items.push({md5:e,title:t.metadata.titleUnicode,version:t.metadata.version,uploadedAt:new Date().toISOString()})}},async readBeatmap(n){const e=await Fi(n);if(!e)throw new Error(`Beatmap with MD5 ${n} not found in storage.`);const t=_o.decodeFromString(e,{parseStoryboard:!1});return Hd.applyToBeatmap(t)},async removeBeatmap(n){await su(n),this.items.splice(this.items.findIndex(e=>e.md5===n),1)},async clearAll(){for(const n of this.items)await this.removeBeatmap(n.md5);this.items=[]}},persist:!0}),jd=new sa,Do=new _d;class Vd{name="ScoreV2";acronym="V2";bitwise=N.ScoreV2;type=Ze.System;multiplier=1;isRanked=!1;incompatibles=N.None;isUserPlayable=!0}class Wd extends Vi{get _availableMods(){return[...super._availableMods,new Vd]}}const aa=Gs("replayStore",{state:()=>({items:[]}),actions:{async addReplay(n){const e=Gu.md5(n);if(await Fi(e)||await iu(e,n),!this.items.find(t=>t.replayMD5===e)){const t=await Do.decodeFromBuffer(n,!1),r=new Wd(t.info.rawMods);this.items.push({replayMD5:e,beatmapMD5:t.info.beatmapHashMD5,player:t.info.username,score:t.info.totalScore,accuracy:t.info.accuracy,mods:r.acronyms,playedAt:t.info.date.toISOString(),uploadedAt:new Date().toISOString()})}},async readReplay(n,e){const t=await Fi(n);if(!t)throw new Error(`Replay with MD5 ${n} not found in storage.`);const r=await Do.decodeFromBuffer(t,!0),i=jd.applyToReplay(r.replay,e);return{info:r.info,replay:i}},async removeReplay(n){await su(n),this.items.splice(this.items.findIndex(e=>e.replayMD5===n),1)},async clearAll(){for(const n of this.items)await this.removeReplay(n.replayMD5);this.items=[]}},persist:!0}),oa=Gs("stateStore",{state:()=>({selectedBeatmapMD5:null,selectedReplayMD5:null})}),zd=Ue({__name:"Upload",setup(n){const e=Ui(),t=aa();async function r(i){if(i.file.name.endsWith(".osu")){const s=await i.file.text();s&&await e.addBeatmap(s)}else if(i.file.name.endsWith(".osr")){const s=await i.file.arrayBuffer();s&&await t.addReplay(s)}}return(i,s)=>{const o=$c,u=Zc;return We(),hn(u,{drag:"",multiple:"",accept:".osu,.osr","show-file-list":!1,"http-request":r},{default:Le(()=>[pe(o,{class:"el-icon--upload"},{default:Le(()=>[pe(At(eh))]),_:1}),s[0]||(s[0]=Mt("div",{class:"el-upload__text"},[sn(" Drop "),Mt("strong",null,".osu"),sn(" or "),Mt("strong",null,".osr"),sn(" files here or "),Mt("em",null,"click to upload")],-1))]),_:1})}}}),Ud={class:"card-header"},Xd={class:"tree-label"},Kd={class:"card-footer"},Yd=Ue({__name:"FileList",setup(n){const e=Ui(),t=aa(),r=oa(),i=Ht(()=>{const l=new Map;e.items.forEach(h=>{l.set(h.md5,{key:h.md5,label:`${h.title} [${h.version}]`,type:"beatmap",children:[]})});const c=[];return t.items.forEach(h=>{const d=h.mods&&h.mods.length>0?h.mods.join(""):"No Mod",m={key:h.replayMD5,label:`${h.player} [${d}] - ${h.playedAt}`,type:"replay"},D=l.get(h.beatmapMD5);D?(m.parent=D,D.children.push(m)):(m.label+=" (No Beatmap)",c.push(m))}),[...Array.from(l.values()),...c]});function s(l,c){l.type==="beatmap"?(r.selectedBeatmapMD5=l.key,r.selectedReplayMD5=null):l.type==="replay"&&(r.selectedBeatmapMD5=l.parent?.key||null,r.selectedReplayMD5=l.key)}function o(l,c){c.type==="beatmap"?(r.selectedBeatmapMD5===c.key&&(r.selectedBeatmapMD5=null,r.selectedReplayMD5=null),e.removeBeatmap(c.key)):c.type==="replay"&&(r.selectedReplayMD5===c.key&&(r.selectedReplayMD5=null),t.removeReplay(c.key))}function u(){r.selectedBeatmapMD5=null,r.selectedReplayMD5=null,e.clearAll(),t.clearAll()}return(l,c)=>{const h=rh,d=nh,m=th;return We(),hn(m,{"body-style":"padding: 0;"},{header:Le(()=>[Mt("div",Ud,[c[1]||(c[1]=Mt("span",null,"Files",-1)),pe(h,{style:{float:"right"},type:"danger",link:"",onClick:u},{default:Le(()=>[...c[0]||(c[0]=[sn(" Clear All ",-1)])]),_:1})])]),footer:Le(()=>[Mt("div",Kd," Total Beatmaps: "+an(At(e).items.length)+", Total Replays: "+an(At(t).items.length),1)]),default:Le(()=>[pe(d,{data:i.value,accordion:"","node-key":"key","highlight-current":"",onNodeClick:s},{default:Le(({node:D,data:p})=>[Mt("span",null,[pe(h,{style:{"margin-left":"4px"},type:"danger",link:"",onClick:v=>o(D,p)},{default:Le(()=>[...c[2]||(c[2]=[sn(" X ",-1)])]),_:1},8,["onClick"])]),Mt("span",Xd,an(p.label),1)]),_:1},8,["data"])]),_:1})}}}),qd=Ue({__name:"Sidebar",setup(n){return(e,t)=>(We(),pt(Li,null,[pe(mh),pe(zd),pe(Yd)],64))}}),Jd=Ue({__name:"App",setup(n){return(e,t)=>{const r=ih,i=Ns("RouterView"),s=sh,o=js;return We(),hn(o,null,{default:Le(()=>[pe(r,{width:"500px"},{default:Le(()=>[pe(At(qd))]),_:1}),pe(s,null,{default:Le(()=>[pe(i)]),_:1})]),_:1})}}}),Xi=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t},Qd=Xi(Jd,[["__scopeId","data-v-f6179cf2"]]);function Zd(n,e){if(n==null)return;let t=n;for(let r=0;r<e.length;r++){if(t===void 0||t[e[r]]===void 0)return;if(t===null||t[e[r]]===null)return null;t=t[e[r]]}return t}function ua(n,e,t){if(t.length===0)return e;const r=t[0];return t.length>1&&(e=ua(typeof n!="object"||n===null||!Object.prototype.hasOwnProperty.call(n,r)?Number.isInteger(Number(t[1]))?[]:{}:n[r],e,Array.prototype.slice.call(t,1))),Number.isInteger(Number(r))&&Array.isArray(n)?n.slice()[r]:Object.assign({},n,{[r]:e})}function Hu(n,e){if(n==null||e.length===0)return n;if(e.length===1){if(n==null)return n;if(Number.isInteger(e[0])&&Array.isArray(n))return Array.prototype.slice.call(n,0).splice(e[0],1);const t={};for(const r in n)t[r]=n[r];return delete t[e[0]],t}if(n[e[0]]==null){if(Number.isInteger(e[0])&&Array.isArray(n))return Array.prototype.concat.call([],n);const t={};for(const r in n)t[r]=n[r];return t}return ua(n,Hu(n[e[0]],Array.prototype.slice.call(e,1)),[e[0]])}function ju(n,e){return e.map(t=>t.split(".")).map(t=>[t,Zd(n,t)]).filter(t=>t[1]!==void 0).reduce((t,r)=>ua(t,r[1],r[0]),{})}function Vu(n,e){return e.map(t=>t.split(".")).reduce((t,r)=>Hu(t,r),n)}function bo(n,{storage:e,serializer:t,key:r,debug:i,pick:s,omit:o,beforeHydrate:u,afterHydrate:l},c,h=!0){try{h&&u?.(c);const d=e.getItem(r);if(d){const m=t.deserialize(d),D=s?ju(m,s):m,p=o?Vu(D,o):D;n.$patch(p)}h&&l?.(c)}catch(d){i&&console.error("[pinia-plugin-persistedstate]",d)}}function yo(n,{storage:e,serializer:t,key:r,debug:i,pick:s,omit:o}){try{const u=s?ju(n,s):n,l=o?Vu(u,o):u,c=t.serialize(l);e.setItem(r,c)}catch(u){i&&console.error("[pinia-plugin-persistedstate]",u)}}function $d(n,e){return typeof n=="function"?n(e):typeof n=="string"?n:e}function ef(n,e,t){const{pinia:r,store:i,options:{persist:s=t}}=n;if(!s)return;if(!(i.$id in r.state.value)){const u=r._s.get(i.$id.replace("__hot:",""));u&&Promise.resolve().then(()=>u.$persist());return}const o=(Array.isArray(s)?s:s===!0?[{}]:[s]).map(e);i.$hydrate=({runHooks:u=!0}={})=>{o.forEach(l=>{bo(i,l,n,u)})},i.$persist=()=>{o.forEach(u=>{yo(i.$state,u)})},o.forEach(u=>{bo(i,u,n),i.$subscribe((l,c)=>yo(c,u),{detached:!0})})}function tf(n={}){return function(e){ef(e,t=>{const r=$d(t.key,e.store.$id);return{key:(n.key?n.key:i=>i)(r),debug:t.debug??n.debug??!1,serializer:t.serializer??n.serializer??{serialize:i=>JSON.stringify(i),deserialize:i=>JSON.parse(i)},storage:t.storage??n.storage??window.localStorage,beforeHydrate:t.beforeHydrate??n.beforeHydrate,afterHydrate:t.afterHydrate??n.afterHydrate,pick:t.pick,omit:t.omit}},n.auto??!1)}}var nf=tf();const rf=Math.PI/180;function sf(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}const Wn=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},Y={_global:Wn,version:"10.0.12",isBrowser:sf(),isUnminified:/param/.test((function(n){}).toString()),dblClickWindow:400,getAngle(n){return Y.angleDeg?n*rf:n},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return Y.DD.isDragging},isTransforming(){var n,e;return(e=(n=Y.Transformer)===null||n===void 0?void 0:n.isTransforming())!==null&&e!==void 0?e:!1},isDragReady(){return!!Y.DD.node},releaseCanvasOnDestroy:!0,document:Wn.document,_injectGlobal(n){typeof Wn.Konva<"u"&&console.error("Several Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),Wn.Konva=n}},Ke=n=>{Y[n.prototype.getClassName()]=n};Y._injectGlobal(Y);const af=`Konva.js unsupported environment.

Looks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.

To use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.

bash: npm install canvas
js: import "konva/canvas-backend";

or

bash: npm install skia-canvas
js: import "konva/skia-backend";
`,So=()=>{if(typeof document>"u")throw new Error(af)};class Et{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new Et(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){const t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.m[0]*t+this.m[2]*r,s=this.m[1]*t+this.m[3]*r,o=this.m[0]*-r+this.m[2]*t,u=this.m[1]*-r+this.m[3]*t;return this.m[0]=i,this.m[1]=s,this.m[2]=o,this.m[3]=u,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){const r=this.m[0]+this.m[2]*t,i=this.m[1]+this.m[3]*t,s=this.m[2]+this.m[0]*e,o=this.m[3]+this.m[1]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o,this}multiply(e){const t=this.m[0]*e.m[0]+this.m[2]*e.m[1],r=this.m[1]*e.m[0]+this.m[3]*e.m[1],i=this.m[0]*e.m[2]+this.m[2]*e.m[3],s=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],u=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=u,this}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,s=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),u=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=u,this}getMatrix(){return this.m}decompose(){const e=this.m[0],t=this.m[1],r=this.m[2],i=this.m[3],s=this.m[4],o=this.m[5],u=e*i-t*r,l={x:s,y:o,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){const c=Math.sqrt(e*e+t*t);l.rotation=t>0?Math.acos(e/c):-Math.acos(e/c),l.scaleX=c,l.scaleY=u/c,l.skewX=(e*r+t*i)/u,l.skewY=0}else if(r!=0||i!=0){const c=Math.sqrt(r*r+i*i);l.rotation=Math.PI/2-(i>0?Math.acos(-r/c):-Math.acos(r/c)),l.scaleX=u/c,l.scaleY=c,l.skewX=0,l.skewY=(e*r+t*i)/u}return l.rotation=M._getRotation(l.rotation),l}}const of="[object Array]",uf="[object Number]",lf="[object String]",cf="[object Boolean]",hf=Math.PI/180,df=180/Math.PI,wr="#",ff="",mf="0",pf="Konva warning: ",vo="Konva error: ",gf="rgb(",is={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},_f=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let hi=[],Er=null;const Df=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(n){setTimeout(n,60)},M={_isElement(n){return!!(n&&n.nodeType==1)},_isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)},_isPlainObject(n){return!!n&&n.constructor===Object},_isArray(n){return Object.prototype.toString.call(n)===of},_isNumber(n){return Object.prototype.toString.call(n)===uf&&!isNaN(n)&&isFinite(n)},_isString(n){return Object.prototype.toString.call(n)===lf},_isBoolean(n){return Object.prototype.toString.call(n)===cf},isObject(n){return n instanceof Object},isValidSelector(n){if(typeof n!="string")return!1;const e=n[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(n){return n===0||n>0?1:-1},requestAnimFrame(n){hi.push(n),hi.length===1&&Df(function(){const e=hi;hi=[],e.forEach(function(t){t()})})},createCanvasElement(){So();const n=document.createElement("canvas");try{n.style=n.style||{}}catch{}return n},createImageElement(){return So(),document.createElement("img")},_isInDocument(n){for(;n=n.parentNode;)if(n==document)return!0;return!1},_urlToImage(n,e){const t=M.createImageElement();t.onload=function(){e(t)},t.src=n},_rgbToHex(n,e,t){return((1<<24)+(n<<16)+(e<<8)+t).toString(16).slice(1)},_hexToRgb(n){n=n.replace(wr,ff);const e=parseInt(n,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){let n=(Math.random()*16777215<<0).toString(16);for(;n.length<6;)n=mf+n;return wr+n},isCanvasFarblingActive(){if(Er!==null)return Er;if(typeof document>"u")return Er=!1,!1;const n=this.createCanvasElement();n.width=10,n.height=10;const e=n.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,10,10),e.fillStyle="#282828",e.fillRect(0,0,10,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let i=0;i<100;i++)if(t[i*4]!==40||t[i*4+1]!==40||t[i*4+2]!==40||t[i*4+3]!==255){r=!0;break}return Er=r,this.releaseCanvas(n),Er},getHitColor(){const n=this.getRandomColor();return this.isCanvasFarblingActive()?this.getSnappedHexColor(n):n},getHitColorKey(n,e,t){return this.isCanvasFarblingActive()&&(n=Math.round(n/5)*5,e=Math.round(e/5)*5,t=Math.round(t/5)*5),wr+this._rgbToHex(n,e,t)},getSnappedHexColor(n){const e=this._hexToRgb(n);return wr+this._rgbToHex(Math.round(e.r/5)*5,Math.round(e.g/5)*5,Math.round(e.b/5)*5)},getRGB(n){let e;return n in is?(e=is[n],{r:e[0],g:e[1],b:e[2]}):n[0]===wr?this._hexToRgb(n.substring(1)):n.substr(0,4)===gf?(e=_f.exec(n.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA(n){return n=n||"black",M._namedColorToRBA(n)||M._hex3ColorToRGBA(n)||M._hex4ColorToRGBA(n)||M._hex6ColorToRGBA(n)||M._hex8ColorToRGBA(n)||M._rgbColorToRGBA(n)||M._rgbaColorToRGBA(n)||M._hslColorToRGBA(n)},_namedColorToRBA(n){const e=is[n.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(n){if(n.indexOf("rgb(")===0){n=n.match(/rgb\(([^)]+)\)/)[1];const e=n.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(n){if(n.indexOf("rgba(")===0){n=n.match(/rgba\(([^)]+)\)/)[1];const e=n.split(/ *, */).map((t,r)=>t.slice(-1)==="%"?r===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(n){if(n[0]==="#"&&n.length===9)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:parseInt(n.slice(7,9),16)/255}},_hex6ColorToRGBA(n){if(n[0]==="#"&&n.length===7)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:1}},_hex4ColorToRGBA(n){if(n[0]==="#"&&n.length===5)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:parseInt(n[4]+n[4],16)/255}},_hex3ColorToRGBA(n){if(n[0]==="#"&&n.length===4)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:1}},_hslColorToRGBA(n){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(n)){const[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n),r=Number(t[0])/360,i=Number(t[1])/100,s=Number(t[2])/100;let o,u,l;if(i===0)return l=s*255,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};s<.5?o=s*(1+i):o=s+i-s*i;const c=2*s-o,h=[0,0,0];for(let d=0;d<3;d++)u=r+1/3*-(d-1),u<0&&u++,u>1&&u--,6*u<1?l=c+(o-c)*6*u:2*u<1?l=o:3*u<2?l=c+(o-c)*(2/3-u)*6:l=c,h[d]=l*255;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}},haveIntersection(n,e){return!(e.x>n.x+n.width||e.x+e.width<n.x||e.y>n.y+n.height||e.y+e.height<n.y)},cloneObject(n){const e={};for(const t in n)this._isPlainObject(n[t])?e[t]=this.cloneObject(n[t]):this._isArray(n[t])?e[t]=this.cloneArray(n[t]):e[t]=n[t];return e},cloneArray(n){return n.slice(0)},degToRad(n){return n*hf},radToDeg(n){return n*df},_degToRad(n){return M.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),M.degToRad(n)},_radToDeg(n){return M.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),M.radToDeg(n)},_getRotation(n){return Y.angleDeg?M.radToDeg(n):n},_capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)},throw(n){throw new Error(vo+n)},error(n){console.error(vo+n)},warn(n){Y.showWarnings&&console.warn(pf+n)},each(n,e){for(const t in n)e(t,n[t])},_inRange(n,e,t){return e<=n&&n<t},_getProjectionToSegment(n,e,t,r,i,s){let o,u,l;const c=(n-t)*(n-t)+(e-r)*(e-r);if(c==0)o=n,u=e,l=(i-t)*(i-t)+(s-r)*(s-r);else{const h=((i-n)*(t-n)+(s-e)*(r-e))/c;h<0?(o=n,u=e,l=(n-i)*(n-i)+(e-s)*(e-s)):h>1?(o=t,u=r,l=(t-i)*(t-i)+(r-s)*(r-s)):(o=n+h*(t-n),u=e+h*(r-e),l=(o-i)*(o-i)+(u-s)*(u-s))}return[o,u,l]},_getProjectionToLine(n,e,t){const r=M.cloneObject(n);let i=Number.MAX_VALUE;return e.forEach(function(s,o){if(!t&&o===e.length-1)return;const u=e[(o+1)%e.length],l=M._getProjectionToSegment(s.x,s.y,u.x,u.y,n.x,n.y),c=l[0],h=l[1],d=l[2];d<i&&(r.x=c,r.y=h,i=d)}),r},_prepareArrayForTween(n,e,t){const r=[],i=[];if(n.length>e.length){const o=e;e=n,n=o}for(let o=0;o<n.length;o+=2)r.push({x:n[o],y:n[o+1]});for(let o=0;o<e.length;o+=2)i.push({x:e[o],y:e[o+1]});const s=[];return i.forEach(function(o){const u=M._getProjectionToLine(o,r,t);s.push(u.x),s.push(u.y)}),s},_prepareToStringify(n){let e;n.visitedByCircularReferenceRemoval=!0;for(const t in n)if(n.hasOwnProperty(t)&&n[t]&&typeof n[t]=="object"){if(e=Object.getOwnPropertyDescriptor(n,t),n[t].visitedByCircularReferenceRemoval||M._isElement(n[t]))if(e.configurable)delete n[t];else return null;else if(M._prepareToStringify(n[t])===null)if(e.configurable)delete n[t];else return null}return delete n.visitedByCircularReferenceRemoval,n},_assign(n,e){for(const t in e)n[t]=e[t];return n},_getFirstPointerId(n){return n.touches?n.changedTouches[0].identifier:n.pointerId||999},releaseCanvas(...n){Y.releaseCanvasOnDestroy&&n.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(n,e,t,r){let i=e<0?e:0,s=t<0?t:0;e=Math.abs(e),t=Math.abs(t);let o=0,u=0,l=0,c=0;typeof r=="number"?o=u=l=c=Math.min(r,e/2,t/2):(o=Math.min(r[0]||0,e/2,t/2),u=Math.min(r[1]||0,e/2,t/2),c=Math.min(r[2]||0,e/2,t/2),l=Math.min(r[3]||0,e/2,t/2)),n.moveTo(i+o,s),n.lineTo(i+e-u,s),n.arc(i+e-u,s+u,u,Math.PI*3/2,0,!1),n.lineTo(i+e,s+t-c),n.arc(i+e-c,s+t-c,c,0,Math.PI/2,!1),n.lineTo(i+l,s+t),n.arc(i+l,s+t-l,l,Math.PI/2,Math.PI,!1),n.lineTo(i,s+o),n.arc(i+o,s+o,o,Math.PI,Math.PI*3/2,!1)},drawRoundedPolygonPath(n,e,t,r,i){r=Math.abs(r);for(let s=0;s<t;s++){const o=e[(s-1+t)%t],u=e[s],l=e[(s+1)%t],c={x:u.x-o.x,y:u.y-o.y},h={x:l.x-u.x,y:l.y-u.y},d=Math.hypot(c.x,c.y),m=Math.hypot(h.x,h.y);let D;typeof i=="number"?D=i:D=s<i.length?i[s]:0,D=r*Math.cos(Math.PI/t)*Math.min(1,D/r*2);const v={x:c.x/d,y:c.y/d},F={x:h.x/m,y:h.y/m},S={x:u.x-v.x*D,y:u.y-v.y*D},C={x:u.x+F.x*D,y:u.y+F.y*D};s===0?n.moveTo(S.x,S.y):n.lineTo(S.x,S.y),n.arcTo(u.x,u.y,C.x,C.y,D)}}};function bf(n){const e=[],t=n.length,r=M;for(let i=0;i<t;i++){let s=n[i];r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s)}return e}const wo=",",yf="(",Sf=")",vf="([",wf="])",Ef=";",Af="()",Ff="=",Eo=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],Tf=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"],Pf=100;let di=null;function Ao(){if(di!==null)return di;try{const e=M.createCanvasElement().getContext("2d");return e?!!e&&"filter"in e:(di=!1,!1)}catch{return di=!1,!1}}class Ki{constructor(e){this.canvas=e,Y.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let r=this.traceArr,i=r.length,s="",o,u,l,c;for(o=0;o<i;o++)u=r[o],l=u.method,l?(c=u.args,s+=l,e?s+=Af:M._isArray(c[0])?s+=vf+c.join(wo)+wf:(t&&(c=c.map(h=>typeof h=="number"?Math.floor(h):h)),s+=yf+c.join(wo)+Sf)):(s+=u.property,e||(s+=Ff+u.val)),s+=Ef;return s}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,r;t.push(e),r=t.length,r>=Pf&&t.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}_applyMiterLimit(e){const t=e.attrs.miterLimit;t!=null&&this.setAttr("miterLimit",t)}setAttr(e,t){this._context[e]=t}arc(e,t,r,i,s,o){this._context.arc(e,t,r,i,s,o)}arcTo(e,t,r,i,s){this._context.arcTo(e,t,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,r,i,s,o){this._context.bezierCurveTo(e,t,r,i,s,o)}clearRect(e,t,r,i){this._context.clearRect(e,t,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const r=arguments;if(r.length===2)return this._context.createImageData(e,t);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,r,i){return this._context.createLinearGradient(e,t,r,i)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,r,i,s,o){return this._context.createRadialGradient(e,t,r,i,s,o)}drawImage(e,t,r,i,s,o,u,l,c){const h=arguments,d=this._context;h.length===3?d.drawImage(e,t,r):h.length===5?d.drawImage(e,t,r,i,s):h.length===9&&d.drawImage(e,t,r,i,s,o,u,l,c)}ellipse(e,t,r,i,s,o,u,l){this._context.ellipse(e,t,r,i,s,o,u,l)}isPointInPath(e,t,r,i){return r?this._context.isPointInPath(r,e,t,i):this._context.isPointInPath(e,t,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,r,i){this._context.fillRect(e,t,r,i)}strokeRect(e,t,r,i){this._context.strokeRect(e,t,r,i)}fillText(e,t,r,i){i?this._context.fillText(e,t,r,i):this._context.fillText(e,t,r)}measureText(e){return this._context.measureText(e)}getImageData(e,t,r,i){return this._context.getImageData(e,t,r,i)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,r,i){this._context.rect(e,t,r,i)}roundRect(e,t,r,i,s){this._context.roundRect(e,t,r,i,s)}putImageData(e,t,r){this._context.putImageData(e,t,r)}quadraticCurveTo(e,t,r,i){this._context.quadraticCurveTo(e,t,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,r,i,s,o){this._context.setTransform(e,t,r,i,s,o)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,r,i){this._context.strokeText(e,t,r,i)}transform(e,t,r,i,s,o){this._context.transform(e,t,r,i,s,o)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=Eo.length,r=this.setAttr,i,s;const o=function(u){let l=e[u],c;e[u]=function(){return s=bf(Array.prototype.slice.call(arguments,0)),c=l.apply(e,arguments),e._trace({method:u,args:s}),c}};for(i=0;i<t;i++)o(Eo[i]);e.setAttr=function(){r.apply(e,arguments);const u=arguments[0];let l=arguments[1];(u==="shadowOffsetX"||u==="shadowOffsetY"||u==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:u,val:l})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}}Tf.forEach(function(n){Object.defineProperty(Ki.prototype,n,{get(){return this._context[n]},set(e){this._context[n]=e}})});class Cf extends Ki{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),r=e.getFillPriority();if(t&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const o=e.getFillRadialGradientColorStops();if(o&&r==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):o&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(t.x,t.y,r.x,r.y);if(i){for(let o=0;o<i.length;o+=2)s.addColorStop(i[o],i[o+1]);this.setAttr("strokeStyle",s)}}_stroke(e){const t=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var t,r,i;const s=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",o=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,u=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},l=e.getAbsoluteScale(),c=this.canvas.getPixelRatio(),h=l.x*c,d=l.y*c;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",o*Math.min(Math.abs(h),Math.abs(d))),this.setAttr("shadowOffsetX",u.x*h),this.setAttr("shadowOffsetY",u.y*d)}}class Mf extends Ki{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}let fi;function xf(){if(fi)return fi;const n=M.createCanvasElement(),e=n.getContext("2d");return fi=(function(){const t=Y._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/r})(),M.releaseCanvas(n),fi}class la{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||Y.pixelRatio||xf();this.pixelRatio=r,this._canvas=M.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(i){return M.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class wn extends la{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new Cf(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}class ca extends la{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new Mf(this),this.setSize(e.width,e.height)}}const xe={get isDragging(){let n=!1;return xe._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return xe._dragElements.forEach(e=>{n=e.node}),n},_dragElements:new Map,_drag(n){const e=[];xe._dragElements.forEach((t,r)=>{const{node:i}=t,s=i.getStage();s.setPointersPositions(n),t.pointerId===void 0&&(t.pointerId=M._getFirstPointerId(n));const o=s._changedPointerPositions.find(u=>u.id===t.pointerId);if(o){if(t.dragStatus!=="dragging"){const u=i.dragDistance();if(Math.max(Math.abs(o.x-t.startPointerPos.x),Math.abs(o.y-t.startPointerPos.y))<u||(i.startDrag({evt:n}),!i.isDragging()))return}i._setDragPosition(n,t),e.push(i)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:n},!0)})},_endDragBefore(n){const e=[];xe._dragElements.forEach(t=>{const{node:r}=t,i=r.getStage();if(n&&i.setPointersPositions(n),!i._changedPointerPositions.find(u=>u.id===t.pointerId))return;(t.dragStatus==="dragging"||t.dragStatus==="stopped")&&(xe.justDragged=!0,Y._mouseListenClick=!1,Y._touchListenClick=!1,Y._pointerListenClick=!1,t.dragStatus="stopped");const o=t.node.getLayer()||t.node instanceof Y.Stage&&t.node;o&&e.indexOf(o)===-1&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(n){xe._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:n},!0),e.dragStatus!=="dragging"&&xe._dragElements.delete(t)})}};Y.isBrowser&&(window.addEventListener("mouseup",xe._endDragBefore,!0),window.addEventListener("touchend",xe._endDragBefore,!0),window.addEventListener("touchcancel",xe._endDragBefore,!0),window.addEventListener("mousemove",xe._drag),window.addEventListener("touchmove",xe._drag),window.addEventListener("mouseup",xe._endDragAfter,!1),window.addEventListener("touchend",xe._endDragAfter,!1),window.addEventListener("touchcancel",xe._endDragAfter,!1));function Pn(n){return M._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||M._isBoolean(n)?n:Object.prototype.toString.call(n)}function Wu(n){return n>255?255:n<0?0:Math.round(n)}function U(){if(Y.isUnminified)return function(n,e){return M._isNumber(n)||M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),n}}function Yi(n){if(Y.isUnminified)return function(e,t){let r=M._isNumber(e),i=M._isArray(e)&&e.length==n;return!r&&!i&&M.warn(Pn(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+n+")"),e}}function ha(){if(Y.isUnminified)return function(n,e){return M._isNumber(n)||n==="auto"||M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),n}}function Kn(){if(Y.isUnminified)return function(n,e){return M._isString(n)||M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),n}}function zu(){if(Y.isUnminified)return function(n,e){const t=M._isString(n),r=Object.prototype.toString.call(n)==="[object CanvasGradient]"||n&&n.addColorStop;return t||r||M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),n}}function Bf(){if(Y.isUnminified)return function(n,e){const t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&n instanceof t||(M._isArray(n)?n.forEach(function(r){M._isNumber(r)||M.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),n}}function Vt(){if(Y.isUnminified)return function(n,e){return n===!0||n===!1||M.warn(Pn(n)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),n}}function kf(n){if(Y.isUnminified)return function(e,t){return e==null||M.isObject(e)||M.warn(Pn(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+n),e}}const Ar="get",Fr="set",w={addGetterSetter(n,e,t,r,i){w.addGetter(n,e,t),w.addSetter(n,e,r,i),w.addOverloadedGetterSetter(n,e)},addGetter(n,e,t){const r=Ar+M._capitalize(e);n.prototype[r]=n.prototype[r]||function(){const i=this.attrs[e];return i===void 0?t:i}},addSetter(n,e,t,r){const i=Fr+M._capitalize(e);n.prototype[i]||w.overWriteSetter(n,e,t,r)},overWriteSetter(n,e,t,r){const i=Fr+M._capitalize(e);n.prototype[i]=function(s){return t&&s!==void 0&&s!==null&&(s=t.call(this,s,e)),this._setAttr(e,s),r&&r.call(this),this}},addComponentsGetterSetter(n,e,t,r,i){const s=t.length,o=M._capitalize,u=Ar+o(e),l=Fr+o(e);n.prototype[u]=function(){const h={};for(let d=0;d<s;d++){const m=t[d];h[m]=this.getAttr(e+o(m))}return h};const c=kf(t);n.prototype[l]=function(h){const d=this.attrs[e];r&&(h=r.call(this,h,e)),c&&c.call(this,h,e);for(const m in h)h.hasOwnProperty(m)&&this._setAttr(e+o(m),h[m]);return h||t.forEach(m=>{this._setAttr(e+o(m),void 0)}),this._fireChangeEvent(e,d,h),i&&i.call(this),this},w.addOverloadedGetterSetter(n,e)},addOverloadedGetterSetter(n,e){const t=M._capitalize(e),r=Fr+t,i=Ar+t;n.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(n,e,t,r){M.error("Adding deprecated "+e);const i=Ar+M._capitalize(e),s=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[i]=function(){M.error(s);const o=this.attrs[e];return o===void 0?t:o},w.addSetter(n,e,r,function(){M.error(s)}),w.addOverloadedGetterSetter(n,e)},backCompat(n,e){M.each(e,function(t,r){const i=n.prototype[r],s=Ar+M._capitalize(t),o=Fr+M._capitalize(t);function u(){i.apply(this,arguments),M.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}n.prototype[t]=u,n.prototype[s]=u,n.prototype[o]=u})},afterSetFilter(){this._filterUpToDate=!1}};function Rf(n){const e=/(\w+)\(([^)]+)\)/g;let t;for(;(t=e.exec(n))!==null;){const[,r,i]=t;switch(r){case"blur":{const s=parseFloat(i.replace("px",""));return function(o){this.blurRadius(s*.5);const u=Y.Filters;u&&u.Blur&&u.Blur.call(this,o)}}case"brightness":{const s=i.includes("%")?parseFloat(i)/100:parseFloat(i);return function(o){this.brightness(s);const u=Y.Filters;u&&u.Brightness&&u.Brightness.call(this,o)}}case"contrast":{const s=parseFloat(i);return function(o){const u=100*(Math.sqrt(s)-1);this.contrast(u);const l=Y.Filters;l&&l.Contrast&&l.Contrast.call(this,o)}}case"grayscale":return function(s){const o=Y.Filters;o&&o.Grayscale&&o.Grayscale.call(this,s)};case"sepia":return function(s){const o=Y.Filters;o&&o.Sepia&&o.Sepia.call(this,s)};case"invert":return function(s){const o=Y.Filters;o&&o.Invert&&o.Invert.call(this,s)};default:M.warn(`CSS filter "${r}" is not supported in fallback mode. Consider using function filters for better compatibility.`);break}}return()=>{}}const Ei="absoluteOpacity",mi="allEventListeners",en="absoluteTransform",Fo="absoluteScale",In="canvas",Lf="Change",Of="children",If="konva",Ss="listening",Nf="mouseenter",Gf="mouseleave",Hf="pointerenter",jf="pointerleave",Vf="touchenter",Wf="touchleave",To="set",Po="Shape",Ai=" ",Co="stage",Sn="transform",zf="Stage",vs="visible",Uf=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ai);let Xf=1;class z{constructor(e){this._id=Xf++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===Sn||e===en)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){let r=this._cache.get(e);return(r===void 0||(e===Sn||e===en)&&r.dirty===!0)&&(r=t.call(this),this._cache.set(e,r)),r}_calculate(e,t,r){if(!this._attachedDepsListeners.get(e)){const i=t.map(s=>s+"Change.konva").join(Ai);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(In)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===en&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(In)){const{scene:e,filter:t,hit:r,buffer:i}=this._cache.get(In);M.releaseCanvas(e,t,r,i),this._cache.delete(In)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const t=e||{};let r={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(t.width||r.width),s=Math.ceil(t.height||r.height),o=t.pixelRatio,u=t.x===void 0?Math.floor(r.x):t.x,l=t.y===void 0?Math.floor(r.y):t.y,c=t.offset||0,h=t.drawBorder||!1,d=t.hitCanvasPixelRatio||1;if(!i||!s){M.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const m=Math.abs(Math.round(r.x)-u)>.5?1:0,D=Math.abs(Math.round(r.y)-l)>.5?1:0;i+=c*2+m,s+=c*2+D,u-=c,l-=c;const p=new wn({pixelRatio:o,width:i,height:s}),v=new wn({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),F=new ca({pixelRatio:d,width:i,height:s}),S=p.getContext(),C=F.getContext(),B=new wn({width:p.width/p.pixelRatio+Math.abs(u),height:p.height/p.pixelRatio+Math.abs(l),pixelRatio:p.pixelRatio}),x=B.getContext();return F.isCache=!0,p.isCache=!0,this._cache.delete(In),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(p.getContext()._context.imageSmoothingEnabled=!1,v.getContext()._context.imageSmoothingEnabled=!1),S.save(),C.save(),x.save(),S.translate(-u,-l),C.translate(-u,-l),x.translate(-u,-l),B.x=u,B.y=l,this._isUnderCache=!0,this._clearSelfAndDescendantCache(Ei),this._clearSelfAndDescendantCache(Fo),this.drawScene(p,this,B),this.drawHit(F,this),this._isUnderCache=!1,S.restore(),C.restore(),h&&(S.save(),S.beginPath(),S.rect(0,0,i,s),S.closePath(),S.setAttr("strokeStyle","red"),S.setAttr("lineWidth",5),S.stroke(),S.restore()),this._cache.set(In,{scene:p,filter:v,hit:F,buffer:B,x:u,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(In)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let i=1/0,s=1/0,o=-1/0,u=-1/0;const l=this.getAbsoluteTransform(t);return r.forEach(function(c){const h=l.point(c);i===void 0&&(i=o=h.x,s=u=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),o=Math.max(o,h.x),u=Math.max(u,h.y)}),{x:i,y:s,width:o-i,height:u-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);const r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){const t=this._getCanvasCache(),r=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),t=this._getCanvasCache(),r=t.scene,i=t.filter,s=i.getContext(),o,u,l,c;if(!e||e.length===0)return r;if(this._filterUpToDate)return i;let h=!0;for(let m=0;m<e.length;m++)if(typeof e[m]=="string"&&Ao(),typeof e[m]!="string"||!Ao()){h=!1;break}const d=r.pixelRatio;if(i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio),h){const m=e.join(" ");return s.save(),s.setAttr("filter",m),s.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),s.restore(),this._filterUpToDate=!0,i}try{for(o=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),u=s.getImageData(0,0,i.getWidth(),i.getHeight()),l=0;l<o;l++)c=e[l],typeof c=="string"&&(c=Rf(c)),c.call(this,u),s.putImageData(u,0,0)}catch(m){M.error("Unable to apply filter. "+m.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,i}on(e,t){if(this._cache&&this._cache.delete(mi),arguments.length===3)return this._delegate.apply(this,arguments);const r=e.split(Ai);for(let i=0;i<r.length;i++){const o=r[i].split("."),u=o[0],l=o[1]||"";this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:l,handler:t})}return this}off(e,t){let r=(e||"").split(Ai),i=r.length,s,o,u,l,c,h;if(this._cache&&this._cache.delete(mi),!e)for(o in this.eventListeners)this._off(o);for(s=0;s<i;s++)if(u=r[s],l=u.split("."),c=l[0],h=l[1],c)this.eventListeners[c]&&this._off(c,h,t);else for(o in this.eventListeners)this._off(o,h,t);return this}dispatchEvent(e){const t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(r){t.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,r){const i=this;this.on(e,function(s){const o=s.target.findAncestors(t,!0,i);for(let u=0;u<o.length;u++)s=M.cloneObject(s),s.currentTarget=o[u],r.call(o[u],s)})}remove(){return this.isDragging()&&this.stopDrag(),xe._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(en),this._clearSelfAndDescendantCache(Ei),this._clearSelfAndDescendantCache(Fo),this._clearSelfAndDescendantCache(Co),this._clearSelfAndDescendantCache(vs),this._clearSelfAndDescendantCache(Ss)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const t="get"+M._capitalize(e);return M._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){let e=this.getParent(),t=[];for(;e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let t,r;if(!e)return this;for(t in e)t!==Of&&(r=To+M._capitalize(t),M._isFunction(this[r])?this[r](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(Ss,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(vs,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let i=!1;xe._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(o.node.nodeType==="Stage"||o.node.getLayer()===r)&&(i=!0)});const s=!t&&!Y.hitOnDragEnabled&&(i||Y.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),t=this,r=0,i,s,o,u;function l(h){for(i=[],s=h.length,o=0;o<s;o++)u=h[o],r++,u.nodeType!==Po&&(i=i.concat(u.getChildren().slice())),u._id===t._id&&(o=s);i.length>0&&i[0].getDepth()<=e&&l(i)}const c=this.getStage();return t.nodeType!==zf&&c&&l(c.getChildren()),r}getDepth(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Sn),this._clearSelfAndDescendantCache(en)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const t=e.getPointerPosition();if(!t)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(t)}getAbsolutePosition(e){let t=!1,r=this.parent;for(;r;){if(r.isCached()){t=!0;break}r=r.parent}t&&!e&&(e=!0);const i=this.getAbsoluteTransform(e).getMatrix(),s=new Et,o=this.offset();return s.m=i.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(e){const{x:t,y:r,...i}=this._clearTransform();this.attrs.x=t,this.attrs.y=r,this._clearCache(Sn);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(e.x,e.y),e={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(Sn),this._clearSelfAndDescendantCache(en),this}_setTransform(e){let t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let t=e.x,r=e.y,i=this.x(),s=this.y();return t!==void 0&&(i+=t),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,t){let r=[],i=this.getParent(),s,o;if(!(t&&t._id===this._id)){for(r.unshift(this);i&&(!t||i._id!==t._id);)r.unshift(i),i=i.parent;for(s=r.length,o=0;o<s;o++)e(r[o])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return M.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return M.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return M.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return M.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return M.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&M.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Ei,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),t,r,i,s,o;const u={attrs:{},className:this.getClassName()};for(t in e)r=e[t],o=M.isObject(r)&&!M._isPlainObject(r)&&!M._isArray(r),!o&&(i=typeof this[t]=="function"&&this[t],delete e[t],s=i?i.call(this):null,e[t]=r,s!==r&&(u.attrs[t]=r));return M._prepareToStringify(u)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,r){const i=[];t&&this._isMatch(e)&&i.push(this);let s=this.parent;for(;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,t,r){return this.findAncestors(e,t,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let t=e.replace(/ /g,"").split(","),r=t.length,i,s;for(i=0;i<r;i++)if(s=t[i],M.isValidSelector(s)||(M.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),M.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),M.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(Co,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,t={},r){return t.target=t.target||this,r?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(en,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let t;if(e)return t=new Et,this._eachAncestorReverse(function(r){const i=r.transformsEnabled();i==="all"?t.multiply(r.getTransform()):i==="position"&&t.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),t;{t=this._cache.get(en)||new Et,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();const r=this.transformsEnabled();if(r==="all")t.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,o=this.attrs.offsetX||0,u=this.attrs.offsetY||0;t.translate(i-o,s-u)}return t.dirty=!1,t}}getAbsoluteScale(e){let t=this;for(;t;)t._isUnderCache&&(e=t),t=t.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Sn,this._getTransform)}_getTransform(){var e,t;const r=this._cache.get(Sn)||new Et;r.reset();const i=this.x(),s=this.y(),o=Y.getAngle(this.rotation()),u=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,c=this.attrs.skewX||0,h=this.attrs.skewY||0,d=this.attrs.offsetX||0,m=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),o!==0&&r.rotate(o),(c!==0||h!==0)&&r.skew(c,h),(u!==1||l!==1)&&r.scale(u,l),(d!==0||m!==0)&&r.translate(-1*d,-1*m),r.dirty=!1,r}clone(e){let t=M.cloneObject(this.attrs),r,i,s,o,u;for(r in e)t[r]=e[r];const l=new this.constructor(t);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,o=0;o<s;o++)u=i[o],u.name.indexOf(If)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(u));return l}_toKonvaCanvas(e){e=e||{};const t=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(t.x),s=e.y!==void 0?e.y:Math.floor(t.y),o=e.pixelRatio||1,u=new wn({width:e.width||Math.ceil(t.width)||(r?r.width():0),height:e.height||Math.ceil(t.height)||(r?r.height():0),pixelRatio:o}),l=u.getContext(),c=new wn({width:u.width/u.pixelRatio+Math.abs(i),height:u.height/u.pixelRatio+Math.abs(s),pixelRatio:u.pixelRatio});return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(i||s)&&l.translate(-1*i,-1*s),this.drawScene(u,void 0,c),l.restore(),u}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const t=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(t,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((t,r)=>{try{const i=e?.callback;i&&delete e.callback,M._urlToImage(this.toDataURL(e),function(s){t(s),i?.(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((t,r)=>{try{const i=e?.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{t(s),i?.(s)},e?.mimeType,e?.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Y.dragDistance}_off(e,t,r){let i=this.eventListeners[e],s,o,u;for(s=0;s<i.length;s++)if(o=i[s].name,u=i[s].handler,(o!=="konva"||t==="konva")&&(!t||o===t)&&(!r||r===u)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,t,r){this._fire(e+Lf,{oldVal:t,newVal:r})}addName(e){if(!this.hasName(e)){const t=this.name(),r=t?t+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const t=this.name();return t?(t||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const t=(this.name()||"").split(/\s/g),r=t.indexOf(e);return r!==-1&&(t.splice(r,1),this.name(t.join(" "))),this}setAttr(e,t){const r=this[To+M._capitalize(e)];return M._isFunction(r)?r.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(Y.autoDrawEnabled){const e=this.getLayer()||this.getStage();e?.batchDraw()}}_setAttr(e,t){const r=this.attrs[e];r===t&&!M.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,t),this._requestDraw())}_setComponentAttr(e,t,r){let i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,t,r){t&&this.nodeType===Po&&(t.target=this);const i=[Nf,Gf,Hf,jf,Vf,Wf];if(!(i.indexOf(e)!==-1&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,t);const o=i.indexOf(e)!==-1&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!o&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,t,r):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){var t,r,i;const s=(t=this._cache.get(mi))!==null&&t!==void 0?t:{};let o=s?.[e];if(o===void 0){o=[];let u=Object.getPrototypeOf(this);for(;u;){const l=(i=(r=u.eventListeners)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:[];o.push(...l),u=Object.getPrototypeOf(u)}s[e]=o,this._cache.set(mi,s)}return o}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;const r=this._getProtoListeners(e);if(r)for(let s=0;s<r.length;s++)r[s].handler.call(this,t);const i=this.eventListeners[e];if(i)for(let s=0;s<i.length;s++)i[s].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const t=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(!r)return;const s=r._getPointerById(t)||r._changedPointerPositions[0]||i;xe._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){xe._dragElements.has(this._id)||this._createDragElement(e);const r=xe._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const r=this.getStage()._getPointerById(t.pointerId);if(!r)return;let i={x:r.x-t.offset.x,y:r.y-t.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const o=s.call(this,i,e);o?i=o:M.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(e){const t=xe._dragElements.get(this._id);t&&(t.dragStatus="stopped"),xe._endDragBefore(e),xe._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=xe._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||Y.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let i=!1;xe._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=xe._dragElements.get(this._id),r=t&&t.dragStatus==="dragging",i=t&&t.dragStatus==="ready";r?this.stopDrag():i&&xe._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const r={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return M.haveIntersection(r,this.getClientRect())}static create(e,t){return M._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){let r=z.prototype.getClassName.call(e),i=e.children,s,o,u;t&&(e.attrs.container=t),Y[r]||(M.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=Y[r];if(s=new l(e.attrs),i)for(o=i.length,u=0;u<o;u++)s.add(z._createNode(i[u]));return s}}z.prototype.nodeType="Node";z.prototype._attrsAffectingSize=[];z.prototype.eventListeners={};z.prototype.on.call(z.prototype,Uf,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Sn),this._clearSelfAndDescendantCache(en)});z.prototype.on.call(z.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(vs)});z.prototype.on.call(z.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Ss)});z.prototype.on.call(z.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Ei)});const Ie=w.addGetterSetter;Ie(z,"zIndex");Ie(z,"absolutePosition");Ie(z,"position");Ie(z,"x",0,U());Ie(z,"y",0,U());Ie(z,"globalCompositeOperation","source-over",Kn());Ie(z,"opacity",1,U());Ie(z,"name","",Kn());Ie(z,"id","",Kn());Ie(z,"rotation",0,U());w.addComponentsGetterSetter(z,"scale",["x","y"]);Ie(z,"scaleX",1,U());Ie(z,"scaleY",1,U());w.addComponentsGetterSetter(z,"skew",["x","y"]);Ie(z,"skewX",0,U());Ie(z,"skewY",0,U());w.addComponentsGetterSetter(z,"offset",["x","y"]);Ie(z,"offsetX",0,U());Ie(z,"offsetY",0,U());Ie(z,"dragDistance",void 0,U());Ie(z,"width",0,U());Ie(z,"height",0,U());Ie(z,"listening",!0,Vt());Ie(z,"preventDefault",!0,Vt());Ie(z,"filters",void 0,function(n){return this._filterUpToDate=!1,n});Ie(z,"visible",!0,Vt());Ie(z,"transformsEnabled","all",Kn());Ie(z,"size");Ie(z,"dragBoundFunc");Ie(z,"draggable",!1,Vt());w.backCompat(z,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Ft extends z{constructor(){super(...arguments),this.children=[]}getChildren(e){const t=this.children||[];return e?t.filter(e):t}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const t=e[0];return t.getParent()?(t.moveTo(this),this):(this._validateAdd(t),t.index=this.getChildren().length,t.parent=this,t._clearCaches(),this.getChildren().push(t),this._fire("add",{child:t}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){const r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&t)}),r}_descendants(e){let t=!1;const r=this.getChildren();for(const i of r){if(t=e(i),t)return!0;if(i.hasChildren()&&(t=i._descendants(e),t))return!0}return!1}toObject(){const e=z.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){let t=e.getParent();for(;t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){const t=z.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){t.add(r.clone())}),t}getAllIntersections(e){const t=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&t.push(r)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),!this.isCached()&&((t=this.children)===null||t===void 0||t.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,r){t.index=r}),this._requestDraw()}drawScene(e,t,r){const i=this.getLayer(),s=e||i&&i.getCanvas(),o=s&&s.getContext(),u=this._getCanvasCache(),l=u&&u.scene,c=s&&s.isCache;if(!this.isVisible()&&!c)return this;if(l){o.save();const h=this.getAbsoluteTransform(t).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",s,t,r);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;const r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),o=this._getCanvasCache();if(o&&o.hit){s.save();const l=this.getAbsoluteTransform(t).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,t);return this}_drawChildren(e,t,r,i){var s;const o=t&&t.getContext(),u=this.clipWidth(),l=this.clipHeight(),c=this.clipFunc(),h=typeof u=="number"&&typeof l=="number"||c,d=r===this;if(h){o.save();const D=this.getAbsoluteTransform(r);let p=D.getMatrix();o.transform(p[0],p[1],p[2],p[3],p[4],p[5]),o.beginPath();let v;if(c)v=c.call(this,o,this);else{const F=this.clipX(),S=this.clipY();o.rect(F||0,S||0,u,l)}o.clip.apply(o,v),p=D.copy().invert().getMatrix(),o.transform(p[0],p[1],p[2],p[3],p[4],p[5])}const m=!d&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";m&&(o.save(),o._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(D){D[e](t,r,i)}),m&&o.restore(),h&&o.restore()}getClientRect(e={}){var t;const r=e.skipTransform,i=e.relativeTo;let s,o,u,l,c={x:1/0,y:1/0,width:0,height:0};const h=this;(t=this.children)===null||t===void 0||t.forEach(function(D){if(!D.visible())return;const p=D.getClientRect({relativeTo:h,skipShadow:e.skipShadow,skipStroke:e.skipStroke});p.width===0&&p.height===0||(s===void 0?(s=p.x,o=p.y,u=p.x+p.width,l=p.y+p.height):(s=Math.min(s,p.x),o=Math.min(o,p.y),u=Math.max(u,p.x+p.width),l=Math.max(l,p.y+p.height)))});const d=this.find("Shape");let m=!1;for(let D=0;D<d.length;D++)if(d[D]._isVisible(this)){m=!0;break}return m&&s!==void 0?c={x:s,y:o,width:u-s,height:l-o}:c={x:0,y:0,width:0,height:0},r?c:this._transformedRect(c,i)}}w.addComponentsGetterSetter(Ft,"clip",["x","y","width","height"]);w.addGetterSetter(Ft,"clipX",void 0,U());w.addGetterSetter(Ft,"clipY",void 0,U());w.addGetterSetter(Ft,"clipWidth",void 0,U());w.addGetterSetter(Ft,"clipHeight",void 0,U());w.addGetterSetter(Ft,"clipFunc");const qr=new Map,Uu=Y._global.PointerEvent!==void 0;function ss(n){return qr.get(n)}function da(n){return{evt:n,pointerId:n.pointerId}}function Xu(n,e){return qr.get(n)===e}function Ku(n,e){Ir(n),e.getStage()&&(qr.set(n,e),Uu&&e._fire("gotpointercapture",da(new PointerEvent("gotpointercapture"))))}function Ir(n,e){const t=qr.get(n);if(!t)return;const r=t.getStage();r&&r.content,qr.delete(n),Uu&&t._fire("lostpointercapture",da(new PointerEvent("lostpointercapture")))}const Kf="Stage",Yf="string",Mo="px",qf="mouseout",Yu="mouseleave",qu="mouseover",Ju="mouseenter",Qu="mousemove",Zu="mousedown",$u="mouseup",Cr="pointermove",Mr="pointerdown",lr="pointerup",xr="pointercancel",Jf="lostpointercapture",pi="pointerout",Br="pointerleave",gi="pointerover",_i="pointerenter",ws="contextmenu",el="touchstart",tl="touchend",nl="touchmove",rl="touchcancel",Es="wheel",Qf=5,Zf=[[Ju,"_pointerenter"],[Zu,"_pointerdown"],[Qu,"_pointermove"],[$u,"_pointerup"],[Yu,"_pointerleave"],[el,"_pointerdown"],[nl,"_pointermove"],[tl,"_pointerup"],[rl,"_pointercancel"],[qu,"_pointerover"],[Es,"_wheel"],[ws,"_contextmenu"],[Mr,"_pointerdown"],[Cr,"_pointermove"],[lr,"_pointerup"],[xr,"_pointercancel"],[Br,"_pointerleave"],[Jf,"_lostpointercapture"]],as={mouse:{[pi]:qf,[Br]:Yu,[gi]:qu,[_i]:Ju,[Cr]:Qu,[Mr]:Zu,[lr]:$u,[xr]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[pi]:"touchout",[Br]:"touchleave",[gi]:"touchover",[_i]:"touchenter",[Cr]:nl,[Mr]:el,[lr]:tl,[xr]:rl,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[pi]:pi,[Br]:Br,[gi]:gi,[_i]:_i,[Cr]:Cr,[Mr]:Mr,[lr]:lr,[xr]:xr,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},kr=n=>n.indexOf("pointer")>=0?"pointer":n.indexOf("touch")>=0?"touch":"mouse",sr=n=>{const e=kr(n);if(e==="pointer")return Y.pointerEventsEnabled&&as.pointer;if(e==="touch")return as.touch;if(e==="mouse")return as.mouse};function xo(n={}){return(n.clipFunc||n.clipWidth||n.clipHeight)&&M.warn("Stage does not support clipping. Please use clip for Layers or Groups."),n}const $f="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);",Nr=[];class qi extends Ft{constructor(e){super(xo(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Nr.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{xo(this.attrs)}),this._checkVisibility()}_validateAdd(e){const t=e.getType()==="Layer",r=e.getType()==="FastLayer";t||r||M.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if(typeof e===Yf){let t;if(e.charAt(0)==="."){const r=e.slice(1);e=document.getElementsByClassName(r)[0]}else e.charAt(0)!=="#"?t=e:t=e.slice(1),e=document.getElementById(t);if(!e)throw"Can not find container in document with id "+t}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const e=this.children,t=e.length;for(let r=0;r<t;r++)e[r].clear();return this}clone(e){return e||(e={}),e.container=typeof document<"u"&&document.createElement("div"),Ft.prototype.clone.call(this,e)}destroy(){super.destroy();const e=this.content;e&&M._isInDocument(e)&&this.container().removeChild(e);const t=Nr.indexOf(this);return t>-1&&Nr.splice(t,1),M.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(M.warn($f),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){e={...e},e.x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();const t=new wn({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),r=t.getContext()._context,i=this.children;return(e.x||e.y)&&r.translate(-1*e.x,-1*e.y),i.forEach(function(s){if(!s.isVisible())return;const o=s._toKonvaCanvas(e);r.drawImage(o._canvas,e.x,e.y,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}),t}getIntersection(e){if(!e)return null;const t=this.children,r=t.length,i=r-1;for(let s=i;s>=0;s--){const o=t[s].getIntersection(e);if(o)return o}return null}_resizeDOM(){const e=this.width(),t=this.height();this.content&&(this.content.style.width=e+Mo,this.content.style.height=t+Mo),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(r=>{r.setSize({width:e,height:t}),r.draw()})}add(e,...t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}super.add(e);const r=this.children.length;return r>Qf&&M.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),Y.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return Xu(e,this)}setPointerCapture(e){Ku(e,this)}releaseCapture(e){Ir(e)}getLayers(){return this.children}_bindContentEvents(){Y.isBrowser&&Zf.forEach(([e,t])=>{this.content.addEventListener(e,r=>{this[t](r)},{passive:!1})})}_pointerenter(e){this.setPointersPositions(e);const t=sr(e.type);t&&this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);const t=sr(e.type);t&&this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){const t=sr(e.type),r=kr(e.type);if(!t)return;this.setPointersPositions(e);const i=this._getTargetShape(r),s=!(Y.isDragging()||Y.isTransforming())||Y.hitOnDragEnabled;i&&s?(i._fireAndBubble(t.pointerout,{evt:e}),i._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[r+"targetShape"]=null):s&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(e){const t=sr(e.type),r=kr(e.type);if(!t)return;this.setPointersPositions(e);let i=!1;this._changedPointerPositions.forEach(s=>{const o=this.getIntersection(s);if(xe.justDragged=!1,Y["_"+r+"ListenClick"]=!0,!o||!o.isListening()){this[r+"ClickStartShape"]=void 0;return}Y.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[r+"ClickStartShape"]=o,o._fireAndBubble(t.pointerdown,{evt:e,pointerId:s.id}),i=!0;const u=e.type.indexOf("touch")>=0;o.preventDefault()&&e.cancelable&&u&&e.preventDefault()}),i||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(e){const t=sr(e.type),r=kr(e.type);if(!t)return;const i=e.type.indexOf("touch")>=0||e.pointerType==="touch";if(Y.isDragging()&&xe.node.preventDefault()&&e.cancelable&&i&&e.preventDefault(),this.setPointersPositions(e),!(!(Y.isDragging()||Y.isTransforming())||Y.hitOnDragEnabled))return;const o={};let u=!1;const l=this._getTargetShape(r);this._changedPointerPositions.forEach(c=>{const h=ss(c.id)||this.getIntersection(c),d=c.id,m={evt:e,pointerId:d},D=l!==h;if(D&&l&&(l._fireAndBubble(t.pointerout,{...m},h),l._fireAndBubble(t.pointerleave,{...m},h)),h){if(o[h._id])return;o[h._id]=!0}h&&h.isListening()?(u=!0,D&&(h._fireAndBubble(t.pointerover,{...m},l),h._fireAndBubble(t.pointerenter,{...m},l),this[r+"targetShape"]=h),h._fireAndBubble(t.pointermove,{...m})):l&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:d}),this[r+"targetShape"]=null)}),u||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){const t=sr(e.type),r=kr(e.type);if(!t)return;this.setPointersPositions(e);const i=this[r+"ClickStartShape"],s=this[r+"ClickEndShape"],o={};let u=!1;this._changedPointerPositions.forEach(l=>{const c=ss(l.id)||this.getIntersection(l);if(c){if(c.releaseCapture(l.id),o[c._id])return;o[c._id]=!0}const h=l.id,d={evt:e,pointerId:h};let m=!1;Y["_"+r+"InDblClickWindow"]?(m=!0,clearTimeout(this[r+"DblTimeout"])):xe.justDragged||(Y["_"+r+"InDblClickWindow"]=!0,clearTimeout(this[r+"DblTimeout"])),this[r+"DblTimeout"]=setTimeout(function(){Y["_"+r+"InDblClickWindow"]=!1},Y.dblClickWindow),c&&c.isListening()?(u=!0,this[r+"ClickEndShape"]=c,c._fireAndBubble(t.pointerup,{...d}),Y["_"+r+"ListenClick"]&&i&&i===c&&(c._fireAndBubble(t.pointerclick,{...d}),m&&s&&s===c&&c._fireAndBubble(t.pointerdblclick,{...d}))):(this[r+"ClickEndShape"]=null,u||(this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),u=!0),Y["_"+r+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:h}),m&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:h}))}),u||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Y["_"+r+"ListenClick"]=!1,e.cancelable&&r!=="touch"&&r!=="pointer"&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(ws,{evt:e}):this._fire(ws,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(Es,{evt:e}):this._fire(Es,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);const t=ss(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(lr,da(e)),Ir(e.pointerId)}_lostpointercapture(e){Ir(e.pointerId)}setPointersPositions(e){const t=this._getContentPosition();let r=null,i=null;e=e||window.event,e.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,s=>{this._pointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,s=>{this._changedPointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})})):(r=(e.clientX-t.left)/t.scaleX,i=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:r,y:i},this._pointerPositions=[{x:r,y:i,id:M._getFirstPointerId(e)}],this._changedPointerPositions=[{x:r,y:i,id:M._getFirstPointerId(e)}])}_setPointerPosition(e){M.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new wn({width:this.width(),height:this.height()}),this.bufferHitCanvas=new ca({pixelRatio:1,width:this.width(),height:this.height()}),!Y.isBrowser)return;const e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}cache(){return M.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}}qi.prototype.nodeType=Kf;Ke(qi);w.addGetterSetter(qi,"container");Y.isBrowser&&document.addEventListener("visibilitychange",()=>{Nr.forEach(n=>{n.batchDraw()})});const il="hasShadow",sl="shadowRGBA",al="patternImage",ol="linearGradient",ul="radialGradient";let Di;function os(){return Di||(Di=M.createCanvasElement().getContext("2d"),Di)}const Gr={};function e1(n){const e=this.attrs.fillRule;e?n.fill(e):n.fill()}function t1(n){n.stroke()}function n1(n){const e=this.attrs.fillRule;e?n.fill(e):n.fill()}function r1(n){n.stroke()}function i1(){this._clearCache(il)}function s1(){this._clearCache(sl)}function a1(){this._clearCache(al)}function o1(){this._clearCache(ol)}function u1(){this._clearCache(ul)}class V extends z{constructor(e){super(e);let t,r=0;for(;t=M.getHitColor(),!(t&&!(t in Gr));)if(r++,r>=1e4){M.warn("Failed to find a unique color key for a shape. Konva may work incorrectly. Most likely your browser is using canvas farbling. Consider disabling it."),t=M.getRandomColor();break}this.colorKey=t,Gr[t]=this}getContext(){return M.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return M.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(il,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(al,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=os().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const r=new Et;r.translate(this.fillPatternX(),this.fillPatternY()),r.rotate(Y.getAngle(this.fillPatternRotation())),r.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),r.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=r.getMatrix(),s=typeof DOMMatrix>"u"?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(s)}return t}}_getLinearGradient(){return this._getCache(ol,this.__getLinearGradient)}__getLinearGradient(){const e=this.fillLinearGradientColorStops();if(e){const t=os(),r=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),s=t.createLinearGradient(r.x,r.y,i.x,i.y);for(let o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}_getRadialGradient(){return this._getCache(ul,this.__getRadialGradient)}__getRadialGradient(){const e=this.fillRadialGradientColorStops();if(e){const t=os(),r=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),s=t.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius());for(let o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}getShadowRGBA(){return this._getCache(sl,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const e=M.colorToRGBA(this.shadowColor());if(e)return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){const t=this.getStage();if(!t)return!1;const r=t.bufferHitCanvas;return r.getContext().clear(),this.drawHit(r,void 0,!0),r.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return z.prototype.destroy.call(this),delete Gr[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!((t=this.attrs.perfectDrawEnabled)!==null&&t!==void 0?t:!0))return!1;const i=e||this.hasFill(),s=this.hasStroke(),o=this.getAbsoluteOpacity()!==1;if(i&&s&&o)return!0;const u=this.hasShadow(),l=this.shadowForStrokeEnabled();return!!(i&&s&&u&&l)}setStrokeHitEnabled(e){M.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){let t=!1,r=this.getParent();for(;r;){if(r.isCached()){t=!0;break}r=r.getParent()}const i=e.skipTransform,s=e.relativeTo||t&&this.getStage()||void 0,o=this.getSelfRect(),l=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,c=o.width+l,h=o.height+l,d=!e.skipShadow&&this.hasShadow(),m=d?this.shadowOffsetX():0,D=d?this.shadowOffsetY():0,p=c+Math.abs(m),v=h+Math.abs(D),F=d&&this.shadowBlur()||0,S=p+F*2,C=v+F*2,B={width:S,height:C,x:-(l/2+F)+Math.min(m,0)+o.x,y:-(l/2+F)+Math.min(D,0)+o.y};return i?B:this._transformedRect(B,s)}drawScene(e,t,r){const i=this.getLayer(),s=e||i.getCanvas(),o=s.getContext(),u=this._getCanvasCache(),l=this.getSceneFunc(),c=this.hasShadow();let h;const d=t===this;if(!this.isVisible()&&!d)return this;if(u){o.save();const m=this.getAbsoluteTransform(t).getMatrix();return o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedSceneCanvas(o),o.restore(),this}if(!l)return this;if(o.save(),this._useBufferCanvas()){h=this.getStage();const m=r||h.bufferCanvas,D=m.getContext();D.clear(),D.save(),D._applyLineJoin(this),D._applyMiterLimit(this);const p=this.getAbsoluteTransform(t).getMatrix();D.transform(p[0],p[1],p[2],p[3],p[4],p[5]),l.call(this,D,this),D.restore();const v=m.pixelRatio;c&&o._applyShadow(this),d||(o._applyOpacity(this),o._applyGlobalCompositeOperation(this)),o.drawImage(m._canvas,m.x||0,m.y||0,m.width/v,m.height/v)}else{if(o._applyLineJoin(this),o._applyMiterLimit(this),!d){const m=this.getAbsoluteTransform(t).getMatrix();o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),o._applyOpacity(this),o._applyGlobalCompositeOperation(this)}c&&o._applyShadow(this),l.call(this,o,this)}return o.restore(),this}drawHit(e,t,r=!1){if(!this.shouldDrawHit(t,r))return this;const i=this.getLayer(),s=e||i.hitCanvas,o=s&&s.getContext(),u=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),c=l&&l.hit;if(this.colorKey||M.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),c){o.save();const d=this.getAbsoluteTransform(t).getMatrix();return o.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!u)return this;if(o.save(),o._applyLineJoin(this),o._applyMiterLimit(this),!(this===t)){const d=this.getAbsoluteTransform(t).getMatrix();o.transform(d[0],d[1],d[2],d[3],d[4],d[5])}return u.call(this,o,this),o.restore(),this}drawHitFromCache(e=0){const t=this._getCanvasCache(),r=this._getCachedSceneCanvas(),i=t.hit,s=i.getContext(),o=i.getWidth(),u=i.getHeight();s.clear(),s.drawImage(r._canvas,0,0,o,u);try{const l=s.getImageData(0,0,o,u),c=l.data,h=c.length,d=M._hexToRgb(this.colorKey);for(let m=0;m<h;m+=4)c[m+3]>e?(c[m]=d.r,c[m+1]=d.g,c[m+2]=d.b,c[m+3]=255):c[m+3]=0;s.putImageData(l,0,0)}catch(l){M.error("Unable to draw hit graph from cached scene canvas. "+l.message)}return this}hasPointerCapture(e){return Xu(e,this)}setPointerCapture(e){Ku(e,this)}releaseCapture(e){Ir(e)}}V.prototype._fillFunc=e1;V.prototype._strokeFunc=t1;V.prototype._fillFuncHit=n1;V.prototype._strokeFuncHit=r1;V.prototype._centroid=!1;V.prototype.nodeType="Shape";Ke(V);V.prototype.eventListeners={};V.prototype.on.call(V.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",i1);V.prototype.on.call(V.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",s1);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",a1);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",o1);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",u1);w.addGetterSetter(V,"stroke",void 0,zu());w.addGetterSetter(V,"strokeWidth",2,U());w.addGetterSetter(V,"fillAfterStrokeEnabled",!1);w.addGetterSetter(V,"hitStrokeWidth","auto",ha());w.addGetterSetter(V,"strokeHitEnabled",!0,Vt());w.addGetterSetter(V,"perfectDrawEnabled",!0,Vt());w.addGetterSetter(V,"shadowForStrokeEnabled",!0,Vt());w.addGetterSetter(V,"lineJoin");w.addGetterSetter(V,"lineCap");w.addGetterSetter(V,"miterLimit");w.addGetterSetter(V,"sceneFunc");w.addGetterSetter(V,"hitFunc");w.addGetterSetter(V,"dash");w.addGetterSetter(V,"dashOffset",0,U());w.addGetterSetter(V,"shadowColor",void 0,Kn());w.addGetterSetter(V,"shadowBlur",0,U());w.addGetterSetter(V,"shadowOpacity",1,U());w.addComponentsGetterSetter(V,"shadowOffset",["x","y"]);w.addGetterSetter(V,"shadowOffsetX",0,U());w.addGetterSetter(V,"shadowOffsetY",0,U());w.addGetterSetter(V,"fillPatternImage");w.addGetterSetter(V,"fill",void 0,zu());w.addGetterSetter(V,"fillPatternX",0,U());w.addGetterSetter(V,"fillPatternY",0,U());w.addGetterSetter(V,"fillLinearGradientColorStops");w.addGetterSetter(V,"strokeLinearGradientColorStops");w.addGetterSetter(V,"fillRadialGradientStartRadius",0);w.addGetterSetter(V,"fillRadialGradientEndRadius",0);w.addGetterSetter(V,"fillRadialGradientColorStops");w.addGetterSetter(V,"fillPatternRepeat","repeat");w.addGetterSetter(V,"fillEnabled",!0);w.addGetterSetter(V,"strokeEnabled",!0);w.addGetterSetter(V,"shadowEnabled",!0);w.addGetterSetter(V,"dashEnabled",!0);w.addGetterSetter(V,"strokeScaleEnabled",!0);w.addGetterSetter(V,"fillPriority","color");w.addComponentsGetterSetter(V,"fillPatternOffset",["x","y"]);w.addGetterSetter(V,"fillPatternOffsetX",0,U());w.addGetterSetter(V,"fillPatternOffsetY",0,U());w.addComponentsGetterSetter(V,"fillPatternScale",["x","y"]);w.addGetterSetter(V,"fillPatternScaleX",1,U());w.addGetterSetter(V,"fillPatternScaleY",1,U());w.addComponentsGetterSetter(V,"fillLinearGradientStartPoint",["x","y"]);w.addComponentsGetterSetter(V,"strokeLinearGradientStartPoint",["x","y"]);w.addGetterSetter(V,"fillLinearGradientStartPointX",0);w.addGetterSetter(V,"strokeLinearGradientStartPointX",0);w.addGetterSetter(V,"fillLinearGradientStartPointY",0);w.addGetterSetter(V,"strokeLinearGradientStartPointY",0);w.addComponentsGetterSetter(V,"fillLinearGradientEndPoint",["x","y"]);w.addComponentsGetterSetter(V,"strokeLinearGradientEndPoint",["x","y"]);w.addGetterSetter(V,"fillLinearGradientEndPointX",0);w.addGetterSetter(V,"strokeLinearGradientEndPointX",0);w.addGetterSetter(V,"fillLinearGradientEndPointY",0);w.addGetterSetter(V,"strokeLinearGradientEndPointY",0);w.addComponentsGetterSetter(V,"fillRadialGradientStartPoint",["x","y"]);w.addGetterSetter(V,"fillRadialGradientStartPointX",0);w.addGetterSetter(V,"fillRadialGradientStartPointY",0);w.addComponentsGetterSetter(V,"fillRadialGradientEndPoint",["x","y"]);w.addGetterSetter(V,"fillRadialGradientEndPointX",0);w.addGetterSetter(V,"fillRadialGradientEndPointY",0);w.addGetterSetter(V,"fillPatternRotation",0);w.addGetterSetter(V,"fillRule",void 0,Kn());w.backCompat(V,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const l1="beforeDraw",c1="draw",ll=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],h1=ll.length;class Yn extends Ft{constructor(e){super(e),this.canvas=new wn,this.hitCanvas=new ca({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){z.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!z.prototype.moveUp.call(this))return!1;const t=this.getStage();return!t||!t.content?!1:(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(z.prototype.moveDown.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(z.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return z.prototype.remove.call(this),e&&e.parentNode&&M._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&M.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e={...e},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),z.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){M.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){M.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,M.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let t=1,r=!1;for(;;){for(let i=0;i<h1;i++){const s=ll[i],o=this._getIntersection({x:e.x+s.x*t,y:e.y+s.y*t}),u=o.shape;if(u)return u;if(r=!!o.antialiased,!o.antialiased)break}if(r)t+=1;else return null}}_getIntersection(e){const t=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,i=r[3];if(i===255){const s=M.getHitColorKey(r[0],r[1],r[2]),o=Gr[s];return o?{shape:o}:{antialiased:!0}}else if(i>0)return{antialiased:!0};return{}}drawScene(e,t,r){const i=this.getLayer(),s=e||i&&i.getCanvas();return this._fire(l1,{node:this}),this.clearBeforeDraw()&&s.getContext().clear(),Ft.prototype.drawScene.call(this,s,t,r),this._fire(c1,{node:this}),this}drawHit(e,t){const r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),Ft.prototype.drawHit.call(this,i,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){M.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return M.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return M.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Yn.prototype.nodeType="Layer";Ke(Yn);w.addGetterSetter(Yn,"imageSmoothingEnabled",!0);w.addGetterSetter(Yn,"clearBeforeDraw",!0);w.addGetterSetter(Yn,"hitGraphEnabled",!0,Vt());class fa extends Yn{constructor(e){super(e),this.listening(!1),M.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}fa.prototype.nodeType="FastLayer";Ke(fa);class pr extends Ft{_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&M.throw("You may only add groups and shapes to groups.")}}pr.prototype.nodeType="Group";Ke(pr);const us=(function(){return Wn.performance&&Wn.performance.now?function(){return Wn.performance.now()}:function(){return new Date().getTime()}})();class xt{constructor(e,t){this.id=xt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:us(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){const t=this.layers,r=t.length;for(let i=0;i<r;i++)if(t[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const t=xt.animations,r=t.length;for(let i=0;i<r;i++)if(t[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=us(),xt._addAnimation(this),this}stop(){return xt._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const t=e.id,r=this.animations,i=r.length;for(let s=0;s<i;s++)if(r[s].id===t){this.animations.splice(s,1);break}}static _runFrames(){const e={},t=this.animations;for(let r=0;r<t.length;r++){const i=t[r],s=i.layers,o=i.func;i._updateFrameObject(us());const u=s.length;let l;if(o?l=o.call(i,i.frame)!==!1:l=!0,!!l)for(let c=0;c<u;c++){const h=s[c];h._id!==void 0&&(e[h._id]=h)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=xt;e.animations.length?(e._runFrames(),M.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,M.requestAnimFrame(this._animationLoop))}}xt.animations=[];xt.animIdCounter=0;xt.animRunning=!1;const d1={node:1,duration:1,easing:1,onFinish:1,yoyo:1},f1=1,Bo=2,ko=3,Ro=["fill","stroke","shadowColor"];let m1=0;class p1{constructor(e,t,r,i,s,o,u){this.prop=e,this.propFunc=t,this.begin=i,this._pos=i,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=u,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=s-this.begin,this.pause()}fire(e){const t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return e===void 0&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=Bo,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=ko,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const e=this.getTimer()-this._startTime;this.state===Bo?this.setTime(e):this.state===ko&&this.setTime(this.duration-e)}pause(){this.state=f1,this.fire("onPause")}getTimer(){return new Date().getTime()}}class Ne{constructor(e){const t=this,r=e.node,i=r._id,s=e.easing||Hr.Linear,o=!!e.yoyo;let u,l;typeof e.duration>"u"?u=.3:e.duration===0?u=.001:u=e.duration,this.node=r,this._id=m1++;const c=r.getLayer()||(r instanceof Y.Stage?r.getLayers():null);c||M.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new xt(function(){t.tween.onEnterFrame()},c),this.tween=new p1(l,function(h){t._tweenFunc(h)},s,0,1,u*1e3,o),this._addListeners(),Ne.attrs[i]||(Ne.attrs[i]={}),Ne.attrs[i][this._id]||(Ne.attrs[i][this._id]={}),Ne.tweens[i]||(Ne.tweens[i]={});for(l in e)d1[l]===void 0&&this._addAttr(l,e[l]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){const r=this.node,i=r._id;let s,o,u,l,c;const h=Ne.tweens[i][e];h&&delete Ne.attrs[i][h][e];let d=r.getAttr(e);if(M._isArray(t))if(s=[],o=Math.max(t.length,d.length),e==="points"&&t.length!==d.length&&(t.length>d.length?(l=d,d=M._prepareArrayForTween(d,t,r.closed())):(u=t,t=M._prepareArrayForTween(t,d,r.closed()))),e.indexOf("fill")===0)for(let m=0;m<o;m++)if(m%2===0)s.push(t[m]-d[m]);else{const D=M.colorToRGBA(d[m]);c=M.colorToRGBA(t[m]),d[m]=D,s.push({r:c.r-D.r,g:c.g-D.g,b:c.b-D.b,a:c.a-D.a})}else for(let m=0;m<o;m++)s.push(t[m]-d[m]);else Ro.indexOf(e)!==-1?(d=M.colorToRGBA(d),c=M.colorToRGBA(t),s={r:c.r-d.r,g:c.g-d.g,b:c.b-d.b,a:c.a-d.a}):s=t-d;Ne.attrs[i][this._id][e]={start:d,diff:s,end:t,trueEnd:u,trueStart:l},Ne.tweens[i][e]=this._id}_tweenFunc(e){const t=this.node,r=Ne.attrs[t._id][this._id];let i,s,o,u,l,c,h,d;for(i in r){if(s=r[i],o=s.start,u=s.diff,d=s.end,M._isArray(o))if(l=[],h=Math.max(o.length,d.length),i.indexOf("fill")===0)for(c=0;c<h;c++)c%2===0?l.push((o[c]||0)+u[c]*e):l.push("rgba("+Math.round(o[c].r+u[c].r*e)+","+Math.round(o[c].g+u[c].g*e)+","+Math.round(o[c].b+u[c].b*e)+","+(o[c].a+u[c].a*e)+")");else for(c=0;c<h;c++)l.push((o[c]||0)+u[c]*e);else Ro.indexOf(i)!==-1?l="rgba("+Math.round(o.r+u.r*e)+","+Math.round(o.g+u.g*e)+","+Math.round(o.b+u.b*e)+","+(o.a+u.a*e)+")":l=o+u*e;t.setAttr(i,l)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const e=this.node,t=Ne.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const e=this.node,t=Ne.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(e*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const e=this.node._id,t=this._id,r=Ne.tweens[e];this.pause(),this.anim&&this.anim.stop();for(const i in r)delete Ne.tweens[e][i];delete Ne.attrs[e][t],Ne.tweens[e]&&(Object.keys(Ne.tweens[e]).length===0&&delete Ne.tweens[e],Object.keys(Ne.attrs[e]).length===0&&delete Ne.attrs[e])}}Ne.attrs={};Ne.tweens={};z.prototype.to=function(n){const e=n.onFinish;n.node=this,n.onFinish=function(){this.destroy(),e&&e()},new Ne(n).play()};const Hr={BackEaseIn(n,e,t,r){return t*(n/=r)*n*((1.70158+1)*n-1.70158)+e},BackEaseOut(n,e,t,r){return t*((n=n/r-1)*n*((1.70158+1)*n+1.70158)+1)+e},BackEaseInOut(n,e,t,r){let i=1.70158;return(n/=r/2)<1?t/2*(n*n*(((i*=1.525)+1)*n-i))+e:t/2*((n-=2)*n*(((i*=1.525)+1)*n+i)+2)+e},ElasticEaseIn(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r)===1?e+t:(s||(s=r*.3),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),-(i*Math.pow(2,10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s))+e)},ElasticEaseOut(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r)===1?e+t:(s||(s=r*.3),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),i*Math.pow(2,-10*n)*Math.sin((n*r-o)*(2*Math.PI)/s)+t+e)},ElasticEaseInOut(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r/2)===2?e+t:(s||(s=r*(.3*1.5)),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),n<1?-.5*(i*Math.pow(2,10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s))+e:i*Math.pow(2,-10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s)*.5+t+e)},BounceEaseOut(n,e,t,r){return(n/=r)<1/2.75?t*(7.5625*n*n)+e:n<2/2.75?t*(7.5625*(n-=1.5/2.75)*n+.75)+e:n<2.5/2.75?t*(7.5625*(n-=2.25/2.75)*n+.9375)+e:t*(7.5625*(n-=2.625/2.75)*n+.984375)+e},BounceEaseIn(n,e,t,r){return t-Hr.BounceEaseOut(r-n,0,t,r)+e},BounceEaseInOut(n,e,t,r){return n<r/2?Hr.BounceEaseIn(n*2,0,t,r)*.5+e:Hr.BounceEaseOut(n*2-r,0,t,r)*.5+t*.5+e},EaseIn(n,e,t,r){return t*(n/=r)*n+e},EaseOut(n,e,t,r){return-t*(n/=r)*(n-2)+e},EaseInOut(n,e,t,r){return(n/=r/2)<1?t/2*n*n+e:-t/2*(--n*(n-2)-1)+e},StrongEaseIn(n,e,t,r){return t*(n/=r)*n*n*n*n+e},StrongEaseOut(n,e,t,r){return t*((n=n/r-1)*n*n*n*n+1)+e},StrongEaseInOut(n,e,t,r){return(n/=r/2)<1?t/2*n*n*n*n*n+e:t/2*((n-=2)*n*n*n*n+2)+e},Linear(n,e,t,r){return t*n/r+e}},Lo=M._assign(Y,{Util:M,Transform:Et,Node:z,Container:Ft,Stage:qi,stages:Nr,Layer:Yn,FastLayer:fa,Group:pr,DD:xe,Shape:V,shapes:Gr,Animation:xt,Tween:Ne,Easings:Hr,Context:Ki,Canvas:la});class gn extends V{_sceneFunc(e){const t=Y.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,r),e.arc(0,0,this.innerRadius(),t,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),t=this.outerRadius(),r=this.clockwise(),i=Y.getAngle(r?360-this.angle():this.angle()),s=Math.cos(Math.min(i,Math.PI)),o=1,u=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),l=Math.sin(Math.min(i,Math.PI/2)),c=s*(s>0?e:t),h=o*t,d=u*(u>0?e:t),m=l*(l>0?t:e);return{x:c,y:r?-1*m:d,width:h-c,height:m-d}}}gn.prototype._centroid=!0;gn.prototype.className="Arc";gn.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];Ke(gn);w.addGetterSetter(gn,"innerRadius",0,U());w.addGetterSetter(gn,"outerRadius",0,U());w.addGetterSetter(gn,"angle",0,U());w.addGetterSetter(gn,"clockwise",!1,Vt());function As(n,e,t,r,i,s,o){const u=Math.sqrt(Math.pow(t-n,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-r,2)),c=o*u/(u+l),h=o*l/(u+l),d=t-c*(i-n),m=r-c*(s-e),D=t+h*(i-n),p=r+h*(s-e);return[d,m,D,p]}function Oo(n,e){const t=n.length,r=[];for(let i=2;i<t-2;i+=2){const s=As(n[i-2],n[i-1],n[i],n[i+1],n[i+2],n[i+3],e);isNaN(s[0])||(r.push(s[0]),r.push(s[1]),r.push(n[i]),r.push(n[i+1]),r.push(s[2]),r.push(s[3]))}return r}class _n extends V{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){const t=this.points(),r=t.length,i=this.tension(),s=this.closed(),o=this.bezier();if(!r)return;let u=0;if(e.beginPath(),e.moveTo(t[0],t[1]),i!==0&&r>4){const l=this.getTensionPoints(),c=l.length;for(u=s?0:4,s||e.quadraticCurveTo(l[0],l[1],l[2],l[3]);u<c-2;)e.bezierCurveTo(l[u++],l[u++],l[u++],l[u++],l[u++],l[u++]);s||e.quadraticCurveTo(l[c-2],l[c-1],t[r-2],t[r-1])}else if(o)for(u=2;u<r;)e.bezierCurveTo(t[u++],t[u++],t[u++],t[u++],t[u++],t[u++]);else for(u=2;u<r;u+=2)e.lineTo(t[u],t[u+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Oo(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),t=e.length,r=this.tension(),i=As(e[t-2],e[t-1],e[0],e[1],e[2],e[3],r),s=As(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],r),o=Oo(e,r);return[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let t=e[0],r=e[0],i=e[1],s=e[1],o,u;for(let l=0;l<e.length/2;l++)o=e[l*2],u=e[l*2+1],t=Math.min(t,o),r=Math.max(r,o),i=Math.min(i,u),s=Math.max(s,u);return{x:t,y:i,width:r-t,height:s-i}}}_n.prototype.className="Line";_n.prototype._attrsAffectingSize=["points","bezier","tension"];Ke(_n);w.addGetterSetter(_n,"closed",!1);w.addGetterSetter(_n,"bezier",!1);w.addGetterSetter(_n,"tension",0,U());w.addGetterSetter(_n,"points",[],Bf());const g1=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],_1=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],D1=[[1],[1,1],[1,2,1],[1,3,3,1]],Io=(n,e,t)=>{let r,i;const o=t/2;r=0;for(let u=0;u<20;u++)i=o*g1[20][u]+o,r+=_1[20][u]*b1(n,e,i);return o*r},No=(n,e,t)=>{t===void 0&&(t=1);const r=n[0]-2*n[1]+n[2],i=e[0]-2*e[1]+e[2],s=2*n[1]-2*n[0],o=2*e[1]-2*e[0],u=4*(r*r+i*i),l=4*(r*s+i*o),c=s*s+o*o;if(u===0)return t*Math.sqrt(Math.pow(n[2]-n[0],2)+Math.pow(e[2]-e[0],2));const h=l/(2*u),d=c/u,m=t+h,D=d-h*h,p=m*m+D>0?Math.sqrt(m*m+D):0,v=h*h+D>0?Math.sqrt(h*h+D):0,F=h+Math.sqrt(h*h+D)!==0?D*Math.log(Math.abs((m+p)/(h+v))):0;return Math.sqrt(u)/2*(m*p-h*v+F)};function b1(n,e,t){const r=Fs(1,t,n),i=Fs(1,t,e),s=r*r+i*i;return Math.sqrt(s)}const Fs=(n,e,t)=>{const r=t.length-1;let i,s;if(r===0)return 0;if(n===0){s=0;for(let o=0;o<=r;o++)s+=D1[r][o]*Math.pow(1-e,r-o)*Math.pow(e,o)*t[o];return s}else{i=new Array(r);for(let o=0;o<r;o++)i[o]=r*(t[o+1]-t[o]);return Fs(n-1,e,i)}},Go=(n,e,t)=>{let r=1,i=n/e,s=(n-t(i))/e,o=0;for(;r>.001;){const u=t(i+s),l=Math.abs(n-u)/e;if(l<r)r=l,i+=s;else{const c=t(i-s),h=Math.abs(n-c)/e;h<r?(r=h,i-=s):s/=2}if(o++,o>500)break}return i};class Ge extends V{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Ge.parsePathData(this.data()),this.pathLength=Ge.getPathLength(this.dataArray)}_sceneFunc(e){const t=this.dataArray;e.beginPath();let r=!1;for(let i=0;i<t.length;i++){const s=t[i].command,o=t[i].points;switch(s){case"L":e.lineTo(o[0],o[1]);break;case"M":e.moveTo(o[0],o[1]);break;case"C":e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":const u=o[0],l=o[1],c=o[2],h=o[3],d=o[4],m=o[5],D=o[6],p=o[7],v=c>h?c:h,F=c>h?1:c/h,S=c>h?h/c:1;e.translate(u,l),e.rotate(D),e.scale(F,S),e.arc(0,0,v,d,d+m,1-p),e.scale(1/F,1/S),e.rotate(-D),e.translate(-u,-l);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(l){if(l.command==="A"){const c=l.points[4],h=l.points[5],d=l.points[4]+h;let m=Math.PI/180;if(Math.abs(c-d)<m&&(m=Math.abs(c-d)),h<0)for(let D=c-m;D>d;D-=m){const p=Ge.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],D,0);e.push(p.x,p.y)}else for(let D=c+m;D<d;D+=m){const p=Ge.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],D,0);e.push(p.x,p.y)}}else if(l.command==="C")for(let c=0;c<=1;c+=.01){const h=Ge.getPointOnCubicBezier(c,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);e.push(h.x,h.y)}else e=e.concat(l.points)});let t=e[0],r=e[0],i=e[1],s=e[1],o,u;for(let l=0;l<e.length/2;l++)o=e[l*2],u=e[l*2+1],isNaN(o)||(t=Math.min(t,o),r=Math.max(r,o)),isNaN(u)||(i=Math.min(i,u),s=Math.max(s,u));return{x:t,y:i,width:r-t,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){return Ge.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,t,r,i){return Math.sqrt((r-e)*(r-e)+(i-t)*(i-t))}static getPathLength(e){let t=0;for(let r=0;r<e.length;++r)t+=e[r].pathLength;return t}static getPointAtLengthOfDataArray(e,t){let r,i=0,s=t.length;if(!s)return null;for(;i<s&&e>t[i].pathLength;)e-=t[i].pathLength,++i;if(i===s)return r=t[i-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return t[i].command==="M"?(r=t[i].points.slice(0,2),{x:r[0],y:r[1]}):{x:t[i].start.x,y:t[i].start.y};const o=t[i],u=o.points;switch(o.command){case"L":return Ge.getPointOnLine(e,o.start.x,o.start.y,u[0],u[1]);case"C":return Ge.getPointOnCubicBezier(Go(e,Ge.getPathLength(t),v=>Io([o.start.x,u[0],u[2],u[4]],[o.start.y,u[1],u[3],u[5]],v)),o.start.x,o.start.y,u[0],u[1],u[2],u[3],u[4],u[5]);case"Q":return Ge.getPointOnQuadraticBezier(Go(e,Ge.getPathLength(t),v=>No([o.start.x,u[0],u[2]],[o.start.y,u[1],u[3]],v)),o.start.x,o.start.y,u[0],u[1],u[2],u[3]);case"A":const l=u[0],c=u[1],h=u[2],d=u[3],m=u[5],D=u[6];let p=u[4];return p+=m*e/o.pathLength,Ge.getPointOnEllipticalArc(l,c,h,d,p,D)}return null}static getPointOnLine(e,t,r,i,s,o,u){o=o??t,u=u??r;const l=this.getLineLength(t,r,i,s);if(l<1e-10)return{x:t,y:r};if(i===t)return{x:o,y:u+(s>r?e:-e)};const c=(s-r)/(i-t),h=Math.sqrt(e*e/(1+c*c))*(i<t?-1:1),d=c*h;if(Math.abs(u-r-c*(o-t))<1e-10)return{x:o+h,y:u+d};const m=((o-t)*(i-t)+(u-r)*(s-r))/(l*l),D=t+m*(i-t),p=r+m*(s-r),v=this.getLineLength(o,u,D,p),F=Math.sqrt(e*e-v*v),S=Math.sqrt(F*F/(1+c*c))*(i<t?-1:1),C=c*S;return{x:D+S,y:p+C}}static getPointOnCubicBezier(e,t,r,i,s,o,u,l,c){function h(F){return F*F*F}function d(F){return 3*F*F*(1-F)}function m(F){return 3*F*(1-F)*(1-F)}function D(F){return(1-F)*(1-F)*(1-F)}const p=l*h(e)+o*d(e)+i*m(e)+t*D(e),v=c*h(e)+u*d(e)+s*m(e)+r*D(e);return{x:p,y:v}}static getPointOnQuadraticBezier(e,t,r,i,s,o,u){function l(D){return D*D}function c(D){return 2*D*(1-D)}function h(D){return(1-D)*(1-D)}const d=o*l(e)+i*c(e)+t*h(e),m=u*l(e)+s*c(e)+r*h(e);return{x:d,y:m}}static getPointOnEllipticalArc(e,t,r,i,s,o){const u=Math.cos(o),l=Math.sin(o),c={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(c.x*u-c.y*l),y:t+(c.x*l+c.y*u)}}static parsePathData(e){if(!e)return[];let t=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(let d=0;d<r.length;d++)t=t.replace(new RegExp(r[d],"g"),"|"+r[d]);const i=t.split("|"),s=[],o=[];let u=0,l=0;const c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let h;for(let d=1;d<i.length;d++){let m=i[d],D=m.charAt(0);for(m=m.slice(1),o.length=0;h=c.exec(m);)o.push(h[0]);let p=[],v=D==="A"||D==="a"?0:-1;for(let F=0,S=o.length;F<S;F++){const C=o[F];if(C==="00"){p.push(0,0),v>=0&&(v+=2,v>=7&&(v-=7));continue}if(v>=0){if(v===3){if(/^[01]{2}\d+(?:\.\d+)?$/.test(C)){p.push(parseInt(C[0],10)),p.push(parseInt(C[1],10)),p.push(parseFloat(C.slice(2))),v+=3,v>=7&&(v-=7);continue}if(C==="11"||C==="10"||C==="01"){p.push(parseInt(C[0],10)),p.push(parseInt(C[1],10)),v+=2,v>=7&&(v-=7);continue}if(C==="0"||C==="1"){p.push(parseInt(C,10)),v+=1,v>=7&&(v-=7);continue}}else if(v===4){if(/^[01]\d+(?:\.\d+)?$/.test(C)){p.push(parseInt(C[0],10)),p.push(parseFloat(C.slice(1))),v+=2,v>=7&&(v-=7);continue}if(C==="0"||C==="1"){p.push(parseInt(C,10)),v+=1,v>=7&&(v-=7);continue}}const B=parseFloat(C);isNaN(B)?p.push(0):p.push(B),v+=1,v>=7&&(v-=7)}else{const B=parseFloat(C);isNaN(B)?p.push(0):p.push(B)}}for(;p.length>0&&!isNaN(p[0]);){let F="",S=[];const C=u,B=l;let x,j,W,Z,J,K,ae,le,_,T;switch(D){case"l":u+=p.shift(),l+=p.shift(),F="L",S.push(u,l);break;case"L":u=p.shift(),l=p.shift(),S.push(u,l);break;case"m":const A=p.shift(),y=p.shift();if(u+=A,l+=y,F="M",s.length>2&&s[s.length-1].command==="z"){for(let O=s.length-2;O>=0;O--)if(s[O].command==="M"){u=s[O].points[0]+A,l=s[O].points[1]+y;break}}S.push(u,l),D="l";break;case"M":u=p.shift(),l=p.shift(),F="M",S.push(u,l),D="L";break;case"h":u+=p.shift(),F="L",S.push(u,l);break;case"H":u=p.shift(),F="L",S.push(u,l);break;case"v":l+=p.shift(),F="L",S.push(u,l);break;case"V":l=p.shift(),F="L",S.push(u,l);break;case"C":S.push(p.shift(),p.shift(),p.shift(),p.shift()),u=p.shift(),l=p.shift(),S.push(u,l);break;case"c":S.push(u+p.shift(),l+p.shift(),u+p.shift(),l+p.shift()),u+=p.shift(),l+=p.shift(),F="C",S.push(u,l);break;case"S":j=u,W=l,x=s[s.length-1],x.command==="C"&&(j=u+(u-x.points[2]),W=l+(l-x.points[3])),S.push(j,W,p.shift(),p.shift()),u=p.shift(),l=p.shift(),F="C",S.push(u,l);break;case"s":j=u,W=l,x=s[s.length-1],x.command==="C"&&(j=u+(u-x.points[2]),W=l+(l-x.points[3])),S.push(j,W,u+p.shift(),l+p.shift()),u+=p.shift(),l+=p.shift(),F="C",S.push(u,l);break;case"Q":S.push(p.shift(),p.shift()),u=p.shift(),l=p.shift(),S.push(u,l);break;case"q":S.push(u+p.shift(),l+p.shift()),u+=p.shift(),l+=p.shift(),F="Q",S.push(u,l);break;case"T":j=u,W=l,x=s[s.length-1],x.command==="Q"&&(j=u+(u-x.points[0]),W=l+(l-x.points[1])),u=p.shift(),l=p.shift(),F="Q",S.push(j,W,u,l);break;case"t":j=u,W=l,x=s[s.length-1],x.command==="Q"&&(j=u+(u-x.points[0]),W=l+(l-x.points[1])),u+=p.shift(),l+=p.shift(),F="Q",S.push(j,W,u,l);break;case"A":Z=p.shift(),J=p.shift(),K=p.shift(),ae=p.shift(),le=p.shift(),_=u,T=l,u=p.shift(),l=p.shift(),F="A",S=this.convertEndpointToCenterParameterization(_,T,u,l,ae,le,Z,J,K);break;case"a":Z=p.shift(),J=p.shift(),K=p.shift(),ae=p.shift(),le=p.shift(),_=u,T=l,u+=p.shift(),l+=p.shift(),F="A",S=this.convertEndpointToCenterParameterization(_,T,u,l,ae,le,Z,J,K);break}s.push({command:F||D,points:S,start:{x:C,y:B},pathLength:this.calcLength(C,B,F||D,S)})}(D==="z"||D==="Z")&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(e,t,r,i){let s,o,u,l;const c=Ge;switch(r){case"L":return c.getLineLength(e,t,i[0],i[1]);case"C":return Io([e,i[0],i[2],i[4]],[t,i[1],i[3],i[5]],1);case"Q":return No([e,i[0],i[2]],[t,i[1],i[3]],1);case"A":s=0;const h=i[4],d=i[5],m=i[4]+d;let D=Math.PI/180;if(Math.abs(h-m)<D&&(D=Math.abs(h-m)),o=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),d<0)for(l=h-D;l>m;l-=D)u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),o=u;else for(l=h+D;l<m;l+=D)u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),o=u;return u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],m,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),s}return 0}static convertEndpointToCenterParameterization(e,t,r,i,s,o,u,l,c){const h=c*(Math.PI/180),d=Math.cos(h)*(e-r)/2+Math.sin(h)*(t-i)/2,m=-1*Math.sin(h)*(e-r)/2+Math.cos(h)*(t-i)/2,D=d*d/(u*u)+m*m/(l*l);D>1&&(u*=Math.sqrt(D),l*=Math.sqrt(D));let p=Math.sqrt((u*u*(l*l)-u*u*(m*m)-l*l*(d*d))/(u*u*(m*m)+l*l*(d*d)));s===o&&(p*=-1),isNaN(p)&&(p=0);const v=p*u*m/l,F=p*-l*d/u,S=(e+r)/2+Math.cos(h)*v-Math.sin(h)*F,C=(t+i)/2+Math.sin(h)*v+Math.cos(h)*F,B=function(ae){return Math.sqrt(ae[0]*ae[0]+ae[1]*ae[1])},x=function(ae,le){return(ae[0]*le[0]+ae[1]*le[1])/(B(ae)*B(le))},j=function(ae,le){return(ae[0]*le[1]<ae[1]*le[0]?-1:1)*Math.acos(x(ae,le))},W=j([1,0],[(d-v)/u,(m-F)/l]),Z=[(d-v)/u,(m-F)/l],J=[(-1*d-v)/u,(-1*m-F)/l];let K=j(Z,J);return x(Z,J)<=-1&&(K=Math.PI),x(Z,J)>=1&&(K=0),o===0&&K>0&&(K=K-2*Math.PI),o===1&&K<0&&(K=K+2*Math.PI),[S,C,u,l,W,K,h,o]}}Ge.prototype.className="Path";Ge.prototype._attrsAffectingSize=["data"];Ke(Ge);w.addGetterSetter(Ge,"data");class qn extends _n{_sceneFunc(e){super._sceneFunc(e);const t=Math.PI*2,r=this.points();let i=r;const s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());const o=this.pointerLength(),u=r.length;let l,c;if(s){const m=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[u-2],r[u-1]],D=Ge.calcLength(i[i.length-4],i[i.length-3],"C",m),p=Ge.getPointOnQuadraticBezier(Math.min(1,1-o/D),m[0],m[1],m[2],m[3],m[4],m[5]);l=r[u-2]-p.x,c=r[u-1]-p.y}else l=r[u-2]-r[u-4],c=r[u-1]-r[u-3];const h=(Math.atan2(c,l)+t)%t,d=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[u-2],r[u-1]),e.rotate(h),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(l=(i[0]+i[2])/2-r[0],c=(i[1]+i[3])/2-r[1]):(l=r[2]-r[0],c=r[3]-r[1]),e.rotate((Math.atan2(-c,-l)+t)%t),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x,y:e.y-t,width:e.width,height:e.height+t*2}}}qn.prototype.className="Arrow";Ke(qn);w.addGetterSetter(qn,"pointerLength",10,U());w.addGetterSetter(qn,"pointerWidth",10,U());w.addGetterSetter(qn,"pointerAtBeginning",!1);w.addGetterSetter(qn,"pointerAtEnding",!0);class gr extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}}gr.prototype._centroid=!0;gr.prototype.className="Circle";gr.prototype._attrsAffectingSize=["radius"];Ke(gr);w.addGetterSetter(gr,"radius",0,U());class Cn extends V{_sceneFunc(e){const t=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),t!==r&&e.scale(1,r/t),e.arc(0,0,t,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}Cn.prototype.className="Ellipse";Cn.prototype._centroid=!0;Cn.prototype._attrsAffectingSize=["radiusX","radiusY"];Ke(Cn);w.addComponentsGetterSetter(Cn,"radius",["x","y"]);w.addGetterSetter(Cn,"radiusX",0,U());w.addGetterSetter(Cn,"radiusY",0,U());class Tt extends V{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),t=this.hasShadow();return e&&t?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const t=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),s=this.attrs.image;let o;if(s){const u=this.attrs.cropWidth,l=this.attrs.cropHeight;u&&l?o=[s,this.cropX(),this.cropY(),u,l,0,0,t,r]:o=[s,0,0,t,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?M.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)),s&&(i&&e.clip(),e.drawImage.apply(e,o))}_hitFunc(e){const t=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?M.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t,r;return(r=(e=this.attrs.width)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.width)!==null&&r!==void 0?r:0}getHeight(){var e,t,r;return(r=(e=this.attrs.height)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.height)!==null&&r!==void 0?r:0}static fromURL(e,t,r=null){const i=M.createImageElement();i.onload=function(){const s=new Tt({image:i});t(s)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}}Tt.prototype.className="Image";Tt.prototype._attrsAffectingSize=["image"];Ke(Tt);w.addGetterSetter(Tt,"cornerRadius",0,Yi(4));w.addGetterSetter(Tt,"image");w.addComponentsGetterSetter(Tt,"crop",["x","y","width","height"]);w.addGetterSetter(Tt,"cropX",0,U());w.addGetterSetter(Tt,"cropY",0,U());w.addGetterSetter(Tt,"cropWidth",0,U());w.addGetterSetter(Tt,"cropHeight",0,U());const cl=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],y1="Change.konva",S1="none",Ts="up",Ps="right",Cs="down",Ms="left",v1=cl.length;class ma extends pr{constructor(e){super(e),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let t=this,r;const i=function(){t._sync()};for(r=0;r<v1;r++)e.on(cl[r]+y1,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),t=this.getTag(),r,i,s,o,u,l,c;if(e&&t){switch(r=e.width(),i=e.height(),s=t.pointerDirection(),o=t.pointerWidth(),c=t.pointerHeight(),u=0,l=0,s){case Ts:u=r/2,l=-1*c;break;case Ps:u=r+o,l=i/2;break;case Cs:u=r/2,l=i+c;break;case Ms:u=-1*o,l=i/2;break}t.setAttrs({x:-1*u,y:-1*l,width:r,height:i}),e.setAttrs({x:-1*u,y:-1*l})}}}ma.prototype.className="Label";Ke(ma);class Jn extends V{_sceneFunc(e){const t=this.width(),r=this.height(),i=this.pointerDirection(),s=this.pointerWidth(),o=this.pointerHeight(),u=this.cornerRadius();let l=0,c=0,h=0,d=0;typeof u=="number"?l=c=h=d=Math.min(u,t/2,r/2):(l=Math.min(u[0]||0,t/2,r/2),c=Math.min(u[1]||0,t/2,r/2),d=Math.min(u[2]||0,t/2,r/2),h=Math.min(u[3]||0,t/2,r/2)),e.beginPath(),e.moveTo(l,0),i===Ts&&(e.lineTo((t-s)/2,0),e.lineTo(t/2,-1*o),e.lineTo((t+s)/2,0)),e.lineTo(t-c,0),e.arc(t-c,c,c,Math.PI*3/2,0,!1),i===Ps&&(e.lineTo(t,(r-o)/2),e.lineTo(t+s,r/2),e.lineTo(t,(r+o)/2)),e.lineTo(t,r-d),e.arc(t-d,r-d,d,0,Math.PI/2,!1),i===Cs&&(e.lineTo((t+s)/2,r),e.lineTo(t/2,r+o),e.lineTo((t-s)/2,r)),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),i===Ms&&(e.lineTo(0,(r+o)/2),e.lineTo(-1*s,r/2),e.lineTo(0,(r-o)/2)),e.lineTo(0,l),e.arc(l,l,l,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,t=0,r=this.pointerWidth(),i=this.pointerHeight(),s=this.pointerDirection(),o=this.width(),u=this.height();return s===Ts?(t-=i,u+=i):s===Cs?u+=i:s===Ms?(e-=r*1.5,o+=r):s===Ps&&(o+=r*1.5),{x:e,y:t,width:o,height:u}}}Jn.prototype.className="Tag";Ke(Jn);w.addGetterSetter(Jn,"pointerDirection",S1);w.addGetterSetter(Jn,"pointerWidth",0,U());w.addGetterSetter(Jn,"pointerHeight",0,U());w.addGetterSetter(Jn,"cornerRadius",0,Yi(4));class Zr extends V{_sceneFunc(e){const t=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),t?M.drawRoundedRectPath(e,r,i,t):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}}Zr.prototype.className="Rect";Ke(Zr);w.addGetterSetter(Zr,"cornerRadius",0,Yi(4));class Mn extends V{_sceneFunc(e){const t=this._getPoints(),r=this.radius(),i=this.sides(),s=this.cornerRadius();if(e.beginPath(),s)M.drawRoundedPolygonPath(e,t,i,r,s);else{e.moveTo(t[0].x,t[0].y);for(let o=1;o<t.length;o++)e.lineTo(t[o].x,t[o].y)}e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,t=this.attrs.radius||0,r=[];for(let i=0;i<e;i++)r.push({x:t*Math.sin(i*2*Math.PI/e),y:-1*t*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let t=e[0].x,r=e[0].x,i=e[0].y,s=e[0].y;return e.forEach(o=>{t=Math.min(t,o.x),r=Math.max(r,o.x),i=Math.min(i,o.y),s=Math.max(s,o.y)}),{x:t,y:i,width:r-t,height:s-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Mn.prototype.className="RegularPolygon";Mn.prototype._centroid=!0;Mn.prototype._attrsAffectingSize=["radius"];Ke(Mn);w.addGetterSetter(Mn,"radius",0,U());w.addGetterSetter(Mn,"sides",0,U());w.addGetterSetter(Mn,"cornerRadius",0,Yi(4));const Ho=Math.PI*2;class Qn extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,Ho,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),Ho,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}Qn.prototype.className="Ring";Qn.prototype._centroid=!0;Qn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];Ke(Qn);w.addGetterSetter(Qn,"innerRadius",0,U());w.addGetterSetter(Qn,"outerRadius",0,U());class Jt extends V{constructor(e){super(e),this._updated=!0,this.anim=new xt(()=>{const t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const t=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[t],o=this.frameOffsets(),u=s[i+0],l=s[i+1],c=s[i+2],h=s[i+3],d=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,c,h),e.closePath(),e.fillStrokeShape(this)),d)if(o){const m=o[t],D=r*2;e.drawImage(d,u,l,c,h,m[D+0],m[D+1],c,h)}else e.drawImage(d,u,l,c,h,0,0,c,h)}_hitFunc(e){const t=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[t],o=this.frameOffsets(),u=s[i+2],l=s[i+3];if(e.beginPath(),o){const c=o[t],h=r*2;e.rect(c[h+0],c[h+1],u,l)}else e.rect(0,0,u,l);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),t=this.animation(),r=this.animations(),i=r[t],s=i.length/4;e<s-1?this.frameIndex(e+1):this.frameIndex(0)}}Jt.prototype.className="Sprite";Ke(Jt);w.addGetterSetter(Jt,"animation");w.addGetterSetter(Jt,"animations");w.addGetterSetter(Jt,"frameOffsets");w.addGetterSetter(Jt,"image");w.addGetterSetter(Jt,"frameIndex",0,U());w.addGetterSetter(Jt,"frameRate",17,U());w.backCompat(Jt,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class xn extends V{_sceneFunc(e){const t=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let s=1;s<i*2;s++){const o=s%2===0?r:t,u=o*Math.sin(s*Math.PI/i),l=-1*o*Math.cos(s*Math.PI/i);e.lineTo(u,l)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}xn.prototype.className="Star";xn.prototype._centroid=!0;xn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];Ke(xn);w.addGetterSetter(xn,"numPoints",5,U());w.addGetterSetter(xn,"innerRadius",0,U());w.addGetterSetter(xn,"outerRadius",0,U());function vn(n){return[...n].reduce((e,t,r,i)=>{if(new RegExp("\\p{Emoji}","u").test(t)){const s=i[r+1];s&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(s)?(e.push(t+s),i[r+1]=""):e.push(t)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(t+(i[r+1]||""))?e.push(t+i[r+1]):r>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(t)?e[e.length-1]+=t:t&&e.push(t);return e},[])}const ar="auto",w1="center",hl="inherit",Tr="justify",E1="Change.konva",A1="2d",jo="-",dl="left",F1="text",T1="Text",P1="top",C1="bottom",Vo="middle",fl="normal",M1="px ",bi=" ",x1="right",Wo="rtl",B1="word",k1="char",zo="none",ls="",ml=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],R1=ml.length;function L1(n){return n.split(",").map(e=>{e=e.trim();const t=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!r&&(e=`"${e}"`),e}).join(", ")}let yi;function cs(){return yi||(yi=M.createCanvasElement().getContext(A1),yi)}function O1(n){n.fillText(this._partialText,this._partialTextX,this._partialTextY)}function I1(n){n.setAttr("miterLimit",2),n.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function N1(n){return n=n||{},!n.fillLinearGradientColorStops&&!n.fillRadialGradientColorStops&&!n.fillPatternImage&&(n.fill=n.fill||"black"),n}class ze extends V{constructor(e){super(N1(e)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<R1;t++)this.on(ml[t]+E1,this._setTextData);this._setTextData()}_sceneFunc(e){var t,r;const i=this.textArr,s=i.length;if(!this.text())return;let o=this.padding(),u=this.fontSize(),l=this.lineHeight()*u,c=this.verticalAlign(),h=this.direction(),d=0,m=this.align(),D=this.getWidth(),p=this.letterSpacing(),v=this.charRenderFunc(),F=this.fill(),S=this.textDecoration(),C=S.indexOf("underline")!==-1,B=S.indexOf("line-through")!==-1,x;h=h===hl?e.direction:h;let j=l/2,W=Vo;if(!Y.legacyTextRendering){const Z=this.measureSize("M");W="alphabetic";const J=(t=Z.fontBoundingBoxAscent)!==null&&t!==void 0?t:Z.actualBoundingBoxAscent,K=(r=Z.fontBoundingBoxDescent)!==null&&r!==void 0?r:Z.actualBoundingBoxDescent;j=(J-K)/2+l/2}for(h===Wo&&e.setAttr("direction",h),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",W),e.setAttr("textAlign",dl),c===Vo?d=(this.getHeight()-s*l-o*2)/2:c===C1&&(d=this.getHeight()-s*l-o*2),e.translate(o,d+o),x=0;x<s;x++){let Z=0,J=0;const K=i[x],ae=K.text,le=K.width,_=K.lastInParagraph;if(e.save(),m===x1?Z+=D-le-o*2:m===w1&&(Z+=(D-le-o*2)/2),C){e.save(),e.beginPath();const A=Y.legacyTextRendering?Math.round(u/2):Math.round(u/4),y=Z,O=j+J+A;e.moveTo(y,O);const I=m===Tr&&!_?D-o*2:le;e.lineTo(y+Math.round(I),O),e.lineWidth=u/15;const k=this._getLinearGradient();e.strokeStyle=k||F,e.stroke(),e.restore()}const T=Z;if(h!==Wo&&(p!==0||m===Tr||v)){const A=ae.split(" ").length-1,y=vn(ae);for(let O=0;O<y.length;O++){const I=y[O];if(I===" "&&!_&&m===Tr&&(Z+=(D-o*2-le)/A),this._partialTextX=Z,this._partialTextY=j+J,this._partialText=I,v){e.save();const q=i.slice(0,x).reduce((be,Q)=>be+vn(Q.text).length,0),ge=O+q;v({char:I,index:ge,x:Z,y:j+J,lineIndex:x,column:O,isLastInLine:_,width:this.measureSize(I).width,context:e})}e.fillStrokeShape(this),v&&e.restore(),Z+=this.measureSize(I).width+p}}else p!==0&&e.setAttr("letterSpacing",`${p}px`),this._partialTextX=Z,this._partialTextY=j+J,this._partialText=ae,e.fillStrokeShape(this);if(B){e.save(),e.beginPath();const A=Y.legacyTextRendering?0:-Math.round(u/4),y=T;e.moveTo(y,j+J+A);const O=m===Tr&&!_?D-o*2:le;e.lineTo(y+Math.round(O),j+J+A),e.lineWidth=u/15;const I=this._getLinearGradient();e.strokeStyle=I||F,e.stroke(),e.restore()}e.restore(),s>1&&(j+=l)}}_hitFunc(e){const t=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const t=M._isString(e)?e:e==null?"":e+"";return this._setAttr(F1,t),this}getWidth(){return this.attrs.width===ar||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===ar||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return M.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var t,r,i,s,o,u,l,c,h,d,m;let D=cs(),p=this.fontSize(),v;D.save(),D.font=this._getContextFont(),v=D.measureText(e),D.restore();const F=p/100;return{actualBoundingBoxAscent:(t=v.actualBoundingBoxAscent)!==null&&t!==void 0?t:71.58203125*F,actualBoundingBoxDescent:(r=v.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(i=v.actualBoundingBoxLeft)!==null&&i!==void 0?i:-7.421875*F,actualBoundingBoxRight:(s=v.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*F,alphabeticBaseline:(o=v.alphabeticBaseline)!==null&&o!==void 0?o:0,emHeightAscent:(u=v.emHeightAscent)!==null&&u!==void 0?u:100*F,emHeightDescent:(l=v.emHeightDescent)!==null&&l!==void 0?l:-20*F,fontBoundingBoxAscent:(c=v.fontBoundingBoxAscent)!==null&&c!==void 0?c:91*F,fontBoundingBoxDescent:(h=v.fontBoundingBoxDescent)!==null&&h!==void 0?h:21*F,hangingBaseline:(d=v.hangingBaseline)!==null&&d!==void 0?d:72.80000305175781*F,ideographicBaseline:(m=v.ideographicBaseline)!==null&&m!==void 0?m:-21*F,width:v.width,height:p}}_getContextFont(){return this.fontStyle()+bi+this.fontVariant()+bi+(this.fontSize()+M1)+L1(this.fontFamily())}_addTextLine(e){this.align()===Tr&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const t=this.letterSpacing(),r=e.length;return cs().measureText(e).width+t*r}_setTextData(){let e=this.text().split(`
`),t=+this.fontSize(),r=0,i=this.lineHeight()*t,s=this.attrs.width,o=this.attrs.height,u=s!==ar&&s!==void 0,l=o!==ar&&o!==void 0,c=this.padding(),h=s-c*2,d=o-c*2,m=0,D=this.wrap(),p=D!==zo,v=D!==k1&&p,F=this.ellipsis();this.textArr=[],cs().font=this._getContextFont();const S=F?this._getTextWidth(ls):0;for(let C=0,B=e.length;C<B;++C){let x=e[C],j=this._getTextWidth(x);if(u&&j>h)for(;x.length>0;){let W=0,Z=vn(x).length,J="",K=0;for(;W<Z;){const ae=W+Z>>>1,le=vn(x),_=le.slice(0,ae+1).join(""),T=this._getTextWidth(_);(F&&l&&m+i>d?T+S:T)<=h?(W=ae+1,J=_,K=T):Z=ae}if(J){if(v){const _=vn(x),T=vn(J),A=_[T.length],y=A===bi||A===jo;let O;if(y&&K<=h)O=T.length;else{const I=T.lastIndexOf(bi),k=T.lastIndexOf(jo);O=Math.max(I,k)+1}O>0&&(W=O,J=_.slice(0,W).join(""),K=this._getTextWidth(J))}if(J=J.trimRight(),this._addTextLine(J),r=Math.max(r,K),m+=i,this._shouldHandleEllipsis(m)){this._tryToAddEllipsisToLastLine();break}if(x=vn(x).slice(W).join("").trimLeft(),x.length>0&&(j=this._getTextWidth(x),j<=h)){this._addTextLine(x),m+=i,r=Math.max(r,j);break}}else break}else this._addTextLine(x),m+=i,r=Math.max(r,j),this._shouldHandleEllipsis(m)&&C<B-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&m+i>d)break}this.textHeight=t,this.textWidth=r}_shouldHandleEllipsis(e){const t=+this.fontSize(),r=this.lineHeight()*t,i=this.attrs.height,s=i!==ar&&i!==void 0,o=this.padding(),u=i-o*2;return!(this.wrap()!==zo)||s&&e+r>u}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,t=e!==ar&&e!==void 0,r=this.padding(),i=e-r*2,s=this.ellipsis(),o=this.textArr[this.textArr.length-1];!o||!s||(t&&(this._getTextWidth(o.text+ls)<i||(o.text=o.text.slice(0,o.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(o.text+ls))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,t=this.hasShadow();return e&&t?!0:super._useBufferCanvas()}}ze.prototype._fillFunc=O1;ze.prototype._strokeFunc=I1;ze.prototype.className=T1;ze.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];Ke(ze);w.overWriteSetter(ze,"width",ha());w.overWriteSetter(ze,"height",ha());w.addGetterSetter(ze,"direction",hl);w.addGetterSetter(ze,"fontFamily","Arial");w.addGetterSetter(ze,"fontSize",12,U());w.addGetterSetter(ze,"fontStyle",fl);w.addGetterSetter(ze,"fontVariant",fl);w.addGetterSetter(ze,"padding",0,U());w.addGetterSetter(ze,"align",dl);w.addGetterSetter(ze,"verticalAlign",P1);w.addGetterSetter(ze,"lineHeight",1,U());w.addGetterSetter(ze,"wrap",B1);w.addGetterSetter(ze,"ellipsis",!1,Vt());w.addGetterSetter(ze,"letterSpacing",0,U());w.addGetterSetter(ze,"text","",Kn());w.addGetterSetter(ze,"textDecoration","");w.addGetterSetter(ze,"charRenderFunc",void 0);const G1="",pl="normal";function gl(n){n.fillText(this.partialText,0,0)}function _l(n){n.strokeText(this.partialText,0,0)}class nt extends V{constructor(e){super(e),this.dummyCanvas=M.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Ge.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const t=this.pathLength;return e>t?null:Ge.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=Ge.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const t=this.textDecoration(),r=this.fill(),i=this.fontSize(),s=this.glyphInfo,o=t.indexOf("underline")!==-1,u=t.indexOf("line-through")!==-1;o&&e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),this.partialText=s[l].text,e.fillStrokeShape(this),o&&(l===0&&e.moveTo(0,i/2+1),e.lineTo(s[l].width,i/2+1)),e.restore()}if(o&&(e.strokeStyle=r,e.lineWidth=i/20,e.stroke()),u){e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),l===0&&e.moveTo(0,0),e.lineTo(s[l].width,0),e.restore()}e.strokeStyle=r,e.lineWidth=i/20,e.stroke()}e.restore()}_hitFunc(e){e.beginPath();const t=this.glyphInfo;if(t.length>=1){const r=t[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<t.length;r++){const i=t[r].p1;e.lineTo(i.x,i.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return M.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return ze.prototype.setText.call(this,e)}_getContextFont(){return ze.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const i=r.measureText(e);return r.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const e=vn(this.text()),t=[];let r=0;for(let d=0;d<e.length;d++)t.push({char:e[d],width:this._getTextSize(e[d]).width}),r+=t[d].width;const{height:i}=this._getTextSize(this.attrs.text);if(this.textWidth=r,this.textHeight=i,this.glyphInfo=[],!this.attrs.data)return null;const s=this.letterSpacing(),o=this.align(),u=this.kerningFunc(),l=Math.max(this.textWidth+((this.attrs.text||"").length-1)*s,0);let c=0;o==="center"&&(c=Math.max(0,this.pathLength/2-l/2)),o==="right"&&(c=Math.max(0,this.pathLength-l));let h=c;for(let d=0;d<t.length;d++){const m=this._getPointAtLength(h);if(!m)return;const D=t[d].char;let p=t[d].width+s;if(D===" "&&o==="justify"){const x=this.text().split(" ").length-1;p+=(this.pathLength-l)/x}const v=this._getPointAtLength(h+p);if(!v)return;const F=Ge.getLineLength(m.x,m.y,v.x,v.y);let S=0;if(u)try{S=u(t[d-1].char,D)*this.fontSize()}catch{S=0}m.x+=S,v.x+=S,this.textWidth+=S;const C=Ge.getPointOnLine(S+F/2,m.x,m.y,v.x,v.y),B=Math.atan2(v.y-m.y,v.x-m.x);this.glyphInfo.push({transposeX:C.x,transposeY:C.y,text:e[d],rotation:B,p0:m,p1:v,width:F}),h+=p}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(c){e.push(c.p0.x),e.push(c.p0.y),e.push(c.p1.x),e.push(c.p1.y)});let t=e[0]||0,r=e[0]||0,i=e[1]||0,s=e[1]||0,o,u;for(let c=0;c<e.length/2;c++)o=e[c*2],u=e[c*2+1],t=Math.min(t,o),r=Math.max(r,o),i=Math.min(i,u),s=Math.max(s,u);const l=this.fontSize();return{x:t-l/2,y:i-l/2,width:r-t+l,height:s-i+l}}destroy(){return M.releaseCanvas(this.dummyCanvas),super.destroy()}}nt.prototype._fillFunc=gl;nt.prototype._strokeFunc=_l;nt.prototype._fillFuncHit=gl;nt.prototype._strokeFuncHit=_l;nt.prototype.className="TextPath";nt.prototype._attrsAffectingSize=["text","fontSize","data"];Ke(nt);w.addGetterSetter(nt,"data");w.addGetterSetter(nt,"fontFamily","Arial");w.addGetterSetter(nt,"fontSize",12,U());w.addGetterSetter(nt,"fontStyle",pl);w.addGetterSetter(nt,"align","left");w.addGetterSetter(nt,"letterSpacing",0,U());w.addGetterSetter(nt,"textBaseline","middle");w.addGetterSetter(nt,"fontVariant",pl);w.addGetterSetter(nt,"text",G1);w.addGetterSetter(nt,"textDecoration","");w.addGetterSetter(nt,"kerningFunc",void 0);const Dl="tr-konva",H1=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(n=>n+`.${Dl}`).join(" "),Uo="nodesRect",j1=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange","draggableChange"],V1={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},W1="ontouchstart"in Y._global;function z1(n,e,t){if(n==="rotater")return t;e+=M.degToRad(V1[n]||0);const r=(M.radToDeg(e)%360+360)%360;return M._inRange(r,315+22.5,360)||M._inRange(r,0,22.5)?"ns-resize":M._inRange(r,45-22.5,45+22.5)?"nesw-resize":M._inRange(r,90-22.5,90+22.5)?"ew-resize":M._inRange(r,135-22.5,135+22.5)?"nwse-resize":M._inRange(r,180-22.5,180+22.5)?"ns-resize":M._inRange(r,225-22.5,225+22.5)?"nesw-resize":M._inRange(r,270-22.5,270+22.5)?"ew-resize":M._inRange(r,315-22.5,315+22.5)?"nwse-resize":(M.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const xi=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function U1(n){return{x:n.x+n.width/2*Math.cos(n.rotation)+n.height/2*Math.sin(-n.rotation),y:n.y+n.height/2*Math.cos(n.rotation)+n.width/2*Math.sin(n.rotation)}}function bl(n,e,t){const r=t.x+(n.x-t.x)*Math.cos(e)-(n.y-t.y)*Math.sin(e),i=t.y+(n.x-t.x)*Math.sin(e)+(n.y-t.y)*Math.cos(e);return{...n,rotation:n.rotation+e,x:r,y:i}}function X1(n,e){const t=U1(n);return bl(n,e,t)}function K1(n,e,t){let r=e;for(let i=0;i<n.length;i++){const s=Y.getAngle(n[i]),o=Math.abs(s-e)%(Math.PI*2);Math.min(o,Math.PI*2-o)<t&&(r=s)}return r}let xs=0;class we extends pr{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(H1,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return M.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Dl+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const t=e.filter(i=>i.isAncestorOf(this)?(M.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=t,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(i=>{const s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(i._attrsAffectingSize.length){const o=i._attrsAffectingSize.map(u=>u+"Change."+this._getEventNamespace()).join(" ");i.on(o,s)}i.on(j1.map(o=>o+`.${this._getEventNamespace()}`).join(" "),s),i.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(i)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let t;e.on(`dragstart.${this._getEventNamespace()}`,r=>{t=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!t)return;const i=e.getAbsolutePosition(),s=i.x-t.x,o=i.y-t.y;this.nodes().forEach(u=>{if(u===e||u.isDragging())return;const l=u.getAbsolutePosition();u.setAbsolutePosition({x:l.x+s,y:l.y+o}),u.startDrag(r)}),t=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Uo),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Uo,this.__getNodeRect)}__getNodeShape(e,t=this.rotation(),r){const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=e.getAbsoluteScale(r),o=e.getAbsolutePosition(r),u=i.x*s.x-e.offsetX()*s.x,l=i.y*s.y-e.offsetY()*s.y,c=(Y.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),h={x:o.x+u*Math.cos(c)+l*Math.sin(-c),y:o.y+l*Math.cos(c)+u*Math.sin(c),width:i.width*s.x,height:i.height*s.y,rotation:c};return bl(h,-Y.getAngle(t),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(c=>{const h=c.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),d=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}],m=c.getAbsoluteTransform();d.forEach(function(D){const p=m.point(D);t.push(p)})});const r=new Et;r.rotate(-Y.getAngle(this.rotation()));let i=1/0,s=1/0,o=-1/0,u=-1/0;t.forEach(function(c){const h=r.point(c);i===void 0&&(i=o=h.x,s=u=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),o=Math.max(o,h.x),u=Math.max(u,h.y)}),r.invert();const l=r.point({x:i,y:s});return{x:l.x,y:l.y,width:o-i,height:u-s,rotation:Y.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),xi.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const t=new Zr({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:W1?10:"auto"}),r=this;t.on("mousedown touchstart",function(i){r._handleMouseDown(i)}),t.on("dragstart",i=>{t.stopDrag(),i.cancelBubble=!0}),t.on("dragend",i=>{i.cancelBubble=!0}),t.on("mouseenter",()=>{const i=Y.getAngle(this.rotation()),s=this.rotateAnchorCursor(),o=z1(e,i,s);t.getStage().content&&(t.getStage().content.style.cursor=o),this._cursorChange=!0}),t.on("mouseout",()=>{t.getStage().content&&(t.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(t)}_createBack(){const e=new V({name:"back",width:0,height:0,sceneFunc(t,r){const i=r.getParent(),s=i.padding();t.beginPath(),t.rect(-s,-s,r.width()+s*2,r.height()+s*2),t.moveTo(r.width()/2,-s),i.rotateEnabled()&&i.rotateLineVisible()&&t.lineTo(r.width()/2,-i.rotateAnchorOffset()*M._sign(r.height())-s),t.fillStrokeShape(r)},hitFunc:(t,r)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();t.beginPath(),t.rect(-i,-i,r.width()+i*2,r.height()+i*2),t.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",t=>{t.cancelBubble=!0}),e.on("dragmove",t=>{t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const t=this._getNodeRect(),r=t.width,i=t.height,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));this.sin=Math.abs(i/s),this.cos=Math.abs(r/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const o=e.target.getAbsolutePosition(),u=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:u.x-o.x,y:u.y-o.y},xs++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:e.evt,target:l})})}_handleMouseMove(e){let t,r,i;const s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(e);const u=o.getPointerPosition();let l={x:u.x-this._anchorDragOffset.x,y:u.y-this._anchorDragOffset.y};const c=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(c,l,e)),s.setAbsolutePosition(l);const h=s.getAbsolutePosition();if(c.x===h.x&&c.y===h.y)return;if(this._movingAnchorName==="rotater"){const C=this._getNodeRect();t=s.x()-C.width/2,r=-s.y()+C.height/2;let B=Math.atan2(-r,t)+Math.PI/2;C.height<0&&(B-=Math.PI);const j=Y.getAngle(this.rotation())+B,W=Y.getAngle(this.rotationSnapTolerance()),J=K1(this.rotationSnaps(),j,W)-C.rotation,K=X1(C,J);this._fitNodesInto(K,e);return}const d=this.shiftBehavior();let m;d==="inverted"?m=this.keepRatio()&&!e.shiftKey:d==="none"?m=this.keepRatio():m=this.keepRatio()||e.shiftKey;let D=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(C.x-s.x(),2)+Math.pow(C.y-s.y(),2));const B=this.findOne(".top-left").x()>C.x?-1:1,x=this.findOne(".top-left").y()>C.y?-1:1;t=i*this.cos*B,r=i*this.sin*x,this.findOne(".top-left").x(C.x-t),this.findOne(".top-left").y(C.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(s.x()-C.x,2)+Math.pow(C.y-s.y(),2));const B=this.findOne(".top-right").x()<C.x?-1:1,x=this.findOne(".top-right").y()>C.y?-1:1;t=i*this.cos*B,r=i*this.sin*x,this.findOne(".top-right").x(C.x+t),this.findOne(".top-right").y(C.y-r)}var p=s.position();this.findOne(".top-left").y(p.y),this.findOne(".bottom-right").x(p.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(C.x-s.x(),2)+Math.pow(s.y()-C.y,2));const B=C.x<s.x()?-1:1,x=s.y()<C.y?-1:1;t=i*this.cos*B,r=i*this.sin*x,s.x(C.x-t),s.y(C.y+r)}p=s.position(),this.findOne(".top-left").x(p.x),this.findOne(".bottom-right").y(p.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(s.x()-C.x,2)+Math.pow(s.y()-C.y,2));const B=this.findOne(".bottom-right").x()<C.x?-1:1,x=this.findOne(".bottom-right").y()<C.y?-1:1;t=i*this.cos*B,r=i*this.sin*x,this.findOne(".bottom-right").x(C.x+t),this.findOne(".bottom-right").y(C.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(D=this.centeredScaling()||e.altKey,D){const C=this.findOne(".top-left"),B=this.findOne(".bottom-right"),x=C.x(),j=C.y(),W=this.getWidth()-B.x(),Z=this.getHeight()-B.y();B.move({x:-x,y:-j}),C.move({x:W,y:Z})}const v=this.findOne(".top-left").getAbsolutePosition();t=v.x,r=v.y;const F=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),S=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:t,y:r,width:F,height:S,rotation:Y.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var t;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();xs--,this._fire("transformend",{evt:e,target:r}),(t=this.getLayer())===null||t===void 0||t.batchDraw(),r&&this._nodes.forEach(i=>{var s;i._fire("transformend",{evt:e,target:i}),(s=i.getLayer())===null||s===void 0||s.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,t){const r=this._getNodeRect(),i=1;if(M._inRange(e.width,-this.padding()*2-i,i)){this.update();return}if(M._inRange(e.height,-this.padding()*2-i,i)){this.update();return}const s=new Et;if(s.rotate(Y.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const m=s.point({x:-this.padding()*2,y:0});e.x+=m.x,e.y+=m.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const m=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const m=s.point({x:0,y:-this.padding()*2});e.x+=m.x,e.y+=m.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const m=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const m=this.boundBoxFunc()(r,e);m?e=m:M.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const o=1e7,u=new Et;u.translate(r.x,r.y),u.rotate(r.rotation),u.scale(r.width/o,r.height/o);const l=new Et,c=e.width/o,h=e.height/o;this.flipEnabled()===!1?(l.translate(e.x,e.y),l.rotate(e.rotation),l.translate(e.width<0?e.width:0,e.height<0?e.height:0),l.scale(Math.abs(c),Math.abs(h))):(l.translate(e.x,e.y),l.rotate(e.rotation),l.scale(c,h));const d=l.multiply(u.invert());this._nodes.forEach(m=>{var D;if(!m.getStage())return;const p=m.getParent().getAbsoluteTransform(),v=m.getTransform().copy();v.translate(m.offsetX(),m.offsetY());const F=new Et;F.multiply(p.copy().invert()).multiply(d).multiply(p).multiply(v);const S=F.decompose();m.setAttrs(S),(D=m.getLayer())===null||D===void 0||D.batchDraw()}),this.rotation(M._getRotation(e.rotation)),this._nodes.forEach(m=>{this._fire("transform",{evt:t,target:m}),m._fire("transform",{evt:t,target:m})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,t){this.findOne(e).setAttrs(t)}update(){var e;const t=this._getNodeRect();this.rotation(M._getRotation(t.rotation));const r=t.width,i=t.height,s=this.enabledAnchors(),o=this.resizeEnabled(),u=this.padding(),l=this.anchorSize(),c=this.find("._anchor");c.forEach(d=>{d.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+u,offsetY:l/2+u,visible:o&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:l/2+u,visible:o&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:l/2-u,offsetY:l/2+u,visible:o&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:l/2+u,visible:o&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:l/2-u,visible:o&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:l/2+u,offsetY:l/2-u,visible:o&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:l/2-u,visible:o&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:l/2-u,offsetY:l/2-u,visible:o&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*M._sign(i)-u,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),draggable:this.nodes().some(d=>d.draggable()),x:0,y:0});const h=this.anchorStyleFunc();h&&c.forEach(d=>{h(d)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),pr.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return z.prototype.toObject.call(this)}clone(e){return z.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}we.isTransforming=()=>xs>0;function Y1(n){return n instanceof Array||M.warn("enabledAnchors value should be an array"),n instanceof Array&&n.forEach(function(e){xi.indexOf(e)===-1&&M.warn("Unknown anchor name: "+e+". Available names are: "+xi.join(", "))}),n||[]}we.prototype.className="Transformer";Ke(we);w.addGetterSetter(we,"enabledAnchors",xi,Y1);w.addGetterSetter(we,"flipEnabled",!0,Vt());w.addGetterSetter(we,"resizeEnabled",!0);w.addGetterSetter(we,"anchorSize",10,U());w.addGetterSetter(we,"rotateEnabled",!0);w.addGetterSetter(we,"rotateLineVisible",!0);w.addGetterSetter(we,"rotationSnaps",[]);w.addGetterSetter(we,"rotateAnchorOffset",50,U());w.addGetterSetter(we,"rotateAnchorCursor","crosshair");w.addGetterSetter(we,"rotationSnapTolerance",5,U());w.addGetterSetter(we,"borderEnabled",!0);w.addGetterSetter(we,"anchorStroke","rgb(0, 161, 255)");w.addGetterSetter(we,"anchorStrokeWidth",1,U());w.addGetterSetter(we,"anchorFill","white");w.addGetterSetter(we,"anchorCornerRadius",0,U());w.addGetterSetter(we,"borderStroke","rgb(0, 161, 255)");w.addGetterSetter(we,"borderStrokeWidth",1,U());w.addGetterSetter(we,"borderDash");w.addGetterSetter(we,"keepRatio",!0);w.addGetterSetter(we,"shiftBehavior","default");w.addGetterSetter(we,"centeredScaling",!1);w.addGetterSetter(we,"ignoreStroke",!1);w.addGetterSetter(we,"padding",0,U());w.addGetterSetter(we,"nodes");w.addGetterSetter(we,"node");w.addGetterSetter(we,"boundBoxFunc");w.addGetterSetter(we,"anchorDragBoundFunc");w.addGetterSetter(we,"anchorStyleFunc");w.addGetterSetter(we,"shouldOverdrawWholeArea",!1);w.addGetterSetter(we,"useSingleNodeRotation",!0);w.backCompat(we,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Dn extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,Y.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Dn.prototype.className="Wedge";Dn.prototype._centroid=!0;Dn.prototype._attrsAffectingSize=["radius"];Ke(Dn);w.addGetterSetter(Dn,"radius",0,U());w.addGetterSetter(Dn,"angle",0,U());w.addGetterSetter(Dn,"clockwise",!1);w.backCompat(Dn,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});function Xo(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const q1=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],J1=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function Q1(n,e){const t=n.data,r=n.width,i=n.height;let s,o,u,l,c,h,d,m,D,p,v,F,S,C,B,x,j,W,Z,J;const K=e+e+1,ae=r-1,le=i-1,_=e+1,T=_*(_+1)/2,A=new Xo,y=q1[e],O=J1[e];let I=null,k=A,q=null,ge=null;for(let be=1;be<K;be++)k=k.next=new Xo,be===_&&(I=k);k.next=A,u=o=0;for(let be=0;be<i;be++){F=S=C=B=l=c=h=d=0,m=_*(x=t[o]),D=_*(j=t[o+1]),p=_*(W=t[o+2]),v=_*(Z=t[o+3]),l+=T*x,c+=T*j,h+=T*W,d+=T*Z,k=A;for(let Q=0;Q<_;Q++)k.r=x,k.g=j,k.b=W,k.a=Z,k=k.next;for(let Q=1;Q<_;Q++)s=o+((ae<Q?ae:Q)<<2),l+=(k.r=x=t[s])*(J=_-Q),c+=(k.g=j=t[s+1])*J,h+=(k.b=W=t[s+2])*J,d+=(k.a=Z=t[s+3])*J,F+=x,S+=j,C+=W,B+=Z,k=k.next;q=A,ge=I;for(let Q=0;Q<r;Q++)t[o+3]=Z=d*y>>O,Z!==0?(Z=255/Z,t[o]=(l*y>>O)*Z,t[o+1]=(c*y>>O)*Z,t[o+2]=(h*y>>O)*Z):t[o]=t[o+1]=t[o+2]=0,l-=m,c-=D,h-=p,d-=v,m-=q.r,D-=q.g,p-=q.b,v-=q.a,s=u+((s=Q+e+1)<ae?s:ae)<<2,F+=q.r=t[s],S+=q.g=t[s+1],C+=q.b=t[s+2],B+=q.a=t[s+3],l+=F,c+=S,h+=C,d+=B,q=q.next,m+=x=ge.r,D+=j=ge.g,p+=W=ge.b,v+=Z=ge.a,F-=x,S-=j,C-=W,B-=Z,ge=ge.next,o+=4;u+=r}for(let be=0;be<r;be++){S=C=B=F=c=h=d=l=0,o=be<<2,m=_*(x=t[o]),D=_*(j=t[o+1]),p=_*(W=t[o+2]),v=_*(Z=t[o+3]),l+=T*x,c+=T*j,h+=T*W,d+=T*Z,k=A;for(let X=0;X<_;X++)k.r=x,k.g=j,k.b=W,k.a=Z,k=k.next;let Q=r;for(let X=1;X<=e;X++)o=Q+be<<2,l+=(k.r=x=t[o])*(J=_-X),c+=(k.g=j=t[o+1])*J,h+=(k.b=W=t[o+2])*J,d+=(k.a=Z=t[o+3])*J,F+=x,S+=j,C+=W,B+=Z,k=k.next,X<le&&(Q+=r);o=be,q=A,ge=I;for(let X=0;X<i;X++)s=o<<2,t[s+3]=Z=d*y>>O,Z>0?(Z=255/Z,t[s]=(l*y>>O)*Z,t[s+1]=(c*y>>O)*Z,t[s+2]=(h*y>>O)*Z):t[s]=t[s+1]=t[s+2]=0,l-=m,c-=D,h-=p,d-=v,m-=q.r,D-=q.g,p-=q.b,v-=q.a,s=be+((s=X+_)<le?s:le)*r<<2,l+=F+=q.r=t[s],c+=S+=q.g=t[s+1],h+=C+=q.b=t[s+2],d+=B+=q.a=t[s+3],q=q.next,m+=x=ge.r,D+=j=ge.g,p+=W=ge.b,v+=Z=ge.a,F-=x,S-=j,C-=W,B-=Z,ge=ge.next,o+=r}}const Z1=function(e){const t=Math.round(this.blurRadius());t>0&&Q1(e,t)};w.addGetterSetter(z,"blurRadius",0,U(),w.afterSetFilter);const $1=function(n){const e=this.brightness()*255,t=n.data,r=t.length;for(let i=0;i<r;i+=4)t[i]+=e,t[i+1]+=e,t[i+2]+=e};w.addGetterSetter(z,"brightness",0,U(),w.afterSetFilter);const em=function(n){const e=this.brightness(),t=n.data,r=t.length;for(let i=0;i<r;i+=4)t[i]=Math.min(255,t[i]*e),t[i+1]=Math.min(255,t[i+1]*e),t[i+2]=Math.min(255,t[i+2]*e)},tm=function(n){const e=Math.pow((this.contrast()+100)/100,2),t=n.data,r=t.length;let i=150,s=150,o=150;for(let u=0;u<r;u+=4)i=t[u],s=t[u+1],o=t[u+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,o/=255,o-=.5,o*=e,o+=.5,o*=255,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,o=o<0?0:o>255?255:o,t[u]=i,t[u+1]=s,t[u+2]=o};w.addGetterSetter(z,"contrast",0,U(),w.afterSetFilter);const nm=function(n){var e,t,r,i,s,o,u,l,c;const h=n.data,d=n.width,m=n.height,D=Math.min(1,Math.max(0,(t=(e=this.embossStrength)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:.5)),p=Math.min(1,Math.max(0,(i=(r=this.embossWhiteLevel)===null||r===void 0?void 0:r.call(this))!==null&&i!==void 0?i:.5)),F=(u={"top-left":315,top:270,"top-right":225,right:180,"bottom-right":135,bottom:90,"bottom-left":45,left:0}[(o=(s=this.embossDirection)===null||s===void 0?void 0:s.call(this))!==null&&o!==void 0?o:"top-left"])!==null&&u!==void 0?u:315,S=!!((c=(l=this.embossBlend)===null||l===void 0?void 0:l.call(this))!==null&&c!==void 0&&c),C=D*10,B=p*255,x=F*Math.PI/180,j=Math.cos(x),W=Math.sin(x),Z=128/1020*C,J=new Uint8ClampedArray(h),K=new Float32Array(d*m);for(let A=0,y=0;y<h.length;y+=4,A++)K[A]=.2126*J[y]+.7152*J[y+1]+.0722*J[y+2];const ae=[-1,0,1,-2,0,2,-1,0,1],le=[-1,-2,-1,0,0,0,1,2,1],_=[-d-1,-d,-d+1,-1,0,1,d-1,d,d+1],T=A=>A<0?0:A>255?255:A;for(let A=1;A<m-1;A++)for(let y=1;y<d-1;y++){const O=A*d+y;let I=0,k=0;I+=K[O+_[0]]*ae[0],k+=K[O+_[0]]*le[0],I+=K[O+_[1]]*ae[1],k+=K[O+_[1]]*le[1],I+=K[O+_[2]]*ae[2],k+=K[O+_[2]]*le[2],I+=K[O+_[3]]*ae[3],k+=K[O+_[3]]*le[3],I+=K[O+_[5]]*ae[5],k+=K[O+_[5]]*le[5],I+=K[O+_[6]]*ae[6],k+=K[O+_[6]]*le[6],I+=K[O+_[7]]*ae[7],k+=K[O+_[7]]*le[7],I+=K[O+_[8]]*ae[8],k+=K[O+_[8]]*le[8];const q=j*I+W*k,ge=T(B+q*Z),be=O*4;if(S){const Q=ge-B;h[be]=T(J[be]+Q),h[be+1]=T(J[be+1]+Q),h[be+2]=T(J[be+2]+Q),h[be+3]=J[be+3]}else h[be]=h[be+1]=h[be+2]=ge,h[be+3]=J[be+3]}for(let A=0;A<d;A++){let y=A*4,O=((m-1)*d+A)*4;h[y]=J[y],h[y+1]=J[y+1],h[y+2]=J[y+2],h[y+3]=J[y+3],h[O]=J[O],h[O+1]=J[O+1],h[O+2]=J[O+2],h[O+3]=J[O+3]}for(let A=1;A<m-1;A++){let y=A*d*4,O=(A*d+(d-1))*4;h[y]=J[y],h[y+1]=J[y+1],h[y+2]=J[y+2],h[y+3]=J[y+3],h[O]=J[O],h[O+1]=J[O+1],h[O+2]=J[O+2],h[O+3]=J[O+3]}return n};w.addGetterSetter(z,"embossStrength",.5,U(),w.afterSetFilter);w.addGetterSetter(z,"embossWhiteLevel",.5,U(),w.afterSetFilter);w.addGetterSetter(z,"embossDirection","top-left",void 0,w.afterSetFilter);w.addGetterSetter(z,"embossBlend",!1,void 0,w.afterSetFilter);function hs(n,e,t,r,i){const s=t-e,o=i-r;if(s===0)return r+o/2;if(o===0)return r;let u=(n-e)/s;return u=o*u+r,u}const rm=function(n){const e=n.data,t=e.length;let r=e[0],i=r,s,o=e[1],u=o,l,c=e[2],h=c,d;const m=this.enhance();if(m===0)return;for(let B=0;B<t;B+=4)s=e[B+0],s<r?r=s:s>i&&(i=s),l=e[B+1],l<o?o=l:l>u&&(u=l),d=e[B+2],d<c?c=d:d>h&&(h=d);i===r&&(i=255,r=0),u===o&&(u=255,o=0),h===c&&(h=255,c=0);let D,p,v,F,S,C;if(m>0)D=i+m*(255-i),p=r-m*(r-0),v=u+m*(255-u),F=o-m*(o-0),S=h+m*(255-h),C=c-m*(c-0);else{const B=(i+r)*.5;D=i+m*(i-B),p=r+m*(r-B);const x=(u+o)*.5;v=u+m*(u-x),F=o+m*(o-x);const j=(h+c)*.5;S=h+m*(h-j),C=c+m*(c-j)}for(let B=0;B<t;B+=4)e[B+0]=hs(e[B+0],r,i,p,D),e[B+1]=hs(e[B+1],o,u,F,v),e[B+2]=hs(e[B+2],c,h,C,S)};w.addGetterSetter(z,"enhance",0,U(),w.afterSetFilter);const im=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const i=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=i,e[r+1]=i,e[r+2]=i}};w.addGetterSetter(z,"hue",0,U(),w.afterSetFilter);w.addGetterSetter(z,"saturation",0,U(),w.afterSetFilter);w.addGetterSetter(z,"luminance",0,U(),w.afterSetFilter);const sm=function(n){const e=n.data,t=e.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=this.luminance()*127,u=r*i*Math.cos(s*Math.PI/180),l=r*i*Math.sin(s*Math.PI/180),c=.299*r+.701*u+.167*l,h=.587*r-.587*u+.33*l,d=.114*r-.114*u-.497*l,m=.299*r-.299*u-.328*l,D=.587*r+.413*u+.035*l,p=.114*r-.114*u+.293*l,v=.299*r-.3*u+1.25*l,F=.587*r-.586*u-1.05*l,S=.114*r+.886*u-.2*l;let C,B,x,j;for(let W=0;W<t;W+=4)C=e[W+0],B=e[W+1],x=e[W+2],j=e[W+3],e[W+0]=c*C+h*B+d*x+o,e[W+1]=m*C+D*B+p*x+o,e[W+2]=v*C+F*B+S*x+o,e[W+3]=j},am=function(n){const e=n.data,t=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=r*i*Math.cos(s*Math.PI/180),u=r*i*Math.sin(s*Math.PI/180),l=.299*r+.701*o+.167*u,c=.587*r-.587*o+.33*u,h=.114*r-.114*o-.497*u,d=.299*r-.299*o-.328*u,m=.587*r+.413*o+.035*u,D=.114*r-.114*o+.293*u,p=.299*r-.3*o+1.25*u,v=.587*r-.586*o-1.05*u,F=.114*r+.886*o-.2*u;for(let S=0;S<t;S+=4){const C=e[S+0],B=e[S+1],x=e[S+2],j=e[S+3];e[S+0]=l*C+c*B+h*x,e[S+1]=d*C+m*B+D*x,e[S+2]=p*C+v*B+F*x,e[S+3]=j}};w.addGetterSetter(z,"hue",0,U(),w.afterSetFilter);w.addGetterSetter(z,"saturation",0,U(),w.afterSetFilter);w.addGetterSetter(z,"value",0,U(),w.afterSetFilter);const om=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]},um=function(n,e,t){const r=n.data,i=e.data,s=n.width,o=n.height,u=t.polarCenterX||s/2,l=t.polarCenterY||o/2;let c=Math.sqrt(u*u+l*l),h=s-u,d=o-l;const m=Math.sqrt(h*h+d*d);c=m>c?m:c;const D=o,p=s,v=360/p*Math.PI/180;for(let F=0;F<p;F+=1){const S=Math.sin(F*v),C=Math.cos(F*v);for(let B=0;B<D;B+=1){h=Math.floor(u+c*B/D*C),d=Math.floor(l+c*B/D*S);let x=(d*s+h)*4;const j=r[x+0],W=r[x+1],Z=r[x+2],J=r[x+3];x=(F+B*s)*4,i[x+0]=j,i[x+1]=W,i[x+2]=Z,i[x+3]=J}}},lm=function(n,e,t){const r=n.data,i=e.data,s=n.width,o=n.height,u=t.polarCenterX||s/2,l=t.polarCenterY||o/2;let c=Math.sqrt(u*u+l*l),h=s-u,d=o-l;const m=Math.sqrt(h*h+d*d);c=m>c?m:c;const D=o,p=s,v=0;let F,S;for(h=0;h<s;h+=1)for(d=0;d<o;d+=1){const C=h-u,B=d-l,x=Math.sqrt(C*C+B*B)*D/c;let j=(Math.atan2(B,C)*180/Math.PI+360+v)%360;j=j*p/360,F=Math.floor(j),S=Math.floor(x);let W=(S*s+F)*4;const Z=r[W+0],J=r[W+1],K=r[W+2],ae=r[W+3];W=(d*s+h)*4,i[W+0]=Z,i[W+1]=J,i[W+2]=K,i[W+3]=ae}},cm=function(n){const e=n.width,t=n.height;let r,i,s,o,u,l,c,h,d,m,D=Math.round(this.kaleidoscopePower());const p=Math.round(this.kaleidoscopeAngle()),v=Math.floor(e*(p%360)/360);if(D<1)return;const F=M.createCanvasElement();F.width=e,F.height=t;const S=F.getContext("2d").getImageData(0,0,e,t);M.releaseCanvas(F),um(n,S,{polarCenterX:e/2,polarCenterY:t/2});let C=e/Math.pow(2,D);for(;C<=8;)C=C*2,D-=1;C=Math.ceil(C);let B=C,x=0,j=B,W=1;for(v+C>e&&(x=B,j=0,W=-1),i=0;i<t;i+=1)for(r=x;r!==j;r+=W)s=Math.round(r+v)%e,d=(e*i+s)*4,u=S.data[d+0],l=S.data[d+1],c=S.data[d+2],h=S.data[d+3],m=(e*i+r)*4,S.data[m+0]=u,S.data[m+1]=l,S.data[m+2]=c,S.data[m+3]=h;for(i=0;i<t;i+=1)for(B=Math.floor(C),o=0;o<D;o+=1){for(r=0;r<B+1;r+=1)d=(e*i+r)*4,u=S.data[d+0],l=S.data[d+1],c=S.data[d+2],h=S.data[d+3],m=(e*i+B*2-r-1)*4,S.data[m+0]=u,S.data[m+1]=l,S.data[m+2]=c,S.data[m+3]=h;B*=2}lm(S,n,{})};w.addGetterSetter(z,"kaleidoscopePower",2,U(),w.afterSetFilter);w.addGetterSetter(z,"kaleidoscopeAngle",0,U(),w.afterSetFilter);function Si(n,e,t){let r=(t*n.width+e)*4;const i=[];return i.push(n.data[r++],n.data[r++],n.data[r++],n.data[r++]),i}function Pr(n,e){return Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2))}function hm(n){const e=[0,0,0];for(let t=0;t<n.length;t++)e[0]+=n[t][0],e[1]+=n[t][1],e[2]+=n[t][2];return e[0]/=n.length,e[1]/=n.length,e[2]/=n.length,e}function dm(n,e){const t=Si(n,0,0),r=Si(n,n.width-1,0),i=Si(n,0,n.height-1),s=Si(n,n.width-1,n.height-1),o=e||10;if(Pr(t,r)<o&&Pr(r,s)<o&&Pr(s,i)<o&&Pr(i,t)<o){const u=hm([r,t,s,i]),l=[];for(let c=0;c<n.width*n.height;c++){const h=Pr(u,[n.data[c*4],n.data[c*4+1],n.data[c*4+2]]);l[c]=h<o?0:255}return l}}function fm(n,e){for(let t=0;t<n.width*n.height;t++)n.data[4*t+3]=e[t]}function mm(n,e,t){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,p=l+m-s;if(D>=0&&D<t&&p>=0&&p<e){const v=D*e+p,F=r[d*i+m];h+=n[v]*F}}o[c]=h===2040?255:0}return o}function pm(n,e,t){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,p=l+m-s;if(D>=0&&D<t&&p>=0&&p<e){const v=D*e+p,F=r[d*i+m];h+=n[v]*F}}o[c]=h>=1020?255:0}return o}function gm(n,e,t){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,p=l+m-s;if(D>=0&&D<t&&p>=0&&p<e){const v=D*e+p,F=r[d*i+m];h+=n[v]*F}}o[c]=h}return o}const _m=function(n){const e=this.threshold();let t=dm(n,e);return t&&(t=mm(t,n.width,n.height),t=pm(t,n.width,n.height),t=gm(t,n.width,n.height),fm(n,t)),n};w.addGetterSetter(z,"threshold",0,U(),w.afterSetFilter);const Dm=function(n){const e=this.noise()*255,t=n.data,r=t.length,i=e/2;for(let s=0;s<r;s+=4)t[s+0]+=i-2*i*Math.random(),t[s+1]+=i-2*i*Math.random(),t[s+2]+=i-2*i*Math.random()};w.addGetterSetter(z,"noise",.2,U(),w.afterSetFilter);const bm=function(n){let e=Math.ceil(this.pixelSize()),t=n.width,r=n.height,i=Math.ceil(t/e),s=Math.ceil(r/e),o=n.data;if(e<=0){M.error("pixelSize value can not be <= 0");return}for(let u=0;u<i;u+=1)for(let l=0;l<s;l+=1){let c=0,h=0,d=0,m=0;const D=u*e,p=D+e,v=l*e,F=v+e;let S=0;for(let C=D;C<p;C+=1)if(!(C>=t))for(let B=v;B<F;B+=1){if(B>=r)continue;const x=(t*B+C)*4;c+=o[x+0],h+=o[x+1],d+=o[x+2],m+=o[x+3],S+=1}c=c/S,h=h/S,d=d/S,m=m/S;for(let C=D;C<p;C+=1)if(!(C>=t))for(let B=v;B<F;B+=1){if(B>=r)continue;const x=(t*B+C)*4;o[x+0]=c,o[x+1]=h,o[x+2]=d,o[x+3]=m}}};w.addGetterSetter(z,"pixelSize",8,U(),w.afterSetFilter);const ym=function(n){const e=Math.round(this.levels()*254)+1,t=n.data,r=t.length,i=255/e;for(let s=0;s<r;s+=1)t[s]=Math.floor(t[s]/i)*i};w.addGetterSetter(z,"levels",.5,U(),w.afterSetFilter);const Sm=function(n){const e=n.data,t=e.length,r=this.red(),i=this.green(),s=this.blue();for(let o=0;o<t;o+=4){const u=(.34*e[o]+.5*e[o+1]+.16*e[o+2])/255;e[o]=u*r,e[o+1]=u*i,e[o+2]=u*s,e[o+3]=e[o+3]}};w.addGetterSetter(z,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});w.addGetterSetter(z,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});w.addGetterSetter(z,"blue",0,Wu,w.afterSetFilter);const vm=function(n){const e=n.data,t=e.length,r=this.red(),i=this.green(),s=this.blue(),o=this.alpha();for(let u=0;u<t;u+=4){const l=1-o;e[u]=r*o+e[u]*l,e[u+1]=i*o+e[u+1]*l,e[u+2]=s*o+e[u+2]*l}};w.addGetterSetter(z,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});w.addGetterSetter(z,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});w.addGetterSetter(z,"blue",0,Wu,w.afterSetFilter);w.addGetterSetter(z,"alpha",1,function(n){return this._filterUpToDate=!1,n>1?1:n<0?0:n});const wm=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const i=e[r+0],s=e[r+1],o=e[r+2];e[r+0]=Math.min(255,i*.393+s*.769+o*.189),e[r+1]=Math.min(255,i*.349+s*.686+o*.168),e[r+2]=Math.min(255,i*.272+s*.534+o*.131)}},Em=function(n){const t=n.data;for(let r=0;r<t.length;r+=4){const i=t[r],s=t[r+1],o=t[r+2];.2126*i+.7152*s+.0722*o>=128&&(t[r]=255-i,t[r+1]=255-s,t[r+2]=255-o)}return n},Am=function(n){const e=this.threshold()*255,t=n.data,r=t.length;for(let i=0;i<r;i+=1)t[i]=t[i]<e?0:255};w.addGetterSetter(z,"threshold",.5,U(),w.afterSetFilter);const ve=Lo.Util._assign(Lo,{Arc:gn,Arrow:qn,Circle:gr,Ellipse:Cn,Image:Tt,Label:ma,Tag:Jn,Line:_n,Path:Ge,Rect:Zr,RegularPolygon:Mn,Ring:Qn,Sprite:Jt,Star:xn,Text:ze,TextPath:nt,Transformer:we,Wedge:Dn,Filters:{Blur:Z1,Brightness:em,Brighten:$1,Contrast:tm,Emboss:nm,Enhance:rm,Grayscale:im,HSL:sm,HSV:am,Invert:om,Kaleidoscope:cm,Mask:_m,Noise:Dm,Pixelate:bm,Posterize:ym,RGB:Sm,RGBA:vm,Sepia:wm,Solarize:Em,Threshold:Am}});function Bi(n){if(!ve.autoDrawEnabled){const e=n.getLayer()||n.getStage();e&&e.batchDraw()}}const Ko={key:!0,style:!0,elm:!0,isRootInsert:!0},ds=".vue-konva-event";function yl(n,e,t,r){const i=n.__konvaNode,s={};let o=!1;for(let u in t){if(Ko.hasOwnProperty(u))continue;const l=u.slice(0,2)==="on",c=t[u]!==e[u];if(l&&c){let h=u.slice(2).toLowerCase();h.slice(0,7)==="content"&&(h="content"+h.slice(7,1).toUpperCase()+h.slice(8)),i?.off(h+ds,t[u])}!e.hasOwnProperty(u)&&i?.setAttr(u,void 0)}for(let u in e){if(Ko.hasOwnProperty(u))continue;let l=u.slice(0,2)==="on";const c=t[u]!==e[u];if(l&&c){let h=u.slice(2).toLowerCase();h.slice(0,7)==="content"&&(h="content"+h.slice(7,1).toUpperCase()+h.slice(8)),e[u]&&(i?.off(h+ds),i?.on(h+ds,e[u]))}!l&&(e[u]!==t[u]||r&&e[u]!==i?.getAttr(u))&&(o=!0,s[u]=e[u])}o&&i&&(i.setAttrs(s),Bi(i))}const Fm="V";function Tm(n){function e(t){return t?.__konvaNode?t:t?.parent?e(t.parent):(console.error("vue-konva error: Can not find parent node"),null)}return e(n.parent)}function Sl(n){return n.component?n.component.__konvaNode||Sl(n.component.subTree):null}function Pm(n){const{el:e,component:t}=n,r=Sl(n);if(e?.tagName&&t&&!r){const i=e.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${i}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return r}function Cm(n){const e=i=>!!i&&typeof i=="object"&&"component"in i,t=i=>Array.isArray(i),r=i=>e(i)?[i,...r(i.children)]:t(i)?i.flatMap(r):[];return r(n.children)}function vl(n,e){const t=Cm(n),r=[];t.forEach(s=>{const o=Pm(s);o&&r.push(o)});let i=!1;r.forEach((s,o)=>{s.getZIndex()!==o&&(s.setZIndex(o),i=!0)}),i&&Bi(e)}const Mm=ve.default?.Stage||ve.Stage,xm=Ue({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(n,{attrs:e,slots:t,expose:r}){const i=tu();if(!i)return;const s=eu({}),o=tt(null),u=new Mm({width:n.config.width,height:n.config.height,container:document.createElement("div")});i.__konvaNode=u,h();function l(){return i?.__konvaNode}function c(){return i?.__konvaNode}function h(){if(!i)return;const d=s||{},m={...e,...n.config};yl(i,m,d,n.__useStrictMode),Object.assign(s,m)}return Xn(()=>{o.value&&(o.value.innerHTML="",u.container(o.value)),h()}),nu(()=>{h(),vl(i.subTree,u)}),Hs(()=>{u.destroy()}),dn(()=>n.config,h,{deep:!0}),r({getStage:c,getNode:l}),()=>He("div",{ref:o,style:e?.style},t.default?.())}}),Bm=".vue-konva-event",km={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function Ye(n,e){return Ue({name:n,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(t,{attrs:r,slots:i,expose:s}){const o=tu();if(!o)return;const u=eu({}),l=new e;o.__konvaNode=l,o.vnode.__konvaNode=l,d();function c(){return o?.__konvaNode}function h(){return o?.__konvaNode}function d(){if(!o)return;const D={};for(const F in o?.vnode.props)F.slice(0,2)==="on"&&(D[F]=o.vnode.props[F]);const p=u||{},v={...r,...t.config,...D};yl(o,v,p,t.__useStrictMode),Object.assign(u,v)}Xn(()=>{const D=Tm(o)?.__konvaNode;D&&"add"in D&&D.add(l),Bi(l)}),Nc(()=>{Bi(l),l.destroy(),l.off(Bm)}),nu(()=>{d(),vl(o.subTree,l)}),dn(()=>t.config,d,{deep:!0}),s({getStage:h,getNode:c});const m=km.hasOwnProperty(n);return()=>m?He("template",{},i.default?.()):null}})}const qe=ve.default||ve,Rm=Ye("Arc",qe.Arc),Lm=Ye("Arrow",qe.Arrow),Om=Ye("Circle",qe.Circle),Im=Ye("Ellipse",qe.Ellipse),Nm=Ye("FastLayer",qe.FastLayer),Gm=Ye("Group",qe.Group),Hm=Ye("Image",qe.Image),jm=Ye("Label",qe.Label),Vm=Ye("Layer",qe.Layer),Wm=Ye("Line",qe.Line),zm=Ye("Path",qe.Path),Um=Ye("Rect",qe.Rect),Xm=Ye("RegularPolygon",qe.RegularPolygon),Km=Ye("Ring",qe.Ring),Ym=Ye("Shape",qe.Shape),qm=Ye("Sprite",qe.Sprite),Jm=Ye("Star",qe.Star),Qm=Ye("Tag",qe.Tag),Zm=Ye("Text",qe.Text),$m=Ye("TextPath",qe.TextPath),ep=Ye("Transformer",qe.Transformer),tp=Ye("Wedge",qe.Wedge),np=Object.freeze(Object.defineProperty({__proto__:null,Arc:Rm,Arrow:Lm,Circle:Om,Ellipse:Im,FastLayer:Nm,Group:Gm,Image:Hm,Label:jm,Layer:Vm,Line:Wm,Path:zm,Rect:Um,RegularPolygon:Xm,Ring:Km,Shape:Ym,Sprite:qm,Star:Jm,Tag:Qm,Text:Zm,TextPath:$m,Transformer:ep,Wedge:tp},Symbol.toStringTag,{value:"Module"})),rp={install:(n,e)=>{const t=e?.prefix||Fm,r=e?.customNodes?Object.entries(e.customNodes).map(([i,s])=>Ye(i,s)):[];[xm,...Object.values(np),...r].forEach(i=>{n.component(`${t}${i.name}`,i)})}},ip=/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$/,Yo=Ue({name:"JsonString",props:{jsonValue:{type:String,required:!0}},setup(n){const e=tt(!0),t=tt(!1),r=tt(null),i=tt(null);Xn(()=>{r.value&&i.value&&r.value.offsetHeight>i.value.offsetHeight&&(t.value=!0)});const s=()=>{e.value=!e.value};return()=>{const o=n.jsonValue,u=ip.test(o);let l;!e.value&&t.value?l=He("span",{class:{"jv-ellipsis":!0},onClick:s},"..."):u?l=He("span",{class:{"jv-item":!0,"jv-string":!0},ref:r},[He("span",null,'"'),He("a",{href:o,target:"_blank",class:"jv-link"},o),He("span",null,'"')]):l=He("span",{class:{"jv-item":!0,"jv-string":!0},ref:r},`"${o}"`);const c=[];return t.value&&c.push(He("span",{class:{"jv-toggle":!0,open:e.value},onClick:s})),c.push(He("span",{class:{"jv-holder-node":!0},ref:i})),c.push(l),He("span",{},c)}}}),sp={class:Nt(["jv-item","jv-undefined"])},ap=Ue({__name:"json-undefined",props:{jsonValue:{type:null,default:void 0}},setup(n){const e=n,t=Ht(()=>e.jsonValue===null?"null":"undefined");return(r,i)=>(We(),pt("span",sp,an(t.value),1))}}),op=Ue({__name:"json-number",props:{jsonValue:{type:Number,required:!0}},setup(n){const e=n,t=Ht(()=>Number.isInteger(e.jsonValue));return(r,i)=>(We(),pt("span",{class:Nt(["jv-item","jv-number",t.value?"jv-number-integer":"jv-number-float"])},an(n.jsonValue.toString()),3))}}),up={class:Nt(["jv-item","jv-boolean"])},lp=Ue({__name:"json-boolean",props:{jsonValue:{type:Boolean,required:!0}},setup(n){return(e,t)=>(We(),pt("span",up,an(n.jsonValue.toString()),1))}}),cp=Ue({name:"JsonObject",props:{jsonValue:{type:Object,required:!0},keyName:{type:String,default:""},depth:{type:Number,default:0},expand:Boolean,sort:Boolean,previewMode:Boolean},emits:["update:expand"],setup(n,{emit:e}){const t=tt({});let r=null;const i=l=>{setTimeout(()=>{t.value=l},0)};dn(()=>n.jsonValue,l=>{i(l)},{immediate:!0,deep:!0});const s=Ht(()=>{if(!n.sort)return t.value;const l=Object.keys(t.value).sort(),c={};return l.forEach(h=>{c[h]=t.value[h]}),c}),o=()=>{if(r)try{r.dispatchEvent(new Event("resized"))}catch{const l=document.createEvent("Event");l.initEvent("resized",!0,!1),r.dispatchEvent(l)}},u=()=>{e("update:expand",!n.expand),o()};return()=>{const l=[];if(l.push(He("span",{class:["jv-item","jv-object"]},"{")),n.expand){for(const c in s.value)if(s.value.hasOwnProperty(c)){const h=s.value[c];l.push(He(pa,{key:c,sort:n.sort,keyName:c,depth:n.depth+1,value:h,previewMode:n.previewMode}))}}return!n.expand&&Object.keys(t.value).length>0&&l.push(He("span",{class:"jv-ellipsis",onClick:u,title:`click to reveal object content (keys: ${Object.keys(s.value).join(", ")})`},"...")),l.push(He("span",{class:["jv-item","jv-object"]},"}")),He("span",{ref:c=>{r=c}},l)}}}),hp=Ue({name:"JsonArray",props:{jsonValue:{type:Array,required:!0},keyName:{type:String,default:""},depth:{type:Number,default:0},sort:Boolean,expand:Boolean,previewMode:Boolean},emits:["update:expand"],setup(n,{emit:e}){const t=tt([]);let r=null;const i=(o,u=0)=>{u===0&&(t.value=[]),setTimeout(()=>{o&&o.length>u&&(t.value.push(o[u]),i(o,u+1))},0)};dn(()=>n.jsonValue,o=>{i(o)},{immediate:!0,deep:!0});const s=()=>{if(e("update:expand",!n.expand),r)try{r.dispatchEvent(new Event("resized"))}catch{const o=document.createEvent("Event");o.initEvent("resized",!0,!1),r.dispatchEvent(o)}};return()=>{const o=[];return!n.previewMode&&!n.keyName&&o.push(He("span",{class:{"jv-toggle":!0,open:!!n.expand},onClick:s})),o.push(He("span",{class:["jv-item","jv-array"]},"[")),n.expand&&t.value.forEach((u,l)=>{o.push(He(pa,{key:l,sort:n.sort,depth:n.depth+1,value:u,previewMode:n.previewMode}))}),!n.expand&&t.value.length>0&&o.push(He("span",{class:"jv-ellipsis",onClick:s,title:`click to reveal ${t.value.length} hidden items`},"...")),o.push(He("span",{class:["jv-item","jv-array"]},"]")),He("span",{ref:u=>{r=u}},o)}}}),dp=["title"],fp=Ue({__name:"json-function",props:{jsonValue:{type:Function,required:!0}},setup(n){return(e,t)=>(We(),pt("span",{class:Nt(["jv-item","jv-function"]),title:n.jsonValue.toString()}," <function> ",8,dp))}}),mp={class:Nt(["jv-item","jv-string"])},pp=Ue({__name:"json-date",props:{jsonValue:{type:Date,required:!0}},setup(n){const e=n,t=Ds("timeformat",i=>i.toLocaleString()),r=Ht(()=>t(e.jsonValue));return(i,s)=>(We(),pt("span",mp,' "'+an(r.value)+'" ',1))}}),gp={class:Nt(["jv-item","jv-regexp"])},_p=Ue({__name:"json-regexp",props:{jsonValue:{type:RegExp,required:!0}},setup(n){return(e,t)=>(We(),pt("span",gp,an(n.jsonValue.toString()),1))}}),pa=Ue({name:"JsonBox",props:{value:{type:[Object,Array,String,Number,Boolean,Function,Date],default:null},keyName:{type:String,default:""},sort:Boolean,depth:{type:Number,default:0},previewMode:Boolean},setup(n){const e=Ds("expandDepth",1/0),t=Ds("keyClick",()=>{}),r=tt(!0);let i=null;Xn(()=>{r.value=n.previewMode||n.depth<e});const s=()=>{if(r.value=!r.value,i)try{i.dispatchEvent(new Event("resized"))}catch{const o=document.createEvent("Event");o.initEvent("resized",!0,!1),i.dispatchEvent(o)}};return()=>{const o=[];let u;n.value===null||n.value===void 0?u=ap:Array.isArray(n.value)?u=hp:n.value instanceof Date?u=pp:n.value instanceof RegExp?u=_p:typeof n.value=="object"?u=cp:typeof n.value=="number"?u=op:typeof n.value=="string"?u=Yo:typeof n.value=="boolean"?u=lp:typeof n.value=="function"?u=fp:u=Yo;const l=n.value&&(Array.isArray(n.value)||typeof n.value=="object"&&!(n.value instanceof Date)&&!(n.value instanceof RegExp));return!n.previewMode&&l&&!(n.value instanceof RegExp)&&o.push(He("span",{class:{"jv-toggle":!0,open:!!r.value},onClick:s})),n.keyName&&o.push(He("span",{class:"jv-key",onClick:()=>{t&&t(n.keyName)}},`${n.keyName}:`)),o.push(He(u,{class:"jv-push",jsonValue:n.value,keyName:n.keyName,sort:n.sort,depth:n.depth,expand:r.value,previewMode:n.previewMode,"onUpdate:expand":c=>{r.value=c}})),He("div",{class:{"jv-node":!0,"jv-key-node":!!n.keyName&&!l,toggle:!n.previewMode&&l},ref:c=>{i=c}},o)}}});function Dp(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Bs={exports:{}};var bp=Bs.exports,qo;function yp(){return qo||(qo=1,(function(n,e){(function(t,r){n.exports=r()})(bp,function(){return(function(){var t={686:(function(s,o,u){u.d(o,{default:function(){return be}});var l=u(279),c=u.n(l),h=u(370),d=u.n(h),m=u(817),D=u.n(m);function p(Q){try{return document.execCommand(Q)}catch{return!1}}var v=function(Q){var X=D()(Q);return p("cut"),X},F=v;function S(Q){var X=document.documentElement.getAttribute("dir")==="rtl",oe=document.createElement("textarea");oe.style.fontSize="12pt",oe.style.border="0",oe.style.padding="0",oe.style.margin="0",oe.style.position="absolute",oe.style[X?"right":"left"]="-9999px";var te=window.pageYOffset||document.documentElement.scrollTop;return oe.style.top="".concat(te,"px"),oe.setAttribute("readonly",""),oe.value=Q,oe}var C=function(Q,X){var oe=S(Q);X.container.appendChild(oe);var te=D()(oe);return p("copy"),oe.remove(),te},B=function(Q){var X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body},oe="";return typeof Q=="string"?oe=C(Q,X):Q instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(Q?.type)?oe=C(Q.value,X):(oe=D()(Q),p("copy")),oe},x=B;function j(Q){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?j=function(X){return typeof X}:j=function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},j(Q)}var W=function(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},X=Q.action,oe=X===void 0?"copy":X,te=Q.container,Ae=Q.target,rt=Q.text;if(oe!=="copy"&&oe!=="cut")throw new Error('Invalid "action" value, use either "copy" or "cut"');if(Ae!==void 0)if(Ae&&j(Ae)==="object"&&Ae.nodeType===1){if(oe==="copy"&&Ae.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if(oe==="cut"&&(Ae.hasAttribute("readonly")||Ae.hasAttribute("disabled")))throw new Error(`Invalid "target" attribute. You can't cut text from elements with "readonly" or "disabled" attributes`)}else throw new Error('Invalid "target" value, use a valid Element');if(rt)return x(rt,{container:te});if(Ae)return oe==="cut"?F(Ae):x(Ae,{container:te})},Z=W;function J(Q){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?J=function(X){return typeof X}:J=function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},J(Q)}function K(Q,X){if(!(Q instanceof X))throw new TypeError("Cannot call a class as a function")}function ae(Q,X){for(var oe=0;oe<X.length;oe++){var te=X[oe];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(Q,te.key,te)}}function le(Q,X,oe){return X&&ae(Q.prototype,X),oe&&ae(Q,oe),Q}function _(Q,X){if(typeof X!="function"&&X!==null)throw new TypeError("Super expression must either be null or a function");Q.prototype=Object.create(X&&X.prototype,{constructor:{value:Q,writable:!0,configurable:!0}}),X&&T(Q,X)}function T(Q,X){return T=Object.setPrototypeOf||function(oe,te){return oe.__proto__=te,oe},T(Q,X)}function A(Q){var X=I();return function(){var oe=k(Q),te;if(X){var Ae=k(this).constructor;te=Reflect.construct(oe,arguments,Ae)}else te=oe.apply(this,arguments);return y(this,te)}}function y(Q,X){return X&&(J(X)==="object"||typeof X=="function")?X:O(Q)}function O(Q){if(Q===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Q}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function k(Q){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(X){return X.__proto__||Object.getPrototypeOf(X)},k(Q)}function q(Q,X){var oe="data-clipboard-".concat(Q);if(X.hasAttribute(oe))return X.getAttribute(oe)}var ge=(function(Q){_(oe,Q);var X=A(oe);function oe(te,Ae){var rt;return K(this,oe),rt=X.call(this),rt.resolveOptions(Ae),rt.listenClick(te),rt}return le(oe,[{key:"resolveOptions",value:function(){var te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.action=typeof te.action=="function"?te.action:this.defaultAction,this.target=typeof te.target=="function"?te.target:this.defaultTarget,this.text=typeof te.text=="function"?te.text:this.defaultText,this.container=J(te.container)==="object"?te.container:document.body}},{key:"listenClick",value:function(te){var Ae=this;this.listener=d()(te,"click",function(rt){return Ae.onClick(rt)})}},{key:"onClick",value:function(te){var Ae=te.delegateTarget||te.currentTarget,rt=this.action(Ae)||"copy",Bn=Z({action:rt,container:this.container,target:this.target(Ae),text:this.text(Ae)});this.emit(Bn?"success":"error",{action:rt,text:Bn,trigger:Ae,clearSelection:function(){Ae&&Ae.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(te){return q("action",te)}},{key:"defaultTarget",value:function(te){var Ae=q("target",te);if(Ae)return document.querySelector(Ae)}},{key:"defaultText",value:function(te){return q("text",te)}},{key:"destroy",value:function(){this.listener.destroy()}}],[{key:"copy",value:function(te){var Ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{container:document.body};return x(te,Ae)}},{key:"cut",value:function(te){return F(te)}},{key:"isSupported",value:function(){var te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["copy","cut"],Ae=typeof te=="string"?[te]:te,rt=!!document.queryCommandSupported;return Ae.forEach(function(Bn){rt=rt&&!!document.queryCommandSupported(Bn)}),rt}}]),oe})(c()),be=ge}),828:(function(s){var o=9;if(typeof Element<"u"&&!Element.prototype.matches){var u=Element.prototype;u.matches=u.matchesSelector||u.mozMatchesSelector||u.msMatchesSelector||u.oMatchesSelector||u.webkitMatchesSelector}function l(c,h){for(;c&&c.nodeType!==o;){if(typeof c.matches=="function"&&c.matches(h))return c;c=c.parentNode}}s.exports=l}),438:(function(s,o,u){var l=u(828);function c(m,D,p,v,F){var S=d.apply(this,arguments);return m.addEventListener(p,S,F),{destroy:function(){m.removeEventListener(p,S,F)}}}function h(m,D,p,v,F){return typeof m.addEventListener=="function"?c.apply(null,arguments):typeof p=="function"?c.bind(null,document).apply(null,arguments):(typeof m=="string"&&(m=document.querySelectorAll(m)),Array.prototype.map.call(m,function(S){return c(S,D,p,v,F)}))}function d(m,D,p,v){return function(F){F.delegateTarget=l(F.target,D),F.delegateTarget&&v.call(m,F)}}s.exports=h}),879:(function(s,o){o.node=function(u){return u!==void 0&&u instanceof HTMLElement&&u.nodeType===1},o.nodeList=function(u){var l=Object.prototype.toString.call(u);return u!==void 0&&(l==="[object NodeList]"||l==="[object HTMLCollection]")&&"length"in u&&(u.length===0||o.node(u[0]))},o.string=function(u){return typeof u=="string"||u instanceof String},o.fn=function(u){var l=Object.prototype.toString.call(u);return l==="[object Function]"}}),370:(function(s,o,u){var l=u(879),c=u(438);function h(p,v,F){if(!p&&!v&&!F)throw new Error("Missing required arguments");if(!l.string(v))throw new TypeError("Second argument must be a String");if(!l.fn(F))throw new TypeError("Third argument must be a Function");if(l.node(p))return d(p,v,F);if(l.nodeList(p))return m(p,v,F);if(l.string(p))return D(p,v,F);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function d(p,v,F){return p.addEventListener(v,F),{destroy:function(){p.removeEventListener(v,F)}}}function m(p,v,F){return Array.prototype.forEach.call(p,function(S){S.addEventListener(v,F)}),{destroy:function(){Array.prototype.forEach.call(p,function(S){S.removeEventListener(v,F)})}}}function D(p,v,F){return c(document.body,p,v,F)}s.exports=h}),817:(function(s){function o(u){var l;if(u.nodeName==="SELECT")u.focus(),l=u.value;else if(u.nodeName==="INPUT"||u.nodeName==="TEXTAREA"){var c=u.hasAttribute("readonly");c||u.setAttribute("readonly",""),u.select(),u.setSelectionRange(0,u.value.length),c||u.removeAttribute("readonly"),l=u.value}else{u.hasAttribute("contenteditable")&&u.focus();var h=window.getSelection(),d=document.createRange();d.selectNodeContents(u),h.removeAllRanges(),h.addRange(d),l=h.toString()}return l}s.exports=o}),279:(function(s){function o(){}o.prototype={on:function(u,l,c){var h=this.e||(this.e={});return(h[u]||(h[u]=[])).push({fn:l,ctx:c}),this},once:function(u,l,c){var h=this;function d(){h.off(u,d),l.apply(c,arguments)}return d._=l,this.on(u,d,c)},emit:function(u){var l=[].slice.call(arguments,1),c=((this.e||(this.e={}))[u]||[]).slice(),h=0,d=c.length;for(h;h<d;h++)c[h].fn.apply(c[h].ctx,l);return this},off:function(u,l){var c=this.e||(this.e={}),h=c[u],d=[];if(h&&l)for(var m=0,D=h.length;m<D;m++)h[m].fn!==l&&h[m].fn._!==l&&d.push(h[m]);return d.length?c[u]=d:delete c[u],this}},s.exports=o,s.exports.TinyEmitter=o})},r={};function i(s){if(r[s])return r[s].exports;var o=r[s]={exports:{}};return t[s](o,o.exports,i),o.exports}return(function(){i.n=function(s){var o=s&&s.__esModule?(function(){return s.default}):(function(){return s});return i.d(o,{a:o}),o}})(),(function(){i.d=function(s,o){for(var u in o)i.o(o,u)&&!i.o(s,u)&&Object.defineProperty(s,u,{enumerable:!0,get:o[u]})}})(),(function(){i.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)}})(),i(686)})().default})})(Bs)),Bs.exports}var Sp=yp();const vp=Dp(Sp),wp=function(n,e){let t=Date.now(),r;return(...i)=>{Date.now()-t<e&&r&&clearTimeout(r),r=setTimeout(()=>{n(...i)},e),t=Date.now()}},Ep=Ue({name:"JsonViewer",components:{JsonBox:pa},props:{value:{type:[Object,Array,String,Number,Boolean,Function],required:!0},expanded:{type:Boolean,default:!1},expandDepth:{type:Number,default:1},copyable:{type:[Boolean,Object],default:!1},sort:{type:Boolean,default:!1},boxed:{type:Boolean,default:!1},theme:{type:String,default:"light"},timeformat:{type:Function,default:n=>n.toLocaleString()},previewMode:{type:Boolean,default:!1},parse:{type:Boolean,default:!1}},emits:["onKeyClick","copied"],setup(n,{emit:e}){const t=tt(!1),r=tt(!1),i=tt(n.expanded),s=tt(null),o=tt(null);ts("expandDepth",n.expandDepth),ts("timeformat",n.timeformat),ts("keyClick",p=>{e("onKeyClick",p)});const u=Ht(()=>"jv-container jv-"+n.theme+(n.boxed?" boxed":"")),l=Ht(()=>{if(typeof n.copyable=="boolean"&&!n.copyable)return{copyText:"copy",copiedText:"copied!",timeout:2e3,align:"right"};const p=n.copyable;return{copyText:p.copyText||"copy",copiedText:p.copiedText||"copied!",timeout:p.timeout||2e3,align:p.align||"right"}}),c=Ht(()=>{if(!n.parse||typeof n.value!="string")return n.value;try{return JSON.parse(n.value)}catch{return n.value}}),h=()=>{d()},d=wp(()=>{Hc(()=>{o.value&&(o.value.$el.clientHeight>=250?r.value=!0:r.value=!1)})},200),m=p=>{t.value||(t.value=!0,setTimeout(()=>{t.value=!1},l.value.timeout),e("copied",p))},D=()=>{i.value=!i.value};return dn(()=>n.value,()=>{h()}),Xn(()=>{n.boxed&&o.value&&(h(),o.value.$el.addEventListener("resized",h,!0)),n.copyable&&s.value&&new vp(s.value,{text:()=>JSON.stringify(c.value,null,2)}).on("success",m)}),{clip:s,jsonBox:o,copied:t,expandableCode:r,expandCode:i,jvClass:u,copyText:l,parseValue:c,toggleExpandCode:D}}}),Ap=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t};function Fp(n,e,t,r,i,s){const o=Ns("json-box");return We(),pt("div",{class:Nt(n.jvClass)},[n.copyable?(We(),pt("div",{key:0,class:Nt(`jv-tooltip ${n.copyText.align||"right"}`)},[Mt("span",{ref:"clip",class:Nt(["jv-button",{copied:n.copied}])},[Gc(n.$slots,"copy",{copied:n.copied},()=>[sn(an(n.copied?n.copyText.copiedText:n.copyText.copyText),1)])],2)],2)):qa("",!0),Mt("div",{class:Nt(["jv-code",{open:n.expandCode,boxed:n.boxed}])},[pe(o,{ref:"jsonBox",value:n.parseValue,sort:n.sort,"preview-mode":n.previewMode},null,8,["value","sort","preview-mode"])],2),n.expandableCode&&n.boxed?(We(),pt("div",{key:1,class:"jv-more",onClick:e[0]||(e[0]=(...u)=>n.toggleExpandCode&&n.toggleExpandCode(...u))},[Mt("span",{class:Nt(["jv-toggle",{open:!!n.expandCode}])},null,2)])):qa("",!0)],2)}const ks=Ap(Ep,[["render",Fp]]),Tp=n=>{n.component(ks.name,ks)},Pp={install:Tp},Cp={};function Mp(n,e){return null}const xp=Xi(Cp,[["render",Mp]]);function Rs(n){return{keys:n.totalColumns,od:n.difficulty.overallDifficulty,notes:n.hitObjects.map(e=>({start:e.startTime,end:e instanceof zn?e.endTime:void 0,column:e.column})),timingPoints:n.controlPoints.timingPoints.map(e=>({time:e.startTime,bpm:e.bpm,meter:e.timeSignature}))}}function Bp(n,e){return e.map(t=>({time:t.startTime,keyStates:Array.from({length:n},(r,i)=>t.actions.has(i+10))}))}const kp=["#FFFFFF","#5EAEFF","#FFEC5E","#FF3F00"],Rp={1:[0],2:[0,0],3:[0,1,0],4:[0,1,1,0],5:[0,1,2,1,0],6:[0,1,0,0,1,0],7:[0,1,0,2,0,1,0],8:[0,1,0,2,2,0,1,0],9:[3,0,1,0,2,0,1,0,3],10:[3,0,1,0,2,2,0,1,0,3],12:[3,1,0,1,0,2,2,0,1,0,1,3],14:[3,0,1,0,1,0,2,2,0,1,0,1,0,3],16:[3,1,0,1,0,1,0,2,2,0,1,0,1,0,1,3],18:[3,0,1,0,1,0,1,0,2,2,0,1,0,1,0,1,0,3]};function Lp(n=kp,e=Rp){return(t,r)=>{const i=e[t];if(!i)throw new Error(`Unsupported keys: ${t}`);const s=i[r.column];if(s===void 0)throw new Error(`Invalid column: ${r.column} for ${t}K`);return n[s]}}const Op={background:{enabled:!0,color:"#000000",createElement:Gp},note:{width:20,height:6,rx:2,bodyWidth:10,bodyColor:"#CCCCCC",colorSelector:Lp(),createElement:Hp},time:{start:"auto",end:"auto",scale:.1,direction:"up"},barline:{strokeWidth:1,color:"#85F000",createElement:jp},axis:{width:30,minute:{color:"#FF3F00",strokeWidth:2,fontSize:18},second:{color:"#FFFFFF",strokeWidth:1,fontSize:18},createElement:Wp},strip:{mode:"num",num:8,time:3e4,ratio:1.5},layout:{margin:[10,10],finalScale:1,targetSize:void 0}};function Ip(n,e){let o=e.time.start==="auto"?Math.max(0,n.timingPoints[0].time):e.time.start,u=e.time.end==="auto"?n.notes.reduce((C,B)=>Math.max(C,B.end??B.start),o):e.time.end;u+=e.note.height/e.time.scale;const l=C=>{const B=n.keys*e.note.width+e.axis.width,x=(u-o)*e.time.scale/C,j=C*B,W=x;return[B,x,j,W,e.layout.margin[0]*2+j,e.layout.margin[1]*2+W]};let c;if(e.strip.mode==="num"){if(e.strip.num===void 0)throw new Error('Strip num must be specified when strip mode is "num"');if(e.strip.num<=0||e.strip.num>50)throw new Error("Invalid strip.num: must be in (0, 50]");c=e.strip.num}else if(e.strip.mode==="time"){if(e.strip.time===void 0)throw new Error('Strip time must be specified when strip mode is "time"');if(e.strip.time<=0)throw new Error("Invalid strip.time: must be a positive number");if(c=Math.ceil((u-o)/e.strip.time),c=Math.min(c,50),c<=0)throw new Error("Computed strip number is zero; check strip.time and time range");u=o+c*e.strip.time}else if(e.strip.mode==="ratio"){if(e.strip.ratio===void 0)throw new Error('Strip ratio must be specified when strip mode is "ratio"');if(e.strip.ratio<=0)throw new Error("Invalid strip.ratio: must be a positive number");if(e.strip.ratio>20)throw new Error("strip.ratio is too large; maximum allowed is 20");c=1;let C=0;for(;c<=50;){const[,,,,B,x]=l(c),j=B/x;if(j>=e.strip.ratio){e.strip.ratio-C<j-e.strip.ratio&&(c-=1);break}c++,C=j}}else throw new Error(`Unsupported strip mode: ${e.strip.mode}`);let[h,d,m,D,p,v]=l(c),F=e.layout.finalScale,S=[...e.layout.margin];if(e.layout.targetSize){let[C,B]=e.layout.targetSize;if(C<32||C>2e4||B<32||B>2e4)throw new Error("layout.targetSize dimensions must be within [32, 20000]");const x=C/p,j=B/v;F=Math.min(F,x,j),S[0]=Math.max(S[0],(C/F-m)/2),S[1]=Math.max(S[1],(B/F-D)/2),p=S[0]*2+m,v=S[1]*2+D}return{beatmap:n,...e,time:{start:o,end:u,scale:e.time.scale,direction:e.time.direction},strip:{num:c,width:h,height:d},margin:S,totalWidth:p,totalHeight:v,finalScale:F}}function wl(n,e){const t={...n};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r],s=n[r];i!==void 0&&(typeof i=="object"&&i!==null&&!Array.isArray(i)&&typeof s=="object"&&s!==null&&!Array.isArray(s)?t[r]=wl(s,i):t[r]=i)}return t}function fs(n){return Array.from({length:n},(e,t)=>t)}function Np(n,e={}){const t=Ip(n,wl(Op,e)),r=n.notes.flatMap(d=>t.note.createElement(t,d)),i=Vp(n.timingPoints,t.time.start,t.time.end).flatMap(d=>t.barline.createElement(t,d)),s=fs(Math.floor(t.time.end/1e3)).filter(d=>d*1e3>=t.time.start).flatMap(d=>t.axis.createElement(t,d*1e3)),o=fs(t.strip.num).flatMap(d=>zp(t,d)),u=fs(t.strip.num).flatMap(d=>Up(t,d)),l=t.background.enabled?t.background.createElement(t):[],c=t.time.direction==="up"?-t.finalScale:t.finalScale,h=t.time.direction==="up"?-t.totalHeight+t.margin[1]:t.margin[1];return`<svg xmlns="http://www.w3.org/2000/svg" width="${t.totalWidth*t.finalScale}" height="${t.totalHeight*t.finalScale}">
  <defs>
    <g id="origin">
      <g id="notes">
        ${r.join(`
        `)}
      </g>
      <g id="barlines">
        ${i.join(`
        `)}
      </g>
      <g id="axis">
        ${s.join(`
        `)}
      </g>
    </g>
    <g id="clip-paths">
      ${o.join(`
      `)}
    </g>
  </defs>
  ${l.join(`
  `)}
  <g transform="scale(${t.finalScale}, ${c}) translate(${t.margin[0]}, ${h})">
    ${u.join(`
    `)}
  </g>
</svg>`}function Gp(n){return[`<rect width="100%" height="100%" fill="${n.background.color}" />`]}function Hp(n,e){const t=e.column*n.note.width,r=(e.start-n.time.start)*n.time.scale,i=r-n.note.height/2,s=n.note.width,o=n.note.colorSelector(n.beatmap.keys,e),u=[`<rect x="${t}" y="${i}" width="${s}" height="${n.note.height}" rx="${n.note.rx}" fill="${o}" />`];if(e.end){const l=t+(s-n.note.bodyWidth)/2,c=r+n.note.height/2,h=n.note.bodyWidth,d=(e.end-e.start)*n.time.scale-n.note.height,m=n.note.bodyColor??o;d>0&&u.push(`<rect x="${l}" y="${c}" width="${h}" height="${d}" fill="${m}" />`)}return u}function jp(n,e){const t=(e-n.time.start)*n.time.scale,r=n.beatmap.keys*n.note.width,i=n.barline.strokeWidth;return[`<line x1="0" y1="${t}" x2="${r}" y2="${t}" stroke="${n.barline.color}" stroke-width="${i}" />`]}function Vp(n,e,t){const r=[...n].sort((s,o)=>s.time-o.time),i=[];for(let s=0;s<r.length;s++){const o=r[s],u=s<r.length-1?r[s+1].time:t,l=6e4/o.bpm*o.meter;for(let c=o.time;c<u&&c<=t;c+=l)c>=e&&i.push(c)}return i}function Wp(n,e){const t=n.beatmap.keys*n.note.width,r=(e-n.time.start)*n.time.scale,i=Math.floor(e/6e4),s=Math.floor(e%6e4/1e3),o=s===0?n.axis.minute:n.axis.second,u=s===0?`${i}`:`${s}`,{color:l,strokeWidth:c,fontSize:h}=o,d=n.time.direction==="up"?-r:r,m=n.time.direction==="up"?"scale(1, -1)":"";return[`<line x1="${t}" y1="${r}" x2="${t+n.axis.width/5}" y2="${r}" stroke="${l}" stroke-width="${c}" />`,`<text x="${t+n.axis.width/2}" y="${d}" fill="${l}" font-size="${h}" text-anchor="middle" dominant-baseline="middle" transform="${m}">${u}</text>`]}function zp(n,e){const t=e*n.strip.height;return[`<clipPath id="strip-${e}">`,`  <rect x="0" y="${t}" width="${n.strip.width}" height="${n.strip.height}" />`,"</clipPath>"]}function Up(n,e){return[`<use href="#origin" transform="translate(${e*n.strip.width}, ${-e*n.strip.height})" clip-path="url(#strip-${e})" />`]}const Xp=["innerHTML"],Kp=Ue({__name:"ManiaSvg",props:{beatmap:{},options:{}},setup(n){const e=n,t=Ht(()=>Np(e.beatmap,e.options));return(r,i)=>(We(),pt("div",{innerHTML:t.value},null,8,Xp))}});var Yp=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,qp=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,Jp=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,ms={Space_Separator:Yp,ID_Start:qp,ID_Continue:Jp},Je={isSpaceSeparator(n){return typeof n=="string"&&ms.Space_Separator.test(n)},isIdStartChar(n){return typeof n=="string"&&(n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="$"||n==="_"||ms.ID_Start.test(n))},isIdContinueChar(n){return typeof n=="string"&&(n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"||n==="$"||n==="_"||n===""||n===""||ms.ID_Continue.test(n))},isDigit(n){return typeof n=="string"&&/[0-9]/.test(n)},isHexDigit(n){return typeof n=="string"&&/[0-9A-Fa-f]/.test(n)}};let Ls,_t,rn,ki,Tn,jt,at,ga,jr;var Qp=function(e,t){Ls=String(e),_t="start",rn=[],ki=0,Tn=1,jt=0,at=void 0,ga=void 0,jr=void 0;do at=Zp(),t2[_t]();while(at.type!=="eof");return typeof t=="function"?Os({"":jr},"",t):jr};function Os(n,e,t){const r=n[e];if(r!=null&&typeof r=="object")if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=String(i),o=Os(r,s,t);o===void 0?delete r[s]:Object.defineProperty(r,s,{value:o,writable:!0,enumerable:!0,configurable:!0})}else for(const i in r){const s=Os(r,i,t);s===void 0?delete r[i]:Object.defineProperty(r,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}return t.call(n,e,r)}let me,de,Rr,tn,Se;function Zp(){for(me="default",de="",Rr=!1,tn=1;;){Se=cn();const n=El[me]();if(n)return n}}function cn(){if(Ls[ki])return String.fromCodePoint(Ls.codePointAt(ki))}function G(){const n=cn();return n===`
`?(Tn++,jt=0):n?jt+=n.length:jt++,n&&(ki+=n.length),n}const El={default(){switch(Se){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":G();return;case"/":G(),me="comment";return;case void 0:return G(),je("eof")}if(Je.isSpaceSeparator(Se)){G();return}return El[_t]()},comment(){switch(Se){case"*":G(),me="multiLineComment";return;case"/":G(),me="singleLineComment";return}throw Ve(G())},multiLineComment(){switch(Se){case"*":G(),me="multiLineCommentAsterisk";return;case void 0:throw Ve(G())}G()},multiLineCommentAsterisk(){switch(Se){case"*":G();return;case"/":G(),me="default";return;case void 0:throw Ve(G())}G(),me="multiLineComment"},singleLineComment(){switch(Se){case`
`:case"\r":case"\u2028":case"\u2029":G(),me="default";return;case void 0:return G(),je("eof")}G()},value(){switch(Se){case"{":case"[":return je("punctuator",G());case"n":return G(),Nn("ull"),je("null",null);case"t":return G(),Nn("rue"),je("boolean",!0);case"f":return G(),Nn("alse"),je("boolean",!1);case"-":case"+":G()==="-"&&(tn=-1),me="sign";return;case".":de=G(),me="decimalPointLeading";return;case"0":de=G(),me="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":de=G(),me="decimalInteger";return;case"I":return G(),Nn("nfinity"),je("numeric",1/0);case"N":return G(),Nn("aN"),je("numeric",NaN);case'"':case"'":Rr=G()==='"',de="",me="string";return}throw Ve(G())},identifierNameStartEscape(){if(Se!=="u")throw Ve(G());G();const n=Is();switch(n){case"$":case"_":break;default:if(!Je.isIdStartChar(n))throw Jo();break}de+=n,me="identifierName"},identifierName(){switch(Se){case"$":case"_":case"":case"":de+=G();return;case"\\":G(),me="identifierNameEscape";return}if(Je.isIdContinueChar(Se)){de+=G();return}return je("identifier",de)},identifierNameEscape(){if(Se!=="u")throw Ve(G());G();const n=Is();switch(n){case"$":case"_":case"":case"":break;default:if(!Je.isIdContinueChar(n))throw Jo();break}de+=n,me="identifierName"},sign(){switch(Se){case".":de=G(),me="decimalPointLeading";return;case"0":de=G(),me="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":de=G(),me="decimalInteger";return;case"I":return G(),Nn("nfinity"),je("numeric",tn*(1/0));case"N":return G(),Nn("aN"),je("numeric",NaN)}throw Ve(G())},zero(){switch(Se){case".":de+=G(),me="decimalPoint";return;case"e":case"E":de+=G(),me="decimalExponent";return;case"x":case"X":de+=G(),me="hexadecimal";return}return je("numeric",tn*0)},decimalInteger(){switch(Se){case".":de+=G(),me="decimalPoint";return;case"e":case"E":de+=G(),me="decimalExponent";return}if(Je.isDigit(Se)){de+=G();return}return je("numeric",tn*Number(de))},decimalPointLeading(){if(Je.isDigit(Se)){de+=G(),me="decimalFraction";return}throw Ve(G())},decimalPoint(){switch(Se){case"e":case"E":de+=G(),me="decimalExponent";return}if(Je.isDigit(Se)){de+=G(),me="decimalFraction";return}return je("numeric",tn*Number(de))},decimalFraction(){switch(Se){case"e":case"E":de+=G(),me="decimalExponent";return}if(Je.isDigit(Se)){de+=G();return}return je("numeric",tn*Number(de))},decimalExponent(){switch(Se){case"+":case"-":de+=G(),me="decimalExponentSign";return}if(Je.isDigit(Se)){de+=G(),me="decimalExponentInteger";return}throw Ve(G())},decimalExponentSign(){if(Je.isDigit(Se)){de+=G(),me="decimalExponentInteger";return}throw Ve(G())},decimalExponentInteger(){if(Je.isDigit(Se)){de+=G();return}return je("numeric",tn*Number(de))},hexadecimal(){if(Je.isHexDigit(Se)){de+=G(),me="hexadecimalInteger";return}throw Ve(G())},hexadecimalInteger(){if(Je.isHexDigit(Se)){de+=G();return}return je("numeric",tn*Number(de))},string(){switch(Se){case"\\":G(),de+=$p();return;case'"':if(Rr)return G(),je("string",de);de+=G();return;case"'":if(!Rr)return G(),je("string",de);de+=G();return;case`
`:case"\r":throw Ve(G());case"\u2028":case"\u2029":n2(Se);break;case void 0:throw Ve(G())}de+=G()},start(){switch(Se){case"{":case"[":return je("punctuator",G())}me="value"},beforePropertyName(){switch(Se){case"$":case"_":de=G(),me="identifierName";return;case"\\":G(),me="identifierNameStartEscape";return;case"}":return je("punctuator",G());case'"':case"'":Rr=G()==='"',me="string";return}if(Je.isIdStartChar(Se)){de+=G(),me="identifierName";return}throw Ve(G())},afterPropertyName(){if(Se===":")return je("punctuator",G());throw Ve(G())},beforePropertyValue(){me="value"},afterPropertyValue(){switch(Se){case",":case"}":return je("punctuator",G())}throw Ve(G())},beforeArrayValue(){if(Se==="]")return je("punctuator",G());me="value"},afterArrayValue(){switch(Se){case",":case"]":return je("punctuator",G())}throw Ve(G())},end(){throw Ve(G())}};function je(n,e){return{type:n,value:e,line:Tn,column:jt}}function Nn(n){for(const e of n){if(cn()!==e)throw Ve(G());G()}}function $p(){switch(cn()){case"b":return G(),"\b";case"f":return G(),"\f";case"n":return G(),`
`;case"r":return G(),"\r";case"t":return G(),"	";case"v":return G(),"\v";case"0":if(G(),Je.isDigit(cn()))throw Ve(G());return"\0";case"x":return G(),e2();case"u":return G(),Is();case`
`:case"\u2028":case"\u2029":return G(),"";case"\r":return G(),cn()===`
`&&G(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Ve(G());case void 0:throw Ve(G())}return G()}function e2(){let n="",e=cn();if(!Je.isHexDigit(e)||(n+=G(),e=cn(),!Je.isHexDigit(e)))throw Ve(G());return n+=G(),String.fromCodePoint(parseInt(n,16))}function Is(){let n="",e=4;for(;e-- >0;){const t=cn();if(!Je.isHexDigit(t))throw Ve(G());n+=G()}return String.fromCodePoint(parseInt(n,16))}const t2={start(){if(at.type==="eof")throw Gn();ps()},beforePropertyName(){switch(at.type){case"identifier":case"string":ga=at.value,_t="afterPropertyName";return;case"punctuator":vi();return;case"eof":throw Gn()}},afterPropertyName(){if(at.type==="eof")throw Gn();_t="beforePropertyValue"},beforePropertyValue(){if(at.type==="eof")throw Gn();ps()},beforeArrayValue(){if(at.type==="eof")throw Gn();if(at.type==="punctuator"&&at.value==="]"){vi();return}ps()},afterPropertyValue(){if(at.type==="eof")throw Gn();switch(at.value){case",":_t="beforePropertyName";return;case"}":vi()}},afterArrayValue(){if(at.type==="eof")throw Gn();switch(at.value){case",":_t="beforeArrayValue";return;case"]":vi()}},end(){}};function ps(){let n;switch(at.type){case"punctuator":switch(at.value){case"{":n={};break;case"[":n=[];break}break;case"null":case"boolean":case"numeric":case"string":n=at.value;break}if(jr===void 0)jr=n;else{const e=rn[rn.length-1];Array.isArray(e)?e.push(n):Object.defineProperty(e,ga,{value:n,writable:!0,enumerable:!0,configurable:!0})}if(n!==null&&typeof n=="object")rn.push(n),Array.isArray(n)?_t="beforeArrayValue":_t="beforePropertyName";else{const e=rn[rn.length-1];e==null?_t="end":Array.isArray(e)?_t="afterArrayValue":_t="afterPropertyValue"}}function vi(){rn.pop();const n=rn[rn.length-1];n==null?_t="end":Array.isArray(n)?_t="afterArrayValue":_t="afterPropertyValue"}function Ve(n){return Ri(n===void 0?`JSON5: invalid end of input at ${Tn}:${jt}`:`JSON5: invalid character '${Al(n)}' at ${Tn}:${jt}`)}function Gn(){return Ri(`JSON5: invalid end of input at ${Tn}:${jt}`)}function Jo(){return jt-=5,Ri(`JSON5: invalid identifier character at ${Tn}:${jt}`)}function n2(n){console.warn(`JSON5: '${Al(n)}' in strings is not valid ECMAScript; consider escaping`)}function Al(n){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[n])return e[n];if(n<" "){const t=n.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return n}function Ri(n){const e=new SyntaxError(n);return e.lineNumber=Tn,e.columnNumber=jt,e}var r2=function(e,t,r){const i=[];let s="",o,u,l="",c;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(r=t.space,c=t.quote,t=t.replacer),typeof t=="function")u=t;else if(Array.isArray(t)){o=[];for(const v of t){let F;typeof v=="string"?F=v:(typeof v=="number"||v instanceof String||v instanceof Number)&&(F=String(v)),F!==void 0&&o.indexOf(F)<0&&o.push(F)}}return r instanceof Number?r=Number(r):r instanceof String&&(r=String(r)),typeof r=="number"?r>0&&(r=Math.min(10,Math.floor(r)),l="          ".substr(0,r)):typeof r=="string"&&(l=r.substr(0,10)),h("",{"":e});function h(v,F){let S=F[v];switch(S!=null&&(typeof S.toJSON5=="function"?S=S.toJSON5(v):typeof S.toJSON=="function"&&(S=S.toJSON(v))),u&&(S=u.call(F,v,S)),S instanceof Number?S=Number(S):S instanceof String?S=String(S):S instanceof Boolean&&(S=S.valueOf()),S){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof S=="string")return d(S);if(typeof S=="number")return String(S);if(typeof S=="object")return Array.isArray(S)?p(S):m(S)}function d(v){const F={"'":.1,'"':.2},S={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let C="";for(let x=0;x<v.length;x++){const j=v[x];switch(j){case"'":case'"':F[j]++,C+=j;continue;case"\0":if(Je.isDigit(v[x+1])){C+="\\x00";continue}}if(S[j]){C+=S[j];continue}if(j<" "){let W=j.charCodeAt(0).toString(16);C+="\\x"+("00"+W).substring(W.length);continue}C+=j}const B=c||Object.keys(F).reduce((x,j)=>F[x]<F[j]?x:j);return C=C.replace(new RegExp(B,"g"),S[B]),B+C+B}function m(v){if(i.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");i.push(v);let F=s;s=s+l;let S=o||Object.keys(v),C=[];for(const x of S){const j=h(x,v);if(j!==void 0){let W=D(x)+":";l!==""&&(W+=" "),W+=j,C.push(W)}}let B;if(C.length===0)B="{}";else{let x;if(l==="")x=C.join(","),B="{"+x+"}";else{let j=`,
`+s;x=C.join(j),B=`{
`+s+x+`,
`+F+"}"}}return i.pop(),s=F,B}function D(v){if(v.length===0)return d(v);const F=String.fromCodePoint(v.codePointAt(0));if(!Je.isIdStartChar(F))return d(v);for(let S=F.length;S<v.length;S++)if(!Je.isIdContinueChar(String.fromCodePoint(v.codePointAt(S))))return d(v);return v}function p(v){if(i.indexOf(v)>=0)throw TypeError("Converting circular structure to JSON5");i.push(v);let F=s;s=s+l;let S=[];for(let B=0;B<v.length;B++){const x=h(String(B),v);S.push(x!==void 0?x:"null")}let C;if(S.length===0)C="[]";else if(l==="")C="["+S.join(",")+"]";else{let B=`,
`+s,x=S.join(B);C=`[
`+s+x+`,
`+F+"]"}return i.pop(),s=F,C}};const i2={parse:Qp,stringify:r2};var s2=i2;const Fl=Ue({__name:"OptionsEditor",props:{template:{}},emits:["update"],setup(n,{emit:e}){const t=n,r=e,i=tt(null);let s=null;function o(u){try{const l=s2.parse(u.state.doc.toString());r("update",l)}catch{ru.error("Invalid JSON5 format. Please correct the errors.")}}return Xn(()=>{i.value&&(s=new Qa({extensions:[dh,fh(),Qa.domEventHandlers({blur:(u,l)=>o(l)})],parent:i.value,doc:t.template}))}),Hs(()=>{s?.destroy(),s=null}),(u,l)=>(We(),pt("div",{ref_key:"editorContainer",ref:i},null,512))}}),a2=`// JSON5, not TypeScript
{
  background: {
    /** Whether to render background */
    //enabled: true,
    /** Background color of the SVG */
    //color: '#000000',
  },
  note: {
    /** Width of each column in px */
    //width: 20,
    /** Height of regular notes in px */
    //height: 6,
    /** Corner radius in px */
    //rx: 2,
    /** Width of long note body in px */
    //bodyWidth: 10,
    /** Color of the long note body */
    //bodyColor: '#CCCCCC' as string | undefined,
  },
  time: {
    /** Start time in ms */
    //start: 'auto' as 'auto' | number,
    /** End time in ms */
    //end: 'auto' as 'auto' | number,
    /** Vertical scale: px per ms */
    //scale: 0.1,
    /** Time direction: 'up' (bottom to top) or 'down' (top to bottom) */
    //direction: 'up' as 'up' | 'down',
  },
  barline: {
    /** Stroke width of bar lines in px */
    //strokeWidth: 1,
    //color: '#85F000', // green
  },
  axis: {
    /** Width of the axis area in px */
    //width: 30,
    /** Style for labels at whole minutes (e.g., 1:00, 2:00) */
    minute: {
      //color: '#FF3F00',
      //strokeWidth: 2,
      //fontSize: 18,
    },
    /** Style for second labels */
    second: {
      //color: '#FFFFFF',
      //strokeWidth: 1,
      //fontSize: 18,
    },
  },
  strip: {
    /**
     * Layout mode for strips
     * - 'num': specify number of strips
     * - 'time': specify time duration per strip
     * - 'ratio': specify target aspect ratio (width / height) to auto-calculate strip count (approximate)
    */
    //mode: 'num' as 'num' | 'time' | 'ratio',
    /** Number of vertical strips to divide the timeline */
    //num: 8 as number | undefined,
    /** Time duration per strip in ms */
    //time: 30000 as number | undefined,
    /** Target aspect ratio (width / height), actual ratio may vary slightly */
    //ratio: 1.5 as number | undefined,
  },
  layout: {
    /**
     * Margin around the entire SVG in px [horizontal, vertical]
     * When targetSize is set, this value serves as the minimum margin
     * and will be automatically adjusted to meet the target size requirements
     */
    //margin: [10, 10] as [number, number],
    /**
     * Maximum scale factor applied to the entire SVG
     * When targetSize is set:
     * - Will be automatically reduced (if needed) to prevent content from exceeding targetSize
     * - After scaling, margin will be adjusted to exactly meet targetSize requirements
     */
    //finalScale: 1.0 as number,
    /**
     * Target size [width, height] for the final SVG
     * When set, the SVG will be adjusted to fit this size by:
     * 1. Reducing finalScale (if needed) to prevent content from exceeding targetSize
     * 2. Adjusting margin (using the margin value as minimum) to exactly meet targetSize
     */
    //targetSize: undefined as [number, number] | undefined,
  },
}`,o2=Ue({__name:"Svg",setup(n){const e=Ui(),t=oa(),r=a2;let i=tt(null),s=tt({});return dn(()=>t.selectedBeatmapMD5,async o=>{if(o){const u=await e.readBeatmap(o);i.value=Rs(u)}else i.value=null},{immediate:!0}),(o,u)=>{const l=Vs,c=js;return We(),hn(c,null,{default:Le(()=>[At(i)?(We(),pt(Li,{key:0},[pe(Kp,{beatmap:At(i),options:At(s)},null,8,["beatmap","options"]),pe(Fl,{class:"editor",template:At(r),onUpdate:u[0]||(u[0]=h=>jc(s)?s.value=h:s=h)},null,8,["template"])],64)):(We(),hn(l,{key:1,description:"Select a beatmap to view"}))]),_:1})}}}),u2=Xi(o2,[["__scopeId","data-v-4141ff72"]]);function l2(n){const e=n.notes.sort((s,o)=>s.start-o.start),t=Array.from({length:n.keys},()=>[]);for(const s of e)t[s.column].push(s);const r=t.map(()=>0),i=s=>({peek:()=>r[s]<t[s].length?t[s][r[s]]:null,pop:()=>{if(r[s]<t[s].length){const o=t[s][r[s]];return r[s]++,o}return null}});return t.map((s,o)=>i(o))}function*c2(n){if(n.length===0)return;const e=n[0].keyStates.length;let t=Array.from({length:e},()=>!1),r=n[0].time,i=0;for(;i<n.length;){const s=n[i];s.time>r?(yield{time:r,keyStates:t},r++):(yield s,t=s.keyStates,i++)}}function*h2(n,e="replay"){const t=n[0].keyStates.length,r=e==="ms"?c2(n):n;let i=Array.from({length:t},()=>!1);for(const s of r){const o={time:s.time,actions:[]};for(let u=0;u<t;u++){const l=i[u]?s.keyStates[u]?"hold":"release":s.keyStates[u]?"press":"none";o.actions.push(l)}i=s.keyStates,yield o}}const d2=[1,1,2/3,1/3,1/6,0],_a=["Perfect","Great","Good","Ok","Meh","Miss"];function f2(n,e="NM"){const t=[16,64-3*n,97-3*n,127-3*n,151-3*n,188-3*n],r=e==="EZ"?1.4:e==="HR"?1/1.4:1;return t.map(i=>i*r)}function m2(n){return n.map((e,t)=>t===0?e*1.2:t===1?e*1.1:e)}function gs(n,e){for(let t=0;t<3;t++)if(n>=-e[t]&&n<=e[t])return t;for(let t=3;t<e.length;t++)if(n>=-e[t]&&n<=e[3]-1)return t;return null}function p2(n,e){const t={...n,result:{time:0,level:5},actions:[]},r=n.end===void 0?e:m2(e);let i=!1,s=!1,o=null;const u=d=>{if(!i&&(i=n.end===void 0?d>n.start+r[3]-1:o===null&&(t.actions.length>0&&d>n.end+r[3]-1||t.actions.length===0&&d>n.start+r[3]-1),i))return t.result.time=d,t},l=d=>{if(!i)if(n.end===void 0){let m=gs(d-n.start,r);if(m!==null)return i=!0,t.result={time:d,level:m},t.actions.push(d),t}else d>=n.start-r[5]&&d<=n.end+r[3]-1&&(o=d<n.start-r[4]?n.end-1:d,t.actions.push(d))},c=d=>{if(d<-r[4])return 5;const m=gs(o-n.start,r)??4,D=Math.min(d,r[4]),p=(Math.abs(o-n.start)+Math.abs(D))/2,v=gs(p,r)??4;return Math.max(m,v,s?2:0)};return{note:n,get isProcessed(){return i},onFrame:u,onHit:l,onRelease:d=>{if(n.end===void 0||i||o===null)return;const m=d-n.end,D=c(m);if(t.result={time:d,level:D},t.actions.push(d),m<-r[4]){s=!0,o=null;return}else return i=!0,t}}}function g2(n,e){let t=null;const r=o=>{if(t===null||t.isProcessed&&o>=t.note.start){const u=n.pop();u&&(t=p2(u,e))}};return{onFrame:o=>{if(r(o),t)return t.onFrame(o)},onAction:(o,u)=>{if(r(o),t){if(u==="press")return t.onHit(o);if(u==="release")return t.onRelease(o)}}}}function _2(n,e,t="NM",r="replay"){const i=l2(n),s=f2(n.od,t),o=i.map(c=>g2(c,s)),u=h2(e,r),l=[];for(const c of u)for(let h=0;h<n.keys;h++){const d=o[h],m=d.onFrame(c.time);m&&l.push(m);const D=c.actions[h],p=d.onAction(c.time,D);p&&l.push(p)}return{method:"osu-v1",notes:l,accTable:d2,nameTable:_a}}function D2(n){const e=n.notes.length;return e===0?0:n.notes.reduce((r,i)=>r+n.accTable[i.result.level],0)/e}function b2(n){const e=n.notes.slice().sort((i,s)=>i.result.time-s.result.time);let t=0,r=0;for(const i of e)i.result.level<n.accTable.length-1?(r+=1,r>t&&(t=r)):r=0;return t}function Tl(n,e){const t={...n};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r],s=n[r];i!==void 0&&(typeof i=="object"&&i!==null&&!Array.isArray(i)&&typeof s=="object"&&s!==null&&!Array.isArray(s)?t[r]=Tl(s,i):t[r]=i)}return t}function y2(){const n=[];return{emit:()=>n.forEach(e=>e()),subscribe:e=>(n.push(e),()=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)})}}function _s(n,e,t){return Math.min(Math.max(n,e),t)}function S2(){return{canvas:{width:"auto",height:930},background:{enabled:!0,color:"#000000",createElement:void 0},beatmap:{keys:7,od:8,duration:"auto",notes:[],timingPoints:[]},note:{width:40,height:12,rx:2,bodyWidth:20,bodyColor:"#CCCCCC",selectColor:void 0,createElement:void 0},replay:{colors:["#FF7A00","#FFD000","#00FF6A","#00D1FF","#B56BFF","#FF0000"],width:4,frames:[],mod:"NM",selectLevels:[0,1,2,3,4,5],useFrameActions:!1,createElement:void 0},barline:{strokeWidth:1,color:"#85F000",createElement:void 0},axis:{width:30,minute:{color:"#FF3F00",strokeWidth:2,fontSize:18},second:{color:"#FFFFFF",strokeWidth:1,fontSize:18},createElement:void 0},scroll:{width:80,window:{min:2e3,max:2e4,default:5e3},nps:{countTails:!0,color:"#FF99CC",createElement:void 0}},tooltip:{enabled:!0,format:void 0}}}function Qo(n){if(n.note.width==="auto"&&n.canvas.width==="auto")throw new Error('Cannot set both note.width and stage.width to "auto"');let e=n.beatmap.notes,t=6e4,r=null;if(e.length>0){const u=e.reduce((l,c)=>Math.max(l,c.end??c.start),0);t=Math.ceil(u/1e3)*1e3,n.replay.frames.length>0&&(r=_2(n.beatmap,n.replay.frames,n.replay.mod))}const i=n.note.width==="auto"?(n.canvas.width-n.scroll.width-n.axis.width)/n.beatmap.keys:n.note.width,s=n.canvas.width==="auto"?n.beatmap.keys*n.note.width+n.scroll.width+n.axis.width:n.canvas.width,o={startTime:0,endTime:n.scroll.window.default,onChange:y2()};return{...n,canvas:{...n.canvas,width:s},beatmap:{...n.beatmap,notes:e,duration:t},note:{...n.note,width:i},replay:{...n.replay,playResult:r},state:o}}function v2(n,e){if(e.destroyChildren(),n.background.enabled){n.background.createElement??=w2;const i=n.background.createElement(n);e.add(i)}const t=F2(n);e.add(t.rect),n.scroll.nps.createElement??=A2;const r=n.scroll.nps.createElement(n);e.add(r),e.add(t.group),e.batchDraw()}function w2(n){return new ve.Rect({x:0,y:0,width:n.canvas.width,height:n.canvas.height,fill:n.background.color,listening:!1})}function E2(n,e=!1){const t=Array.from({length:n.duration/1e3},()=>0);for(const r of n.notes)t[Math.floor(r.start/1e3)]++,e&&r.end!==void 0&&t[Math.floor(r.end/1e3)]++;return t}function A2(n){const e=E2(n.beatmap,n.scroll.nps.countTails),t=Math.max(...e,1),r=n.canvas.height/e.length,i=Math.min(2,r/8),s=new ve.Group({x:0,y:0});for(let o=0;o<e.length;o++){const u=e[o]/t*n.scroll.width,l=new ve.Rect({x:n.scroll.width-u,y:n.canvas.height-r*(o+1)+i/2,width:u,height:r-i,fill:n.scroll.nps.color});l.setAttr("getData",()=>({name:"NPS",time:o*1e3,nps:e[o]})),s.add(l)}return s}function Zo(n){const e=n.state.endTime-n.state.startTime,t=n.canvas.height*(e/n.beatmap.duration),r=n.canvas.height-n.state.startTime/n.beatmap.duration*n.canvas.height;return{topY:r-t,bottomY:r,height:t}}function wi(n,e,t){const r=n.beatmap.duration*(t-e)/n.canvas.height,i=n.beatmap.duration*(n.canvas.height-t)/n.canvas.height;n.state.startTime=i,n.state.endTime=i+r,n.state.onChange.emit()}function F2(n){const e=Zo(n),t=n.canvas.height*(n.scroll.window.min/n.beatmap.duration),r=n.canvas.height*(n.scroll.window.max/n.beatmap.duration),i=10,s=new ve.Group({x:0,y:0}),o=new ve.Rect({x:0,y:0,width:n.scroll.width,height:n.canvas.height,fill:"rgba(0, 0, 0, 0)"}),u=new ve.Rect({x:0,y:e.topY,width:n.scroll.width,height:e.height,fill:"rgba(255, 255, 255, 0.2)",stroke:"#FFFFFF",strokeWidth:2,draggable:!0,dragBoundFunc:function(h){return{x:this.absolutePosition().x,y:_s(h.y,0,n.canvas.height-this.height())}}});u.setAttr("getData",()=>({name:"Window",start:Math.round(n.state.startTime),end:Math.round(n.state.endTime)}));const l=new ve.Rect({x:0,y:e.topY-i/2,width:n.scroll.width,height:i,fill:"rgba(255, 255, 255, 0.5)",draggable:!0,dragBoundFunc:function(h){const d=u.y()+u.height(),m=_s(h.y+i/2,d-r,d-t);return{x:this.absolutePosition().x,y:Math.max(m,0)-i/2}}}),c=new ve.Rect({x:0,y:e.bottomY-i/2,width:n.scroll.width,height:i,fill:"rgba(255, 255, 255, 0.5)",draggable:!0,dragBoundFunc:function(h){const d=u.y(),m=_s(h.y+i/2,d+t,d+r);return{x:this.absolutePosition().x,y:Math.min(m,n.canvas.height)-i/2}}});return o.on("click",()=>{const h=o.getRelativePointerPosition();if(h){console.log(h);const{height:d}=Zo(n);let m,D;h.y<d/2?(m=Math.max(h.y-d/2,0),D=m+d):(D=Math.min(h.y+d/2,n.canvas.height),m=D-d),wi(n,m,D),u.y(m),l.y(m-i/2),c.y(D-i/2)}}),l.on("dragmove",()=>{const h=l.y()+i/2,d=u.y()+u.height(),m=d-h;u.y(h),u.height(m),wi(n,h,d)}),c.on("dragmove",()=>{const h=c.y()+i/2,d=u.y(),m=h-d;u.height(m),wi(n,d,h)}),u.on("dragmove",()=>{const h=u.y(),d=h+u.height();l.y(h-i/2),c.y(d-i/2),wi(n,h,d)}),l.on("mouseenter",()=>{document.body.style.cursor="ns-resize"}),l.on("mouseleave",()=>{document.body.style.cursor="default"}),c.on("mouseenter",()=>{document.body.style.cursor="ns-resize"}),c.on("mouseleave",()=>{document.body.style.cursor="default"}),u.on("mouseenter",()=>{document.body.style.cursor="move"}),u.on("mouseleave",()=>{document.body.style.cursor="default"}),s.add(u),s.add(l),s.add(c),{group:s,rect:o}}const T2=["#FFFFFF","#5EAEFF","#FFEC5E","#FF3F00"],P2={1:[0],2:[0,0],3:[0,1,0],4:[0,1,1,0],5:[0,1,2,1,0],6:[0,1,0,0,1,0],7:[0,1,0,2,0,1,0],8:[0,1,0,2,2,0,1,0],9:[3,0,1,0,2,0,1,0,3],10:[3,0,1,0,2,2,0,1,0,3],12:[3,1,0,1,0,2,2,0,1,0,1,3],14:[3,0,1,0,1,0,2,2,0,1,0,1,0,3],16:[3,1,0,1,0,1,0,2,2,0,1,0,1,0,1,3],18:[3,0,1,0,1,0,1,0,2,2,0,1,0,1,0,1,0,3]};function C2(n=T2,e=P2){return(t,r)=>{const i=e[t];if(!i)throw new Error(`Unsupported keys: ${t}`);const s=i[r.column];if(s===void 0)throw new Error(`Invalid column: ${r.column} for ${t}K`);return n[s]}}function $o(n,e){e.destroyChildren(),n.barline.createElement??=Pl;const t=x2(n);e.add(t),n.note.selectColor??=C2(),n.note.createElement??=Ml,n.replay.createElement??=xl;const r=k2(n);if(e.add(r),n.replay.useFrameActions){const s=O2(n);e.add(s)}n.axis.createElement??=Cl;const i=B2(n);e.add(i),e.batchDraw()}function Un(n,e){const t=n.canvas.height/(n.state.endTime-n.state.startTime);return n.canvas.height-(e-n.state.startTime)*t}function M2(n,e,t){const r=[...n].sort((s,o)=>s.time-o.time),i=[];for(let s=0;s<r.length;s++){const o=r[s],u=s<r.length-1?r[s+1].time:t,c=6e4/o.bpm*o.meter;for(let h=o.time;h<u&&h<=t;h+=c)h>=e&&i.push(h)}return i}function Pl(n,e){const t=Un(n,e);return new ve.Line({points:[0,t,n.canvas.width-n.scroll.width-n.axis.width,t],stroke:n.barline.color,strokeWidth:n.barline.strokeWidth})}function x2(n){const e=new ve.Group({x:n.scroll.width,y:0}),t=M2(n.beatmap.timingPoints,0,n.beatmap.duration);for(const r of t){if(r<n.state.startTime||r>n.state.endTime)continue;const i=Pl(n,r);e.add(i)}return e}function Cl(n,e){const t=Un(n,e),r=Math.floor(e/6e4),i=Math.floor(e%6e4/1e3),s=i===0?n.axis.minute:n.axis.second,o=i===0?`${r}`:`${i}`,u=new ve.Group,l=new ve.Line({points:[0,t,n.axis.width-s.fontSize-8,t],stroke:s.color,strokeWidth:1}),c=new ve.Text({x:n.axis.width-s.fontSize-5,y:t-s.fontSize/2,text:o,fontSize:s.fontSize,fill:s.color});return u.add(l),u.add(c),u}function B2(n){const e=n.scroll.width+n.beatmap.keys*n.note.width,t=new ve.Group({x:e,y:0});for(let r=1e3;r<n.beatmap.duration;r+=1e3){if(r<n.state.startTime||r>n.state.endTime)continue;const i=Cl(n,r);t.add(i)}return t}function Ml(n,e){const t=e.column*n.note.width,r=Un(n,e.start),i=n.note.selectColor(n.beatmap.keys,e),s=new ve.Group,o=new ve.Rect({x:t,y:r-n.note.height/2,width:n.note.width,height:n.note.height,fill:i,cornerRadius:n.note.rx});if(s.add(o),e.end){const u=Un(n,e.end),l=new ve.Rect({x:t+(n.note.width-n.note.bodyWidth)/2,y:u,width:n.note.bodyWidth,height:r-u-n.note.height/2,fill:n.note.bodyColor??i});s.add(l)}return s}function k2(n){const e=new ve.Group({x:n.scroll.width,y:0}),t=n.note.height/n.canvas.height*(n.state.endTime-n.state.startTime),r=n.replay.playResult!==null,i=r?n.replay.playResult.notes:n.beatmap.notes;for(const s of i){const o=s.end??s.start+t;if(s.start>n.state.endTime||o<n.state.startTime)continue;const u={name:"Note",start:s.start,end:s.end,result:void 0,actions:void 0},l=Ml(n,s);if(e.add(l),r){const c=s;if(n.replay.selectLevels.includes(c.result.level)){const h=xl(n,c);e.add(h)}u.result=_a[c.result.level],u.actions=c.actions}l.setAttr("getData",()=>u)}return e}function xl(n,e){const t=new ve.Group;if(e.actions.length===0)t.add(R2(n,e));else for(let r=0;r<e.actions.length;r+=2){const i={column:e.column,start:e.actions[r],end:r+1<e.actions.length?e.actions[r+1]:void 0,level:e.result.level};t.add(Bl(n,i))}return t}function R2(n,e){const t=e.end?(e.start+e.end)/2:e.start,r=new ve.Text({text:"X",x:e.column*n.note.width+n.note.width/2,y:Un(n,t),fontSize:n.note.bodyWidth,fontStyle:"bold",fill:n.replay.colors[n.replay.colors.length-1]});return r.offsetX(r.width()/2),r.offsetY(r.height()/2),r}function*L2(n){const e=n[0].keyStates.length,t=Array.from({length:e},()=>null);for(const r of n)for(let i=0;i<e;i++){const s=r.keyStates[i],o=t[i];s&&o===null?t[i]=r.time:!s&&o!==null&&(t[i]=null,yield{column:i,start:o,end:r.time,level:-1})}}function Bl(n,e){const t=e.column*n.note.width,r=Un(n,e.start),i=n.note.width/4,s=[[t+i,r,t+i*3,r]];if(e.end){const l=Un(n,e.end);s.push([t+i*2,r,t+i*2,l])}const o=new ve.Group,u=e.level!==-1?n.replay.colors[e.level]:n.replay.colors[n.replay.colors.length-1];for(const l of s){const c=new ve.Line({points:l,stroke:u,strokeWidth:n.replay.width});c.setAttr("getData",()=>({name:"Key",start:e.start,end:e.end})),o.add(c)}return o}function O2(n){const e=new ve.Group({x:n.scroll.width,y:0});if(n.replay.frames.length===0)return e;for(const t of L2(n.replay.frames))(t.end??t.start)<n.state.startTime||t.start>n.state.endTime||e.add(Bl(n,t));return e}function I2(n,e){if(e.destroyChildren(),n.tooltip.enabled){n.tooltip.format??=N2;const t=G2();e.add(t),e.batchDraw(),n.state.onChange.subscribe(()=>{t.hide()}),e.getStage()?.off("click"),e.getStage()?.on("click",r=>{const i=r.target,s=kl(i);if(s){const o=n.tooltip.format(s);t.getText().text(o);const u=e.getRelativePointerPosition();u&&t.position({x:u.x,y:u.y}),t.show()}else t.hide();e.batchDraw()})}}function kl(n){if(typeof n.getAttr=="function"){const e=n.getAttr("getData");return typeof e=="function"?e():e!==void 0?e:n.getParent()?kl(n.getParent()):null}}function N2(n){const e=t=>Object.entries(t).filter(([r,i])=>i!==void 0).reduce((r,[i,s])=>(i==="name"||i==="title"?r.unshift(`${s}`):Array.isArray(s)?s.length<=2?r.push(`${i}: [${s.join(", ")}]`):(r.push(`${i}: [`),r.push(...s.map(o=>`  ${o},`)),r.push("]")):typeof s=="object"?(r.push(`${i}: {`),r.push(...e(s).map(o=>`  ${o}`)),r.push("}")):r.push(`${i}: ${s}`),r),[]);return e(n).join(`
`)}function G2(n){const e=new ve.Label({opacity:.75,visible:!1});return e.add(new ve.Tag({fill:"#ffffff",pointerDirection:"down",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOffsetX:3,shadowOffsetY:3,shadowOpacity:.3})),e.add(new ve.Text({text:"",fontSize:14,padding:5,fill:"#000000"})),e}function H2(n){const e=new ve.Stage({container:n}),t=new ve.Layer;e.add(t);const r=new ve.Layer;e.add(r);const i=new ve.Layer;e.add(i);let s=S2(),o=Qo(s);return{setOptions:h=>{s=Tl(s,h),o=Qo(s)},render:()=>{e.width(o.canvas.width),e.height(o.canvas.height),v2(o,t),o.state.onChange.subscribe(()=>{$o(o,r)}),$o(o,r),I2(o,i)},destroy:()=>{e.destroy()},getContext:()=>o}}const j2=Ue({__name:"ManiaPanel",props:{options:{}},emits:["update"],setup(n,{emit:e}){const t=n,r=e,i=tt(null);let s=null,o=null;const u=tt(0);return dn([()=>t.options,u],([l,c])=>{s&&(s.setOptions(l),s.setOptions({canvas:{height:Math.max(c,500)}}),s.render(),r("update",s.getContext()))},{deep:!0}),Xn(()=>{const l=i.value;if(!l)return;s=H2(l);const c=()=>{i.value&&s&&(u.value=i.value.clientHeight)};c(),o=new ResizeObserver(()=>{c()}),o.observe(l)}),Hs(()=>{o?.disconnect(),o=null,s?.destroy(),s=null}),(l,c)=>(We(),pt("div",{ref_key:"panelContainer",ref:i},null,512))}}),V2=`// JSON5, not TypeScript
{
  canvas: {
    /** Total width of the canvas in px */
    // width: 'auto' as 'auto' | number,
    /** Total height of the canvas in px */
    // height: 930,
  },
  background: {
    /** Whether to render background */
    // enabled: true,
    /** Background color */
    // color: '#000000', // black
  },
  beatmap: {
    /** Number of columns (keys) */
    // keys: 7,
    /** Overall Difficulty */
    // od: 8,
    /** Duration of the beatmap in milliseconds */
    // duration: 'auto' as 'auto' | number,
  },
  note: {
    /** Width of each column in px */
    // width: 40 as 'auto' | number,
    /** Height of regular notes in px */
    // height: 12,
    /** Corner radius in px */
    // rx: 2,
    /** Width of long note body in px */
    // bodyWidth: 20,
    /** Color of the long note body */
    // bodyColor: '#CCCCCC' as string | undefined,
  },
  replay: {
    /** Colors of the replay keys */
    // colors: ['#FF7A00', '#FFD000', '#00FF6A', '#00D1FF', '#B56BFF', '#FF0000'],
    /** Width of the replay keys in px */
    // width: 4,
    /** Levels to render from note results */
    // selectLevels: [0, 1, 2, 3, 4, 5],
    /** Render key action from replay frames rather than notes result */
    // useFrameActions: false,
  },
  barline: {
    /** Stroke width of bar lines in px */
    // strokeWidth: 1,
    /** Color of the bar lines */
    // color: '#85F000', // green
  },
  axis: {
    /** Width of the axis area in px */
    // width: 30,
    /** Style for labels at whole minutes (e.g., 1:00, 2:00) */
    minute: {
      // color: '#FF3F00',
      // strokeWidth: 2,
      // fontSize: 18,
    },
    /** Style for second labels */
    second: {
      // color: '#FFFFFF',
      // strokeWidth: 1,
      // fontSize: 18,
    },
  },
  scroll: {
    /** Width of the scrollbar in px */
    // width: 80,
    /** Time window for the scrollbar in milliseconds */
    window: {
      // min: 2000, // ms
      // max: 20000, // ms
      // default: 5000, // ms
    },
    /** NPS (notes-per-second) histogram rendered as the scrollbar background */
    nps: {
      /** Whether to count note tails in NPS calculation */
      // countTails: true,
      /** Color of the NPS bars */
      // color: '#FF99CC',
    },
  },
  tooltip: {
    /** Whether to show tooltips on notes */
    // enabled: true,
  },
}
`,W2=Ue({__name:"ResultTable",props:{playResult:{}},setup(n){const e=n,t=Ht(()=>{if(!e.playResult||e.playResult.notes.length===0)return null;const i=_a.map(s=>({name:s,rice:0,ln:0,total:0}));for(const s of e.playResult.notes)s.end===void 0?i[s.result.level].rice+=1:i[s.result.level].ln+=1,i[s.result.level].total+=1;return{counts:i,accuracy:D2(e.playResult),maxCombo:b2(e.playResult)}}),r=i=>`${(i*100).toFixed(2)}%`;return(i,s)=>{const o=oh,u=ah,l=lh,c=uh,h=Vs;return t.value?(We(),pt(Li,{key:0},[pe(u,{gutter:20},{default:Le(()=>[pe(At(Ja),null,{default:Le(()=>[pe(o,{title:"Accuracy",value:t.value.accuracy,formatter:r},null,8,["value"])]),_:1}),pe(At(Ja),null,{default:Le(()=>[pe(o,{title:"Max Combo(no hold ticks)",value:t.value.maxCombo},null,8,["value"])]),_:1})]),_:1}),pe(c,{data:t.value.counts,border:"","show-summary":""},{default:Le(()=>[pe(l,{prop:"name",label:"Result"}),pe(l,{prop:"rice",label:"Rice Notes"}),pe(l,{prop:"ln",label:"Long Notes"}),pe(l,{prop:"total",label:"Total"})]),_:1},8,["data"])],64)):(We(),hn(h,{key:1,description:"No results to display"}))}}}),z2=Ue({__name:"Panel",setup(n){const e=Ui(),t=aa(),r=oa(),i=V2,s=tt("options"),o=tt({}),u=Vc(null);function l(c){u.value=c,Wc(u)}return dn(()=>r.selectedBeatmapMD5,async c=>{if(!c)return;const h=await e.readBeatmap(c),d=Rs(h);o.value={beatmap:d,replay:{frames:[]}}}),dn(()=>r.selectedReplayMD5,async c=>{if(!c)return;const h=new sa,d=await e.readBeatmap(r.selectedBeatmapMD5),m=await t.readReplay(c,d),D=h.createModCombination(m.info.rawMods),p=h.applyToBeatmapWithMods(d,D);(D.has("HR")||D.has("EZ"))&&(p.difficulty.overallDifficulty=d.difficulty.overallDifficulty);const v=Rs(p),F=m.replay.frames,S=Bp(v.keys,F),C=D.has("EZ")?"EZ":D.has("HR")?"HR":"NM";o.value={beatmap:v,replay:{frames:S,mod:C}},v.notes.some(x=>x.end)&&ru({message:"Osu V1 LN support is WIP and not accurate.",type:"warning",duration:5e3,showClose:!0,grouping:!0})}),(c,h)=>{const d=ch,m=hh,D=Vs,p=js;return We(),hn(p,null,{default:Le(()=>[At(r).selectedBeatmapMD5?(We(),pt(Li,{key:0},[pe(j2,{options:o.value,onUpdate:l},null,8,["options"]),pe(m,{type:"border-card",modelValue:s.value,"onUpdate:modelValue":h[1]||(h[1]=v=>s.value=v)},{default:Le(()=>[pe(d,{label:"Options",name:"options"},{default:Le(()=>[pe(Fl,{template:At(i),onUpdate:h[0]||(h[0]=v=>o.value=v)},null,8,["template"])]),_:1}),pe(d,{label:"Stats",name:"stats"},{default:Le(()=>[pe(W2,{playResult:u.value?.replay.playResult??null},null,8,["playResult"])]),_:1}),pe(d,{label:"Context",name:"context"},{default:Le(()=>[pe(At(ks),{value:u.value??{},"expand-depth":2},null,8,["value"])]),_:1})]),_:1},8,["modelValue"])],64)):(We(),hn(D,{key:1,description:"Select a beatmap or replay to view"}))]),_:1})}}}),U2=Xi(z2,[["__scopeId","data-v-0bd9ca56"]]),X2=[{path:"/",redirect:"/panel"},{path:"/home",component:xp},{path:"/svg",component:u2},{path:"/panel",component:U2}],K2=zc({history:Uc(),routes:X2}),Rl=Xc();Rl.use(nf);const $r=Kc(Qd);$r.use(Rl);$r.use(rp);$r.use(Pp);$r.use(K2);$r.mount("#app");
