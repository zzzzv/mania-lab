import{t as Dt,ak as Fc,c as Fi,ab as Wo,x as en,y as ot,F as Be,M as ge,$ as fn,al as Cs,B as Kt,u as vt,_ as qi,z as Rn,O as Pi,P as Vo,r as qt,g as zo,a2 as jo,o as Ti,R as Uo,E as Ms,f as nr,D as Pc,h as Tc,am as Cc,an as Mc,ao as xc,ap as Bc}from"./vue-vendor-BgNlNIni.js";import{E as kc,a as Rc,g as Lc,c as Oc,b as Ic,d as Nc,u as Gc,e as Hc,f as Wc,h as Vc,i as xs,j as zc,k as jc,l as Uc,m as Bs,n as Xc,o as Na,p as Kc,q as Yc,r as qc,s as Jc,t as Qc}from"./element-plus-BEpOZisv.js";import{E as Ga,b as Zc,j as $c}from"./codemirror-Ccbez8mr.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const eh=Dt({__name:"AppMenu",setup(n){const e=Fc(),t=Fi(()=>e.path==="/"?"/panel":e.path);return(r,i)=>{const s=Wo("RouterLink"),o=Rc,u=kc;return ot(),en(u,{mode:"horizontal","default-active":t.value},{default:Be(()=>[ge(o,{index:"/home"},{default:Be(()=>[ge(s,{to:"/home"},{default:Be(()=>[...i[0]||(i[0]=[fn("Home",-1)])]),_:1})]),_:1}),ge(o,{index:"/svg"},{default:Be(()=>[ge(s,{to:"/svg"},{default:Be(()=>[...i[1]||(i[1]=[fn("SVG",-1)])]),_:1})]),_:1}),ge(o,{index:"/panel"},{default:Be(()=>[ge(s,{to:"/panel"},{default:Be(()=>[...i[2]||(i[2]=[fn("Panel",-1)])]),_:1})]),_:1})]),_:1},8,["default-active"])}}});function Ci(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function th(n,e){let t;const r=()=>{if(t)return t;const i=indexedDB.open(n);return i.onupgradeneeded=()=>i.result.createObjectStore(e),t=Ci(i),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(i,s)=>r().then(o=>s(o.transaction(e,i).objectStore(e)))}let Ji;function ks(){return Ji||(Ji=th("keyval-store","keyval")),Ji}function _i(n,e=ks()){return e("readonly",t=>Ci(t.get(n)))}function Xo(n,e,t=ks()){return t("readwrite",r=>(r.put(e,n),Ci(r.transaction)))}function Ko(n,e=ks()){return e("readwrite",t=>(t.delete(n),Ci(t.transaction)))}class Mi{comboColors=[];sliderTrackColor;sliderBorderColor;clone(){const e=new Mi;return e.comboColors=this.comboColors.map(t=>t.clone()),this.sliderTrackColor&&(e.sliderTrackColor=this.sliderTrackColor),this.sliderBorderColor&&(e.sliderBorderColor=this.sliderBorderColor),e}}class Jn{static BASE_DIFFICULTY=5;_CS=Jn.BASE_DIFFICULTY;_HP=Jn.BASE_DIFFICULTY;_OD=Jn.BASE_DIFFICULTY;_AR;_multiplier=1;_tickRate=1;_rate=1;get circleSize(){return Math.fround(this._CS)}set circleSize(e){this._CS=e}get drainRate(){return Math.fround(this._HP)}set drainRate(e){this._HP=e}get overallDifficulty(){return Math.fround(this._OD)}set overallDifficulty(e){this._OD=e}get approachRate(){return Math.fround(this._AR??this._OD)}set approachRate(e){this._AR=e}get sliderMultiplier(){return this._multiplier}set sliderMultiplier(e){this._multiplier=e}get sliderTickRate(){return this._tickRate}set sliderTickRate(e){this._tickRate=e}get clockRate(){return this._rate}set clockRate(e){this._rate=e}clone(){const e=new Jn;return e.circleSize=this._CS,e.drainRate=this._HP,e.overallDifficulty=this._OD,typeof this._AR=="number"&&(e.approachRate=this._AR),e.sliderMultiplier=this._multiplier,e.sliderTickRate=this._tickRate,e.clockRate=this._rate,e}static range(e,t,r,i){return e>5?r+(i-r)*(e-5)/5:e<5?r-(r-t)*(5-e)/5:r}}class Rs{bookmarks=[];distanceSpacing=1;beatDivisor=4;gridSize=1;timelineZoom=2;clone(){const e=new Rs;return e.bookmarks=this.bookmarks.slice(),e.distanceSpacing=this.distanceSpacing,e.beatDivisor=this.beatDivisor,e.gridSize=this.gridSize,e.timelineZoom=this.timelineZoom,e}}let Ha;(function(n){n[n.AdditiveBlending=0]="AdditiveBlending",n[n.AlphaBlending=1]="AlphaBlending"})(Ha||(Ha={}));class ut{source;destination;sourceAlpha;destinationAlpha;rgbEquation;alphaEquation;static None=new ut({source:5,destination:15,sourceAlpha:5,destinationAlpha:15,rgbEquation:1,alphaEquation:1});static Inherit=new ut({source:0,destination:0,sourceAlpha:0,destinationAlpha:0,rgbEquation:0,alphaEquation:0});static Mixture=new ut({source:12,destination:10,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1});static Additive=new ut({source:12,destination:5,sourceAlpha:5,destinationAlpha:5,rgbEquation:1,alphaEquation:1});constructor(e){this.source=e.source||0,this.destination=e.destination||0,this.sourceAlpha=e.sourceAlpha||0,this.destinationAlpha=e.destinationAlpha||0,this.rgbEquation=e.rgbEquation||0,this.alphaEquation=e.alphaEquation||0}copyFromParent(e){this.source===0&&(this.source=e.source),this.destination===0&&(this.destination=e.destination),this.sourceAlpha===0&&(this.sourceAlpha=e.sourceAlpha),this.destinationAlpha===0&&(this.destinationAlpha=e.destinationAlpha),this.rgbEquation===0&&(this.rgbEquation=e.rgbEquation),this.alphaEquation===0&&(this.alphaEquation=e.alphaEquation)}applyDefaultToInherited(){this.source===0&&(this.source=12),this.destination===0&&(this.destination=10),this.sourceAlpha===0&&(this.sourceAlpha=5),this.destinationAlpha===0&&(this.destinationAlpha=5),this.rgbEquation===0&&(this.rgbEquation=1),this.alphaEquation===0&&(this.alphaEquation=1)}equals(e){return e.source===this.source&&e.destination===this.destination&&e.sourceAlpha===this.sourceAlpha&&e.destinationAlpha===this.destinationAlpha&&e.rgbEquation===this.rgbEquation&&e.alphaEquation===this.alphaEquation}get isDisabled(){return this.source===5&&this.destination===15&&this.sourceAlpha===5&&this.destinationAlpha===15&&this.rgbEquation===1&&this.alphaEquation===1}get rgbEquationMode(){return ut._translateEquation(this.rgbEquation)}get alphaEquationMode(){return ut._translateEquation(this.alphaEquation)}get sourceBlendingFactor(){return ut._translateBlendingFactorSrc(this.source)}get destinationBlendingFactor(){return ut._translateBlendingFactorDest(this.destination)}get sourceAlphaBlendingFactor(){return ut._translateBlendingFactorSrc(this.sourceAlpha)}get destinationAlphaBlendingFactor(){return ut._translateBlendingFactorDest(this.destinationAlpha)}static _translateBlendingFactorSrc(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateBlendingFactorDest(e){switch(e){case 1:return 32771;case 2:return 32769;case 3:return 772;case 4:return 774;case 5:return 1;case 6:return 32772;case 7:return 32770;case 8:return 773;case 9:return 775;case 10:return 771;case 11:return 769;case 12:return 770;case 13:return 776;case 14:return 768;default:case 15:return 0}}static _translateEquation(e){switch(e){default:case 0:case 1:return 32774;case 2:return 32775;case 3:return 32776;case 4:return 32778;case 5:return 32779}}}let pt;(function(n){n[n.y0=1]="y0",n[n.y1=2]="y1",n[n.y2=4]="y2",n[n.x0=8]="x0",n[n.x1=16]="x1",n[n.x2=32]="x2",n[n.Custom=64]="Custom",n[n.TopLeft=9]="TopLeft",n[n.TopCentre=17]="TopCentre",n[n.TopRight=33]="TopRight",n[n.CentreLeft=10]="CentreLeft",n[n.Centre=18]="Centre",n[n.CentreRight=34]="CentreRight",n[n.BottomLeft=12]="BottomLeft",n[n.BottomCentre=20]="BottomCentre",n[n.BottomRight=36]="BottomRight"})(pt||(pt={}));let Ae;(function(n){n.None="",n.Movement="M",n.MovementX="MX",n.MovementY="MY",n.Fade="F",n.Scale="S",n.VectorScale="V",n.Rotation="R",n.Color="C",n.Parameter="P"})(Ae||(Ae={}));let rr;(function(n){n.None="",n.Loop="L",n.Trigger="T"})(rr||(rr={}));let et;(function(n){n[n.Background=0]="Background",n[n.Video=1]="Video",n[n.Break=2]="Break",n[n.Colour=3]="Colour",n[n.Sprite=4]="Sprite",n[n.Sample=5]="Sample",n[n.Animation=6]="Animation",n[n.StoryboardCommand=7]="StoryboardCommand"})(et||(et={}));let St;(function(n){n[n.Background=0]="Background",n[n.Fail=1]="Fail",n[n.Pass=2]="Pass",n[n.Foreground=3]="Foreground",n[n.Overlay=4]="Overlay",n[n.Video=5]="Video"})(St||(St={}));let Rr;(function(n){n[n.LoopForever=0]="LoopForever",n[n.LoopOnce=1]="LoopOnce"})(Rr||(Rr={}));let it;(function(n){n[n.TopLeft=0]="TopLeft",n[n.Centre=1]="Centre",n[n.CentreLeft=2]="CentreLeft",n[n.TopRight=3]="TopRight",n[n.BottomCentre=4]="BottomCentre",n[n.TopCentre=5]="TopCentre",n[n.Custom=6]="Custom",n[n.CentreRight=7]="CentreRight",n[n.BottomLeft=8]="BottomLeft",n[n.BottomRight=9]="BottomRight"})(it||(it={}));let Jt;(function(n){n.None="",n.HorizontalFlip="H",n.VerticalFlip="V",n.BlendingMode="A"})(Jt||(Jt={}));class mn{red;green;blue;alpha;constructor(e,t,r,i){this.red=e??255,this.green=t??255,this.blue=r??255,this.alpha=i??1}get hex(){const e=Math.round(this.alpha*255);return"#"+this.red.toString(16).padStart(2,"0")+this.green.toString(16).padStart(2,"0")+this.blue.toString(16).padStart(2,"0")+e.toString(16).padStart(2,"0")}equals(e){return this.red===e.red&&this.green===e.green&&this.blue===e.blue&&this.alpha===e.alpha}clone(){return new mn(this.red,this.green,this.blue,this.alpha)}toString(){return`${this.red},${this.green},${this.blue},${this.alpha}`}}class ae{x;y;constructor(e,t){this.x=e,this.y=isFinite(t)?t:e}get floatX(){return Math.fround(this.x)}get floatY(){return Math.fround(this.y)}add(e){return new ae(this.x+e.x,this.y+e.y)}fadd(e){return new ae(Math.fround(this.floatX+e.floatX),Math.fround(this.floatY+e.floatY))}subtract(e){return new ae(this.x-e.x,this.y-e.y)}fsubtract(e){return new ae(Math.fround(this.floatX-e.floatX),Math.fround(this.floatY-e.floatY))}scale(e){return new ae(this.x*e,this.y*e)}fscale(e){const t=Math.fround(e);return new ae(Math.fround(this.floatX*t),Math.fround(this.floatY*t))}divide(e){return new ae(this.x/e,this.y/e)}fdivide(e){const t=Math.fround(e);return new ae(Math.fround(this.floatX/t),Math.fround(this.floatY/t))}dot(e){return this.x*e.x+this.y*e.y}fdot(e){return Math.fround(Math.fround(Math.fround(this.floatX*e.floatX)+Math.fround(this.floatY*e.floatY)))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}flength(){return Math.fround(Math.sqrt(Math.fround(Math.fround(this.floatX*this.floatX)+Math.fround(this.floatY*this.floatY))))}distance(e){const t=this.x-e.x,r=this.y-e.y;return Math.sqrt(t*t+r*r)}fdistance(e){const t=Math.fround(this.floatX-e.floatX),r=Math.fround(this.floatY-e.floatY);return Math.fround(Math.sqrt(Math.fround(Math.fround(t*t)+Math.fround(r*r))))}normalize(){const e=1/this.length();return new ae(this.x*e,this.y*e)}fnormalize(){const e=Math.fround(1/this.flength());return new ae(Math.fround(this.floatX*e),Math.fround(this.floatY*e))}equals(e){return this.x===e.x&&this.y===e.y}clone(){return new ae(this.x,this.y)}toString(){return`${this.x},${this.y}`}}function Vr(n,e,t){return Math.max(e,Math.min(t,n))}function Qn(n){return Vr(n,0,1)}function nh(n,e,t,r,i){return n<e?r:n>=t?i:(n-e)/(t-e)*(i-r)+r}function rh(n,e,t){return nh(n,e,t,0,1)}let de;(function(n){n[n.None=0]="None",n[n.Out=1]="Out",n[n.In=2]="In",n[n.InQuad=3]="InQuad",n[n.OutQuad=4]="OutQuad",n[n.InOutQuad=5]="InOutQuad",n[n.InCubic=6]="InCubic",n[n.OutCubic=7]="OutCubic",n[n.InOutCubic=8]="InOutCubic",n[n.InQuart=9]="InQuart",n[n.OutQuart=10]="OutQuart",n[n.InOutQuart=11]="InOutQuart",n[n.InQuint=12]="InQuint",n[n.OutQuint=13]="OutQuint",n[n.InOutQuint=14]="InOutQuint",n[n.InSine=15]="InSine",n[n.OutSine=16]="OutSine",n[n.InOutSine=17]="InOutSine",n[n.InExpo=18]="InExpo",n[n.OutExpo=19]="OutExpo",n[n.InOutExpo=20]="InOutExpo",n[n.InCirc=21]="InCirc",n[n.OutCirc=22]="OutCirc",n[n.InOutCirc=23]="InOutCirc",n[n.InElastic=24]="InElastic",n[n.OutElastic=25]="OutElastic",n[n.OutElasticHalf=26]="OutElasticHalf",n[n.OutElasticQuarter=27]="OutElasticQuarter",n[n.InOutElastic=28]="InOutElastic",n[n.InBack=29]="InBack",n[n.OutBack=30]="OutBack",n[n.InOutBack=31]="InOutBack",n[n.InBounce=32]="InBounce",n[n.OutBounce=33]="OutBounce",n[n.InOutBounce=34]="InOutBounce",n[n.OutPow10=35]="OutPow10"})(de||(de={}));const tn=2*Math.PI/.3,nn=.3/4,Lr=1.70158,ti=Lr*1.525,yt=1/2.75,Di=Math.pow(2,-10),Yo=Math.pow(2,-11),ih=Math.pow(2,-10)*Math.sin((.5-nn)*tn),sh=Math.pow(2,-10)*Math.sin((.25-nn)*tn),Wa=Math.pow(2,-10)*Math.sin((1-nn*1.5)*tn/1.5),be=n=>e=>n(Qn(e)),ah=be(n=>n),oh=be(n=>n*n),uh=be(n=>n*(2-n)),lh=be(n=>n<.5?n*n*2:--n*n*-2+1),ch=be(n=>n*n*n),hh=be(n=>--n*n*n+1),dh=be(n=>n<.5?n*n*n*4:--n*n*n*4+1),fh=be(n=>n*n*n*n),mh=be(n=>1- --n*n*n*n),ph=be(n=>n<.5?n*n*n*n*8:--n*n*n*n*-8+1),gh=be(n=>n*n*n*n*n),_h=be(n=>--n*n*n*n*n+1),Dh=be(n=>n<.5?n*n*n*n*n*16:--n*n*n*n*n*16+1),bh=be(n=>1-Math.cos(n*Math.PI*.5)),Sh=be(n=>Math.sin(n*Math.PI*.5)),yh=be(n=>.5-.5*Math.cos(Math.PI*n)),wh=be(n=>Math.pow(2,10*(n-1))+Di*(n-1)),vh=be(n=>-Math.pow(2,-10*n)+1+Di*n),Eh=be(n=>n<.5?.5*(Math.pow(2,20*n-10)+Di*(2*n-1)):1-.5*(Math.pow(2,-20*n+10)+Di*(-2*n+1))),Ah=be(n=>1-Math.sqrt(1-n*n)),Fh=be(n=>Math.sqrt(1- --n*n)),Ph=be(n=>(n*=2)<1?.5-.5*Math.sqrt(1-n*n):.5*Math.sqrt(1-(n-=2)*n)+.5),Th=be(n=>-Math.pow(2,-10+10*n)*Math.sin((1-nn-n)*tn)+Yo*(1-n)),Ch=be(n=>Math.pow(2,-10*n)*Math.sin((n-nn)*tn)+1-Yo*n),Mh=be(n=>Math.pow(2,-10*n)*Math.sin((.5*n-nn)*tn)+1-ih*n),xh=be(n=>Math.pow(2,-10*n)*Math.sin((.25*n-nn)*tn)+1-sh*n),Bh=be(n=>(n*=2)<1?-.5*(Math.pow(2,-10+10*n)*Math.sin((1-nn*1.5-n)*tn/1.5)-Wa*(1-n)):.5*(Math.pow(2,-10*--n)*Math.sin((n-nn*1.5)*tn/1.5)-Wa*n)+1),kh=be(n=>n*n*((Lr+1)*n-Lr)),Rh=be(n=>--n*n*((Lr+1)*n+Lr)+1),Lh=be(n=>(n*=2)<1?.5*n*n*((ti+1)*n-ti):.5*((n-=2)*n*((ti+1)*n+ti)+2)),Oh=be(n=>(n=1-n,n<yt?1-7.5625*n*n:n<2*yt?1-(7.5625*(n-=1.5*yt)*n+.75):n<2.5*yt?1-(7.5625*(n-=2.25*yt)*n+.9375):1-(7.5625*(n-=2.625*yt)*n+.984375))),ds=be(n=>n<yt?7.5625*n*n:n<2*yt?7.5625*(n-=1.5*yt)*n+.75:n<2.5*yt?7.5625*(n-=2.25*yt)*n+.9375:7.5625*(n-=2.625*yt)*n+.984375),Ih=be(n=>n<.5?.5-.5*ds(1-n*2):ds((n-.5)*2)*.5+.5),Nh=be(n=>--n*Math.pow(n,10)+1);function Gh(n){switch(n){case de.In:case de.InQuad:return oh;case de.Out:case de.OutQuad:return uh;case de.InOutQuad:return lh;case de.InCubic:return ch;case de.OutCubic:return hh;case de.InOutCubic:return dh;case de.InQuart:return fh;case de.OutQuart:return mh;case de.InOutQuart:return ph;case de.InQuint:return gh;case de.OutQuint:return _h;case de.InOutQuint:return Dh;case de.InSine:return bh;case de.OutSine:return Sh;case de.InOutSine:return yh;case de.InExpo:return wh;case de.OutExpo:return vh;case de.InOutExpo:return Eh;case de.InCirc:return Ah;case de.OutCirc:return Fh;case de.InOutCirc:return Ph;case de.InElastic:return Th;case de.OutElastic:return Ch;case de.OutElasticHalf:return Mh;case de.OutElasticQuarter:return xh;case de.InOutElastic:return Bh;case de.InBack:return kh;case de.OutBack:return Rh;case de.InOutBack:return Lh;case de.InBounce:return Oh;case de.OutBounce:return ds;case de.InOutBounce:return Ih;case de.OutPow10:return Nh}return ah}class Ls{type;parameter;easing;startTime;endTime;constructor(e){this.type=e?.type??Ae.None,this.parameter=e?.parameter??Jt.None,this.easing=e?.easing??de.None,this.startTime=e?.startTime??0,this.endTime=e?.endTime??0,this.startValue=e?.startValue??null,this.endValue=e?.endValue??null}get duration(){return this.endTime-this.startTime}getProgress(e){const t=rh(e,this.startTime,this.endTime);return Gh(this.easing)(t)}getValueAtProgress(e){const t=(s,o,u)=>o+s*(u-o),r=(s,o,u)=>o===u||s>=o&&s<u;if(typeof this.startValue=="number"){const s=this.startValue,o=this.endValue;return t(e,s,o)}if(this.startValue instanceof ae){const s=this.startValue,o=this.endValue;return new ae(t(e,s.floatX,o.floatX),t(e,s.floatY,o.floatY))}if(this.startValue instanceof mn){const s=this.startValue,o=this.endValue;return new mn(t(e,s.red,o.red),t(e,s.green,o.green),t(e,s.blue,o.blue),t(e,s.alpha,o.alpha))}const i=this.startTime+this.duration*e;if(typeof this.startValue=="boolean")return r(i,this.startTime,this.endTime);if(this.startValue instanceof ut){const s=this.startValue,o=this.endValue;return r(i,this.startTime,this.endTime)?s:o}return this.endValue}getValueAtTime(e){return this.getValueAtProgress(this.getProgress(e))}equals(e){return this.type===e.type&&this.startTime===e.startTime&&this.endTime===e.endTime&&this.startValue===e.startValue&&this.endValue===e.endValue&&this.easing===e.easing&&this.parameter===e.parameter}}class Ot{_commands=[];startTime=1/0;endTime=-1/0;[Symbol.iterator](){const e=this.commands;let t=-1;return{next:()=>({value:e[++t],done:!(t in e)})}}get commands(){return this._commands.sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}add(e,t,r,i,s,o,u){i<r&&([r,i]=[i,r],[s,o]=[o,s]),this._commands.push(new Ls({type:e,easing:t,startTime:r,endTime:i,startValue:s,endValue:o,parameter:u})),r<this.startTime&&(this.startValue=s,this.startTime=r),i>this.endTime&&(this.endValue=o,this.endTime=i)}get hasCommands(){return this._commands.length>0}}class Os{x=new Ot;y=new Ot;scale=new Ot;vectorScale=new Ot;rotation=new Ot;color=new Ot;alpha=new Ot;blendingParameters=new Ot;flipH=new Ot;flipV=new Ot;_timelines;constructor(){this._timelines=[this.x,this.y,this.scale,this.vectorScale,this.rotation,this.color,this.alpha,this.blendingParameters,this.flipH,this.flipV]}get timelines(){return this._timelines}get totalCommands(){return this._timelines.reduce((e,t)=>e+t.commands.length,0)}get commands(){return this._timelines.flatMap(e=>e.commands).sort((e,t)=>e.startTime-t.startTime||e.endTime-t.endTime)}get commandsStartTime(){let e=1/0;for(let t=0;t<this._timelines.length;++t)e=Math.min(e,this._timelines[t].startTime);return e}get commandsEndTime(){let e=-1/0;for(let t=0;t<this._timelines.length;++t)e=Math.max(e,this._timelines[t].endTime);return e}get commandsDuration(){return this.commandsEndTime-this.commandsStartTime}get startTime(){return this.commandsStartTime}get endTime(){return this.commandsEndTime}get duration(){return this.endTime-this.startTime}get hasCommands(){for(let e=0;e<this._timelines.length;++e)if(this._timelines[e].hasCommands)return!0;return!1}}class qo extends Os{type=rr.Loop;loopStartTime;loopCount;constructor(e,t){super(),this.loopStartTime=e||0,this.loopCount=t||0}get totalIterations(){return this.loopCount+1}get startTime(){return this.loopStartTime+this.commandsStartTime}get endTime(){return this.startTime+this.commandsDuration*this.totalIterations}unrollCommands(){const e=this.commands;if(e.length===0)return[];const{commandsDuration:t,totalIterations:r,loopStartTime:i}=this,s=new Array(r*e.length);for(let o=0;o<r;o++){const u=i+o*t;for(let l=0;l<e.length;l++){const c=o*e.length+l,h=e[l];s[c]=new Ls({...h,startTime:h.startTime+u,endTime:h.endTime+u})}}return s}}class Jo extends Os{type=rr.Trigger;triggerName;triggerStartTime;triggerEndTime;groupNumber;constructor(e,t,r,i){super(),this.triggerName=e||"",this.triggerStartTime=t||0,this.triggerEndTime=r||0,this.groupNumber=i||0}unrollCommands(){const e=this.commands;if(e.length===0)return[];const t=new Array(e.length);for(let r=0;r<e.length;r++)t[r]=new Ls({...e[r],startTime:e[r].startTime+this.triggerStartTime,endTime:e[r].endTime+this.triggerStartTime});return t}}class Is{origin;anchor;startTime=1/0;endTime=-1/0;filePath;commands=[];timelineGroup=new Os;loops=[];triggers=[];startPosition;scale=new ae(1,1);color=new mn;rotation=0;flipX=!1;flipY=!1;isAdditive=!1;constructor(e,t,r,i){this.filePath=e??"",this.origin=t??it.TopLeft,this.anchor=r??pt.TopLeft,this.startPosition=i??new ae(0,0)}get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}get duration(){return this.endTime-this.startTime}get hasCommands(){return this.timelineGroup.hasCommands||this.loops.some(e=>e.hasCommands)||this.triggers.some(e=>e.hasCommands)}get isDrawable(){return this.color.alpha>=.01&&this.hasCommands}addLoop(e,t){const r=new qo(e,t);return this.loops.push(r),r}addTrigger(e,t,r,i){const s=new Jo(e,t,r,i);return this.triggers.push(s),s}updateCommands(){const e=[...this.timelineGroup.commands,...this.loops.flatMap(t=>t.unrollCommands())];return this.commands=e.sort((t,r)=>t.startTime-r.startTime),this.commands}adjustTimesToCommands(){let e=this.startTime,t=this.endTime;for(const r of this.commands)e=Math.min(e,r.startTime),t=Math.max(t,r.endTime);this.startTime=e,this.endTime=t}resetValuesToCommands(){const e={};for(const t of this.commands)e[t.type]||(this.setValueFromCommand(t,0),e[t.type]=!0)}setValueFromCommand(e,t){const r=e.getValueAtProgress(t);switch(e.type){case Ae.Movement:this.startPosition.x=r.x,this.startPosition.y=r.y;break;case Ae.MovementX:this.startPosition.x=r;break;case Ae.MovementY:this.startPosition.y=r;break;case Ae.Fade:this.color.alpha=r;break;case Ae.Scale:this.scale.x=r,this.scale.y=r;break;case Ae.VectorScale:this.scale.x=r.x,this.scale.y=r.y;break;case Ae.Rotation:this.rotation=r;break;case Ae.Color:this.color.red=r.red,this.color.green=r.green,this.color.blue=r.blue;break}if(e.type===Ae.Parameter)switch(e.parameter){case Jt.BlendingMode:this.isAdditive=r.rgbEquation===1;break;case Jt.HorizontalFlip:this.flipX=r;break;case Jt.VerticalFlip:this.flipY=r}}}class Qo extends Is{frameCount;frameDelay;loopType;constructor(e,t,r,i,s,o,u){super(e,t,r,i),this.frameCount=s??0,this.frameDelay=o??0,this.loopType=u??Rr.LoopForever}}class Zo{startTime;volume;filePath;get isDrawable(){return!0}constructor(e,t,r){this.filePath=e??"",this.startTime=t??0,this.volume=r??100}}class $o{startTime;filePath;get isDrawable(){return!0}constructor(e,t){this.filePath=e??"",this.startTime=t??0}}class An{name;depth;masking;visibleWhenPassing=!0;visibleWhenFailing=!0;elements=[];constructor(e){this.name=e.name,this.depth=e.depth,this.masking=e.masking??!0}}class Hh{variables=new Map;colors=new Mi;useSkinSprites=!1;minimumLayerDepth=0;fileFormat=14;_layers=new Map;constructor(){this.addLayer(new An({name:"Video",depth:4,masking:!1})),this.addLayer(new An({name:"Background",depth:3})),this.addLayer(new An({name:"Fail",depth:2,visibleWhenPassing:!1})),this.addLayer(new An({name:"Pass",depth:1,visibleWhenFailing:!1})),this.addLayer(new An({name:"Foreground",depth:0})),this.addLayer(new An({name:"Overlay",depth:-2147483648}))}get layers(){return this._layers}get hasDrawable(){for(const e of this.layers.values())if(e.elements.find(t=>t.isDrawable))return!0;return!1}get hasVariables(){for(const e in this.variables)return!0;return!1}get earliestEventTime(){let e=1/0;return this._layers.forEach(t=>{const i=t.elements.reduce((s,o)=>Math.min(s,o.startTime),0);e=Math.min(i,e)}),e===1/0?null:e}get latestEventTime(){let e=-1/0;return this._layers.forEach(t=>{const i=t.elements.reduce((s,o)=>Math.max(s,o?.endTime??o.startTime),0);e=Math.max(i,e)}),e===-1/0?null:e}addLayer(e){this._layers.has(e.name)||this._layers.set(e.name,e)}getLayerByType(e){return this.getLayerByName(St[e]??"Background")}getLayerByName(e){const t=this._layers.get(e)??new An({name:e,depth:--this.minimumLayerDepth});return this._layers.has(e)||this._layers.set(e,t),t}}class Ns{backgroundPath=null;breaks=[];storyboard=null;get isBackgroundReplaced(){if(!this.backgroundPath||!this.storyboard)return!1;const e=this.backgroundPath.trim().toLowerCase();return this.storyboard.getLayerByType(St.Background).elements.some(r=>r.filePath.toLowerCase()===e)}clone(){const e=new Ns;return e.backgroundPath=this.backgroundPath,e.breaks=this.breaks,e.storyboard=this.storyboard,e}}let Ce;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Soft=2]="Soft",n[n.Drum=3]="Drum"})(Ce||(Ce={}));class Gs{audioFilename="";audioHash;overlayPosition="NoChange";skinPreference="";audioLeadIn=0;previewTime=-1;countdown=1;stackLeniency=.7;countdownOffset=0;sampleSet=Ce.Normal;letterboxInBreaks=!1;storyFireInFront;useSkinSprites=!1;alwaysShowPlayfield;epilepsyWarning=!1;specialStyle=!1;widescreenStoryboard=!1;samplesMatchPlaybackRate=!1;clone(){const e=new Gs;return e.audioFilename=this.audioFilename,this.audioHash&&(e.audioHash=this.audioHash),e.overlayPosition=this.overlayPosition,e.skinPreference=this.skinPreference,e.audioLeadIn=this.audioLeadIn,e.previewTime=this.previewTime,e.countdown=this.countdown,e.stackLeniency=this.stackLeniency,e.countdownOffset=this.countdownOffset,e.sampleSet=this.sampleSet,e.letterboxInBreaks=this.letterboxInBreaks,this.storyFireInFront&&(e.storyFireInFront=this.storyFireInFront),e.useSkinSprites=this.useSkinSprites,this.alwaysShowPlayfield&&(e.alwaysShowPlayfield=this.alwaysShowPlayfield),e.epilepsyWarning=this.epilepsyWarning,e.specialStyle=this.specialStyle,e.widescreenStoryboard=this.widescreenStoryboard,e.samplesMatchPlaybackRate=this.samplesMatchPlaybackRate,e}}class Hs{title="Unknown Title";artist="Unknown Artist";creator="Unknown Creator";version="Normal";source="";tags=[];beatmapId=0;beatmapSetId=0;_titleUnicode="Unknown Title";get titleUnicode(){return this._titleUnicode!=="Unknown Title"?this._titleUnicode:this.title}set titleUnicode(e){this._titleUnicode=e}_artistUnicode="Unknown Artist";get artistUnicode(){return this._artistUnicode!=="Unknown Artist"?this._artistUnicode:this.artist}set artistUnicode(e){this._artistUnicode=e}clone(){const e=new Hs;return e.title=this.title,e.titleUnicode=this.titleUnicode,e.artist=this.artist,e.artistUnicode=this.artistUnicode,e.creator=this.creator,e.version=this.version,e.source=this.source,e.tags=this.tags.slice(),e.beatmapId=this.beatmapId,e.beatmapSetId=this.beatmapSetId,e}}class xi{group;constructor(e){this.group=e||null}attachGroup(e){this.group=e}dettachGroup(){this.group=null}get startTime(){return this.group?this.group.startTime:0}}class Wh{controlPoints=[];startTime;constructor(e){this.startTime=e}add(e){const t=this.controlPoints.find(r=>r.pointType===e.pointType);t&&this.remove(t),e.attachGroup(this),this.controlPoints.push(e)}remove(e){const t=this.controlPoints.findIndex(r=>r.pointType===e.pointType);t!==-1&&(this.controlPoints.splice(t,1),e.dettachGroup())}}function Vh(n,e){let t=0,r,i=n.length-1;for(;t<=i;){if(r=t+(i-t>>1),n[r]===e)return r;n[r]<e?t=r+1:i=r-1}return~t}function eu(n,e){if(!n.length||e<n[0].startTime)return-1;if(e>=n[n.length-1].startTime)return n.length-1;let t=0,r=n.length-2;for(;t<=r;){const i=t+(r-t>>1);if(n[i].startTime<e)t=i+1;else if(n[i].startTime>e)r=i-1;else return i}return t-1}function Kn(n,e){const t=eu(n,e);return t===-1?null:n[t]}function zh(n){const e=n.length,t=[];for(let r=0;r<e;r++){t[r]=1;for(let i=0;i<e;i++)r!==i&&(t[r]*=n[r].floatX-n[i].floatX);t[r]=1/t[r]}return t}function jh(n,e,t){if(n===null||n.length===0)throw new Error("points must contain at least one point");if(n.length!==e.length)throw new Error("points must contain exactly as many items as weights");let r=0,i=0;for(let s=0,o=n.length;s<o;++s){if(t===n[s].floatX)return n[s].floatY;const u=e[s]/(t-n[s].floatX);r+=u*n[s].floatY,i+=u}return r/i}class Xt{static MAX_INT32=2147483647;static MAX_UINT32=4294967295;static INT_MASK=2147483647;static INT_TO_REAL=1/(Xt.MAX_INT32+1);_y=842502087;_z=3579807591;_w=273326509;_x=0;_bitBuffer=0;_bitIndex=32;constructor(e){this._x=e}_next(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y>>>0,this._y=this._z>>>0,this._z=this._w>>>0,this._w=(this._w^this._w>>>19)>>>0,this._w=(this._w^e)>>>0,this._w=(this._w^e>>>8)>>>0,this._w}next(){return(Xt.INT_MASK&this._next())>>0}nextUInt(e=0,t=Xt.MAX_INT32){return e===0&&t===Xt.MAX_INT32?this._next():e+this.nextDouble()*(t-e)>>>0}nextInt(e=0,t=Xt.MAX_INT32){return e+this.nextDouble()*(t-e)>>0}nextDouble(){return Xt.INT_TO_REAL*this.next()}nextBool(){return this._bitIndex===32?(this._bitBuffer=this.nextUInt(),this._bitIndex=1,(this._bitBuffer&1)===1):(this._bitIndex=this._bitIndex+1>>0,((this._bitBuffer>>=1)&1)===1)}}class Gt{static PRECISION_ERROR=1e-15;static round(e,t=1){return t?this.roundToEven(e):this.roundAwayFromZero(e)}static roundToEven(e){return this.isAtMidPoint(e)?2*Math.round(e/2):Math.round(e)}static roundAwayFromZero(e){return this.isAtMidPoint(e)?e>0?Math.ceil(e):Math.floor(e):Math.round(e)}static isAtMidPoint(e){return Math.abs(.5-Math.abs(e-(e>>0)))<=this.PRECISION_ERROR}}class bi{static _QUICK_SORT_DEPTH_THRESHOLD=32;static _INTRO_SORT_SIZE_THRESHOLD=16;static depthSort(e,t){return!e||e.length===0||(t??=this.defaultCompare,this._depthLimitedQuickSort(e,0,e.length-1,t,this._QUICK_SORT_DEPTH_THRESHOLD)),e}static introSort(e,t){return!e||e.length<2||(t??=this.defaultCompare,this._introSort(e,0,e.length-1,t,2*this._floorLog2(e.length))),e}static _depthLimitedQuickSort(e,t,r,i,s){do{if(s===0)return this._heapsort(e,t,r,i);let o=t,u=r;const l=o+(u-o>>1);this._swapIfGreater(e,i,o,l),this._swapIfGreater(e,i,o,u),this._swapIfGreater(e,i,l,u);const c=e[l];do{for(;i(e[o],c)<0;)o++;for(;i(c,e[u])<0;)u--;if(o>u)break;o<u&&([e[o],e[u]]=[e[u],e[o]]),o++,u--}while(o<=u);if(s--,u-t<=r-o){t<u&&this._depthLimitedQuickSort(e,t,u,i,s),t=o;continue}o<r&&this._depthLimitedQuickSort(e,o,r,i,s),r=u}while(t<r)}static _introSort(e,t,r,i,s){for(;r>t;){const o=r-t+1;if(o<=this._INTRO_SORT_SIZE_THRESHOLD){if(o===1)return;if(o===2){this._swapIfGreater(e,i,t,r);return}if(o===3){this._swapIfGreater(e,i,t,r-1),this._swapIfGreater(e,i,t,r),this._swapIfGreater(e,i,r-1,r);return}this._insertionSort(e,t,r,i);return}if(s===0){this._heapsort(e,t,r,i);return}s--;const u=this._pickPivotAndPartition(e,t,r,i);this._introSort(e,u+1,r,i,s),r=u-1}}static _insertionSort(e,t,r,i){for(let s=t;s<r;++s){let o=s;const u=e[s+1];for(;o>=t&&i(u,e[o])<0;)e[o+1]=e[o],o--;e[o+1]=u}}static _pickPivotAndPartition(e,t,r,i){const s=t+(r-t)/2>>0;this._swapIfGreater(e,i,t,s),this._swapIfGreater(e,i,t,r),this._swapIfGreater(e,i,s,r);const o=e[s];this._swap(e,s,r-1);let u=t,l=r-1;for(;u<l;){for(;i(e[++u],o)<0;);for(;i(o,e[--l])<0;);if(u>=l)break;this._swap(e,u,l)}return this._swap(e,u,r-1),u}static _heapsort(e,t,r,i){const s=r-t+1;for(let o=s/2;o>=1;--o)this._downHeap(e,o,s,t,i);for(let o=s;o>1;--o)this._swap(e,t,t+o-1),this._downHeap(e,1,o-1,t,i)}static _downHeap(e,t,r,i,s){const o=e[i+t-1];for(;t<=r/2;){let u=2*t;if(u<r&&s(e[i+u-1],e[i+u])<0&&u++,s(o,e[i+u-1])>=0)break;e[i+t-1]=e[i+u-1],t=u}e[i+t-1]=o}static _swap(e,t,r){t!==r&&([e[t],e[r]]=[e[r],e[t]])}static _swapIfGreater(e,t,r,i){r!==i&&t(e[r],e[i])>0&&([e[r],e[i]]=[e[i],e[r]])}static _floorLog2(e){let t=0;for(;e>=1;)t++,e/=2;return t}static defaultCompare=(e,t)=>{if(e===void 0&&t===void 0)return 0;if(e===void 0)return 1;if(t===void 0)return-1;const r=bi.toString(e),i=bi.toString(t);return r<i?-1:r>i?1:0};static toString=e=>{if(e===null)return"null";if(typeof e=="boolean"||typeof e=="number")return e.toString();if(typeof e=="string")return e;if(typeof e=="symbol")throw new TypeError;return JSON.stringify(e)}}let Ue;(function(n){n[n.TimingPoint=0]="TimingPoint",n[n.DifficultyPoint=1]="DifficultyPoint",n[n.EffectPoint=2]="EffectPoint",n[n.SamplePoint=3]="SamplePoint"})(Ue||(Ue={}));class $n extends xi{static default=new $n;pointType=Ue.DifficultyPoint;generateTicks=!0;isLegacy=!1;sliderVelocityUnlimited=1;get sliderVelocity(){return Vr(this.sliderVelocityUnlimited,.1,10)}set sliderVelocity(e){this.sliderVelocityUnlimited=e}bpmMultiplier=1;isRedundant(e){return e instanceof $n&&e.sliderVelocity===this.sliderVelocity&&e.generateTicks===this.generateTicks}equals(e){return e instanceof $n&&this.sliderVelocity===e.sliderVelocity}}class er extends xi{static default=new er;pointType=Ue.EffectPoint;kiai=!1;omitFirstBarLine=!1;scrollSpeedUnlimited=1;get scrollSpeed(){return Vr(this.scrollSpeedUnlimited,.1,10)}set scrollSpeed(e){this.scrollSpeedUnlimited=e}isRedundant(e){return!this.omitFirstBarLine&&e instanceof er&&this.kiai===e.kiai&&this.omitFirstBarLine===e.omitFirstBarLine&&this.scrollSpeed===e.scrollSpeed}equals(e){return e instanceof er&&this.kiai===e.kiai&&this.omitFirstBarLine===e.omitFirstBarLine&&this.scrollSpeed===e.scrollSpeed}}class tr extends xi{static default=new tr;pointType=Ue.SamplePoint;sampleSet=Ce[Ce.Normal];customIndex=0;volume=100;isRedundant(e){return e instanceof tr&&this.volume===e.volume&&this.customIndex===e.customIndex&&this.sampleSet===e.sampleSet}equals(e){return e instanceof tr&&this.volume===e.volume&&this.customIndex===e.customIndex&&this.sampleSet===e.sampleSet}}let Or;(function(n){n[n.SimpleTriple=3]="SimpleTriple",n[n.SimpleQuadruple=4]="SimpleQuadruple"})(Or||(Or={}));class Qt extends xi{static default=new Qt;static DEFAULT_BEAT_LENGTH=1e3;pointType=Ue.TimingPoint;beatLengthUnlimited=Qt.DEFAULT_BEAT_LENGTH;get beatLength(){return Vr(this.beatLengthUnlimited,6,6e4)}set beatLength(e){this.beatLengthUnlimited=e}timeSignature=Or.SimpleQuadruple;get bpmUnlimited(){return 6e4/this.beatLengthUnlimited}get bpm(){return 6e4/this.beatLength}isRedundant(){return!1}equals(e){return e instanceof Qt&&this.timeSignature===e.timeSignature&&this.beatLength===e.beatLength}}class Ws{groups=[];difficultyPoints=[];effectPoints=[];samplePoints=[];timingPoints=[];get allPoints(){const e=[];return this.groups.forEach(t=>e.push(...t.controlPoints)),e}groupAt(e){let t=this.groups.find(r=>r.startTime===e);return t||(t=new Wh(e),this.groups.push(t),this.groups.sort((r,i)=>r.startTime-i.startTime)),t}difficultyPointAt(e){const t=Kn(this.difficultyPoints,e),r=$n.default;return t||r}effectPointAt(e){const t=Kn(this.effectPoints,e),r=er.default;return t||r}samplePointAt(e){const t=Kn(this.samplePoints,e),r=tr.default;return t||r}timingPointAt(e){const t=Kn(this.timingPoints,e),r=this.timingPoints[0]||Qt.default;return t||r}add(e,t){if(this.checkAlreadyExisting(t,e))return!1;const r=this.getCurrentList(e),i=eu(r,t);return r.splice(i+1,0,e),this.groupAt(t).add(e),!0}getCurrentList(e){switch(e.pointType){case Ue.DifficultyPoint:return this.difficultyPoints;case Ue.EffectPoint:return this.effectPoints;case Ue.SamplePoint:return this.samplePoints;case Ue.TimingPoint:return this.timingPoints}throw new TypeError(`Unknown control point type: ${e.pointType}!`)}checkAlreadyExisting(e,t){let r=null;switch(t.pointType){case Ue.DifficultyPoint:r=this.difficultyPointAt(e);break;case Ue.EffectPoint:r=this.effectPointAt(e);break;case Ue.SamplePoint:r=Kn(this.samplePoints,e);break;case Ue.TimingPoint:r=Kn(this.timingPoints,e)}return t?.isRedundant(r)}remove(e,t){let r;switch(e.pointType){case Ue.DifficultyPoint:r=this.difficultyPoints;break;case Ue.EffectPoint:r=this.effectPoints;break;case Ue.SamplePoint:r=this.samplePoints;break;default:r=this.timingPoints}const i=r.findIndex(s=>s.startTime===e.startTime);return i===-1?!1:(r.splice(i,1),this.groupAt(t).remove(e),!0)}clear(){this.groups.length=0,this.difficultyPoints.length=0,this.effectPoints.length=0,this.samplePoints.length=0,this.timingPoints.length=0}clone(){const e=new Ws;return e.groups=this.groups,e.difficultyPoints=this.difficultyPoints,e.effectPoints=this.effectPoints,e.samplePoints=this.samplePoints,e.timingPoints=this.timingPoints,e}}let se;(function(n){n[n.None=0]="None",n[n.Normal=1]="Normal",n[n.Whistle=2]="Whistle",n[n.Finish=4]="Finish",n[n.Clap=8]="Clap"})(se||(se={}));let le;(function(n){n[n.Normal=1]="Normal",n[n.Slider=2]="Slider",n[n.NewCombo=4]="NewCombo",n[n.Spinner=8]="Spinner",n[n.ComboSkip1=16]="ComboSkip1",n[n.ComboSkip2=32]="ComboSkip2",n[n.ComboSkip3=64]="ComboSkip3",n[n.ComboOffset=112]="ComboOffset",n[n.Hold=128]="Hold"})(le||(le={}));let st;(function(n){n.Catmull="C",n.Bezier="B",n.Linear="L",n.PerfectCurve="P"})(st||(st={}));let Cn;(function(n){n[n.Tick=1]="Tick",n[n.LegacyLastTick=2]="LegacyLastTick",n[n.Head=4]="Head",n[n.Tail=8]="Tail",n[n.Repeat=16]="Repeat"})(Cn||(Cn={}));class Uh{static SLIDER_MAX_DISTANCE=1e5;static*generate(e){const t=Math.min(this.SLIDER_MAX_DISTANCE,e.path.distance),r=Vr(e.tickDistance||0,0,t),i=e.velocity*10;let s=e.startTime;if(yield{eventType:Cn.Head,startTime:s,spanStartTime:s,spanIndex:0,progress:0},r!==0&&r!==1/0)for(let d=0;d<e.spans;++d){const m=!!(d&1),D=[];let g=r;for(;g<t-i;){const F=g/t,T=m?1-F:F;D.push({eventType:Cn.Tick,startTime:s+T*e.spanDuration,spanStartTime:s,spanIndex:d,progress:F}),g+=r}m&&D.reverse();for(const F of D)yield F;d<e.repeats&&(yield{eventType:Cn.Repeat,startTime:s+e.spanDuration,spanStartTime:s,spanIndex:d,progress:d+1&1}),s+=e.spanDuration}const o=e.spans*e.spanDuration,u=e.spans-1,l=e.startTime+u*e.spanDuration,c=Math.max(e.startTime+o/2,l+e.spanDuration-(e.legacyLastTickOffset||0));let h=(c-l)/e.spanDuration;(e.spans&1)===0&&(h=1-h),yield{eventType:Cn.LegacyLastTick,startTime:c,spanStartTime:l,spanIndex:u,progress:h},yield{eventType:Cn.Tail,startTime:e.startTime+o,spanStartTime:l,spanIndex:u,progress:e.spans%2}}}class zt{result;min;average;max;constructor(e,t,r,i){this.result=e,this.min=t,this.average=r,this.max=i}static map(e,t,r,i){return e>5?r+(i-r)*(e-5)/5:e<5?r-(r-t)*(5-e)/5:r}}let k;(function(n){n[n.None=0]="None",n[n.Miss=1]="Miss",n[n.Meh=2]="Meh",n[n.Ok=3]="Ok",n[n.Good=4]="Good",n[n.Great=5]="Great",n[n.Perfect=6]="Perfect",n[n.SmallTickMiss=7]="SmallTickMiss",n[n.SmallTickHit=8]="SmallTickHit",n[n.LargeTickMiss=9]="LargeTickMiss",n[n.LargeTickHit=10]="LargeTickHit",n[n.SmallBonus=11]="SmallBonus",n[n.LargeBonus=12]="LargeBonus",n[n.IgnoreMiss=13]="IgnoreMiss",n[n.IgnoreHit=14]="IgnoreHit",n[n.ComboBreak=15]="ComboBreak",n[n.SliderTailHit=16]="SliderTailHit",n[n.LegacyComboIncrease=17]="LegacyComboIncrease"})(k||(k={}));class Pr{static _BASE_RANGES=[new zt(k.Perfect,22.4,19.4,13.9),new zt(k.Great,64,49,34),new zt(k.Good,97,82,67),new zt(k.Ok,127,112,97),new zt(k.Meh,151,136,121),new zt(k.Miss,188,173,158)];_perfect=0;_great=0;_good=0;_ok=0;_meh=0;_miss=0;_lowestSuccessfulHitResult(){for(let e=k.Meh;e<=k.Perfect;++e)if(this.isHitResultAllowed(e))return e;return k.None}*getAllAvailableWindows(){for(let e=k.Meh;e<=k.Perfect;++e)this.isHitResultAllowed(e)&&(yield[e,this.windowFor(e)])}isHitResultAllowed(e){return!0}setDifficulty(e){for(const t of this._getRanges()){const r=zt.map(e,t.min,t.average,t.max);switch(t.result){case k.Miss:this._miss=r;break;case k.Meh:this._meh=r;break;case k.Ok:this._ok=r;break;case k.Good:this._good=r;break;case k.Great:this._great=r;break;case k.Perfect:this._perfect=r;break}}}resultFor(e){e=Math.abs(e);for(let t=k.Perfect;t>=k.Miss;--t)if(this.isHitResultAllowed(t)&&e<=this.windowFor(t))return t;return k.None}windowFor(e){switch(e){case k.Perfect:return this._perfect;case k.Great:return this._great;case k.Good:return this._good;case k.Ok:return this._ok;case k.Meh:return this._meh;case k.Miss:return this._miss;default:throw new Error("Unknown enum member")}}canBeHit(e){return e<=this.windowFor(this._lowestSuccessfulHitResult())}_getRanges(){return Pr._BASE_RANGES}static EmptyHitWindows=class tu extends Pr{static _ranges=[new zt(k.Perfect,0,0,0),new zt(k.Miss,0,0,0)];isHitResultAllowed(t){switch(t){case k.Perfect:case k.Miss:return!0}return!1}_getRanges(){return tu._ranges}};static empty=new Pr.EmptyHitWindows}class zr{kiai=!1;nestedHitObjects=[];startTime=0;hitType=le.Normal;hitSound=se.Normal;samples=[];startPosition=new ae(0,0);hitWindows=new Pr;get startX(){return this.startPosition.floatX}set startX(e){this.startPosition.x=e}get startY(){return this.startPosition.floatY}set startY(e){this.startPosition.y=e}createNestedHitObjects(){this.nestedHitObjects=[]}applyDefaultsToSelf(e,t){this.kiai=e.effectPointAt(this.startTime+1).kiai,this.hitWindows?.setDifficulty(t.overallDifficulty)}applyDefaultsToNested(e,t){this.nestedHitObjects.forEach(r=>{r.applyDefaults(e,t)})}applyDefaults(e,t){this.applyDefaultsToSelf(e,t),this.nestedHitObjects=[],this.createNestedHitObjects(),this.nestedHitObjects.sort((r,i)=>r.startTime-i.startTime),this.applyDefaultsToNested(e,t)}clone(){const e=this.constructor,t=new e;return t.startPosition=this.startPosition.clone(),t.startTime=this.startTime,t.hitType=this.hitType,t.hitSound=this.hitSound,t.samples=this.samples.map(r=>r.clone()),t.kiai=this.kiai,t}}class dt{static BEZIER_TOLERANCE=Math.fround(.25);static CIRCULAR_ARC_TOLERANCE=Math.fround(.1);static CATMULL_DETAIL=50;static approximateBezier(e){return this.approximateBSpline(e)}static approximateBSpline(e,t=0){const r=[],i=e.length-1;if(i<0)return r;const s=[],o=[],u=e.slice();if(t>0&&t<i){for(let d=0;d<i-t;++d){const m=[u[d]];for(let D=0;D<t-1;++D){m[D+1]=u[d+1];for(let g=1;g<t-D;++g){const F=Math.min(g,i-t-d);u[d+g]=u[d+g].fscale(F).fadd(u[d+g+1]).fdivide(F+1)}}m[t]=u[d+1],s.push(m)}s.push(u.slice(i-t)),s.reverse()}else t=i,s.push(u);const l=[],c=[],h=c;for(;s.length>0;){const d=s.pop()||[];if(this._bezierIsFlatEnough(d)){this._bezierApproximate(d,r,l,c,t+1),o.push(d);continue}const m=o.pop()||[];this._bezierSubdivide(d,h,m,l,t+1);for(let D=0;D<t+1;++D)d[D]=h[D];s.push(m),s.push(d)}return r.push(e[i]),r}static approximateCatmull(e){const t=[],r=e.length;for(let i=0;i<r-1;i++){const s=i>0?e[i-1]:e[i],o=e[i],u=i<r-1?e[i+1]:o.fadd(o).fsubtract(s),l=i<r-2?e[i+2]:u.fadd(u).fsubtract(o);for(let c=0;c<dt.CATMULL_DETAIL;c++)t.push(dt._catmullFindPoint(s,o,u,l,Math.fround(Math.fround(c)/dt.CATMULL_DETAIL))),t.push(dt._catmullFindPoint(s,o,u,l,Math.fround(Math.fround(c+1)/dt.CATMULL_DETAIL)))}return t}static approximateCircularArc(e){const t=this._circularArcProperties(e);if(!t.isValid)return this.approximateBezier(e);let r=2;if(2*t.radius>dt.CIRCULAR_ARC_TOLERANCE){let s=Math.fround(dt.CIRCULAR_ARC_TOLERANCE/t.radius);s=Math.fround(1-s),s=Math.fround(2*Math.fround(Math.acos(s)));const o=Math.ceil(Math.fround(t.thetaRange/s)),u=isFinite(o)?o:-2147483648;r=Math.max(2,u)}const i=[];for(let s=0;s<r;++s){const o=s/(r-1),u=t.thetaStart+t.direction*o*t.thetaRange,l=new ae(Math.fround(Math.cos(u)),Math.fround(Math.sin(u)));i.push(l.fscale(t.radius).fadd(t.centre))}return i}static _circularArcProperties(e){const t=e[0],r=e[1],i=e[2],s=Math.fround(Math.fround(r.floatY-t.floatY)*Math.fround(i.floatX-t.floatX)-Math.fround(r.floatX-t.floatX)*Math.fround(i.floatY-t.floatY));if(Math.abs(s)<Math.fround(.001))return new Va;const o=Math.fround(2*Math.fround(Math.fround(t.floatX*r.fsubtract(i).floatY)+Math.fround(r.floatX*i.fsubtract(t).floatY)+Math.fround(i.floatX*t.fsubtract(r).floatY))),u=Math.fround(Math.fround(t.floatX*t.floatX)+Math.fround(t.floatY*t.floatY)),l=Math.fround(Math.fround(r.floatX*r.floatX)+Math.fround(r.floatY*r.floatY)),c=Math.fround(Math.fround(i.floatX*i.floatX)+Math.fround(i.floatY*i.floatY)),h=new ae(Math.fround(Math.fround(Math.fround(u*r.fsubtract(i).floatY)+Math.fround(l*i.fsubtract(t).floatY))+Math.fround(c*t.fsubtract(r).floatY)),Math.fround(Math.fround(Math.fround(u*i.fsubtract(r).floatX)+Math.fround(l*t.fsubtract(i).floatX))+Math.fround(c*r.fsubtract(t).floatX))).fdivide(o),d=t.fsubtract(h),m=i.fsubtract(h),D=d.flength(),g=Math.atan2(d.floatY,d.floatX);let F=Math.atan2(m.floatY,m.floatX);for(;F<g;)F+=2*Math.PI;let T=1,E=F-g,C=i.fsubtract(t);return C=new ae(C.floatY,-C.floatX),C.fdot(r.fsubtract(t))<0&&(T=-T,E=2*Math.PI-E),new Va(g,E,T,D,h)}static approximateLinear(e){return e.slice()}static approximateLagrangePolynomial(e){const r=[],i=zh(e);let s=e[0].floatX,o=e[0].floatX;for(let l=1,c=e.length;l<c;l++)s=Math.min(s,e[l].floatX),o=Math.max(o,e[l].floatX);const u=o-s;for(let l=0;l<51;l++){const c=s+u/50*l,h=Math.fround(jh(e,i,c));r.push(new ae(c,h))}return r}static _bezierIsFlatEnough(e){let t;for(let r=1,i=e.length;r<i-1;r++)if(t=e[r-1].fsubtract(e[r].fscale(2)).fadd(e[r+1]),t.flength()**2>dt.BEZIER_TOLERANCE**2*4)return!1;return!0}static _bezierSubdivide(e,t,r,i,s){const o=i;for(let u=0;u<s;++u)o[u]=e[u];for(let u=0;u<s;++u){t[u]=o[0],r[s-u-1]=o[s-u-1];for(let l=0;l<s-u-1;l++)o[l]=o[l].fadd(o[l+1]).fdivide(2)}}static _bezierApproximate(e,t,r,i,s){const o=i,u=r;dt._bezierSubdivide(e,o,u,r,s);for(let l=0;l<s-1;++l)o[s+l]=u[l+1];t.push(e[0]);for(let l=1;l<s-1;++l){const c=2*l,h=o[c-1].fadd(o[c].fscale(2)).fadd(o[c+1]).fscale(Math.fround(.25));t.push(h)}}static _catmullFindPoint(e,t,r,i,s){const o=Math.fround(s*s),u=Math.fround(s*o),l=[];for(let c=0;c<=1;++c){const h=c===0?e.floatX:e.floatY,d=c===0?t.floatX:t.floatY,m=c===0?r.floatX:r.floatY,D=c===0?i.floatX:i.floatY,g=Math.fround(2*d),F=Math.fround(m-h),T=Math.fround(2*h),E=Math.fround(5*d),C=Math.fround(4*m),x=Math.fround(3*d),B=Math.fround(3*m),W=Math.fround(F*s),j=Math.fround(T-E),q=Math.fround(j+C),J=Math.fround(q-D),K=Math.fround(J),re=Math.fround(x-h),oe=Math.fround(re-B),_=Math.fround(oe+D),A=Math.fround(K*o),v=Math.fround(_*u),S=Math.fround(g+W),O=Math.fround(S+A),I=Math.fround(O+v);l.push(Math.fround(Math.fround(.5)*I))}return new ae(l[0],l[1])}}class Va{isValid;thetaStart;thetaRange;direction;radius;centre;constructor(e,t,r,i,s){this.isValid=!!(e||t||r||i||s),this.thetaStart=e||0,this.thetaRange=t||0,this.direction=r||0,this.radius=i?Math.fround(i):0,this.centre=s||new ae(0,0)}get thetaEnd(){return this.thetaStart+this.thetaRange*this.direction}}class fs{position;type;constructor(e,t){this.position=e||new ae(0,0),this.type=t||null}}class Vs{_expectedDistance;_controlPoints;_curveType;_calculatedLength=0;_calculatedPath=[];_cumulativeLength=[];_isCached=!1;constructor(e,t,r){this._curveType=e||st.Linear,this._controlPoints=t||[],this._expectedDistance=r||0}get curveType(){return this._curveType}set curveType(e){this._curveType=e,this.invalidate()}get controlPoints(){return this._controlPoints}set controlPoints(e){this._controlPoints=e,this.invalidate()}get expectedDistance(){return this._expectedDistance}set expectedDistance(e){this._expectedDistance=e,this.invalidate()}get distance(){return this._ensureValid(),this._cumulativeLength.length?this._cumulativeLength[this._cumulativeLength.length-1]:0}set distance(e){this.expectedDistance=e}get calculatedDistance(){return this._ensureValid(),this._calculatedLength}get path(){this._ensureValid();const e=[];for(let t=0;t<this._calculatedPath.length&&!(this._cumulativeLength[t]>=this.expectedDistance);t++)e.push(this._calculatedPath[t]);return e.push(this.positionAt(1)),e}get calculatedPath(){return this._ensureValid(),this._calculatedPath}invalidate(){this._calculatedLength=0,this._calculatedPath=[],this._cumulativeLength=[],this._isCached=!1}calculatePathToProgress(e,t,r){this._ensureValid();const i=this._progressToDistance(t),s=this._progressToDistance(r);let o=0;for(;o<this._calculatedPath.length&&this._cumulativeLength[o]<i;)++o;for(e=[this._interpolateVertices(o,i)];o<this._calculatedPath.length&&this._cumulativeLength[o++]<=s;)e.push(this._calculatedPath[o]);e.push(this._interpolateVertices(o,s))}progressAt(e,t){const r=e*t%1;return Math.trunc(e*t)%2?1-r:r}positionAt(e){this._ensureValid();const t=this._progressToDistance(e);return this._interpolateVertices(this._indexOfDistance(t),t)}curvePositionAt(e,t){return this.positionAt(this.progressAt(e,t))}clone(){const e=this._controlPoints.map(t=>new fs(t.position.clone(),t.type));return new Vs(this._curveType,e,this._expectedDistance)}_ensureValid(){this._isCached||(this._calculatePath(),this._calculateLength(),this._isCached=!0)}_calculatePath(){this._calculatedPath=[];const e=this.controlPoints.length;if(e===0)return;const t=[];for(let i=0;i<e;i++)t[i]=this.controlPoints[i].position;let r=0;for(let i=0;i<e;++i){if(!this.controlPoints[i].type&&i<e-1)continue;const s=t.slice(r,i+1),o=this.controlPoints[r].type||st.Linear;for(const u of this._calculateSubPath(s,o)){const l=this._calculatedPath[this._calculatedPath.length-1];(this._calculatedPath.length===0||!l.equals(u))&&this._calculatedPath.push(u)}r=i}}_calculateSubPath(e,t){switch(t){case st.Linear:return dt.approximateLinear(e);case st.PerfectCurve:{if(e.length!==3)break;const r=dt.approximateCircularArc(e);if(r.length===0)break;return r}case st.Catmull:return dt.approximateCatmull(e)}return dt.approximateBezier(e)}_calculateLength(){this._calculatedLength=0,this._cumulativeLength=[0];for(let e=0,t=this._calculatedPath.length-1;e<t;++e){const r=this._calculatedPath[e+1].fsubtract(this._calculatedPath[e]);this._calculatedLength+=r.flength(),this._cumulativeLength.push(this._calculatedLength)}if(this.expectedDistance&&this._calculatedLength!==this.expectedDistance){const e=this.controlPoints,t=e[e.length-1],r=e[e.length-2];if(e.length>=2&&t.position.equals(r.position)&&this.expectedDistance>this._calculatedLength){this._cumulativeLength.push(this._calculatedLength);return}this._cumulativeLength.pop();let s=this._calculatedPath.length-1;if(this._calculatedLength>this.expectedDistance)for(;this._cumulativeLength.length>0&&this._cumulativeLength[this._cumulativeLength.length-1]>=this.expectedDistance;)this._cumulativeLength.pop(),this._calculatedPath.splice(s--,1);if(s<=0){this._cumulativeLength.push(0);return}const o=this._calculatedPath[s].fsubtract(this._calculatedPath[s-1]).fnormalize(),u=Math.fround(this.expectedDistance-this._cumulativeLength[this._cumulativeLength.length-1]);this._calculatedPath[s]=this._calculatedPath[s-1].fadd(o.fscale(u)),this._cumulativeLength.push(this.expectedDistance)}}_indexOfDistance(e){let t=Vh(this._cumulativeLength,e);return t<0&&(t=~t),t}_progressToDistance(e){return Qn(e)*this.distance}_interpolateVertices(e,t){if(this._calculatedPath.length===0)return new ae(0,0);if(e<=0)return this._calculatedPath[0];if(e>=this._calculatedPath.length)return this._calculatedPath[this._calculatedPath.length-1];const r=this._calculatedPath[e-1],i=this._calculatedPath[e],s=this._cumulativeLength[e-1],o=this._cumulativeLength[e];if(Math.abs(s-o)<.001)return r;const u=(t-s)/(o-s);return r.fadd(i.fsubtract(r).fscale(u))}}class Mn{sampleSet=Ce[Ce.None];hitSound=se[se.Normal];customIndex=0;suffix="";volume=100;isLayered=!1;filename="";clone(){const e=new Mn;return e.sampleSet=this.sampleSet,e.hitSound=this.hitSound,e.customIndex=this.customIndex,e.suffix=this.suffix,e.volume=this.volume,e.isLayered=this.isLayered,e.filename=this.filename,e}}class zs{filename="";volume=100;normalSet=Ce.Normal;additionSet=Ce.Normal;customIndex=0;clone(){const e=new zs;return e.filename=this.filename,e.volume=this.volume,e.normalSet=this.normalSet,e.additionSet=this.additionSet,e.customIndex=this.customIndex,e}}class nu{base;general=new Gs;editor=new Rs;difficulty=new Jn;metadata=new Hs;colors=new Mi;events=new Ns;controlPoints=new Ws;hitObjects=[];fileFormat=14;fileUpdateDate=new Date;originalMode=0;get mode(){return this.originalMode}get length(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[0],t=this.hitObjects[this.hitObjects.length-1],r=t,i=e.startTime;return((r.endTime||t.startTime)-i)/this.difficulty.clockRate}get totalLength(){if(!this.hitObjects.length)return 0;const e=this.hitObjects[this.hitObjects.length-1];return(e.endTime||e.startTime)/this.difficulty.clockRate}_getLongestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((r,i)=>{const s=e?i.beatLengthUnlimited:i.beatLength;return s>=0?Math.max(s,r):r},-1/0);return isFinite(t)?t:Qt.DEFAULT_BEAT_LENGTH}get bpmMin(){return 6e4/this._getLongestBeatLength(!1)*this.difficulty.clockRate}get bpmMinUnlimited(){return 6e4/this._getLongestBeatLength(!0)*this.difficulty.clockRate}_getShortestBeatLength(e){const t=this.controlPoints.timingPoints.reduce((r,i)=>{const s=e?i.beatLengthUnlimited:i.beatLength;return s>=0?Math.min(s,r):r},1/0);return isFinite(t)?t:Qt.DEFAULT_BEAT_LENGTH}get bpmMax(){return 6e4/this._getShortestBeatLength(!1)*this.difficulty.clockRate}get bpmMaxUnlimited(){return 6e4/this._getShortestBeatLength(!0)*this.difficulty.clockRate}_getMostCommonBeatLength(e){if(!this.controlPoints.timingPoints.length)return Qt.DEFAULT_BEAT_LENGTH;const t=this.controlPoints.timingPoints,r=this.hitObjects.at(-1),i=r?.endTime??r?.startTime??t.at(-1)?.startTime??0,s=new Map;return t.forEach((o,u)=>{const l=e?o.beatLengthUnlimited:o.beatLength,c=Gt.round(l*1e3)/1e3;if(s.has(c)||s.set(c,0),o.startTime>i)return;const h=u===0?0:o.startTime,d=u===t.length-1?i:t[u+1].startTime,m=s.get(c)??0;s.set(c,m+(d-h))}),s.size===0?this.bpmMax:[...s.entries()].sort((o,u)=>u[1]-o[1])[0][0]}get bpm(){return 6e4/this._getMostCommonBeatLength(!1)*this.difficulty.clockRate}get bpmUnlimited(){return 6e4/this._getMostCommonBeatLength(!0)*this.difficulty.clockRate}get totalBreakTime(){return(this.events.breaks||[]).reduce((e,t)=>e+t.duration,0)}get hittable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&le.Normal?1:0),0)}get slidable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&le.Slider?1:0),0)}get spinnable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&le.Spinner?1:0),0)}get holdable(){return this.hitObjects.reduce((e,t)=>e+(t.hitType&le.Hold?1:0),0)}clone(){const e=this.constructor,t=new e;return t.general=this.general.clone(),t.editor=this.editor.clone(),t.difficulty=this.difficulty.clone(),t.metadata=this.metadata.clone(),t.colors=this.colors.clone(),t.events=this.events.clone(),t.controlPoints=this.controlPoints.clone(),t.hitObjects=this.hitObjects.map(r=>r.clone()),t.originalMode=this.originalMode,t.fileFormat=this.fileFormat,this.base&&(t.base=this.base),t}}class Xh{convertBeatmap(e){const t=this.createBeatmap();t.general=e.general,t.editor=e.editor,t.difficulty=e.difficulty.clone(),t.metadata=e.metadata,t.colors=e.colors,t.events=e.events,t.controlPoints=e.controlPoints,t.fileFormat=e.fileFormat,t.originalMode=e.originalMode,t.base=e.base??e;for(const r of this.convertHitObjects(t.base))t.hitObjects.push(r);return t.hitObjects.sort((r,i)=>r.startTime-i.startTime),t}}class js{id=0;beatmapsetId=0;creatorId=0;creator="";favourites=0;passcount=0;playcount=0;status=-2;title="Unknown title";artist="Unknown artist";version="Normal";hittable=0;slidable=0;spinnable=0;holdable=0;length=0;bpmMin=0;bpmMax=0;bpm=0;circleSize=0;approachRate=0;overallDifficulty=0;drainRate=0;_ruleset=null;get ruleset(){return this._ruleset}set ruleset(e){this._ruleset=e,this._mods=this.ruleset?.createModCombination(this.rawMods)??null}_rulesetId=0;get rulesetId(){return this.ruleset?.id??this._rulesetId}set rulesetId(e){this._rulesetId=e}_mods=null;get mods(){return this._mods}set mods(e){this._mods=e,this._rawMods=e?.bitwise??0}_rawMods=0;get rawMods(){return this._rawMods}set rawMods(e){this._rawMods!==e&&(this._rawMods=e,this._mods=this.ruleset?.createModCombination(e)??null)}starRating=0;maxCombo=0;isConvert=!1;deletedAt=null;updatedAt=null;hashMD5="";constructor(e={}){Object.assign(this,e)}get totalHits(){return this.hittable+this.slidable+this.spinnable+this.holdable}clone(){const e=this.constructor,t=new e;return Object.assign(t,this),t}equals(e){return e&&this.id!==0&&e.id!==0?this.id===e.id:!1}toJSON(){const e={},t=["ruleset","rawMods","mods"];for(const r in this)r.startsWith("_")||t.includes(r)||(e[r]=this[r]);return{...e,mods:this.mods?.toString()??"NM",rulesetId:this.rulesetId,totalHits:this.totalHits,deletedAt:this.deletedAt?this.deletedAt.getTime()/1e3:null,updatedAt:this.updatedAt?this.updatedAt.getTime()/1e3:null}}static fromJSON(e){return new js({...e,deletedAt:e.deletedAt?new Date(e.deletedAt*1e3):null,updatedAt:e.updatedAt?new Date(e.updatedAt*1e3):null,rawMods:e.mods})}}class Kh{preProcess(e){const r=e.hitObjects.filter(s=>{const o=s;if(typeof o.comboIndex=="number")return o});let i=null;for(let s=0;s<r.length;s++){const o=r[s];s===0&&(r[s].hitType|=le.NewCombo,r[s].isNewCombo=!0),o.comboIndex=i?.comboIndex??0,o.comboIndexWithOffsets=i?.comboIndexWithOffsets??0,o.currentComboIndex=(i?.currentComboIndex??-1)+1,o.isNewCombo&&(o.currentComboIndex=0,o.comboIndex++,o.comboIndexWithOffsets+=o.comboOffset+1,i!==null&&(i.lastInCombo=!0)),i=o}return e}postProcess(e){return e}}let Nt;(function(n){n[n.None=0]="None",n[n.Kiai=1]="Kiai",n[n.OmitFirstBarLine=8]="OmitFirstBarLine"})(Nt||(Nt={}));class Yh{startTime;endTime;constructor(e,t){this.startTime=e,this.endTime=t}get duration(){return this.endTime-this.startTime}get hasEffect(){return this.duration>=650}contains(e){return this.startTime<=e&&e<=this.endTime}}class Si{_baseBeatmap;constructor(e){this._baseBeatmap=e}hitObjects=[];get general(){return this._baseBeatmap.general}set general(e){this._baseBeatmap.general=e}get editor(){return this._baseBeatmap.editor}set editor(e){this._baseBeatmap.editor=e}get difficulty(){return this._baseBeatmap.difficulty}set difficulty(e){this._baseBeatmap.difficulty=e}get metadata(){return this._baseBeatmap.metadata}set metadata(e){this._baseBeatmap.metadata=e}get colors(){return this._baseBeatmap.colors}set colors(e){this._baseBeatmap.colors=e}get events(){return this._baseBeatmap.events}set events(e){this._baseBeatmap.events=e}get controlPoints(){return this._baseBeatmap.controlPoints}set controlPoints(e){this._baseBeatmap.controlPoints=e}get mode(){return this._baseBeatmap.mode}get originalMode(){return this._baseBeatmap.originalMode}get fileFormat(){return this._baseBeatmap.fileFormat}get length(){return this._baseBeatmap.length}get bpmMin(){return this._baseBeatmap.bpmMin}get bpmMax(){return this._baseBeatmap.bpmMax}get bpm(){return this._baseBeatmap.bpm}get totalBreakTime(){return this._baseBeatmap.totalBreakTime}clone(){return new Si(this._baseBeatmap)}}class qh extends nu{clone(){const e=super.clone();return e.mods=this.mods.clone(),e}}class Jh{mods;starRating;maxCombo=0;constructor(e,t){this.mods=e,this.starRating=t}}class Qh{mods;totalPerformance;constructor(e,t){this.mods=e,this.totalPerformance=t}}class Zh{time;attributes;constructor(e,t){this.time=e,this.attributes=t}compareTo(e){return this.time<e.time?-1:this.time>e.time?1:this.time===e.time?0:Number.isFinite(this.time)?1:Number.isFinite(e.time)?-1:0}}class $h{_beatmap;_ruleset;_mods;constructor(e,t){this._beatmap=e,this._ruleset=t,this._mods=e?.mods??this._ruleset.createModCombination()}calculate(e){return this.calculateWithMods(this._mods,e)}*calculateAll(e){for(const t of this._createDifficultyModCombinations())yield this.calculateWithMods(t,e)}calculateWithMods(e,t){const r=this._getWorkingBeatmap(e);t??=r.difficulty.clockRate;const i=this._createSkills(r,e,t);if(!r.hitObjects.length)return this._createDifficultyAttributes(r,e,i,t);for(const s of this._getDifficultyHitObjects(r,t))for(const o of i)o.process(s);return this._createDifficultyAttributes(r,e,i,t)}calculateAt(e,t){return this.calculateWithModsAt(this._mods,e,t)}calculateWithModsAt(e,t,r){if(!t)return this.calculateWithMods(e);const i=this._getWorkingBeatmap(e);r??=i.difficulty.clockRate;const s=this._createSkills(i,e,r);if(!i.hitObjects.length||t<=0)return this._createDifficultyAttributes(i,e,s,r);const o=new Si(i);o.hitObjects=i.hitObjects.slice(0,t);for(const u of this._getDifficultyHitObjects(o,r))for(const l of s)l.process(u);return this._createDifficultyAttributes(o,e,s,r)}calculateTimed(e){return this.calculateTimedWithMods(this._mods,e)}*calculateTimedWithMods(e,t){const r=this._getWorkingBeatmap(e);if(!r.hitObjects.length)return;t??=r.difficulty.clockRate;const i=this._createSkills(r,e,t),s=new Si(r);for(const o of this._getDifficultyHitObjects(r,t)){s.hitObjects.push(o.baseObject);for(const c of i)c.process(o);const u=o.endTime*t,l=this._createDifficultyAttributes(s,e,i,t);yield new Zh(u,l)}}_getWorkingBeatmap(e){const t=this._beatmap,r=this._beatmap.mode===this._ruleset.id,i=t.mods?.equals(e)??!1;if(r&&i)return t;const s=this._beatmap.base??this._beatmap;return this._ruleset.applyToBeatmapWithMods(s,e)}_getDifficultyHitObjects(e,t){return this._sortObjects(this._createDifficultyHitObjects(e,t))}_sortObjects(e){return e.sort((t,r)=>t.startTime-r.startTime)}_createDifficultyModCombinations(){const e=this._ruleset;function*t(r,i){const s=i.reduce((o,u)=>o+u.bitwise,0);yield e.createModCombination(s);for(let o=0;o<r.length;++o){const u=r[o];if(i.find(d=>d.incompatibles&u.bitwise)||i.find(d=>d.bitwise&u.bitwise))continue;const l=r.slice(o+1),c=[...i,u],h=t(l,c);for(const d of h)yield d}}return t(this.difficultyMods,[])}get difficultyMods(){return[]}}class e0{attributes;_ruleset;_score;constructor(e,t,r){this._ruleset=e,this._score=r,this.attributes=t}calculate(e,t){return this.calculateAttributes(e,t).totalPerformance}}class t0{index;baseObject;lastObject;deltaTime;startTime;endTime;_difficultyHitObjects;constructor(e,t,r,i,s){this._difficultyHitObjects=i,this.index=s,this.baseObject=e,this.lastObject=t,this.deltaTime=(e.startTime-t.startTime)/r,this.startTime=e.startTime/r;const o=e;this.endTime=(o?.endTime??e.startTime)/r}previous(e){const t=this.index-(e+1);return this._difficultyHitObjects[t]??null}next(e){const t=this.index+(e+1);return this._difficultyHitObjects[t]??null}}class n0{_mods;constructor(e){this._mods=e}}class r0 extends n0{_decayWeight=.9;_sectionLength=400;_currentSectionPeak=0;_currentSectionEnd=0;_strainPeaks=[];process(e){for(e.index===0&&(this._currentSectionEnd=Math.ceil(e.startTime/this._sectionLength),this._currentSectionEnd*=this._sectionLength);e.startTime>this._currentSectionEnd;)this._saveCurrentPeak(),this._startNewSectionFrom(this._currentSectionEnd,e),this._currentSectionEnd+=this._sectionLength;this._currentSectionPeak=Math.max(this._strainValueAt(e),this._currentSectionPeak)}_saveCurrentPeak(){this._strainPeaks.push(this._currentSectionPeak)}_startNewSectionFrom(e,t){this._currentSectionPeak=this._calculateInitialStrain(e,t)}*getCurrentStrainPeaks(){for(const e of this._strainPeaks)yield e;yield this._currentSectionPeak}get difficultyValue(){let e=0,t=1;const r=[...this.getCurrentStrainPeaks()].filter(i=>i>0);r.sort((i,s)=>s-i);for(const i of r)e+=i*t,t*=this._decayWeight;return e}}class i0 extends r0{_currentStrain=0;_calculateInitialStrain(e,t){const r=t.previous(0)?.startTime??0,i=this._strainDecay(e-r);return this._currentStrain*i}_strainValueAt(e){return this._currentStrain*=this._strainDecay(e.deltaTime),this._currentStrain+=this._strainValueOf(e)*this._skillMultiplier,this._currentStrain}_strainDecay(e){return Math.pow(this._strainDecayBase,e/1e3)}}let N;(function(n){n[n.None=0]="None",n[n.NoFail=1]="NoFail",n[n.Easy=2]="Easy",n[n.TouchDevice=4]="TouchDevice",n[n.Hidden=8]="Hidden",n[n.HardRock=16]="HardRock",n[n.SuddenDeath=32]="SuddenDeath",n[n.DoubleTime=64]="DoubleTime",n[n.Relax=128]="Relax",n[n.HalfTime=256]="HalfTime",n[n.Nightcore=512]="Nightcore",n[n.Flashlight=1024]="Flashlight",n[n.Autoplay=2048]="Autoplay",n[n.SpunOut=4096]="SpunOut",n[n.Relax2=8192]="Relax2",n[n.Perfect=16384]="Perfect",n[n.Key4=32768]="Key4",n[n.Key5=65536]="Key5",n[n.Key6=131072]="Key6",n[n.Key7=262144]="Key7",n[n.Key8=524288]="Key8",n[n.FadeIn=1048576]="FadeIn",n[n.Random=2097152]="Random",n[n.Cinema=4194304]="Cinema",n[n.Target=8388608]="Target",n[n.Key9=16777216]="Key9",n[n.KeyCoop=33554432]="KeyCoop",n[n.Key1=67108864]="Key1",n[n.Key3=134217728]="Key3",n[n.Key2=268435456]="Key2",n[n.ScoreV2=536870912]="ScoreV2",n[n.Mirror=1073741824]="Mirror",n[n.KeyMod=487555072]="KeyMod",n[n.DifficultyDecrease=258]="DifficultyDecrease",n[n.DifficultyIncrease=1616]="DifficultyIncrease"})(N||(N={}));let Xe;(function(n){n[n.DifficultyReduction=0]="DifficultyReduction",n[n.DifficultyIncrease=1]="DifficultyIncrease",n[n.Conversion=2]="Conversion",n[n.Automation=3]="Automation",n[n.Fun=4]="Fun",n[n.System=5]="System"})(Xe||(Xe={}));class Et{bitwise=N.None;type=Xe.Fun;multiplier=1;isRanked=!0;isUserPlayable=!0;incompatibles=N.None;incompatibleMods=[]}class s0 extends Et{name="Autoplay";acronym="AT";bitwise=N.Autoplay;type=Xe.Automation;multiplier=1;isRanked=!1;isUserPlayable=!1;incompatibles=N.NoFail|N.SuddenDeath|N.Perfect|N.Relax|N.Relax2|N.SpunOut|N.Cinema}class a0 extends Et{name="Cinema";acronym="CN";bitwise=N.Cinema;type=Xe.Fun;multiplier=1;isRanked=!1;isUserPlayable=!1;incompatibles=N.NoFail|N.SuddenDeath|N.Perfect|N.Relax|N.Relax2|N.SpunOut|N.Autoplay}class ru extends Et{name="Double Time";acronym="DT";bitwise=N.DoubleTime;type=Xe.DifficultyIncrease;multiplier=1.12;isRanked=!0;incompatibles=N.HalfTime|N.Nightcore;applyToDifficulty(e){e.clockRate=1.5}}class o0 extends Et{name="Easy";acronym="EZ";bitwise=N.Easy;type=Xe.DifficultyReduction;multiplier=.5;isRanked=!0;incompatibles=N.HardRock;applyToDifficulty(e){e.circleSize=Math.fround(e.circleSize*.5),e.approachRate=Math.fround(e.approachRate*.5),e.drainRate=Math.fround(e.drainRate*.5),e.overallDifficulty=Math.fround(e.overallDifficulty*.5)}}class u0 extends Et{name="Flashlight";acronym="FL";bitwise=N.Flashlight;type=Xe.DifficultyIncrease;multiplier=1.12;isRanked=!0;incompatibles=N.None}class l0 extends Et{name="Half Time";acronym="HT";bitwise=N.HalfTime;type=Xe.DifficultyReduction;multiplier=.3;isRanked=!0;incompatibles=N.DoubleTime|N.Nightcore;applyToDifficulty(e){e.clockRate=.75}}class c0 extends Et{name="Hard Rock";acronym="HR";bitwise=N.HardRock;type=Xe.DifficultyIncrease;multiplier=1.06;isRanked=!0;incompatibles=N.Easy;applyToDifficulty(e){const t=Math.fround(1.4),r=Math.fround(e.circleSize*Math.fround(1.3)),i=Math.fround(e.approachRate*t),s=Math.fround(e.drainRate*t),o=Math.fround(e.overallDifficulty*t);e.circleSize=Math.min(r,10),e.approachRate=Math.min(i,10),e.drainRate=Math.min(s,10),e.overallDifficulty=Math.min(o,10)}}class h0 extends Et{name="Hidden";acronym="HD";bitwise=N.Hidden;type=Xe.DifficultyIncrease;multiplier=1.06;isRanked=!0;incompatibles=N.None}class d0 extends ru{name="Nightcore";acronym="NC";bitwise=N.Nightcore;incompatibles=N.HalfTime|N.DoubleTime}class f0 extends Et{name="No Fail";acronym="NF";bitwise=N.NoFail;type=Xe.DifficultyReduction;multiplier=.5;isRanked=!0;incompatibles=N.SuddenDeath|N.Perfect|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class m0 extends Et{name="No Mod";acronym="NM";bitwise=N.None;type=Xe.System;multiplier=1;isRanked=!0;incompatibles=N.None}class p0 extends Et{name="Perfect";acronym="PF";bitwise=N.Perfect;type=Xe.DifficultyIncrease;multiplier=1;isRanked=!0;incompatibles=N.NoFail|N.SuddenDeath|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class g0 extends Et{name="Sudden Death";acronym="SD";bitwise=N.SuddenDeath;type=Xe.DifficultyIncrease;multiplier=1;isRanked=!0;incompatibles=N.NoFail|N.Perfect|N.Autoplay|N.Cinema|N.Relax|N.Relax2}class Ir{acronym;constructor(e){this.acronym=e?.acronym??""}static fromMod(e){return new Ir({acronym:e.acronym})}static fromJSON(e){return new Ir({acronym:e.acronym})}toString(){return this.acronym}toJSON(){return{acronym:this.acronym}}}class _0{_mods=[];constructor(e){const t=this._availableMods;if(typeof e=="number"||typeof e=="string"){let r=this.toBitwise(e),i=1<<30;for(;i>0;){const s=t.find(o=>o.bitwise&r&i);s&&!(this.bitwise&s.incompatibles)&&this._mods.push(s),r&=~i,i>>=1}}if(!this._mods.length){const r=t.find(i=>i.bitwise===0);r&&this._mods.push(r)}this._mods.sort((r,i)=>r.bitwise-i.bitwise)}get all(){return this._mods}get beatmapMods(){return this.all.filter(t=>t.applyToBeatmap)}get hitObjectMods(){return this.all.filter(t=>t.applyToHitObjects)}get difficultyMods(){return this.all.filter(t=>t.applyToDifficulty)}get converterMods(){return this.all.filter(t=>t.applyToConverter)}get names(){return this.all.map(e=>e.name)}get acronyms(){return this.all.map(e=>e.acronym)}get bitwise(){return this.all.reduce((e,t)=>(e|=t.bitwise,t.bitwise===N.Nightcore&&(e|=N.DoubleTime),t.bitwise===N.Perfect&&(e|=N.SuddenDeath),e),0)}get multiplier(){return this.all.reduce((e,t)=>e*t.multiplier,1)}get isRanked(){return this.all.reduce((e,t)=>e&&t.isRanked,!0)}get incompatibles(){return this.all.reduce((e,t)=>e|t.incompatibles,0)}has(e){const t=this.toBitwise(e);return(this.bitwise&t)===t||this.bitwise===t}any(e){return this._mods.some(t=>t instanceof e)}beatmapModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToBeatmap)}beatmapModAt(e){const t=this.toBitwise(e);return this.beatmapModsAt(t)[0]||null}hitObjectModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToHitObjects)}hitObjectModAt(e){const t=this.toBitwise(e);return this.hitObjectModsAt(t)[0]||null}difficultyModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToDifficulty)}difficultyModAt(e){const t=this.toBitwise(e);return this.difficultyModsAt(t)[0]||null}converterModsAt(e){const t=this.toBitwise(e);return this.all.filter(i=>i.bitwise&t&&i.applyToConverter)}converterModAt(e){const t=this.toBitwise(e);return this.converterModsAt(t)[0]||null}modsAt(e){const t=this.toBitwise(e);return this.all.filter(r=>r.bitwise&t)}modAt(e){const t=this.toBitwise(e);return this.modsAt(t)[0]||null}toString(){return this.acronyms.join("")}toJSON(){return this.toString()}toBitwise(e){return typeof e=="number"?Math.max(0,e):typeof e!="string"||!e||e.length%2?0:(e.match(/.{1,2}/g)?.map(r=>r.toUpperCase())??[]).reduce((r,i)=>{const s=this._availableMods.find(o=>o.acronym===i);return r|(s?.bitwise??0)},0)}clone(){const e=this.constructor;return new e(this.bitwise)}equals(e){return this.bitwise===e.bitwise&&this.mode===e.mode}get _availableMods(){return[]}}let It;(function(n){n[n.None=0]="None",n[n.Left1=1]="Left1",n[n.Right1=2]="Right1",n[n.Left2=4]="Left2",n[n.Right2=8]="Right2",n[n.Smoke=16]="Smoke"})(It||(It={}));class iu{startTime;interval;constructor(e,t){this.startTime=e??0,this.interval=t??0}clone(){const e=this.constructor,t=new e;return t.startTime=this.startTime,t.interval=this.interval,t}}class Bi extends iu{buttonState;position;constructor(e,t,r,i){super(e,t),this.position=r??new ae(0,0),this.buttonState=i??It.None}get mouseX(){return this.position.x}get mouseY(){return this.position.y}get mousePosition(){return new ae(this.mouseX??0,this.mouseY??0)}get mouseLeft(){return this.mouseLeft1||this.mouseLeft2}get mouseRight(){return this.mouseRight1||this.mouseRight2}get mouseLeft1(){return(this.buttonState&It.Left1)>0}get mouseRight1(){return(this.buttonState&It.Right1)>0}get mouseLeft2(){return(this.buttonState&It.Left2)>0}get mouseRight2(){return(this.buttonState&It.Right2)>0}get smoke(){return(this.buttonState&It.Smoke)>0}clone(){const e=super.clone();return e.buttonState=this.buttonState,e.position=this.position.clone(),e}}class D0{startTime;health;constructor(e,t){this.startTime=e??0,this.health=t??0}clone(){const e=this.constructor,t=new e;return t.startTime=this.startTime,t.health=this.health,t}}class su{gameVersion=0;mode=0;hashMD5="";frames=[];lifeBar=[];constructor(e={}){Object.assign(this,e)}get length(){if(!this.frames?.length)return 0;const e=this.frames[0].startTime;return this.frames[this.frames.length-1].startTime-e}clone(){const e=this.constructor,t=new e;return t.gameVersion=this.gameVersion,t.mode=this.mode,t.hashMD5=this.hashMD5,t.frames=this.frames.map(r=>r.clone()),t}equals(e){return this.hashMD5===e.hashMD5}}class b0{convertReplay(e,t){const r=this.createReplay();r.gameVersion=e.gameVersion,r.mode=e.mode,r.hashMD5=e.hashMD5,r.lifeBar=e.lifeBar;for(const i of this.convertFrames(e.frames,t))r.frames.push(i);return r}createReplay(){return new su}*convertFrames(e,t){let r=null;for(const i of e){const s=this._convertFrame(i,r,t);yield s,r=s}}_convertFrame(e,t,r){if(this._isConvertedReplayFrame(e))return e;const i=this._createConvertibleReplayFrame();if(i&&e instanceof Bi)return i.fromLegacy(e,t,r);throw new Error("Replay can not be converted to this ruleset!")}}class S0{applyToBeatmap(e){const t=e.mods,r=t?t.bitwise:0,i=this.createModCombination(r);return this.applyToBeatmapWithMods(e,i)}applyToBeatmapWithMods(e,t){t||(t=this.createModCombination(0)),this.id!==t.mode&&(t=this.createModCombination(t.bitwise));const r=this._createBeatmapConverter();if(e.hitObjects.length>0&&!r.canConvert(e))throw new Error("Beatmap can not be converted to this ruleset!");t.converterMods.forEach(o=>o.applyToConverter(r));const i=r.convertBeatmap(e);i.mods=t,t.difficultyMods.forEach(o=>{o.applyToDifficulty(i.difficulty)});const s=this._createBeatmapProcessor();return s.preProcess(i),i.hitObjects.forEach(o=>{o.applyDefaults(i.controlPoints,i.difficulty)}),t.hitObjectMods.forEach(o=>{o.applyToHitObjects(i.hitObjects)}),s.postProcess(i),t.beatmapMods.forEach(o=>o.applyToBeatmap(i)),i}applyToReplay(e,t){if(t&&e.mode!==t.mode)throw new Error("Replay and beatmap mode does not match!");return this._createReplayConverter().convertReplay(e,t)}resetMods(e){const t=this.createModCombination(0);return this.applyToBeatmapWithMods(e,t)}}let za;(function(n){n[n.F=-1]="F",n[n.D=0]="D",n[n.C=1]="C",n[n.B=2]="B",n[n.A=3]="A",n[n.S=4]="S",n[n.SH=5]="SH",n[n.X=6]="X",n[n.XH=7]="XH"})(za||(za={}));class Mt extends Map{static increasesCombo(e){return this.affectsCombo(e)&&this.isHit(e)}static breaksCombo(e){return this.affectsCombo(e)&&!this.isHit(e)}static affectsCombo(e){switch(e){case k.Miss:case k.Meh:case k.Ok:case k.Good:case k.Great:case k.Perfect:case k.LargeTickHit:case k.LargeTickMiss:case k.LegacyComboIncrease:case k.ComboBreak:case k.SliderTailHit:return!0;default:return!1}}static affectsAccuracy(e){switch(e){case k.LegacyComboIncrease:return!1;case k.ComboBreak:return!1;default:return this.isScorable(e)&&!this.isBonus(e)}}static isBasic(e){switch(e){case k.LegacyComboIncrease:return!1;case k.ComboBreak:return!1;default:return this.isScorable(e)&&!this.isTick(e)&&!this.isBonus(e)}}static isTick(e){switch(e){case k.LargeTickHit:case k.LargeTickMiss:case k.SmallTickHit:case k.SmallTickMiss:case k.SliderTailHit:return!0;default:return!1}}static isBonus(e){switch(e){case k.SmallBonus:case k.LargeBonus:return!0;default:return!1}}static isMiss(e){switch(e){case k.IgnoreMiss:case k.Miss:case k.SmallTickMiss:case k.LargeTickMiss:case k.ComboBreak:return!0;default:return!1}}static isHit(e){switch(e){case k.None:case k.IgnoreMiss:case k.Miss:case k.SmallTickMiss:case k.LargeTickMiss:case k.ComboBreak:return!1;default:return!0}}static isScorable(e){switch(e){case k.LegacyComboIncrease:return!0;case k.ComboBreak:return!0;case k.SliderTailHit:return!0;default:return e>=k.Miss&&e<k.IgnoreMiss}}static isValidHitResult(e,t,r){return e===k.None?!1:e===t||e===r?!0:e>t&&e<r}get(e){return super.has(e)||super.set(e,0),super.get(e)}toJSON(){const e={};return this.forEach((t,r)=>{e[Mt._getJsonableKeyFromHitResult(r)]=t}),e}static fromJSON(e){const t=new Mt;return Object.entries(e).forEach(i=>{const s=i[0],o=i[1];t.set(this._getHitResultFromJsonableKey(s),o)}),t}static _getJsonableKeyFromHitResult(e){switch(e){case k.None:return"none";case k.Miss:return"miss";case k.Meh:return"meh";case k.Ok:return"ok";case k.Good:return"good";case k.Great:return"great";case k.Perfect:return"perfect";case k.SmallTickMiss:return"small_tick_miss";case k.SmallTickHit:return"small_tick_hit";case k.LargeTickMiss:return"large_tick_miss";case k.LargeTickHit:return"large_tick_hit";case k.SmallBonus:return"small_bonus";case k.LargeBonus:return"large_bonus";case k.IgnoreMiss:return"ignore_miss";case k.IgnoreHit:return"ignore_hit";case k.ComboBreak:return"combo_break";case k.SliderTailHit:return"slider_tail_hit";case k.LegacyComboIncrease:return"legacy_combo_increase"}}static _getHitResultFromJsonableKey(e){switch(e){case"none":return k.None;case"miss":return k.Miss;case"meh":return k.Meh;case"ok":return k.Ok;case"good":return k.Good;case"great":return k.Great;case"perfect":return k.Perfect;case"small_tick_miss":return k.SmallTickMiss;case"small_tick_hit":return k.SmallTickHit;case"large_tick_miss":return k.LargeTickMiss;case"large_tick_hit":return k.LargeTickHit;case"small_bonus":return k.SmallBonus;case"large_bonus":return k.LargeBonus;case"ignore_miss":return k.IgnoreMiss;case"ignore_hit":return k.IgnoreHit;case"combo_break":return k.ComboBreak;case"slider_tail_hit":return k.SliderTailHit;case"legacy_combo_increase":return k.LegacyComboIncrease}}}class Nr{onlineId;mods;statistics;maximumStatistics;clientVersion;rank;userId;totalScoreWithoutMods;constructor(e){this.onlineId=e?.onlineId??-1,this.mods=e?.mods??[],this.statistics=e?.statistics??new Mt,this.maximumStatistics=e?.maximumStatistics??new Mt,this.clientVersion=e?.clientVersion??"",this.rank=e?.rank??"F",this.userId=e?.userId??-1,this.totalScoreWithoutMods=e?.totalScoreWithoutMods??0}static fromScore(e){return new Nr({onlineId:e.id,mods:e.apiMods,statistics:e.statistics,maximumStatistics:e.maximumStatistics,clientVersion:e.clientVersion,rank:e.rank,userId:e.userId,totalScoreWithoutMods:0})}static fromJSON(e){return new Nr({onlineId:e.online_id,mods:e.mods.map(t=>Ir.fromJSON(t)),statistics:Mt.fromJSON(e.statistics),maximumStatistics:Mt.fromJSON(e.maximum_statistics),clientVersion:e.client_version,rank:e.rank,userId:e.user_id,totalScoreWithoutMods:e.total_score_without_mods})}toJSON(){return{online_id:this.onlineId,mods:this.mods,statistics:this.statistics.toJSON(),maximum_statistics:this.maximumStatistics.toJSON(),client_version:this.clientVersion,rank:this.rank,user_id:this.userId,total_score_without_mods:this.totalScoreWithoutMods}}}class y0{statistics=new Mt;maximumStatistics=new Mt;_legacyCountGeki=0;_legacyCountKatu=0;get countGeki(){return this.rulesetId===3?this.statistics.has(k.Perfect)?this.statistics.get(k.Perfect):this._legacyCountGeki:this._legacyCountGeki}set countGeki(e){this.statistics&&(this.rulesetId===3&&this.statistics.set(k.Perfect,e),this._legacyCountGeki=e)}get count300(){return this.statistics.get(k.Great)}set count300(e){this.statistics&&this.statistics.set(k.Great,e)}get countKatu(){return this.rulesetId===2?this.statistics.has(k.SmallTickMiss)?this.statistics.get(k.SmallTickMiss):this._legacyCountKatu:this.rulesetId===3?this.statistics.has(k.Good)?this.statistics.get(k.Good):this._legacyCountKatu:this._legacyCountKatu}set countKatu(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(k.SmallTickMiss,e),this.rulesetId===3&&this.statistics.set(k.Good,e),this._legacyCountKatu=e)}get count100(){return this.rulesetId===2?this.statistics.get(k.LargeTickHit):this.statistics.get(k.Ok)}set count100(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(k.LargeTickHit,e),this.statistics.set(k.Ok,e))}get count50(){return this.rulesetId===2?this.statistics.get(k.SmallTickHit):this.statistics.get(k.Meh)}set count50(e){this.statistics&&(this.rulesetId===2&&this.statistics.set(k.SmallTickHit,e),this.statistics.set(k.Meh,e))}get countMiss(){return this.statistics.get(k.Miss)}set countMiss(e){this.statistics&&this.statistics.set(k.Miss,e)}get totalHits(){const e=this.countGeki,t=this.countKatu,r=this.count300,i=this.count100,s=this.count50,o=this.countMiss;switch(this.rulesetId){case 0:return r+i+s+o;case 1:return r+i+s+o;case 2:return r+t+i+s+o;case 3:return e+r+t+i+s+o}return e+r+t+i+s+o}}function w0(n){const e=n.countGeki,t=n.countKatu,r=n.count300,i=n.count100,s=n.count50,o=n.totalHits;if(o<=0)return 1;switch(n.rulesetId){case 0:return Qn((s/6+i/3+r)/o);case 1:return Qn((i/2+r)/o);case 2:return Qn((s+i+r)/o);case 3:return Qn((s/6+i/3+t/1.5+(r+e))/o)}return 1}function v0(n){if(!n.passed)return"F";switch(n.rulesetId){case 0:return E0(n);case 1:return A0(n);case 2:return F0(n);case 3:return P0(n)}return"F"}function E0(n){const{count300:e,count50:t,countMiss:r,totalHits:i}=n,s=Math.fround(e/i),o=Math.fround(t/i);return s===1?pn(n)?"XH":"X":s>.9&&o<=.01&&r===0?pn(n)?"SH":"S":s>.8&&r===0||s>.9?"A":s>.7&&r===0||s>.8?"B":s>.6?"C":"D"}function A0(n){const{count300:e,count50:t,countMiss:r,totalHits:i}=n,s=Math.fround(e/i),o=Math.fround(t/i);return s===1?pn(n)?"XH":"X":s>.9&&o<=.01&&r===0?pn(n)?"SH":"S":s>.8&&r===0||s>.9?"A":s>.7&&r===0||s>.8?"B":s>.6?"C":"D"}function F0(n){const e=n.accuracy;return e===1?pn(n)?"XH":"X":e>.98?pn(n)?"SH":"S":e>.94?"A":e>.9?"B":e>.85?"C":"D"}function P0(n){const e=n.accuracy;return e===1?pn(n)?"XH":"X":e>.95?pn(n)?"SH":"S":e>.9?"A":e>.8?"B":e>.7?"C":"D"}function pn(n){if(n.mods)return n.mods.has("HD")||n.mods.has("FL");if(typeof n.rawMods=="number"){const e=(n.rawMods&N.Hidden)>0,t=(n.rawMods&N.Flashlight)>0;return e||t}if(typeof n.rawMods=="string"){const e=n.rawMods.match(/.{1,2}/g)?.map(t=>t.toUpperCase())??[];return e.includes("HD")||e.includes("FL")}return!1}class ki extends y0{id=-1;totalScore=0;totalScoreVersion=0;totalPerformance=null;maxCombo=0;passed=!1;perfect=!1;clientVersion="";isLegacyScore=!1;_ruleset=null;_rulesetId=0;_mods=null;_apiMods=null;_rawMods=0;_accuracy=null;_rank=null;get accuracy(){return this._accuracy??w0(this)}set accuracy(e){this._accuracy=e}get rank(){return this._rank??v0(this)}set rank(e){this._rank=e,this.passed=e!=="F"}get ruleset(){return this._ruleset}set ruleset(e){this._ruleset=e,this._mods=this.ruleset?.createModCombination(this.rawMods)??null}get rulesetId(){return this.ruleset?.id??this._rulesetId}set rulesetId(e){this._rulesetId=e}get apiMods(){return this._apiMods!==null?this._apiMods:this._mods!==null?this._mods.acronyms.map(e=>new Ir({acronym:e})):[]}set apiMods(e){this._apiMods=e}get mods(){return this._mods}set mods(e){this._mods=e,this._rawMods=e?.bitwise??0}get rawMods(){return this._rawMods}set rawMods(e){this._rawMods!==e&&(this._rawMods=e,this._mods=this.ruleset?.createModCombination(e)??null)}username="";userId=0;beatmap=null;beatmapId=0;date=new Date;beatmapHashMD5="";constructor(e={}){super(),Object.assign(this,e)}clone(){const e=this.constructor,t=new e;return Object.assign(t,this),t.statistics=new Mt(this.statistics),t}equals(e){return e&&this.id!==0&&e.id!==0?this.id===e.id:!1}toJSON(){const e={},t=["beatmap","ruleset","rawMods","mods"];for(const r in this)r.startsWith("_")||t.includes(r)||(e[r]=this[r]);return{...e,statistics:this.statistics.toJSON(),beatmap:this.beatmap?.toJSON()??null,mods:this.mods?.toString()??"NM",date:this.date.getTime()/1e3,accuracy:this.accuracy,rank:this.rank,rulesetId:this.rulesetId,countGeki:this.countGeki,count300:this.count300,countKatu:this.countKatu,count100:this.count100,count50:this.count50,countMiss:this.countMiss,totalHits:this.totalHits}}static fromJSON(e){return new ki({...e,rawMods:e.mods,beatmap:e.beatmap?js.fromJSON(e.beatmap):null,statistics:Mt.fromJSON(e.statistics),date:new Date(e.date*1e3)})}}class ja{info=new ki;replay=null;constructor(e,t){e&&(this.info=e),t&&(this.replay=t)}clone(){const e=this.constructor,t=new e;return t.info=this.info.clone(),t.replay=this.replay?.clone()??null,t}equals(e){if(!e)return!1;const t=this.info.equals(e.info);return this.replay===null&&e.replay===null?t:this.replay!==null&&e.replay!==null?t&&this.replay.equals(e.replay):!1}}let Ua;(function(n){n[n.Unknown=0]="Unknown",n[n.BD=1]="BD",n[n.BE=2]="BE",n[n.BF=3]="BF",n[n.BG=4]="BG",n[n.BA=5]="BA",n[n.BB=6]="BB",n[n.WF=7]="WF",n[n.BL=8]="BL",n[n.BM=9]="BM",n[n.BN=10]="BN",n[n.BO=11]="BO",n[n.BH=12]="BH",n[n.BI=13]="BI",n[n.BJ=14]="BJ",n[n.BT=15]="BT",n[n.JM=16]="JM",n[n.BV=17]="BV",n[n.BW=18]="BW",n[n.WS=19]="WS",n[n.BQ=20]="BQ",n[n.BR=21]="BR",n[n.BS=22]="BS",n[n.JE=23]="JE",n[n.BY=24]="BY",n[n.BZ=25]="BZ",n[n.RU=26]="RU",n[n.RW=27]="RW",n[n.RS=28]="RS",n[n.TL=29]="TL",n[n.RE=30]="RE",n[n.TM=31]="TM",n[n.TJ=32]="TJ",n[n.RO=33]="RO",n[n.TK=34]="TK",n[n.GW=35]="GW",n[n.GU=36]="GU",n[n.GT=37]="GT",n[n.GS=38]="GS",n[n.GR=39]="GR",n[n.GQ=40]="GQ",n[n.GP=41]="GP",n[n.JP=42]="JP",n[n.GY=43]="GY",n[n.GG=44]="GG",n[n.GF=45]="GF",n[n.GE=46]="GE",n[n.GD=47]="GD",n[n.GB=48]="GB",n[n.GA=49]="GA",n[n.SV=50]="SV",n[n.GN=51]="GN",n[n.GM=52]="GM",n[n.GL=53]="GL",n[n.GI=54]="GI",n[n.GH=55]="GH",n[n.OM=56]="OM",n[n.TN=57]="TN",n[n.JO=58]="JO",n[n.HR=59]="HR",n[n.HT=60]="HT",n[n.HU=61]="HU",n[n.HK=62]="HK",n[n.HN=63]="HN",n[n.HM=64]="HM",n[n.VE=65]="VE",n[n.PR=66]="PR",n[n.PS=67]="PS",n[n.PW=68]="PW",n[n.PT=69]="PT",n[n.SJ=70]="SJ",n[n.PY=71]="PY",n[n.IQ=72]="IQ",n[n.PA=73]="PA",n[n.PF=74]="PF",n[n.PG=75]="PG",n[n.PE=76]="PE",n[n.PK=77]="PK",n[n.PH=78]="PH",n[n.PN=79]="PN",n[n.PL=80]="PL",n[n.PM=81]="PM",n[n.ZM=82]="ZM",n[n.EH=83]="EH",n[n.EE=84]="EE",n[n.EG=85]="EG",n[n.ZA=86]="ZA",n[n.EC=87]="EC",n[n.IT=88]="IT",n[n.VN=89]="VN",n[n.SB=90]="SB",n[n.ET=91]="ET",n[n.SO=92]="SO",n[n.ZW=93]="ZW",n[n.SA=94]="SA",n[n.ES=95]="ES",n[n.ER=96]="ER",n[n.ME=97]="ME",n[n.MD=98]="MD",n[n.MG=99]="MG",n[n.MF=100]="MF",n[n.MA=101]="MA",n[n.MC=102]="MC",n[n.UZ=103]="UZ",n[n.MM=104]="MM",n[n.ML=105]="ML",n[n.MO=106]="MO",n[n.MN=107]="MN",n[n.MH=108]="MH",n[n.MK=109]="MK",n[n.MU=110]="MU",n[n.MT=111]="MT",n[n.MW=112]="MW",n[n.MV=113]="MV",n[n.MQ=114]="MQ",n[n.MP=115]="MP",n[n.MS=116]="MS",n[n.MR=117]="MR",n[n.IM=118]="IM",n[n.UG=119]="UG",n[n.TZ=120]="TZ",n[n.MY=121]="MY",n[n.MX=122]="MX",n[n.IL=123]="IL",n[n.FR=124]="FR",n[n.IO=125]="IO",n[n.SH=126]="SH",n[n.FI=127]="FI",n[n.FJ=128]="FJ",n[n.FK=129]="FK",n[n.FM=130]="FM",n[n.FO=131]="FO",n[n.NI=132]="NI",n[n.NL=133]="NL",n[n.NO=134]="NO",n[n.NA=135]="NA",n[n.VU=136]="VU",n[n.NC=137]="NC",n[n.NE=138]="NE",n[n.NF=139]="NF",n[n.NG=140]="NG",n[n.NZ=141]="NZ",n[n.NP=142]="NP",n[n.NR=143]="NR",n[n.NU=144]="NU",n[n.CK=145]="CK",n[n.XK=146]="XK",n[n.CI=147]="CI",n[n.CH=148]="CH",n[n.CO=149]="CO",n[n.CN=150]="CN",n[n.CM=151]="CM",n[n.CL=152]="CL",n[n.CC=153]="CC",n[n.CA=154]="CA",n[n.CG=155]="CG",n[n.CF=156]="CF",n[n.CD=157]="CD",n[n.CZ=158]="CZ",n[n.CY=159]="CY",n[n.CX=160]="CX",n[n.CR=161]="CR",n[n.CW=162]="CW",n[n.CV=163]="CV",n[n.CU=164]="CU",n[n.SZ=165]="SZ",n[n.SY=166]="SY",n[n.SX=167]="SX",n[n.KG=168]="KG",n[n.KE=169]="KE",n[n.SS=170]="SS",n[n.SR=171]="SR",n[n.KI=172]="KI",n[n.KH=173]="KH",n[n.KN=174]="KN",n[n.KM=175]="KM",n[n.ST=176]="ST",n[n.SK=177]="SK",n[n.KR=178]="KR",n[n.SI=179]="SI",n[n.KP=180]="KP",n[n.KW=181]="KW",n[n.SN=182]="SN",n[n.SM=183]="SM",n[n.SL=184]="SL",n[n.SC=185]="SC",n[n.KZ=186]="KZ",n[n.KY=187]="KY",n[n.SG=188]="SG",n[n.SE=189]="SE",n[n.SD=190]="SD",n[n.DO=191]="DO",n[n.DM=192]="DM",n[n.DJ=193]="DJ",n[n.DK=194]="DK",n[n.VG=195]="VG",n[n.DE=196]="DE",n[n.YE=197]="YE",n[n.DZ=198]="DZ",n[n.US=199]="US",n[n.UY=200]="UY",n[n.YT=201]="YT",n[n.UM=202]="UM",n[n.LB=203]="LB",n[n.LC=204]="LC",n[n.LA=205]="LA",n[n.TV=206]="TV",n[n.TW=207]="TW",n[n.TT=208]="TT",n[n.TR=209]="TR",n[n.LK=210]="LK",n[n.LI=211]="LI",n[n.LV=212]="LV",n[n.TO=213]="TO",n[n.LT=214]="LT",n[n.LU=215]="LU",n[n.LR=216]="LR",n[n.LS=217]="LS",n[n.TH=218]="TH",n[n.TF=219]="TF",n[n.TG=220]="TG",n[n.TD=221]="TD",n[n.TC=222]="TC",n[n.LY=223]="LY",n[n.VA=224]="VA",n[n.VC=225]="VC",n[n.AE=226]="AE",n[n.AD=227]="AD",n[n.AG=228]="AG",n[n.AF=229]="AF",n[n.AI=230]="AI",n[n.VI=231]="VI",n[n.IS=232]="IS",n[n.IR=233]="IR",n[n.AM=234]="AM",n[n.AL=235]="AL",n[n.AO=236]="AO",n[n.AQ=237]="AQ",n[n.AS=238]="AS",n[n.AR=239]="AR",n[n.AU=240]="AU",n[n.AT=241]="AT",n[n.AW=242]="AW",n[n.IN=243]="IN",n[n.AX=244]="AX",n[n.AZ=245]="AZ",n[n.IE=246]="IE",n[n.ID=247]="ID",n[n.UA=248]="UA",n[n.QA=249]="QA",n[n.MZ=250]="MZ"})(Ua||(Ua={}));var Us=(function(){var n=1,e=2,t=3,r=typeof setImmediate=="function"?setImmediate:setTimeout,i=4294967296,s=[4294967295,-i],o=[0,-9223372036854776e3],u=[0,0],l=[1,0];function c(a,f){postMessage({action:t,cbn:f,result:a})}function h(a){var f=[];return f[a-1]=void 0,f}function d(a,f){return g(a[0]+f[0],a[1]+f[1])}function m(a,f){return C(~~Math.max(Math.min(a[1]/i,2147483647),-2147483648)&~~Math.max(Math.min(f[1]/i,2147483647),-2147483648),E(a)&E(f))}function D(a,f){var p,b;return a[0]==f[0]&&a[1]==f[1]?0:(p=a[1]<0,b=f[1]<0,p&&!b?-1:!p&&b?1:q(a,f)[1]<0?-1:1)}function g(a,f){var p,b;for(f%=18446744073709552e3,a%=18446744073709552e3,p=f%i,b=Math.floor(a/i)*i,f=f-p+b,a=a-b+p;a<0;)a+=i,f-=i;for(;a>4294967295;)a-=i,f+=i;for(f=f%18446744073709552e3;f>9223372032559809e3;)f-=18446744073709552e3;for(;f<-9223372036854776e3;)f+=18446744073709552e3;return[a,f]}function F(a,f){return a[0]==f[0]&&a[1]==f[1]}function T(a){return a>=0?[a,0]:[a+i,-i]}function E(a){return a[0]>=2147483648?~~Math.max(Math.min(a[0]-i,2147483647),-2147483648):~~Math.max(Math.min(a[0],2147483647),-2147483648)}function C(a,f){var p,b;return p=a*i,b=f,f<0&&(b+=i),[b,p]}function x(a){return a<=30?1<<a:x(30)*x(a-30)}function B(a,f){var p,b,w,P;if(f&=63,F(a,o))return f?u:a;if(a[1]<0)throw new Error("Neg");return P=x(f),b=a[1]*P%18446744073709552e3,w=a[0]*P,p=w-w%i,b+=p,w-=p,b>=9223372036854776e3&&(b-=18446744073709552e3),[w,b]}function W(a,f){var p;return f&=63,p=x(f),g(Math.floor(a[0]/p),a[1]/p)}function j(a,f){var p;return f&=63,p=W(a,f),a[1]<0&&(p=d(p,B([2,0],63-f))),p}function q(a,f){return g(a[0]-f[0],a[1]-f[1])}function J(a,f){return a.buf=f,a.pos=0,a.count=f.length,a}function K(a){return a.pos>=a.count?-1:a.buf[a.pos++]&255}function re(a,f,p,b){return a.pos>=a.count?-1:(b=Math.min(b,a.count-a.pos),O(a.buf,a.pos,f,p,b),a.pos+=b,b)}function oe(a){return a.buf=h(32),a.count=0,a}function _(a){var f=a.buf;return f.length=a.count,f}function A(a,f){a.buf[a.count++]=f<<24>>24}function v(a,f,p,b){O(f,p,a.buf,a.count,b),a.count+=b}function S(a,f,p,b,w){var P;for(P=f;P<p;++P)b[w++]=a.charCodeAt(P)}function O(a,f,p,b,w){for(var P=0;P<w;++P)p[b+P]=a[f+P]}function I(a,f){rc(f,1<<a.s),f._numFastBytes=a.f,ic(f,a.m),f._numLiteralPosStateBits=0,f._numLiteralContextBits=3,f._posStateBits=2,f._posStateMask=3}function R(a,f,p,b,w){var P,L;if(D(b,s)<0)throw new Error("invalid length "+b);for(a.length_0=b,P=Zl({}),I(w,P),P._writeEndMark=typeof Us.disableEndMark>"u",sc(P,p),L=0;L<64;L+=8)A(p,E(W(b,L))&255);a.chunker=(P._needReleaseMFStream=0,P._inStream=f,P._finished=0,Ql(P),P._rangeEncoder.Stream=p,tc(P),_a(P),ga(P),P._lenEncoder._tableSize=P._numFastBytes+1-2,Ea(P._lenEncoder,1<<P._posStateBits),P._repMatchLenEncoder._tableSize=P._numFastBytes+1-2,Ea(P._repMatchLenEncoder,1<<P._posStateBits),P.nowPos64=u,Bl({},P))}function Y(a,f,p){return a.output=oe({}),R(a,J({},f),a.output,T(f.length),p),a}function fe(a,f,p){var b,w="",P,L=[],Q,$;for(P=0;P<5;++P){if(Q=K(f),Q==-1)throw new Error("truncated input");L[P]=Q<<24>>24}if(b=Nl({}),!Hl(b,L))throw new Error("corrupted input");for(P=0;P<64;P+=8){if(Q=K(f),Q==-1)throw new Error("truncated input");Q=Q.toString(16),Q.length==1&&(Q="0"+Q),w=Q+""+w}/^0+$|^f+$/i.test(w)?a.length_0=s:($=parseInt(w,16),$>4294967295?a.length_0=s:a.length_0=T($)),a.chunker=Ol(b,f,p,a.length_0)}function _e(a,f){return a.output=oe({}),fe(a,J({},f),a.output),a}function Re(a,f,p,b){var w;a._keepSizeBefore=f,a._keepSizeAfter=p,w=f+p+b,(a._bufferBase==null||a._blockSize!=w)&&(a._bufferBase=null,a._blockSize=w,a._bufferBase=h(a._blockSize)),a._pointerToLastSafePosition=a._blockSize-p}function Me(a,f){return a._bufferBase[a._bufferOffset+a._pos+f]}function Hn(a,f,p,b){var w,P;for(a._streamEndWasReached&&a._pos+f+b>a._streamPos&&(b=a._streamPos-(a._pos+f)),++p,P=a._bufferOffset+a._pos+f,w=0;w<b&&a._bufferBase[P+w]==a._bufferBase[P+w-p];++w);return w}function ur(a){return a._streamPos-a._pos}function wl(a){var f,p,b;for(b=a._bufferOffset+a._pos-a._keepSizeBefore,b>0&&--b,p=a._bufferOffset+a._streamPos-b,f=0;f<p;++f)a._bufferBase[f]=a._bufferBase[b+f];a._bufferOffset-=b}function vl(a){var f;++a._pos,a._pos>a._posLimit&&(f=a._bufferOffset+a._pos,f>a._pointerToLastSafePosition&&wl(a),aa(a))}function aa(a){var f,p,b;if(!a._streamEndWasReached)for(;;){if(b=-a._bufferOffset+a._blockSize-a._streamPos,!b)return;if(f=re(a._stream,a._bufferBase,a._bufferOffset+a._streamPos,b),f==-1){a._posLimit=a._streamPos,p=a._bufferOffset+a._posLimit,p>a._pointerToLastSafePosition&&(a._posLimit=a._pointerToLastSafePosition-a._bufferOffset),a._streamEndWasReached=1;return}a._streamPos+=f,a._streamPos>=a._pos+a._keepSizeAfter&&(a._posLimit=a._streamPos-a._keepSizeAfter)}}function oa(a,f){a._bufferOffset+=f,a._posLimit-=f,a._pos-=f,a._streamPos-=f}var Ur=(function(){var a,f,p,b=[];for(a=0;a<256;++a){for(p=a,f=0;f<8;++f)(p&1)!=0?p=p>>>1^-306674912:p>>>=1;b[a]=p}return b})();function El(a,f,p,b,w){var P,L,Q;f<1073741567&&(a._cutValue=16+(b>>1),Q=~~((f+p+b+w)/2)+256,Re(a,f+p,b+w,Q),a._matchMaxLen=b,P=f+1,a._cyclicBufferSize!=P&&(a._son=h((a._cyclicBufferSize=P)*2)),L=65536,a.HASH_ARRAY&&(L=f-1,L|=L>>1,L|=L>>2,L|=L>>4,L|=L>>8,L>>=1,L|=65535,L>16777216&&(L>>=1),a._hashMask=L,++L,L+=a.kFixHashSize),L!=a._hashSizeSum&&(a._hash=h(a._hashSizeSum=L)))}function Al(a,f){var p,b,w,P,L,Q,$,Z,ee,Pe,he,me,Je,te,ye,Ke,we,At,tt,Ft,kt;if(a._pos+a._matchMaxLen<=a._streamPos)te=a._matchMaxLen;else if(te=a._streamPos-a._pos,te<a.kMinMatchCheck)return Xr(a),0;for(we=0,ye=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,b=a._bufferOffset+a._pos,Ke=1,Z=0,ee=0,a.HASH_ARRAY?(kt=Ur[a._bufferBase[b]&255]^a._bufferBase[b+1]&255,Z=kt&1023,kt^=(a._bufferBase[b+2]&255)<<8,ee=kt&65535,Pe=(kt^Ur[a._bufferBase[b+3]&255]<<5)&a._hashMask):Pe=a._bufferBase[b]&255^(a._bufferBase[b+1]&255)<<8,w=a._hash[a.kFixHashSize+Pe]||0,a.HASH_ARRAY&&(P=a._hash[Z]||0,L=a._hash[1024+ee]||0,a._hash[Z]=a._pos,a._hash[1024+ee]=a._pos,P>ye&&a._bufferBase[a._bufferOffset+P]==a._bufferBase[b]&&(f[we++]=Ke=2,f[we++]=a._pos-P-1),L>ye&&a._bufferBase[a._bufferOffset+L]==a._bufferBase[b]&&(L==P&&(we-=2),f[we++]=Ke=3,f[we++]=a._pos-L-1,P=L),we!=0&&P==w&&(we-=2,Ke=1)),a._hash[a.kFixHashSize+Pe]=a._pos,tt=(a._cyclicBufferPos<<1)+1,Ft=a._cyclicBufferPos<<1,me=Je=a.kNumHashDirectBytes,a.kNumHashDirectBytes!=0&&w>ye&&a._bufferBase[a._bufferOffset+w+a.kNumHashDirectBytes]!=a._bufferBase[b+a.kNumHashDirectBytes]&&(f[we++]=Ke=a.kNumHashDirectBytes,f[we++]=a._pos-w-1),p=a._cutValue;;){if(w<=ye||p--==0){a._son[tt]=a._son[Ft]=0;break}if($=a._pos-w,Q=($<=a._cyclicBufferPos?a._cyclicBufferPos-$:a._cyclicBufferPos-$+a._cyclicBufferSize)<<1,At=a._bufferOffset+w,he=me<Je?me:Je,a._bufferBase[At+he]==a._bufferBase[b+he]){for(;++he!=te&&a._bufferBase[At+he]==a._bufferBase[b+he];);if(Ke<he&&(f[we++]=Ke=he,f[we++]=$-1,he==te)){a._son[Ft]=a._son[Q],a._son[tt]=a._son[Q+1];break}}(a._bufferBase[At+he]&255)<(a._bufferBase[b+he]&255)?(a._son[Ft]=w,Ft=Q+1,w=a._son[Ft],Je=he):(a._son[tt]=w,tt=Q,w=a._son[tt],me=he)}return Xr(a),we}function Fl(a){a._bufferOffset=0,a._pos=0,a._streamPos=0,a._streamEndWasReached=0,aa(a),a._cyclicBufferPos=0,oa(a,-1)}function Xr(a){var f;++a._cyclicBufferPos>=a._cyclicBufferSize&&(a._cyclicBufferPos=0),vl(a),a._pos==1073741823&&(f=a._pos-a._cyclicBufferSize,ua(a._son,a._cyclicBufferSize*2,f),ua(a._hash,a._hashSizeSum,f),oa(a,f))}function ua(a,f,p){var b,w;for(b=0;b<f;++b)w=a[b]||0,w<=p?w=0:w-=p,a[b]=w}function Pl(a,f){a.HASH_ARRAY=f>2,a.HASH_ARRAY?(a.kNumHashDirectBytes=0,a.kMinMatchCheck=4,a.kFixHashSize=66560):(a.kNumHashDirectBytes=2,a.kMinMatchCheck=3,a.kFixHashSize=0)}function Tl(a,f){var p,b,w,P,L,Q,$,Z,ee,Pe,he,me,Je,te,ye,Ke,we;do{if(a._pos+a._matchMaxLen<=a._streamPos)me=a._matchMaxLen;else if(me=a._streamPos-a._pos,me<a.kMinMatchCheck){Xr(a);continue}for(Je=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,b=a._bufferOffset+a._pos,a.HASH_ARRAY?(we=Ur[a._bufferBase[b]&255]^a._bufferBase[b+1]&255,Q=we&1023,a._hash[Q]=a._pos,we^=(a._bufferBase[b+2]&255)<<8,$=we&65535,a._hash[1024+$]=a._pos,Z=(we^Ur[a._bufferBase[b+3]&255]<<5)&a._hashMask):Z=a._bufferBase[b]&255^(a._bufferBase[b+1]&255)<<8,w=a._hash[a.kFixHashSize+Z],a._hash[a.kFixHashSize+Z]=a._pos,ye=(a._cyclicBufferPos<<1)+1,Ke=a._cyclicBufferPos<<1,Pe=he=a.kNumHashDirectBytes,p=a._cutValue;;){if(w<=Je||p--==0){a._son[ye]=a._son[Ke]=0;break}if(L=a._pos-w,P=(L<=a._cyclicBufferPos?a._cyclicBufferPos-L:a._cyclicBufferPos-L+a._cyclicBufferSize)<<1,te=a._bufferOffset+w,ee=Pe<he?Pe:he,a._bufferBase[te+ee]==a._bufferBase[b+ee]){for(;++ee!=me&&a._bufferBase[te+ee]==a._bufferBase[b+ee];);if(ee==me){a._son[Ke]=a._son[P],a._son[ye]=a._son[P+1];break}}(a._bufferBase[te+ee]&255)<(a._bufferBase[b+ee]&255)?(a._son[Ke]=w,Ke=P+1,w=a._son[Ke],he=ee):(a._son[ye]=w,ye=P,w=a._son[ye],Pe=ee)}Xr(a)}while(--f!=0)}function Cl(a,f,p){var b=a._pos-f-1;for(b<0&&(b+=a._windowSize);p!=0;--p)b>=a._windowSize&&(b=0),a._buffer[a._pos++]=a._buffer[b++],a._pos>=a._windowSize&&Kr(a)}function Ml(a,f){(a._buffer==null||a._windowSize!=f)&&(a._buffer=h(f)),a._windowSize=f,a._pos=0,a._streamPos=0}function Kr(a){var f=a._pos-a._streamPos;f&&(v(a._stream,a._buffer,a._streamPos,f),a._pos>=a._windowSize&&(a._pos=0),a._streamPos=a._pos)}function la(a,f){var p=a._pos-f-1;return p<0&&(p+=a._windowSize),a._buffer[p]}function xl(a,f){a._buffer[a._pos++]=f,a._pos>=a._windowSize&&Kr(a)}function ca(a){Kr(a),a._stream=null}function Yr(a){return a-=2,a<4?a:3}function un(a){return a<4?0:a<10?a-3:a-6}function Bl(a,f){return a.encoder=f,a.decoder=null,a.alive=1,a}function kl(a,f){return a.decoder=f,a.encoder=null,a.alive=1,a}function qr(a){if(!a.alive)throw new Error("bad state");return a.encoder?Ll(a):Rl(a),a.alive}function Rl(a){var f=Il(a.decoder);if(f==-1)throw new Error("corrupted input");a.inBytesProcessed=s,a.outBytesProcessed=a.decoder.nowPos64,(f||D(a.decoder.outSize,u)>=0&&D(a.decoder.nowPos64,a.decoder.outSize)>=0)&&(Kr(a.decoder.m_OutWindow),ca(a.decoder.m_OutWindow),a.decoder.m_RangeDecoder.Stream=null,a.alive=0)}function Ll(a){Jl(a.encoder,a.encoder.processedInSize,a.encoder.processedOutSize,a.encoder.finished),a.inBytesProcessed=a.encoder.processedInSize[0],a.encoder.finished[0]&&(nc(a.encoder),a.alive=0)}function Ol(a,f,p,b){return a.m_RangeDecoder.Stream=f,ca(a.m_OutWindow),a.m_OutWindow._stream=p,Gl(a),a.state=0,a.rep0=0,a.rep1=0,a.rep2=0,a.rep3=0,a.outSize=b,a.nowPos64=u,a.prevByte=0,kl({},a)}function Il(a){var f,p,b,w,P,L;if(L=E(a.nowPos64)&a.m_PosStateMask,!ct(a.m_RangeDecoder,a.m_IsMatchDecoders,(a.state<<4)+L))f=jl(a.m_LiteralDecoder,E(a.nowPos64),a.prevByte),a.state<7?a.prevByte=Xl(f,a.m_RangeDecoder):a.prevByte=Kl(f,a.m_RangeDecoder,la(a.m_OutWindow,a.rep0)),xl(a.m_OutWindow,a.prevByte),a.state=un(a.state),a.nowPos64=d(a.nowPos64,l);else{if(ct(a.m_RangeDecoder,a.m_IsRepDecoders,a.state))b=0,ct(a.m_RangeDecoder,a.m_IsRepG0Decoders,a.state)?(ct(a.m_RangeDecoder,a.m_IsRepG1Decoders,a.state)?(ct(a.m_RangeDecoder,a.m_IsRepG2Decoders,a.state)?(p=a.rep3,a.rep3=a.rep2):p=a.rep2,a.rep2=a.rep1):p=a.rep1,a.rep1=a.rep0,a.rep0=p):ct(a.m_RangeDecoder,a.m_IsRep0LongDecoders,(a.state<<4)+L)||(a.state=a.state<7?9:11,b=1),b||(b=da(a.m_RepLenDecoder,a.m_RangeDecoder,L)+2,a.state=a.state<7?8:11);else if(a.rep3=a.rep2,a.rep2=a.rep1,a.rep1=a.rep0,b=2+da(a.m_LenDecoder,a.m_RangeDecoder,L),a.state=a.state<7?7:10,P=Qr(a.m_PosSlotDecoder[Yr(b)],a.m_RangeDecoder),P>=4){if(w=(P>>1)-1,a.rep0=(2|P&1)<<w,P<14)a.rep0+=gc(a.m_PosDecoders,a.rep0-P-1,a.m_RangeDecoder,w);else if(a.rep0+=Sc(a.m_RangeDecoder,w-4)<<4,a.rep0+=pc(a.m_PosAlignDecoder,a.m_RangeDecoder),a.rep0<0)return a.rep0==-1?1:-1}else a.rep0=P;if(D(T(a.rep0),a.nowPos64)>=0||a.rep0>=a.m_DictionarySizeCheck)return-1;Cl(a.m_OutWindow,a.rep0,b),a.nowPos64=d(a.nowPos64,T(b)),a.prevByte=la(a.m_OutWindow,0)}return 0}function Nl(a){a.m_OutWindow={},a.m_RangeDecoder={},a.m_IsMatchDecoders=h(192),a.m_IsRepDecoders=h(12),a.m_IsRepG0Decoders=h(12),a.m_IsRepG1Decoders=h(12),a.m_IsRepG2Decoders=h(12),a.m_IsRep0LongDecoders=h(192),a.m_PosSlotDecoder=h(4),a.m_PosDecoders=h(114),a.m_PosAlignDecoder=lr({},4),a.m_LenDecoder=fa({}),a.m_RepLenDecoder=fa({}),a.m_LiteralDecoder={};for(var f=0;f<4;++f)a.m_PosSlotDecoder[f]=lr({},6);return a}function Gl(a){a.m_OutWindow._streamPos=0,a.m_OutWindow._pos=0,Te(a.m_IsMatchDecoders),Te(a.m_IsRep0LongDecoders),Te(a.m_IsRepDecoders),Te(a.m_IsRepG0Decoders),Te(a.m_IsRepG1Decoders),Te(a.m_IsRepG2Decoders),Te(a.m_PosDecoders),Ul(a.m_LiteralDecoder);for(var f=0;f<4;++f)Te(a.m_PosSlotDecoder[f].Models);ma(a.m_LenDecoder),ma(a.m_RepLenDecoder),Te(a.m_PosAlignDecoder.Models),yc(a.m_RangeDecoder)}function Hl(a,f){var p,b,w,P,L,Q,$;if(f.length<5)return 0;for($=f[0]&255,w=$%9,Q=~~($/9),P=Q%5,L=~~(Q/5),p=0,b=0;b<4;++b)p+=(f[1+b]&255)<<b*8;return p>99999999||!Vl(a,w,P,L)?0:Wl(a,p)}function Wl(a,f){return f<0?0:(a.m_DictionarySize!=f&&(a.m_DictionarySize=f,a.m_DictionarySizeCheck=Math.max(a.m_DictionarySize,1),Ml(a.m_OutWindow,Math.max(a.m_DictionarySizeCheck,4096))),1)}function Vl(a,f,p,b){if(f>8||p>4||b>4)return 0;zl(a.m_LiteralDecoder,p,f);var w=1<<b;return ha(a.m_LenDecoder,w),ha(a.m_RepLenDecoder,w),a.m_PosStateMask=w-1,1}function ha(a,f){for(;a.m_NumPosStates<f;++a.m_NumPosStates)a.m_LowCoder[a.m_NumPosStates]=lr({},3),a.m_MidCoder[a.m_NumPosStates]=lr({},3)}function da(a,f,p){if(!ct(f,a.m_Choice,0))return Qr(a.m_LowCoder[p],f);var b=8;return ct(f,a.m_Choice,1)?b+=8+Qr(a.m_HighCoder,f):b+=Qr(a.m_MidCoder[p],f),b}function fa(a){return a.m_Choice=h(2),a.m_LowCoder=h(16),a.m_MidCoder=h(16),a.m_HighCoder=lr({},8),a.m_NumPosStates=0,a}function ma(a){Te(a.m_Choice);for(var f=0;f<a.m_NumPosStates;++f)Te(a.m_LowCoder[f].Models),Te(a.m_MidCoder[f].Models);Te(a.m_HighCoder.Models)}function zl(a,f,p){var b,w;if(!(a.m_Coders!=null&&a.m_NumPrevBits==p&&a.m_NumPosBits==f))for(a.m_NumPosBits=f,a.m_PosMask=(1<<f)-1,a.m_NumPrevBits=p,w=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=h(w),b=0;b<w;++b)a.m_Coders[b]=Yl({})}function jl(a,f,p){return a.m_Coders[((f&a.m_PosMask)<<a.m_NumPrevBits)+((p&255)>>>8-a.m_NumPrevBits)]}function Ul(a){var f,p;for(p=1<<a.m_NumPrevBits+a.m_NumPosBits,f=0;f<p;++f)Te(a.m_Coders[f].m_Decoders)}function Xl(a,f){var p=1;do p=p<<1|ct(f,a.m_Decoders,p);while(p<256);return p<<24>>24}function Kl(a,f,p){var b,w,P=1;do if(w=p>>7&1,p<<=1,b=ct(f,a.m_Decoders,(1+w<<8)+P),P=P<<1|b,w!=b){for(;P<256;)P=P<<1|ct(f,a.m_Decoders,P);break}while(P<256);return P<<24>>24}function Yl(a){return a.m_Decoders=h(768),a}var Wn=(function(){var a,f,p,b=2,w=[0,1];for(p=2;p<22;++p)for(f=1<<(p>>1)-1,a=0;a<f;++a,++b)w[b]=p<<24>>24;return w})();function pa(a,f){var p,b,w,P;a._optimumEndIndex=f,w=a._optimum[f].PosPrev,b=a._optimum[f].BackPrev;do a._optimum[f].Prev1IsChar&&(Fa(a._optimum[w]),a._optimum[w].PosPrev=w-1,a._optimum[f].Prev2&&(a._optimum[w-1].Prev1IsChar=0,a._optimum[w-1].PosPrev=a._optimum[f].PosPrev2,a._optimum[w-1].BackPrev=a._optimum[f].BackPrev2)),P=w,p=b,b=a._optimum[P].BackPrev,w=a._optimum[P].PosPrev,a._optimum[P].BackPrev=p,a._optimum[P].PosPrev=f,f=P;while(f>0);return a.backRes=a._optimum[0].BackPrev,a._optimumCurrentIndex=a._optimum[0].PosPrev,a._optimumCurrentIndex}function ql(a){a._state=0,a._previousByte=0;for(var f=0;f<4;++f)a._repDistances[f]=0}function Jl(a,f,p,b){var w,P,L,Q,$,Z,ee,Pe,he,me,Je,te,ye,Ke,we;if(f[0]=u,p[0]=u,b[0]=1,a._inStream&&(a._matchFinder._stream=a._inStream,Fl(a._matchFinder),a._needReleaseMFStream=1,a._inStream=null),!a._finished){if(a._finished=1,Ke=a.nowPos64,F(a.nowPos64,u)){if(!ur(a._matchFinder)){ji(a,E(a.nowPos64));return}Ui(a),ye=E(a.nowPos64)&a._posStateMask,He(a._rangeEncoder,a._isMatch,(a._state<<4)+ye,0),a._state=un(a._state),L=Me(a._matchFinder,-a._additionalOffset),Aa(zn(a._literalEncoder,E(a.nowPos64),a._previousByte),a._rangeEncoder,L),a._previousByte=L,--a._additionalOffset,a.nowPos64=d(a.nowPos64,l)}if(!ur(a._matchFinder)){ji(a,E(a.nowPos64));return}for(;;){if(ee=$l(a,E(a.nowPos64)),me=a.backRes,ye=E(a.nowPos64)&a._posStateMask,P=(a._state<<4)+ye,ee==1&&me==-1)He(a._rangeEncoder,a._isMatch,P,0),L=Me(a._matchFinder,-a._additionalOffset),we=zn(a._literalEncoder,E(a.nowPos64),a._previousByte),a._state<7?Aa(we,a._rangeEncoder,L):(he=Me(a._matchFinder,-a._repDistances[0]-1-a._additionalOffset),dc(we,a._rangeEncoder,he,L)),a._previousByte=L,a._state=un(a._state);else{if(He(a._rangeEncoder,a._isMatch,P,1),me<4){if(He(a._rangeEncoder,a._isRep,a._state,1),me?(He(a._rangeEncoder,a._isRepG0,a._state,1),me==1?He(a._rangeEncoder,a._isRepG1,a._state,0):(He(a._rangeEncoder,a._isRepG1,a._state,1),He(a._rangeEncoder,a._isRepG2,a._state,me-2))):(He(a._rangeEncoder,a._isRepG0,a._state,0),ee==1?He(a._rangeEncoder,a._isRep0Long,P,0):He(a._rangeEncoder,a._isRep0Long,P,1)),ee==1?a._state=a._state<7?9:11:(Ki(a._repMatchLenEncoder,a._rangeEncoder,ee-2,ye),a._state=a._state<7?8:11),Q=a._repDistances[me],me!=0){for(Z=me;Z>=1;--Z)a._repDistances[Z]=a._repDistances[Z-1];a._repDistances[0]=Q}}else{for(He(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,Ki(a._lenEncoder,a._rangeEncoder,ee-2,ye),me-=4,te=Xi(me),Pe=Yr(ee),hr(a._posSlotEncoder[Pe],a._rangeEncoder,te),te>=4&&($=(te>>1)-1,w=(2|te&1)<<$,Je=me-w,te<14?Dc(a._posEncoders,w-te-1,a._rangeEncoder,$,Je):(Ta(a._rangeEncoder,Je>>4,$-4),Pa(a._posAlignEncoder,a._rangeEncoder,Je&15),++a._alignPriceCount)),Q=me,Z=3;Z>=1;--Z)a._repDistances[Z]=a._repDistances[Z-1];a._repDistances[0]=Q,++a._matchPriceCount}a._previousByte=Me(a._matchFinder,ee-1-a._additionalOffset)}if(a._additionalOffset-=ee,a.nowPos64=d(a.nowPos64,T(ee)),!a._additionalOffset){if(a._matchPriceCount>=128&&_a(a),a._alignPriceCount>=16&&ga(a),f[0]=a.nowPos64,p[0]=wc(a._rangeEncoder),!ur(a._matchFinder)){ji(a,E(a.nowPos64));return}if(D(q(a.nowPos64,Ke),[4096,0])>=0){a._finished=0,b[0]=0;return}}}}}function Ql(a){var f,p;a._matchFinder||(f={},p=4,a._matchFinderType||(p=2),Pl(f,p),a._matchFinder=f),cc(a._literalEncoder,a._numLiteralPosStateBits,a._numLiteralContextBits),!(a._dictionarySize==a._dictionarySizePrev&&a._numFastBytesPrev==a._numFastBytes)&&(El(a._matchFinder,a._dictionarySize,4096,a._numFastBytes,274),a._dictionarySizePrev=a._dictionarySize,a._numFastBytesPrev=a._numFastBytes)}function Zl(a){var f;for(a._repDistances=h(4),a._optimum=[],a._rangeEncoder={},a._isMatch=h(192),a._isRep=h(12),a._isRepG0=h(12),a._isRepG1=h(12),a._isRepG2=h(12),a._isRep0Long=h(192),a._posSlotEncoder=[],a._posEncoders=h(114),a._posAlignEncoder=cr({},4),a._lenEncoder=va({}),a._repMatchLenEncoder=va({}),a._literalEncoder={},a._matchDistances=[],a._posSlotPrices=[],a._distancesPrices=[],a._alignPrices=h(16),a.reps=h(4),a.repLens=h(4),a.processedInSize=[u],a.processedOutSize=[u],a.finished=[0],a.properties=h(5),a.tempPrices=h(128),a._longestMatchLength=0,a._matchFinderType=1,a._numDistancePairs=0,a._numFastBytesPrev=-1,a.backRes=0,f=0;f<4096;++f)a._optimum[f]={};for(f=0;f<4;++f)a._posSlotEncoder[f]=cr({},6);return a}function ga(a){for(var f=0;f<16;++f)a._alignPrices[f]=_c(a._posAlignEncoder,f);a._alignPriceCount=0}function _a(a){var f,p,b,w,P,L,Q,$;for(w=4;w<128;++w)L=Xi(w),b=(L>>1)-1,f=(2|L&1)<<b,a.tempPrices[w]=bc(a._posEncoders,f-L-1,b,w-f);for(P=0;P<4;++P){for(p=a._posSlotEncoder[P],Q=P<<6,L=0;L<a._distTableSize;++L)a._posSlotPrices[Q+L]=Zr(p,L);for(L=14;L<a._distTableSize;++L)a._posSlotPrices[Q+L]+=(L>>1)-1-4<<6;for($=P*128,w=0;w<4;++w)a._distancesPrices[$+w]=a._posSlotPrices[Q+w];for(;w<128;++w)a._distancesPrices[$+w]=a._posSlotPrices[Q+Xi(w)]+a.tempPrices[w]}a._matchPriceCount=0}function ji(a,f){Sa(a),ac(a,f&a._posStateMask);for(var p=0;p<5;++p)Yi(a._rangeEncoder)}function $l(a,f){var p,b,w,P,L,Q,$,Z,ee,Pe,he,me,Je,te,ye,Ke,we,At,tt,Ft,kt,mt,jn,ei,Pt,Rt,Lt,ht,Wt,Ye,ie,ln,vn,nt,rt,Ba,Tt,fr,En,Vt,Un,mr,ve,Qe,Xn,ka,Ra,La,Oa,Ia;if(a._optimumEndIndex!=a._optimumCurrentIndex)return Je=a._optimum[a._optimumCurrentIndex].PosPrev-a._optimumCurrentIndex,a.backRes=a._optimum[a._optimumCurrentIndex].BackPrev,a._optimumCurrentIndex=a._optimum[a._optimumCurrentIndex].PosPrev,Je;if(a._optimumCurrentIndex=a._optimumEndIndex=0,a._longestMatchWasFound?(me=a._longestMatchLength,a._longestMatchWasFound=0):me=Ui(a),Lt=a._numDistancePairs,Pt=ur(a._matchFinder)+1,Pt<2)return a.backRes=-1,1;for(Pt>273&&(Pt=273),Vt=0,ee=0;ee<4;++ee)a.reps[ee]=a._repDistances[ee],a.repLens[ee]=Hn(a._matchFinder,-1,a.reps[ee],273),a.repLens[ee]>a.repLens[Vt]&&(Vt=ee);if(a.repLens[Vt]>=a._numFastBytes)return a.backRes=Vt,Je=a.repLens[Vt],ba(a,Je-1),Je;if(me>=a._numFastBytes)return a.backRes=a._matchDistances[Lt-1]+4,ba(a,me-1),me;if($=Me(a._matchFinder,-1),we=Me(a._matchFinder,-a._repDistances[0]-1-1),me<2&&$!=we&&a.repLens[Vt]<2)return a.backRes=-1,1;if(a._optimum[0].State=a._state,nt=f&a._posStateMask,a._optimum[1].Price=Ee[a._isMatch[(a._state<<4)+nt]>>>2]+Jr(zn(a._literalEncoder,f,a._previousByte),a._state>=7,we,$),Fa(a._optimum[1]),At=Ee[2048-a._isMatch[(a._state<<4)+nt]>>>2],En=At+Ee[2048-a._isRep[a._state]>>>2],we==$&&(Un=En+ec(a,a._state,nt),Un<a._optimum[1].Price&&(a._optimum[1].Price=Un,mc(a._optimum[1]))),he=me>=a.repLens[Vt]?me:a.repLens[Vt],he<2)return a.backRes=a._optimum[1].BackPrev,1;a._optimum[1].PosPrev=0,a._optimum[0].Backs0=a.reps[0],a._optimum[0].Backs1=a.reps[1],a._optimum[0].Backs2=a.reps[2],a._optimum[0].Backs3=a.reps[3],Pe=he;do a._optimum[Pe--].Price=268435455;while(Pe>=2);for(ee=0;ee<4;++ee)if(fr=a.repLens[ee],!(fr<2)){Ba=En+Vn(a,ee,a._state,nt);do P=Ba+wn(a._repMatchLenEncoder,fr-2,nt),ie=a._optimum[fr],P<ie.Price&&(ie.Price=P,ie.PosPrev=0,ie.BackPrev=ee,ie.Prev1IsChar=0);while(--fr>=2)}if(ei=At+Ee[a._isRep[a._state]>>>2],Pe=a.repLens[0]>=2?a.repLens[0]+1:2,Pe<=me){for(ht=0;Pe>a._matchDistances[ht];)ht+=2;for(;Z=a._matchDistances[ht+1],P=ei+Da(a,Z,Pe,nt),ie=a._optimum[Pe],P<ie.Price&&(ie.Price=P,ie.PosPrev=0,ie.BackPrev=Z+4,ie.Prev1IsChar=0),!(Pe==a._matchDistances[ht]&&(ht+=2,ht==Lt));++Pe);}for(p=0;;){if(++p,p==he)return pa(a,p);if(tt=Ui(a),Lt=a._numDistancePairs,tt>=a._numFastBytes)return a._longestMatchLength=tt,a._longestMatchWasFound=1,pa(a,p);if(++f,vn=a._optimum[p].PosPrev,a._optimum[p].Prev1IsChar?(--vn,a._optimum[p].Prev2?(ve=a._optimum[a._optimum[p].PosPrev2].State,a._optimum[p].BackPrev2<4?ve=ve<7?8:11:ve=ve<7?7:10):ve=a._optimum[vn].State,ve=un(ve)):ve=a._optimum[vn].State,vn==p-1?a._optimum[p].BackPrev?ve=un(ve):ve=ve<7?9:11:(a._optimum[p].Prev1IsChar&&a._optimum[p].Prev2?(vn=a._optimum[p].PosPrev2,ln=a._optimum[p].BackPrev2,ve=ve<7?8:11):(ln=a._optimum[p].BackPrev,ln<4?ve=ve<7?8:11:ve=ve<7?7:10),Ye=a._optimum[vn],ln<4?ln?ln==1?(a.reps[0]=Ye.Backs1,a.reps[1]=Ye.Backs0,a.reps[2]=Ye.Backs2,a.reps[3]=Ye.Backs3):ln==2?(a.reps[0]=Ye.Backs2,a.reps[1]=Ye.Backs0,a.reps[2]=Ye.Backs1,a.reps[3]=Ye.Backs3):(a.reps[0]=Ye.Backs3,a.reps[1]=Ye.Backs0,a.reps[2]=Ye.Backs1,a.reps[3]=Ye.Backs2):(a.reps[0]=Ye.Backs0,a.reps[1]=Ye.Backs1,a.reps[2]=Ye.Backs2,a.reps[3]=Ye.Backs3):(a.reps[0]=ln-4,a.reps[1]=Ye.Backs0,a.reps[2]=Ye.Backs1,a.reps[3]=Ye.Backs2)),a._optimum[p].State=ve,a._optimum[p].Backs0=a.reps[0],a._optimum[p].Backs1=a.reps[1],a._optimum[p].Backs2=a.reps[2],a._optimum[p].Backs3=a.reps[3],Q=a._optimum[p].Price,$=Me(a._matchFinder,-1),we=Me(a._matchFinder,-a.reps[0]-1-1),nt=f&a._posStateMask,b=Q+Ee[a._isMatch[(ve<<4)+nt]>>>2]+Jr(zn(a._literalEncoder,f,Me(a._matchFinder,-2)),ve>=7,we,$),mt=a._optimum[p+1],Ft=0,b<mt.Price&&(mt.Price=b,mt.PosPrev=p,mt.BackPrev=-1,mt.Prev1IsChar=0,Ft=1),At=Q+Ee[2048-a._isMatch[(ve<<4)+nt]>>>2],En=At+Ee[2048-a._isRep[ve]>>>2],we==$&&!(mt.PosPrev<p&&!mt.BackPrev)&&(Un=En+(Ee[a._isRepG0[ve]>>>2]+Ee[a._isRep0Long[(ve<<4)+nt]>>>2]),Un<=mt.Price&&(mt.Price=Un,mt.PosPrev=p,mt.BackPrev=0,mt.Prev1IsChar=0,Ft=1)),Rt=ur(a._matchFinder)+1,Rt=4095-p<Rt?4095-p:Rt,Pt=Rt,!(Pt<2)){if(Pt>a._numFastBytes&&(Pt=a._numFastBytes),!Ft&&we!=$&&(Xn=Math.min(Rt-1,a._numFastBytes),ye=Hn(a._matchFinder,0,a.reps[0],Xn),ye>=2)){for(Qe=un(ve),rt=f+1&a._posStateMask,jn=b+Ee[2048-a._isMatch[(Qe<<4)+rt]>>>2]+Ee[2048-a._isRep[Qe]>>>2],Wt=p+1+ye;he<Wt;)a._optimum[++he].Price=268435455;P=jn+(ka=wn(a._repMatchLenEncoder,ye-2,rt),ka+Vn(a,0,Qe,rt)),ie=a._optimum[Wt],P<ie.Price&&(ie.Price=P,ie.PosPrev=p+1,ie.BackPrev=0,ie.Prev1IsChar=1,ie.Prev2=0)}for(mr=2,Tt=0;Tt<4;++Tt)if(te=Hn(a._matchFinder,-1,a.reps[Tt],Pt),!(te<2)){Ke=te;do{for(;he<p+te;)a._optimum[++he].Price=268435455;P=En+(Ra=wn(a._repMatchLenEncoder,te-2,nt),Ra+Vn(a,Tt,ve,nt)),ie=a._optimum[p+te],P<ie.Price&&(ie.Price=P,ie.PosPrev=p,ie.BackPrev=Tt,ie.Prev1IsChar=0)}while(--te>=2);if(te=Ke,Tt||(mr=te+1),te<Rt&&(Xn=Math.min(Rt-1-te,a._numFastBytes),ye=Hn(a._matchFinder,te,a.reps[Tt],Xn),ye>=2)){for(Qe=ve<7?8:11,rt=f+te&a._posStateMask,w=En+(La=wn(a._repMatchLenEncoder,te-2,nt),La+Vn(a,Tt,ve,nt))+Ee[a._isMatch[(Qe<<4)+rt]>>>2]+Jr(zn(a._literalEncoder,f+te,Me(a._matchFinder,te-1-1)),1,Me(a._matchFinder,te-1-(a.reps[Tt]+1)),Me(a._matchFinder,te-1)),Qe=un(Qe),rt=f+te+1&a._posStateMask,kt=w+Ee[2048-a._isMatch[(Qe<<4)+rt]>>>2],jn=kt+Ee[2048-a._isRep[Qe]>>>2],Wt=te+1+ye;he<p+Wt;)a._optimum[++he].Price=268435455;P=jn+(Oa=wn(a._repMatchLenEncoder,ye-2,rt),Oa+Vn(a,0,Qe,rt)),ie=a._optimum[p+Wt],P<ie.Price&&(ie.Price=P,ie.PosPrev=p+te+1,ie.BackPrev=0,ie.Prev1IsChar=1,ie.Prev2=1,ie.PosPrev2=p,ie.BackPrev2=Tt)}}if(tt>Pt){for(tt=Pt,Lt=0;tt>a._matchDistances[Lt];Lt+=2);a._matchDistances[Lt]=tt,Lt+=2}if(tt>=mr){for(ei=At+Ee[a._isRep[ve]>>>2];he<p+tt;)a._optimum[++he].Price=268435455;for(ht=0;mr>a._matchDistances[ht];)ht+=2;for(te=mr;;++te)if(L=a._matchDistances[ht+1],P=ei+Da(a,L,te,nt),ie=a._optimum[p+te],P<ie.Price&&(ie.Price=P,ie.PosPrev=p,ie.BackPrev=L+4,ie.Prev1IsChar=0),te==a._matchDistances[ht]){if(te<Rt&&(Xn=Math.min(Rt-1-te,a._numFastBytes),ye=Hn(a._matchFinder,te,L,Xn),ye>=2)){for(Qe=ve<7?7:10,rt=f+te&a._posStateMask,w=P+Ee[a._isMatch[(Qe<<4)+rt]>>>2]+Jr(zn(a._literalEncoder,f+te,Me(a._matchFinder,te-1-1)),1,Me(a._matchFinder,te-(L+1)-1),Me(a._matchFinder,te-1)),Qe=un(Qe),rt=f+te+1&a._posStateMask,kt=w+Ee[2048-a._isMatch[(Qe<<4)+rt]>>>2],jn=kt+Ee[2048-a._isRep[Qe]>>>2],Wt=te+1+ye;he<p+Wt;)a._optimum[++he].Price=268435455;P=jn+(Ia=wn(a._repMatchLenEncoder,ye-2,rt),Ia+Vn(a,0,Qe,rt)),ie=a._optimum[p+Wt],P<ie.Price&&(ie.Price=P,ie.PosPrev=p+te+1,ie.BackPrev=0,ie.Prev1IsChar=1,ie.Prev2=1,ie.PosPrev2=p,ie.BackPrev2=L+4)}if(ht+=2,ht==Lt)break}}}}}function Da(a,f,p,b){var w,P=Yr(p);return f<128?w=a._distancesPrices[P*128+f]:w=a._posSlotPrices[(P<<6)+oc(f)]+a._alignPrices[f&15],w+wn(a._lenEncoder,p-2,b)}function Vn(a,f,p,b){var w;return f?(w=Ee[2048-a._isRepG0[p]>>>2],f==1?w+=Ee[a._isRepG1[p]>>>2]:(w+=Ee[2048-a._isRepG1[p]>>>2],w+=dr(a._isRepG2[p],f-2))):(w=Ee[a._isRepG0[p]>>>2],w+=Ee[2048-a._isRep0Long[(p<<4)+b]>>>2]),w}function ec(a,f,p){return Ee[a._isRepG0[f]>>>2]+Ee[a._isRep0Long[(f<<4)+p]>>>2]}function tc(a){ql(a),vc(a._rangeEncoder),Te(a._isMatch),Te(a._isRep0Long),Te(a._isRep),Te(a._isRepG0),Te(a._isRepG1),Te(a._isRepG2),Te(a._posEncoders),hc(a._literalEncoder);for(var f=0;f<4;++f)Te(a._posSlotEncoder[f].Models);ya(a._lenEncoder,1<<a._posStateBits),ya(a._repMatchLenEncoder,1<<a._posStateBits),Te(a._posAlignEncoder.Models),a._longestMatchWasFound=0,a._optimumEndIndex=0,a._optimumCurrentIndex=0,a._additionalOffset=0}function ba(a,f){f>0&&(Tl(a._matchFinder,f),a._additionalOffset+=f)}function Ui(a){var f=0;return a._numDistancePairs=Al(a._matchFinder,a._matchDistances),a._numDistancePairs>0&&(f=a._matchDistances[a._numDistancePairs-2],f==a._numFastBytes&&(f+=Hn(a._matchFinder,f-1,a._matchDistances[a._numDistancePairs-1],273-f))),++a._additionalOffset,f}function Sa(a){a._matchFinder&&a._needReleaseMFStream&&(a._matchFinder._stream=null,a._needReleaseMFStream=0)}function nc(a){Sa(a),a._rangeEncoder.Stream=null}function rc(a,f){a._dictionarySize=f;for(var p=0;f>1<<p;++p);a._distTableSize=p*2}function ic(a,f){var p=a._matchFinderType;a._matchFinderType=f,a._matchFinder&&p!=a._matchFinderType&&(a._dictionarySizePrev=-1,a._matchFinder=null)}function sc(a,f){a.properties[0]=(a._posStateBits*5+a._numLiteralPosStateBits)*9+a._numLiteralContextBits<<24>>24;for(var p=0;p<4;++p)a.properties[1+p]=a._dictionarySize>>8*p<<24>>24;v(f,a.properties,0,5)}function ac(a,f){if(a._writeEndMark){He(a._rangeEncoder,a._isMatch,(a._state<<4)+f,1),He(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,Ki(a._lenEncoder,a._rangeEncoder,0,f);var p=Yr(2);hr(a._posSlotEncoder[p],a._rangeEncoder,63),Ta(a._rangeEncoder,67108863,26),Pa(a._posAlignEncoder,a._rangeEncoder,15)}}function Xi(a){return a<2048?Wn[a]:a<2097152?Wn[a>>10]+20:Wn[a>>20]+40}function oc(a){return a<131072?Wn[a>>6]+12:a<134217728?Wn[a>>16]+32:Wn[a>>26]+52}function uc(a,f,p,b){p<8?(He(f,a._choice,0,0),hr(a._lowCoder[b],f,p)):(p-=8,He(f,a._choice,0,1),p<8?(He(f,a._choice,1,0),hr(a._midCoder[b],f,p)):(He(f,a._choice,1,1),hr(a._highCoder,f,p-8)))}function lc(a){a._choice=h(2),a._lowCoder=h(16),a._midCoder=h(16),a._highCoder=cr({},8);for(var f=0;f<16;++f)a._lowCoder[f]=cr({},3),a._midCoder[f]=cr({},3);return a}function ya(a,f){Te(a._choice);for(var p=0;p<f;++p)Te(a._lowCoder[p].Models),Te(a._midCoder[p].Models);Te(a._highCoder.Models)}function wa(a,f,p,b,w){var P,L,Q,$,Z;for(P=Ee[a._choice[0]>>>2],L=Ee[2048-a._choice[0]>>>2],Q=L+Ee[a._choice[1]>>>2],$=L+Ee[2048-a._choice[1]>>>2],Z=0,Z=0;Z<8;++Z){if(Z>=p)return;b[w+Z]=P+Zr(a._lowCoder[f],Z)}for(;Z<16;++Z){if(Z>=p)return;b[w+Z]=Q+Zr(a._midCoder[f],Z-8)}for(;Z<p;++Z)b[w+Z]=$+Zr(a._highCoder,Z-8-8)}function Ki(a,f,p,b){uc(a,f,p,b),--a._counters[b]==0&&(wa(a,b,a._tableSize,a._prices,b*272),a._counters[b]=a._tableSize)}function va(a){return lc(a),a._prices=[],a._counters=[],a}function wn(a,f,p){return a._prices[p*272+f]}function Ea(a,f){for(var p=0;p<f;++p)wa(a,p,a._tableSize,a._prices,p*272),a._counters[p]=a._tableSize}function cc(a,f,p){var b,w;if(!(a.m_Coders!=null&&a.m_NumPrevBits==p&&a.m_NumPosBits==f))for(a.m_NumPosBits=f,a.m_PosMask=(1<<f)-1,a.m_NumPrevBits=p,w=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=h(w),b=0;b<w;++b)a.m_Coders[b]=fc({})}function zn(a,f,p){return a.m_Coders[((f&a.m_PosMask)<<a.m_NumPrevBits)+((p&255)>>>8-a.m_NumPrevBits)]}function hc(a){var f,p=1<<a.m_NumPrevBits+a.m_NumPosBits;for(f=0;f<p;++f)Te(a.m_Coders[f].m_Encoders)}function Aa(a,f,p){var b,w,P=1;for(w=7;w>=0;--w)b=p>>w&1,He(f,a.m_Encoders,P,b),P=P<<1|b}function dc(a,f,p,b){var w,P,L,Q,$=1,Z=1;for(P=7;P>=0;--P)w=b>>P&1,Q=Z,$&&(L=p>>P&1,Q+=1+L<<8,$=L==w),He(f,a.m_Encoders,Q,w),Z=Z<<1|w}function fc(a){return a.m_Encoders=h(768),a}function Jr(a,f,p,b){var w,P=1,L=7,Q,$=0;if(f){for(;L>=0;--L)if(Q=p>>L&1,w=b>>L&1,$+=dr(a.m_Encoders[(1+Q<<8)+P],w),P=P<<1|w,Q!=w){--L;break}}for(;L>=0;--L)w=b>>L&1,$+=dr(a.m_Encoders[P],w),P=P<<1|w;return $}function Fa(a){a.BackPrev=-1,a.Prev1IsChar=0}function mc(a){a.BackPrev=0,a.Prev1IsChar=0}function lr(a,f){return a.NumBitLevels=f,a.Models=h(1<<f),a}function Qr(a,f){var p,b=1;for(p=a.NumBitLevels;p!=0;--p)b=(b<<1)+ct(f,a.Models,b);return b-(1<<a.NumBitLevels)}function pc(a,f){var p,b,w=1,P=0;for(b=0;b<a.NumBitLevels;++b)p=ct(f,a.Models,w),w<<=1,w+=p,P|=p<<b;return P}function gc(a,f,p,b){var w,P,L=1,Q=0;for(P=0;P<b;++P)w=ct(p,a,f+L),L<<=1,L+=w,Q|=w<<P;return Q}function cr(a,f){return a.NumBitLevels=f,a.Models=h(1<<f),a}function hr(a,f,p){var b,w,P=1;for(w=a.NumBitLevels;w!=0;)--w,b=p>>>w&1,He(f,a.Models,P,b),P=P<<1|b}function Zr(a,f){var p,b,w=1,P=0;for(b=a.NumBitLevels;b!=0;)--b,p=f>>>b&1,P+=dr(a.Models[w],p),w=(w<<1)+p;return P}function Pa(a,f,p){var b,w,P=1;for(w=0;w<a.NumBitLevels;++w)b=p&1,He(f,a.Models,P,b),P=P<<1|b,p>>=1}function _c(a,f){var p,b,w=1,P=0;for(b=a.NumBitLevels;b!=0;--b)p=f&1,f>>>=1,P+=dr(a.Models[w],p),w=w<<1|p;return P}function Dc(a,f,p,b,w){var P,L,Q=1;for(L=0;L<b;++L)P=w&1,He(p,a,f+Q,P),Q=Q<<1|P,w>>=1}function bc(a,f,p,b){var w,P,L=1,Q=0;for(P=p;P!=0;--P)w=b&1,b>>>=1,Q+=Ee[((a[f+L]-w^-w)&2047)>>>2],L=L<<1|w;return Q}function ct(a,f,p){var b,w=f[p];return b=(a.Range>>>11)*w,(a.Code^-2147483648)<(b^-2147483648)?(a.Range=b,f[p]=w+(2048-w>>>5)<<16>>16,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8),0):(a.Range-=b,a.Code-=b,f[p]=w-(w>>>5)<<16>>16,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8),1)}function Sc(a,f){var p,b,w=0;for(p=f;p!=0;--p)a.Range>>>=1,b=a.Code-a.Range>>>31,a.Code-=a.Range&b-1,w=w<<1|1-b,a.Range&-16777216||(a.Code=a.Code<<8|K(a.Stream),a.Range<<=8);return w}function yc(a){a.Code=0,a.Range=-1;for(var f=0;f<5;++f)a.Code=a.Code<<8|K(a.Stream)}function Te(a){for(var f=a.length-1;f>=0;--f)a[f]=1024}var Ee=(function(){var a,f,p,b,w=[];for(f=8;f>=0;--f)for(b=1<<9-f-1,a=1<<9-f,p=b;p<a;++p)w[p]=(f<<6)+(a-p<<6>>>9-f-1);return w})();function He(a,f,p,b){var w,P=f[p];w=(a.Range>>>11)*P,b?(a.Low=d(a.Low,m(T(w),[4294967295,0])),a.Range-=w,f[p]=P-(P>>>5)<<16>>16):(a.Range=w,f[p]=P+(2048-P>>>5)<<16>>16),a.Range&-16777216||(a.Range<<=8,Yi(a))}function Ta(a,f,p){for(var b=p-1;b>=0;--b)a.Range>>>=1,(f>>>b&1)==1&&(a.Low=d(a.Low,T(a.Range))),a.Range&-16777216||(a.Range<<=8,Yi(a))}function wc(a){return d(d(T(a._cacheSize),a._position),[4,0])}function vc(a){a._position=u,a.Low=u,a.Range=-1,a._cacheSize=1,a._cache=0}function Yi(a){var f,p=E(j(a.Low,32));if(p!=0||D(a.Low,[4278190080,0])<0){a._position=d(a._position,T(a._cacheSize)),f=a._cache;do A(a.Stream,f+p),f=255;while(--a._cacheSize!=0);a._cache=E(a.Low)>>>24}++a._cacheSize,a.Low=B(m(a.Low,[16777215,0]),8)}function dr(a,f){return Ee[((a-f^-f)&2047)>>>2]}function Ca(a){for(var f=0,p=0,b,w,P,L=a.length,Q=[],$=[];f<L;++f,++p){if(b=a[f]&255,b&128)if((b&224)==192){if(f+1>=L||(w=a[++f]&255,(w&192)!=128))return a;$[p]=(b&31)<<6|w&63}else if((b&240)==224){if(f+2>=L||(w=a[++f]&255,(w&192)!=128)||(P=a[++f]&255,(P&192)!=128))return a;$[p]=(b&15)<<12|(w&63)<<6|P&63}else return a;else{if(!b)return a;$[p]=b}p==16383&&(Q.push(String.fromCharCode.apply(String,$)),p=-1)}return p>0&&($.length=p,Q.push(String.fromCharCode.apply(String,$))),Q.join("")}function Ma(a){var f,p=[],b,w=0,P,L=a.length;if(typeof a=="object")return a;for(S(a,0,L,p,0),P=0;P<L;++P)f=p[P],f>=1&&f<=127?++w:!f||f>=128&&f<=2047?w+=2:w+=3;for(b=[],w=0,P=0;P<L;++P)f=p[P],f>=1&&f<=127?b[w++]=f<<24>>24:!f||f>=128&&f<=2047?(b[w++]=(192|f>>6&31)<<24>>24,b[w++]=(128|f&63)<<24>>24):(b[w++]=(224|f>>12&15)<<24>>24,b[w++]=(128|f>>6&63)<<24>>24,b[w++]=(128|f&63)<<24>>24);return b}function $r(a){return a[1]+a[0]}function Ec(a,f,p,b){var w={},P,L,Q=typeof p>"u"&&typeof b>"u";if(typeof p!="function"&&(L=p,p=b=0),b=b||function(Z){if(!(typeof L>"u"))return c(Z,L)},p=p||function(Z,ee){if(!(typeof L>"u"))return postMessage({action:n,cbn:L,result:Z,error:ee})},Q){for(w.c=Y({},Ma(a),xa(f));qr(w.c.chunker););return _(w.c.output)}try{w.c=Y({},Ma(a),xa(f)),b(0)}catch(Z){return p(null,Z)}function $(){try{for(var Z,ee=new Date().getTime();qr(w.c.chunker);)if(P=$r(w.c.chunker.inBytesProcessed)/$r(w.c.length_0),new Date().getTime()-ee>200)return b(P),r($,0),0;b(1),Z=_(w.c.output),r(p.bind(null,Z),0)}catch(Pe){p(null,Pe)}}r($,0)}function Ac(a,f,p){var b={},w,P,L,Q,$=typeof f>"u"&&typeof p>"u";if(typeof f!="function"&&(P=f,f=p=0),p=p||function(ee){if(!(typeof P>"u"))return c(L?ee:-1,P)},f=f||function(ee,Pe){if(!(typeof P>"u"))return postMessage({action:e,cbn:P,result:ee,error:Pe})},$){for(b.d=_e({},a);qr(b.d.chunker););return Ca(_(b.d.output))}try{b.d=_e({},a),Q=$r(b.d.length_0),L=Q>-1,p(0)}catch(ee){return f(null,ee)}function Z(){try{for(var ee,Pe=0,he=new Date().getTime();qr(b.d.chunker);)if(++Pe%1e3==0&&new Date().getTime()-he>200)return L&&(w=$r(b.d.chunker.decoder.nowPos64)/Q,p(w)),r(Z,0),0;p(1),ee=Ca(_(b.d.output)),r(f.bind(null,ee),0)}catch(me){f(null,me)}}r(Z,0)}var xa=(function(){var a=[{s:16,f:64,m:0},{s:20,f:64,m:0},{s:19,f:64,m:1},{s:20,f:64,m:1},{s:21,f:128,m:1},{s:22,f:128,m:1},{s:23,f:128,m:1},{s:24,f:255,m:1},{s:25,f:255,m:1}];return function(f){return a[f-1]||a[6]}})();return{compress:Ec,decompress:Ac}})();const T0=Us.compress,C0=Us.decompress;class H{static MAX_COORDINATE_VALUE=131072;static MAX_PARSE_VALUE=2147483647;static parseInt(e,t=this.MAX_PARSE_VALUE,r=!1){return this._getValue(parseInt(e),t,r)}static parseFloat(e,t=this.MAX_PARSE_VALUE,r=!1){return this._getValue(parseFloat(e),t,r)}static parseEnum(e,t){const r=t.trim(),i=parseInt(r);if(i in e)return i;if(r in e)return e[r];throw new Error("Unknown enum value!")}static parseByte(e){const t=parseInt(e);if(t<0)throw new Error("Value must be greater than 0!");if(t>255)throw new Error("Value must be less than 255!");return this._getValue(t)}static _getValue(e,t=this.MAX_PARSE_VALUE,r=!1){if(e<-t)throw new Error("Value is too low!");if(e>t)throw new Error("Value is too high!");if(!r&&Number.isNaN(e))throw new Error("Not a number");return e}}class M0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim().split(",").map(u=>H.parseByte(u));if(s.length!==3&&s.length!==4)throw new Error(`Color specified in incorrect format (should be R,G,B or R,G,B,A): ${s.join(",")}`);const o=new mn(s[0],s[1],s[2],s[3]);this.addColor(o,t,r.trim())}static addColor(e,t,r){if(r==="SliderTrackOverride"){t.colors.sliderTrackColor=e;return}if(r==="SliderBorder"){t.colors.sliderBorderColor=e;return}r.startsWith("Combo")&&t.colors.comboColors.push(e)}}class x0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"CircleSize":t.difficulty.circleSize=H.parseFloat(s);break;case"HPDrainRate":t.difficulty.drainRate=H.parseFloat(s);break;case"OverallDifficulty":t.difficulty.overallDifficulty=H.parseFloat(s);break;case"ApproachRate":t.difficulty.approachRate=H.parseFloat(s);break;case"SliderMultiplier":t.difficulty.sliderMultiplier=H.parseFloat(s);break;case"SliderTickRate":t.difficulty.sliderTickRate=H.parseFloat(s)}}}class B0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"Bookmarks":t.editor.bookmarks=s.split(",").map(o=>+o);break;case"DistanceSpacing":t.editor.distanceSpacing=Math.max(0,H.parseFloat(s));break;case"BeatDivisor":t.editor.beatDivisor=H.parseInt(s);break;case"GridSize":t.editor.gridSize=H.parseInt(s);break;case"TimelineZoom":t.editor.timelineZoom=Math.max(0,H.parseFloat(s))}}}class au{static handleLine(e,t){const r=this._getDepth(e);switch(r>0&&(e=e.substring(r)),r<2&&this._storyboardSprite&&(this._timelineGroup=this._storyboardSprite.timelineGroup),r){case 0:return this._handleElement(e,t);case 1:return this._handleCompoundOrCommand(e);case 2:return this._handleCommand(e)}}static _handleElement(e,t){const r=e.split(","),i=this.parseEventType(r[0]);switch(this._storyboardSprite?.hasCommands&&(this._storyboardSprite.updateCommands(),this._storyboardSprite.adjustTimesToCommands(),this._storyboardSprite.resetValuesToCommands()),i){case et.Video:{const s=t.getLayerByType(St.Video),o=H.parseInt(r[1]),u=r[2].replace(/"/g,"");s.elements.push(new $o(u,o));return}case et.Sprite:{const s=t.getLayerByType(this.parseLayerType(r[1])),o=this.parseOrigin(r[2]),u=this.convertOrigin(o),l=r[3].replace(/"/g,""),c=H.parseFloat(r[4],H.MAX_COORDINATE_VALUE),h=H.parseFloat(r[5],H.MAX_COORDINATE_VALUE);this._storyboardSprite=new Is(l,o,u,new ae(c,h)),s.elements.push(this._storyboardSprite);return}case et.Animation:{const s=t.getLayerByType(this.parseLayerType(r[1])),o=this.parseOrigin(r[2]),u=this.convertOrigin(o),l=r[3].replace(/"/g,""),c=H.parseFloat(r[4],H.MAX_COORDINATE_VALUE),h=H.parseFloat(r[5],H.MAX_COORDINATE_VALUE),d=H.parseInt(r[6]);let m=H.parseFloat(r[7]);t.fileFormat<6&&(m=Math.round(.015*m)*1.186*(1e3/60));const D=this.parseLoopType(r[8]);this._storyboardSprite=new Qo(l,o,u,new ae(c,h),d,m,D),s.elements.push(this._storyboardSprite);return}case et.Sample:{const s=H.parseFloat(r[1]),o=t.getLayerByType(this.parseLayerType(r[2])),u=r[3].replace(/"/g,""),l=r.length>4?H.parseInt(r[4]):100,c=new Zo(u,s,l);o.elements.push(c)}}}static _handleCompoundOrCommand(e){const t=e.split(",");switch(t[0]){case rr.Trigger:{this._timelineGroup=this._storyboardSprite?.addTrigger(t[1],t.length>2?H.parseFloat(t[2]):-1/0,t.length>3?H.parseFloat(t[3]):1/0,t.length>4?H.parseInt(t[4]):0);return}case rr.Loop:{this._timelineGroup=this._storyboardSprite?.addLoop(H.parseFloat(t[1]),Math.max(0,H.parseInt(t[2])-1));return}default:this._handleCommand(e)}}static _handleCommand(e){const t=e.split(","),r=t[0],i=H.parseInt(t[1]),s=H.parseInt(t[2]),o=H.parseInt(t[3]||t[2]);switch(r){case Ae.Fade:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.alpha.add(r,i,s,o,u,l);return}case Ae.Scale:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.scale.add(r,i,s,o,u,l);return}case Ae.VectorScale:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=t.length>6?H.parseFloat(t[6]):u,h=t.length>7?H.parseFloat(t[7]):l;this._timelineGroup?.vectorScale.add(r,i,s,o,new ae(u,l),new ae(c,h));return}case Ae.Rotation:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.rotation.add(r,i,s,o,u,l);return}case Ae.Movement:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=t.length>6?H.parseFloat(t[6]):u,h=t.length>7?H.parseFloat(t[7]):l;this._timelineGroup?.x.add(Ae.MovementX,i,s,o,u,c),this._timelineGroup?.y.add(Ae.MovementY,i,s,o,l,h);return}case Ae.MovementX:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.x.add(r,i,s,o,u,l);return}case Ae.MovementY:{const u=H.parseFloat(t[4]),l=t.length>5?H.parseFloat(t[5]):u;this._timelineGroup?.y.add(r,i,s,o,u,l);return}case Ae.Color:{const u=H.parseFloat(t[4]),l=H.parseFloat(t[5]),c=H.parseFloat(t[6]),h=t.length>7?H.parseFloat(t[7]):u,d=t.length>8?H.parseFloat(t[8]):l,m=t.length>9?H.parseFloat(t[9]):c;this._timelineGroup?.color.add(r,i,s,o,new mn(u,l,c,1),new mn(h,d,m,1));return}case Ae.Parameter:return this._handleParameterCommand(t)}throw new Error(`Unknown command type: ${r}`)}static _handleParameterCommand(e){const t=Ae.Parameter,r=H.parseInt(e[1]),i=H.parseInt(e[2]),s=H.parseInt(e[3]||e[2]),o=e[4];switch(o){case Jt.BlendingMode:{const u=ut.Additive,l=i===s?ut.Additive:ut.Inherit;this._timelineGroup?.blendingParameters.add(t,r,i,s,u,l,o);return}case Jt.HorizontalFlip:this._timelineGroup?.flipH.add(t,r,i,s,!0,i===s,o);return;case Jt.VerticalFlip:{this._timelineGroup?.flipV.add(t,r,i,s,!0,i===s,o);return}}throw new Error(`Unknown parameter type: ${o}`)}static parseEventType(e){if(e.startsWith(" ")||e.startsWith("_"))return et.StoryboardCommand;try{return H.parseEnum(et,e)}catch{throw new Error(`Unknown event type: ${e}`)}}static parseLayerType(e){try{return H.parseEnum(St,e)}catch{throw new Error(`Unknown layer type: ${e}`)}}static parseOrigin(e){try{return H.parseEnum(it,e)}catch{return it.TopLeft}}static convertOrigin(e){switch(e){case it.TopLeft:return pt.TopLeft;case it.TopCentre:return pt.TopCentre;case it.TopRight:return pt.TopRight;case it.CentreLeft:return pt.CentreLeft;case it.Centre:return pt.Centre;case it.CentreRight:return pt.CentreRight;case it.BottomLeft:return pt.BottomLeft;case it.BottomCentre:return pt.BottomCentre;case it.BottomRight:return pt.BottomRight}return pt.TopLeft}static parseLoopType(e){try{return H.parseEnum(Rr,e)}catch{return Rr.LoopForever}}static _getDepth(e){let t=0;for(const r of e){if(r!==" "&&r!=="_")break;++t}return t}}class k0{static handleLine(e,t,r,i){const s=e.split(",").map((u,l)=>l?u.trim():u);switch(au.parseEventType(s[0])){case et.Background:t.events.backgroundPath=s[2].replace(/"/g,"");break;case et.Break:{const u=H.parseFloat(s[1])+i,l=Math.max(u,H.parseFloat(s[2])+i),c=new Yh(u,l);t.events.breaks||(t.events.breaks=[]),t.events.breaks.push(c);break}case et.Video:case et.Sample:case et.Sprite:case et.Animation:case et.StoryboardCommand:r&&r.push(e)}}}class R0{static handleLine(e,t,r){const[i,...s]=e.split(":"),o=s.join(":").trim();switch(i.trim()){case"AudioFilename":t.general.audioFilename=o;break;case"AudioHash":t.general.audioHash=o;break;case"OverlayPosition":t.general.overlayPosition=o;break;case"SkinPreference":t.general.skinPreference=o;break;case"AudioLeadIn":t.general.audioLeadIn=H.parseInt(o);break;case"PreviewTime":t.general.previewTime=H.parseInt(o)+r;break;case"Countdown":t.general.countdown=H.parseInt(o);break;case"StackLeniency":t.general.stackLeniency=H.parseFloat(o);break;case"Mode":t.originalMode=H.parseInt(o);break;case"CountdownOffset":t.general.countdownOffset=H.parseInt(o);break;case"SampleSet":t.general.sampleSet=Ce[o];break;case"LetterboxInBreaks":t.general.letterboxInBreaks=o==="1";break;case"StoryFireInFront":t.general.storyFireInFront=o==="1";break;case"UseSkinSprites":t.general.useSkinSprites=o==="1";break;case"AlwaysShowPlayfield":t.general.alwaysShowPlayfield=o==="1";break;case"EpilepsyWarning":t.general.epilepsyWarning=o==="1";break;case"SpecialStyle":t.general.specialStyle=o==="1";break;case"WidescreenStoryboard":t.general.widescreenStoryboard=o==="1";break;case"SamplesMatchPlaybackRate":t.general.samplesMatchPlaybackRate=o==="1"}}}class L0 extends zr{isNewCombo=!1;comboOffset=0;clone(){const e=super.clone();return e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}class O0 extends zr{endTime=0;nodeSamples=[];get duration(){return this.endTime-this.startTime}clone(){const e=super.clone();return e.endTime=this.endTime,e.nestedHitObjects=this.nestedHitObjects.map(t=>t.clone()),e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e}}class Xs extends zr{static BASE_SCORING_DISTANCE=100;get duration(){return this.spans*this.spanDuration}get endTime(){return this.startTime+this.duration}get spans(){return this.repeats+1}set spans(e){this.repeats=e-1}get spanDuration(){return this.distance/this.velocity}get distance(){return this.path.distance}set distance(e){this.path.distance=e}repeats=0;velocity=1;path=new Vs;legacyLastTickOffset=36;nodeSamples=[];isNewCombo=!1;comboOffset=0;applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const r=e.timingPointAt(this.startTime),i=e.difficultyPointAt(this.startTime),s=Xs.BASE_SCORING_DISTANCE*t.sliderMultiplier*i.sliderVelocity;this.velocity=s/r.beatLength}clone(){const e=super.clone();return e.legacyLastTickOffset=this.legacyLastTickOffset,e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e.velocity=this.velocity,e.repeats=this.repeats,e.path=this.path.clone(),e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}class I0 extends zr{endTime=0;isNewCombo=!1;comboOffset=0;get duration(){return this.endTime-this.startTime}clone(){const e=super.clone();return e.endTime=this.endTime,e.isNewCombo=this.isNewCombo,e.comboOffset=this.comboOffset,e}}let at;(function(n){n.Beatmap=".osu",n.Storyboard=".osb",n.Replay=".osr"})(at||(at={}));let Ct;(function(n){n[n.FileFormat=0]="FileFormat",n[n.Section=1]="Section",n[n.Empty=2]="Empty",n[n.Data=3]="Data",n[n.Break=4]="Break"})(Ct||(Ct={}));let xe;(function(n){n.General="General",n.Editor="Editor",n.Metadata="Metadata",n.Difficulty="Difficulty",n.Events="Events",n.TimingPoints="TimingPoints",n.Colours="Colours",n.HitObjects="HitObjects",n.Variables="Variables",n.Fonts="Fonts",n.CatchTheBeat="CatchTheBeat",n.Mania="Mania"})(xe||(xe={}));const Zt=function(){throw new Error("Filesystem operations are not available in a browser environment")};class N0{static encodeColors(e){const t=e.colors;if(Object.keys(t).length===1&&!t.comboColors.length)return"";const r=["[Colours]"];return t.comboColors.forEach((i,s)=>{r.push(`Combo${s+1}:${i}`)}),t.sliderTrackColor&&r.push(`SliderTrackOverride:${t.sliderTrackColor}`),t.sliderBorderColor&&r.push(`SliderBorder:${t.sliderBorderColor}`),r.join(`
`)}}class G0{static encodeDifficultySection(e){const t=["[Difficulty]"],r=e.difficulty;return t.push(`HPDrainRate:${r.drainRate}`),t.push(`CircleSize:${r.circleSize}`),t.push(`OverallDifficulty:${r.overallDifficulty}`),t.push(`ApproachRate:${r.approachRate}`),t.push(`SliderMultiplier:${r.sliderMultiplier}`),t.push(`SliderTickRate:${r.sliderTickRate}`),t.join(`
`)}}class H0{static encodeEditorSection(e){const t=["[Editor]"],r=e.editor;return t.push(`Bookmarks:${r.bookmarks.join(",")}`),t.push(`DistanceSpacing:${r.distanceSpacing}`),t.push(`BeatDivisor:${r.beatDivisor}`),t.push(`GridSize:${r.gridSize}`),t.push(`TimelineZoom:${r.timelineZoom}`),t.join(`
`)}}class Xa{static encodeEventSection(e){const t=[];return t.push("[Events]"),t.push("//Background and Video events"),t.push(this.encodeVideos(e)),t.push(this.encodeStoryboard(e)),t.join(`
`)}static encodeVideos(e){const t=[],r=e.getLayerByType(St.Video);return r.elements.length>0&&t.push(this.encodeStoryboardLayer(r)),t.join(`
`)}static encodeStoryboard(e){const t=[];t.push("//Storyboard Layer 0 (Background)");const r=e.getLayerByType(St.Background);r.elements.length>0&&t.push(this.encodeStoryboardLayer(r)),t.push("//Storyboard Layer 1 (Fail)");const i=e.getLayerByType(St.Fail);i.elements.length>0&&t.push(this.encodeStoryboardLayer(i)),t.push("//Storyboard Layer 2 (Pass)");const s=e.getLayerByType(St.Pass);s.elements.length>0&&t.push(this.encodeStoryboardLayer(s)),t.push("//Storyboard Layer 3 (Foreground)");const o=e.getLayerByType(St.Foreground);o.elements.length>0&&t.push(this.encodeStoryboardLayer(o)),t.push("//Storyboard Layer 4 (Overlay)");const u=e.getLayerByType(St.Overlay);return u.elements.length>0&&t.push(this.encodeStoryboardLayer(u)),t.join(`
`)}static encodeStoryboardLayer(e){const t=[];return e.elements.forEach(r=>{t.push(this.encodeStoryboardElement(r,e.name));const i=r;i?.loops?.forEach(s=>{s.commands.length>0&&(t.push(this.encodeCompound(s)),t.push(this.encodeTimelineGroup(s,2)))}),i?.timelineGroup?.commands.length>0&&t.push(this.encodeTimelineGroup(i.timelineGroup)),i?.triggers?.forEach(s=>{s.commands.length>0&&(t.push(this.encodeCompound(s)),t.push(this.encodeTimelineGroup(s,2)))})}),t.join(`
`)}static encodeStoryboardElement(e,t){return e instanceof Qo?["Animation",t,it[e.origin],`"${e.filePath}"`,e.startPosition,e.frameCount,e.frameDelay,e.loopType].join(","):e instanceof Is?["Sprite",t,it[e.origin],`"${e.filePath}"`,e.startPosition].join(","):e instanceof Zo?["Sample",e.startTime,t,`"${e.filePath}"`,e.volume].join(","):e instanceof $o?["Video",e.startTime,e.filePath,"0,0"].join(","):""}static encodeCompound(e,t=1){const r="".padStart(t," ");return e instanceof qo?r+[e.type,e.loopStartTime,e.totalIterations].join(","):e instanceof Jo?r+[e.type,e.triggerName,e.triggerStartTime,e.triggerEndTime,e.groupNumber].join(","):""}static encodeTimelineGroup(e,t=1){const r="".padStart(t," "),i=[],s=e.commands;let o=!1;for(let u=0;u<s.length;++u){if(o){o=!1;continue}if(u<s.length-1){const l=s[u],c=s[u+1],h=l.type===Ae.MovementX,d=c.type===Ae.MovementY,m=l.easing===c.easing,D=l.startTime===c.startTime,g=l.endTime===c.endTime;if(h&&d&&(m&&D&&g)){i.push(r+this.encodeMoveCommand(l,c)),o=!0;continue}}i.push(r+this.encodeCommand(s[u]))}return i.join(`
`)}static encodeMoveCommand(e,t){const r=[Ae.Movement,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",e.startValue,t.startValue],i=e.startValue===e.endValue,s=t.startValue===t.endValue;return(!i||!s)&&r.push(`${e.endValue},${t.endValue}`),r.join(",")}static encodeCommand(e){return[e.type,e.easing,e.startTime,e.startTime!==e.endTime?e.endTime:"",this._encodeCommandParams(e)].join(",")}static _encodeCommandParams(e){if(e.type===Ae.Parameter)return e.parameter;if(e.type===Ae.Color){const t=o=>`${o.red},${o.green},${o.blue}`,r=e,i=r.startValue,s=r.endValue;return this._areValuesEqual(e)?t(i):t(i)+","+t(s)}return this._areValuesEqual(e)?`${e.startValue}`:`${e.startValue},${e.endValue}`}static _areValuesEqual(e){if(e.type===Ae.VectorScale){const t=e;return t.startValue.equals(t.endValue)}if(e.type===Ae.Color){const t=e;return t.startValue.equals(t.endValue)}return e.startValue===e.endValue}}class W0{static encodeEventSection(e){const t=[],r=e.events;return t.push("[Events]"),t.push("//Background and Video events"),r.backgroundPath&&t.push(`0,0,"${r.backgroundPath}",0,0`),r.storyboard&&t.push(Xa.encodeVideos(r.storyboard)),t.push("//Break Periods"),r.breaks&&r.breaks.length>0&&r.breaks.forEach(i=>{t.push(`${et[et.Break]},${i.startTime},${i.endTime}`)}),r.storyboard&&t.push(Xa.encodeStoryboard(r.storyboard)),t.join(`
`)}}class V0{static encodeGeneralSection(e){const t=["[General]"],r=e.general;return t.push(`AudioFilename:${r.audioFilename}`),t.push(`AudioLeadIn:${r.audioLeadIn}`),r.audioHash&&t.push(`AudioHash:${r.audioHash}`),t.push(`PreviewTime:${r.previewTime}`),t.push(`Countdown:${r.countdown}`),t.push(`SampleSet:${Ce[r.sampleSet]}`),t.push(`StackLeniency:${r.stackLeniency}`),t.push(`Mode:${e.mode}`),t.push(`LetterboxInBreaks:${+r.letterboxInBreaks}`),r.storyFireInFront&&t.push(`StoryFireInFront:${+r.storyFireInFront}`),t.push(`UseSkinSprites:${+r.useSkinSprites}`),r.alwaysShowPlayfield&&t.push(`AlwaysShowPlayfield:${+r.alwaysShowPlayfield}`),t.push(`OverlayPosition:${r.overlayPosition}`),t.push(`SkinPreference:${r.skinPreference}`),t.push(`EpilepsyWarning:${+r.epilepsyWarning}`),t.push(`CountdownOffset:${r.countdownOffset}`),t.push(`SpecialStyle:${+r.specialStyle}`),t.push(`WidescreenStoryboard:${+r.widescreenStoryboard}`),t.push(`SamplesMatchPlaybackRate:${+r.samplesMatchPlaybackRate}`),t.join(`
`)}}class z0{static encodeHitObjects(e){const t=["[HitObjects]"];return e.difficulty,e.hitObjects.forEach(i=>{const s=[],u=i.startPosition,l=new ae(u?u.x:256,u?u.y:192);s.push(l.toString()),s.push(i.startTime.toString()),s.push(i.hitType.toString()),s.push(i.hitSound.toString());const c=[];if(i.hitType&le.Slider){const E=i;c.push(this.encodePathData(E,l))}else if(i.hitType&le.Spinner){const E=i;c.push(this.encodeEndTimeData(E))}else if(i.hitType&le.Hold){const E=i;c.push(this.encodeEndTimeData(E))}const h=[],d=i.samples.find(E=>E.hitSound===se[se.Normal]),m=i.samples.find(E=>E.hitSound!==se[se.Normal]);let D=Ce.None,g=Ce.None;d&&(D=Ce[d.sampleSet]),m&&(g=Ce[m.sampleSet]),h[0]=D.toString(),h[1]=g.toString(),h[2]=i.samples[0].customIndex.toString(),h[3]=i.samples[0].volume.toString(),h[4]=i.samples[0].filename,c.push(h.join(":"));const F=s.join(","),T=i.hitType&le.Hold?c.join(":"):c.join(",");t.push([F,T].join(","))}),t.join(`
`)}static encodePathData(e,t){const r=[];let i;e.path.controlPoints.forEach((l,c)=>{if(l.type!==null){let h=l.type!==i||l.type===st.PerfectCurve;if(c>1){const d=t.add(e.path.controlPoints[c-1].position),m=t.add(e.path.controlPoints[c-2].position);~~d.x===~~m.x&&~~d.y===~~m.y&&(h=!0)}h?(r.push(e.path.curveType),i=l.type):r.push(`${t.x+l.position.x}:${t.y+l.position.y}`)}c!==0&&r.push(`${t.x+l.position.x}:${t.y+l.position.y}`)});const s=[];s.push(r.join("|")),s.push((e.repeats+1).toString()),s.push(e.distance.toString());const o=[],u=[];return e.nodeSamples.forEach((l,c)=>{o[c]=se.None,u[c]=[Ce.None,Ce.None],l.forEach((h,d)=>{d===0?u[c][0]=Ce[h.sampleSet]:(o[c]|=se[h.hitSound],u[c][1]=Ce[h.sampleSet])})}),s.push(o.join("|")),s.push(u.map(l=>l.join(":")).join("|")),s.join(",")}static encodeEndTimeData(e){return e.endTime.toString()}}class j0{static encodeMetadataSection(e){const t=["[Metadata]"],r=e.metadata;return t.push(`Title:${r.title}`),t.push(`TitleUnicode:${r.titleUnicode}`),t.push(`Artist:${r.artist}`),t.push(`ArtistUnicode:${r.artistUnicode}`),t.push(`Creator:${r.creator}`),t.push(`Version:${r.version}`),t.push(`Source:${r.source}`),t.push(`Tags:${r.tags.join(" ")}`),t.push(`BeatmapID:${r.beatmapId}`),t.push(`BeatmapSetID:${r.beatmapSetId}`),t.join(`
`)}}class U0{static lastDifficultyPoint=null;static lastEffectPoint=null;static lastSamplePoint=null;static encodeControlPoints(e){const t=["[TimingPoints]"];return e.controlPoints.groups.forEach(r=>{r.controlPoints.find(o=>o.beatLength)&&t.push(this.encodeGroup(r,!0)),t.push(this.encodeGroup(r))}),t.join(`
`)}static encodeGroup(e,t=!1){const{difficultyPoint:r,effectPoint:i,samplePoint:s,timingPoint:o}=this.updateActualPoints(e),u=e.startTime;let l=-100;r!==null&&(l/=r.sliderVelocity);let c=Ce.None,h=0,d=100;s!==null&&(c=Ce[s.sampleSet],h=s.customIndex,d=s.volume);let m=Nt.None;if(i!==null){const F=i.kiai?Nt.Kiai:Nt.None,T=i.omitFirstBarLine?Nt.OmitFirstBarLine:Nt.None;m|=F|T}let D=Or.SimpleQuadruple,g=0;return t&&o!==null&&(l=o.beatLength,D=o.timeSignature,g=1),[u,l,D,c,h,d,g,m].join(",")}static updateActualPoints(e){let t=null;return e.controlPoints.forEach(r=>{r.pointType===Ue.DifficultyPoint&&!r.isRedundant(this.lastDifficultyPoint)&&(this.lastDifficultyPoint=r),r.pointType===Ue.EffectPoint&&!r.isRedundant(this.lastEffectPoint)&&(this.lastEffectPoint=r),r.pointType===Ue.SamplePoint&&!r.isRedundant(this.lastSamplePoint)&&(this.lastSamplePoint=r),r.pointType===Ue.TimingPoint&&(t=r)}),{timingPoint:t,difficultyPoint:this.lastDifficultyPoint,effectPoint:this.lastEffectPoint,samplePoint:this.lastSamplePoint}}}class Ka{static encodeLifeBar(e){return e.length?e.map(t=>`${t.startTime}|${t.health}`).join(","):""}static encodeReplayFrames(e,t){const r=[];if(e){let i=0;e.forEach(s=>{const o=Math.round(s.startTime),u=this._getLegacyFrame(s,t),l=[o-i,u?.mouseX??0,u?.mouseY??0,u?.buttonState??It.None];r.push(l.join("|")),i=o})}return r.push("-12345|0|0|0"),r.join(",")}static _getLegacyFrame(e,t){if(e instanceof Bi)return e;const r=e;if(r.toLegacy)return r.toLegacy(t);throw new Error("Some of the replay frames can not be converted to the legacy format!")}}const X0=new TextDecoder;function K0(n){if(n.length<=0)return new Uint8Array(0);const e=n.reduce((r,i)=>r+i.byteLength,0),t=new Uint8Array(e);return n.reduce((r,i)=>(t.set(new Uint8Array(i.buffer),r),r+i.byteLength),0),t}function Gr(n){return typeof n=="string"?n:X0.decode(n)}class ou{static _lzma=Y0();static async decompress(e){try{return await this._lzma.decompress(e)}catch{return""}}static async compress(e){try{return await this._lzma.compress(e,1)}catch{return new Uint8Array([])}}}function Y0(){return{decompress(n){return new Promise((e,t)=>{C0(n,(r,i)=>{i?t(i):e(typeof r=="string"?r:new Uint8Array(r).toString())})})},compress(n){return new Promise((e,t)=>{T0(n,1,(r,i)=>{i?t(i):e(new Uint8Array(r))})})}}}class q0{_bytesWritten=0;_views=[];get bytesWritten(){return this._bytesWritten}finish(){return K0(this._views)}async compressData(e){return ou.compress(e)}writeByte(e){return this._update(1,new Uint8Array([e]))}writeBytes(e){return this.writeInteger(e.byteLength),this._bytesWritten+=e.byteLength,this._views.push(e),e.byteLength}writeShort(e){return this._update(2,new Uint16Array([e]))}writeInteger(e){return this._update(4,new Int32Array([e]))}writeLong(e){return this._update(8,new BigInt64Array([e]))}writeDate(e){const t=BigInt(621355968e5),r=BigInt(e.getTime());return this.writeLong((r+t)*BigInt(1e4))}writeString(e){if(e.length===0)return this.writeByte(0);let t=this.writeByte(11);t+=this.writeULEB128(e.length);const r=new Uint8Array(e.length);for(let i=0;i<e.length;++i)r[i]=e.charCodeAt(i),t++;return this._update(t,r),t}writeULEB128(e){let t=0,r=0;do t=e&127,e>>=7,e!==0&&(t|=128),r+=this.writeByte(t);while(e!==0);return r}_update(e,t){return this._bytesWritten+=e,this._views.push(t),e}}class Ks{static FIRST_LAZER_VERSION=128;async encodeToPath(e,t){e.endsWith(at.Beatmap)||(e+=at.Beatmap);try{await Zt(Zt(e),{recursive:!0}),await Zt(e,await this.encodeToString(t))}catch(r){const i=r.message||r;throw new Error(`Failed to encode a beatmap: ${i}`)}}encodeToString(e){return e?.fileFormat?[`osu file format v${e.fileFormat??Ks.FIRST_LAZER_VERSION}`,V0.encodeGeneralSection(e),H0.encodeEditorSection(e),j0.encodeMetadataSection(e),G0.encodeDifficultySection(e),W0.encodeEventSection(e),U0.encodeControlPoints(e),N0.encodeColors(e),z0.encodeHitObjects(e)].join(`

`)+`
`:""}}class Hr{static LATEST_VERSION=30000016;static DEFAULT_GAME_VERSION=Hr.LATEST_VERSION;static FIRST_LAZER_VERSION=3e7;async encodeToPath(e,t,r){e.endsWith(at.Replay)||(e+=at.Replay);const i=await this.encodeToBuffer(t,r);try{await Zt(Zt(e),{recursive:!0}),await Zt(e,new Uint8Array(i))}catch(s){const o=s.message||s;throw new Error(`Failed to encode a score: ${o}`)}}async encodeToBuffer(e,t){if(typeof e?.info?.id!="number")return new Uint8Array;const r=new q0;try{if(r.writeByte(e.info.rulesetId),r.writeInteger(Hr.LATEST_VERSION),r.writeString(e.info.beatmapHashMD5??""),r.writeString(e.info.username),r.writeString(e.replay?.hashMD5??""),r.writeShort(e.info.count300),r.writeShort(e.info.count100),r.writeShort(e.info.count50),r.writeShort(e.info.countGeki),r.writeShort(e.info.countKatu),r.writeShort(e.info.countMiss),r.writeInteger(e.info.totalScore),r.writeShort(e.info.maxCombo),r.writeByte(Number(e.info.perfect)),r.writeInteger((e.info.mods?.bitwise??Number(e.info.rawMods))||0),r.writeString(Ka.encodeLifeBar(e.replay?.lifeBar??[])),r.writeDate(e.info.date),e.replay){const s=Ka.encodeReplayFrames(e.replay.frames,t);r.writeBytes(await r.compressData(s))}else r.writeInteger(0);r.writeLong(BigInt(e.info.id));const i=JSON.stringify(Nr.fromScore(e.info));return r.writeBytes(await r.compressData(i)),r.finish()}catch(i){const s=i.message||i;throw new Error(`Failed to encode a score: '${s}'`)}}}class J0{static _forceNewCombo=!1;static _extraComboOffset=0;static handleLine(e,t,r){const i=e.split(",").map(l=>l.trim()),s=H.parseInt(i[3]),o=this.createHitObject(s);o.startX=H.parseInt(i[0],H.MAX_COORDINATE_VALUE),o.startY=H.parseInt(i[1],H.MAX_COORDINATE_VALUE),o.startTime=H.parseFloat(i[2])+r,o.hitType=s,o.hitSound=H.parseInt(i[4]);const u=new zs;this.addExtras(i.slice(5),o,u,r,t.fileFormat),this.addComboOffset(o,t),o.samples.length===0&&(o.samples=this.convertSoundType(o.hitSound,u)),t.hitObjects.push(o)}static addComboOffset(e,t){const r=t.originalMode===0,i=t.originalMode===2;if(!r&&!i)return;const s=e,o=Math.trunc((e.hitType&le.ComboOffset)>>4),u=!!(e.hitType&le.NewCombo);(e.hitType&le.Normal||e.hitType&le.Slider)&&(s.isNewCombo=u||this._forceNewCombo,s.comboOffset=o+this._extraComboOffset,this._forceNewCombo=!1,this._extraComboOffset=0),e.hitType&le.Spinner&&(this._forceNewCombo=t.fileFormat<=8||u||!1,this._extraComboOffset+=o)}static addExtras(e,t,r,i,s){if(t.hitType&le.Normal&&e.length>0&&this.readCustomSampleBanks(e[0],r),t.hitType&le.Slider)return this.addSliderExtras(e,t,r,s);if(t.hitType&le.Spinner)return this.addSpinnerExtras(e,t,r,i);if(t.hitType&le.Hold)return this.addHoldExtras(e,t,r,i)}static addSliderExtras(e,t,r,i){const s=e[0],o=t.startPosition,u=H.parseInt(e[1]);if(t.repeats>9e3)throw new Error("Repeat count is way too high");if(t.repeats=Math.max(0,u-1),t.path.controlPoints=this.convertPathString(s,o,i),t.path.curveType=t.path.controlPoints[0].type,e.length>2){const l=H.parseFloat(e[2],H.MAX_COORDINATE_VALUE);t.path.expectedDistance=Math.max(0,l)}e.length>5&&this.readCustomSampleBanks(e[5],r),t.samples=this.convertSoundType(t.hitSound,r),t.nodeSamples=this.getSliderNodeSamples(e,t,r)}static addSpinnerExtras(e,t,r,i){t.endTime=H.parseInt(e[0])+i,e.length>1&&this.readCustomSampleBanks(e[1],r)}static addHoldExtras(e,t,r,i){if(t.endTime=t.startTime,e.length>0&&e[0]){const s=e[0].split(":");t.endTime=Math.max(t.endTime,H.parseFloat(s[0]))+i,this.readCustomSampleBanks(s.slice(1).join(":"),r)}}static getSliderNodeSamples(e,t,r){const i=t.repeats+2,s=[];for(let l=0;l<i;++l)s.push(r.clone());if(e.length>4&&e[4].length>0){const l=e[4].split("|");for(let c=0;c<i&&!(c>=l.length);++c)this.readCustomSampleBanks(l[c],s[c])}const o=[];for(let l=0;l<i;++l)o.push(t.hitSound);if(e.length>3&&e[3].length>0){const l=e[3].split("|");for(let c=0;c<i&&!(c>=l.length);++c)o[c]=parseInt(l[c])||se.None}const u=[];for(let l=0;l<i;l++)u.push(this.convertSoundType(o[l],s[l]));return u}static convertPathString(e,t,r){const i=e.split("|").map(c=>c.trim()),s=[];let o=0,u=0,l=!0;for(;++u<i.length;){if(i[u].length>1)continue;const c=i.slice(o,u),h=u<i.length-1?i[u+1]:null,d=this.convertPoints(c,h,l,t,r);for(const m of d)s.push(...m);o=u,l=!1}if(u>o){const c=i.slice(o,u),h=this.convertPoints(c,null,l,t,r);for(const d of h)s.push(...d)}return s}static*convertPoints(e,t,r,i,s){const o=r?1:0,u=t!==null?1:0,l=[];o===1&&(l[0]=new fs);for(let g=1;g<e.length;++g)l[o+g-1]=m(e[g],i);t!==null&&(l[l.length-1]=m(t,i));let c=this.convertPathType(e[0]);c===st.PerfectCurve&&(l.length!==3?c=st.Bezier:D(l)&&(c=st.Linear)),l[0].type=c;let h=0,d=0;for(;++d<l.length-u;){if(!l[d].position.equals(l[d-1].position))continue;const g=s<Ks.FIRST_LAZER_VERSION;c===st.Catmull&&d>1&&g||d!==l.length-u-1&&(l[d-1].type=c,yield l.slice(h,d),h=d+1)}d>h&&(yield l.slice(h,d));function m(g,F){const T=g.split(":").map(C=>Math.trunc(H.parseFloat(C,H.MAX_COORDINATE_VALUE))),E=new ae(T[0],T[1]).fsubtract(F);return new fs(E)}function D(g){const F=(g[1].position.y-g[0].position.y)*(g[2].position.x-g[0].position.x),T=(g[1].position.x-g[0].position.x)*(g[2].position.y-g[0].position.y);return Math.abs(F-T)<.001}}static convertPathType(e){switch(e){default:case"C":return st.Catmull;case"B":return st.Bezier;case"L":return st.Linear;case"P":return st.PerfectCurve}}static readCustomSampleBanks(e,t){if(!e)return;const r=e.split(":");t.normalSet=H.parseInt(r[0]),t.additionSet=H.parseInt(r[1]),t.additionSet===Ce.None&&(t.additionSet=t.normalSet),r.length>2&&(t.customIndex=H.parseInt(r[2])),r.length>3&&(t.volume=Math.max(0,H.parseInt(r[3]))),t.filename=r.length>4?r[4]:""}static convertSoundType(e,t){if(t.filename){const i=new Mn;return i.filename=t.filename,i.volume=t.volume,[i]}const r=[new Mn];if(r[0].hitSound=se[se.Normal],r[0].sampleSet=Ce[t.normalSet],r[0].isLayered=e!==se.None&&!(e&se.Normal),e&se.Finish){const i=new Mn;i.hitSound=se[se.Finish],r.push(i)}if(e&se.Whistle){const i=new Mn;i.hitSound=se[se.Whistle],r.push(i)}if(e&se.Clap){const i=new Mn;i.hitSound=se[se.Clap],r.push(i)}return r.forEach((i,s)=>{i.sampleSet=s!==0?Ce[t.additionSet]:Ce[t.normalSet],i.volume=t.volume,i.customIndex=0,t.customIndex>=2&&(i.customIndex=t.customIndex)}),r}static createHitObject(e){if(e&le.Normal)return new L0;if(e&le.Slider)return new Xs;if(e&le.Spinner)return new I0;if(e&le.Hold)return new O0;throw new Error(`Unknown hit object type: ${e}!`)}}class Q0{static handleLine(e,t){const[r,...i]=e.split(":"),s=i.join(":").trim();switch(r.trim()){case"Title":t.metadata.title=s;break;case"TitleUnicode":t.metadata.titleUnicode=s;break;case"Artist":t.metadata.artist=s;break;case"ArtistUnicode":t.metadata.artistUnicode=s;break;case"Creator":t.metadata.creator=s;break;case"Version":t.metadata.version=s;break;case"Source":t.metadata.source=s;break;case"Tags":t.metadata.tags=s.split(" ");break;case"BeatmapID":t.metadata.beatmapId=H.parseInt(s);break;case"BeatmapSetID":t.metadata.beatmapSetId=H.parseInt(s)}}}class Ya{static pendingTime=0;static pendingTypes=[];static pendingPoints=[];static controlPoints;static handleLine(e,t,r){this.controlPoints=t.controlPoints;const i=e.split(",");let s=Or.SimpleQuadruple,o=Ce[Ce.None],u=0,l=100,c=!0,h=Nt.None;if(i.length>2)switch(i.length){default:case 8:h=H.parseInt(i[7]);case 7:c=i[6]==="1";case 6:l=H.parseInt(i[5]);case 5:u=H.parseInt(i[4]);case 4:o=Ce[H.parseInt(i[3])];case 3:s=H.parseInt(i[2])}if(s<1)throw new Error("The numerator of a time signature must be positive.");const d=H.parseFloat(i[0])+r,m=H.parseFloat(i[1],H.MAX_PARSE_VALUE,!0);let D=1,g=1;if(m<0&&(g=100/-m,D=Math.min(Math.fround(-m),1e4),D=Math.max(10,D)/100),c&&Number.isNaN(m))throw new Error("Beat length cannot be NaN in a timing control point");if(c){const C=new Qt;C.beatLength=m,C.timeSignature=s,this.addControlPoint(C,d,!0)}const F=new $n;F.bpmMultiplier=D,F.sliderVelocity=g,F.generateTicks=!Number.isNaN(m),F.isLegacy=!0,this.addControlPoint(F,d,c);const T=new er;T.kiai=(h&Nt.Kiai)>0,T.omitFirstBarLine=(h&Nt.OmitFirstBarLine)>0,(t.originalMode===1||t.originalMode===3)&&(T.scrollSpeed=g),this.addControlPoint(T,d,c);const E=new tr;E.sampleSet=o,E.customIndex=u,E.volume=l,this.addControlPoint(E,d,c)}static addControlPoint(e,t,r){t!==this.pendingTime&&this.flushPendingPoints(),r?this.pendingPoints.unshift(e):this.pendingPoints.push(e),this.pendingTime=t}static flushPendingPoints(){const e=this.pendingTime,t=this.pendingPoints,r=this.controlPoints,i=this.pendingTypes;let s=t.length;for(;--s>=0;)i.includes(t[s].pointType)||(i.push(t[s].pointType),r.add(t[s],e));this.pendingPoints=[],this.pendingTypes=[]}}class qa{static decodeLifeBar(e){if(!e)return[];const t=[],r=e.split(",");for(let i=0;i<r.length;++i){if(!r[i])continue;const s=r[i].split("|");if(s.length<2)continue;const o=this.handleLifeBarFrame(s);t.push(o)}return t}static handleLifeBarFrame(e){return new D0(H.parseInt(e[0]),H.parseFloat(e[1]))}static decodeReplayFrames(e){if(!e)return[];let t=0;const r=[],i=e.split(",");for(let s=0;s<i.length;++s){if(!i[s])continue;const o=i[s].split("|");if(o.length<4||o[0]==="-12345")continue;const u=this.handleReplayFrame(o);t+=u.interval,!(s<2&&u.mouseX===256&&u.mouseY===-500)&&(u.interval<0||(u.startTime=t,r.push(u)))}return r}static handleReplayFrame(e){return new Bi(0,H.parseFloat(e[0]),new ae(H.parseFloat(e[1],H.MAX_COORDINATE_VALUE),H.parseFloat(e[2],H.MAX_COORDINATE_VALUE)),H.parseInt(e[3]))}}class Z0{view;_bytesRead=0;get bytesRead(){return this._bytesRead}constructor(e){this.view=new DataView(new Uint8Array(e).buffer)}get remainingBytes(){return this.view.byteLength-this._bytesRead}async readCompressedData(e){return Gr(await ou.decompress(e))}readByte(){return this.view.getUint8(this._bytesRead++)}readBytes(e){e??=this.readInteger();const t=this.view.buffer.slice(this._bytesRead,this._bytesRead+e);return this._bytesRead+=e,new Uint8Array(t)}readShort(){const e=this.view.getUint16(this._bytesRead,!0);return this._bytesRead+=2,e}readInteger(){const e=this.view.getInt32(this._bytesRead,!0);return this._bytesRead+=4,e}readLong(){const e=this.view.getBigInt64(this._bytesRead,!0);return this._bytesRead+=8,e}readDate(){return new Date(Number(this.readLong()/BigInt(1e4))-621355968e5)}readULEB128(){let e=0,t=0,r=0;do r=this.readByte(),e|=(r&127)<<t,t+=7;while((r&128)!==0);return e}readString(){if(this.readByte()!==11)return"";const e=this.readULEB128();return e>0?Gr(this.readBytes(e)):""}}class $0{static handleLine(e,t){const[r,...i]=e.split(":").map(o=>o.trim()),s=i.join(" ");r==="UseSkinSprites"&&(t.useSkinSprites=s==="1")}}class Ja{static handleLine(e,t){if(!e.startsWith("$"))return;const r=e.split("=");r.length===2&&t.set(r[0],r[1].trimEnd())}static decodeVariables(e,t){return!e.includes("$")||!t.size||t.forEach((r,i)=>{e=e.replace(i,r)}),e}}class uu{async _getFileBuffer(e){try{await Zt(e)}catch{throw new Error("File doesn't exist!")}try{return await Zt(e)}catch{throw new Error("File can't be read!")}}async _getFileUpdateDate(e){try{return(await Zt(e)).mtime}catch{throw new Error("Failed to get last file update date!")}}}class ed extends Map{currentSection=null;get(e){return super.get(e)??!1}set(e,t=!0){return super.set(e,t)}reset(){return this.forEach((e,t,r)=>{r.set(t,!0)}),this.currentSection=null,this}get hasEnabledSections(){for(const e of this.values())if(e)return!0;return!1}get isSectionEnabled(){return this.currentSection?this.get(this.currentSection):!1}}class lu extends uu{_lines=null;_foundFirstNonEmptyLine=!1;_sectionMap=new ed;_getLines(e){let t=null;if(e.constructor===Array&&(t=e),!t||!t.length)throw new Error("Data not found!");return t}_parseLine(e,t){if(!this._foundFirstNonEmptyLine&&e.includes("osu file format v")){const r=e.trim();try{return r.startsWith("osu file format v")&&(t.fileFormat=H.parseInt(r.split("v")[1])),Ct.FileFormat}catch{throw new Error("Wrong file format version!")}}if(!this._foundFirstNonEmptyLine&&!this._isEmptyLine(e)&&(this._foundFirstNonEmptyLine=!0),this._shouldSkipLine(e))return Ct.Empty;if(e=this._preprocessLine(e),e.startsWith("[")&&e.endsWith("]")){const r=e.slice(1,-1);return this._sectionMap.currentSection&&(this._sectionMap.set(this._sectionMap.currentSection,!1),this._sectionMap.currentSection=null),this._sectionMap.hasEnabledSections?(r in xe&&(this._sectionMap.currentSection=r),Ct.Section):Ct.Break}if(!this._sectionMap.isSectionEnabled)return Ct.Empty;try{return this._parseSectionData(e,t),Ct.Data}catch{return Ct.Empty}}_parseSectionData(e,t){const r=t;this._sectionMap.currentSection===xe.Colours&&r?.colors&&M0.handleLine(e,r)}_preprocessLine(e){return this._sectionMap.currentSection!==xe.Metadata&&(e=this._stripComments(e)),e.trimEnd()}_shouldSkipLine(e){return this._isEmptyLine(e)||e.startsWith("//")}_isEmptyLine(e){return typeof e!="string"||!e}_stripComments(e){const t=e.indexOf("//");return t>0?e.substring(0,t):e}_reset(){this._sectionMap.reset(),this._lines=null,this._foundFirstNonEmptyLine=!1}_setEnabledSections(e){this._sectionMap.set(xe.Colours,e?.parseColours)}}class td extends lu{_variables=new Map;async decodeFromPath(e,t){if(!e.endsWith(at.Beatmap)&&!e.endsWith(at.Storyboard))throw new Error(`Wrong format of the first file! Only ${at.Beatmap} and ${at.Storyboard} files are supported!`);if(typeof t=="string"&&!t.endsWith(at.Storyboard))throw new Error(`Wrong format of the second file! Only ${at.Storyboard} files are supported as a second argument!`);try{const r=await this._getFileBuffer(e),i=typeof t=="string"?await this._getFileBuffer(e):void 0;return this.decodeFromBuffer(r,i)}catch(r){const i=r.message||r;throw new Error(`Failed to decode a storyboard: '${i}'`)}}decodeFromBuffer(e,t){const r=Gr(e),i=t?Gr(t):void 0;return this.decodeFromString(r,i)}decodeFromString(e,t){typeof e!="string"&&(e=String(e)),typeof t!="string"&&typeof t<"u"&&(t=String(t));const r=e.split(/\r?\n/),i=t?.split(/\r?\n/);return this.decodeFromLines(r,i)}decodeFromLines(e,t){const r=new Hh;this._reset(),this._setEnabledSections(),this._lines=[...this._getLines(e),...t?this._getLines(t):[]];for(let i=0;i<this._lines.length&&this._parseLine(this._lines[i],r)!==Ct.Break;++i);return r.variables=this._variables,r}_parseSectionData(e,t){switch(this._sectionMap.currentSection){case xe.General:return $0.handleLine(e,t);case xe.Events:return au.handleLine(e,t);case xe.Variables:return Ja.handleLine(e,this._variables)}super._parseSectionData(e,t)}_setEnabledSections(){super._setEnabledSections(),this._sectionMap.set(xe.General),this._sectionMap.set(xe.Variables),this._sectionMap.set(xe.Events)}_preprocessLine(e){return e=Ja.decodeVariables(e,this._variables),super._preprocessLine(e)}_reset(){super._reset(),this._sectionMap.currentSection=xe.Events}}class nd extends lu{static EARLY_VERSION_TIMING_OFFSET=24;_offset=0;_sbLines=null;async decodeFromPath(e,t){if(!e.endsWith(at.Beatmap))throw new Error(`Wrong file format! Only ${at.Beatmap} files are supported!`);try{const r=await this._getFileBuffer(e),i=this.decodeFromBuffer(r,t);return i.fileUpdateDate=await this._getFileUpdateDate(e),i}catch(r){const i=r.message||r;throw new Error(`Failed to decode a beatmap: ${i}`)}}decodeFromBuffer(e,t){return this.decodeFromString(Gr(e),t)}decodeFromString(e,t){return e=typeof e!="string"?String(e):e,this.decodeFromLines(e.split(/\r?\n/),t)}decodeFromLines(e,t){const r=new nu;this._reset(),this._lines=this._getLines(e),this._setEnabledSections(typeof t!="boolean"?t:{}),this._sbLines=this._shouldParseStoryboard(t)?[]:null;for(let i=0;i<this._lines.length&&this._parseLine(this._lines[i],r)!==Ct.Break;++i);Ya.flushPendingPoints();for(let i=0;i<r.hitObjects.length;++i)r.hitObjects[i].applyDefaults(r.controlPoints,r.difficulty);if(r.hitObjects.sort((i,s)=>i.startTime-s.startTime),this._sbLines&&this._sbLines.length){const i=new td;r.events.storyboard=i.decodeFromLines(this._sbLines),r.events.storyboard.useSkinSprites=r.general.useSkinSprites,r.events.storyboard.colors=r.colors,r.events.storyboard.fileFormat=r.fileFormat}return r}_parseSectionData(e,t){switch(this._sectionMap.currentSection){case xe.General:return R0.handleLine(e,t,this._offset);case xe.Editor:return B0.handleLine(e,t);case xe.Metadata:return Q0.handleLine(e,t);case xe.Difficulty:return x0.handleLine(e,t);case xe.Events:return k0.handleLine(e,t,this._sbLines,this._offset);case xe.TimingPoints:return Ya.handleLine(e,t,this._offset);case xe.HitObjects:return J0.handleLine(e,t,this._offset)}super._parseSectionData(e,t)}_setEnabledSections(e){super._setEnabledSections(e),this._sectionMap.set(xe.General,e?.parseGeneral),this._sectionMap.set(xe.Editor,e?.parseEditor),this._sectionMap.set(xe.Metadata,e?.parseMetadata),this._sectionMap.set(xe.Difficulty,e?.parseDifficulty),this._sectionMap.set(xe.Events,e?.parseEvents),this._sectionMap.set(xe.TimingPoints,e?.parseTimingPoints),this._sectionMap.set(xe.HitObjects,e?.parseHitObjects)}_shouldParseStoryboard(e){const t=e,r=t?.parseStoryboard??e,i=typeof r=="boolean"?r:!0;return(t?.parseEvents??!0)&&i}}class rd extends uu{async decodeFromPath(e,t=!0){if(!e.endsWith(at.Replay))throw new Error(`Wrong file format! Only ${at.Replay} files are supported!`);try{const r=await this._getFileBuffer(e);return await this.decodeFromBuffer(r,t)}catch(r){const i=r.message||r;throw new Error(`Failed to decode a score: '${i}'`)}}async decodeFromBuffer(e,t=!0){const r=new Z0(e),i=new ki;let s=null;try{i.rulesetId=r.readByte();const o=r.readInteger();i.isLegacyScore=o<Hr.FIRST_LAZER_VERSION,i.totalScoreVersion=o<30000002?30000001:Hr.LATEST_VERSION,i.beatmapHashMD5=r.readString(),i.username=r.readString();const u=r.readString();i.count300=r.readShort(),i.count100=r.readShort(),i.count50=r.readShort(),i.countGeki=r.readShort(),i.countKatu=r.readShort(),i.countMiss=r.readShort(),i.totalScore=r.readInteger(),i.maxCombo=r.readShort(),i.perfect=!!r.readByte(),i.rawMods=r.readInteger();const l=r.readString();i.date=r.readDate();const c=r.readBytes();if(t&&c.length>0){s=new su;const d=await r.readCompressedData(c);s.mode=i.rulesetId,s.gameVersion=o,s.hashMD5=u,s.frames=qa.decodeReplayFrames(d),s.lifeBar=qa.decodeLifeBar(l)}o>=20140721?i.id=Number(r.readLong()):o>=20121008&&(i.id=r.readInteger());const h=o>=30000001?r.readBytes():new Uint8Array;if(h.length>0){const d=await r.readCompressedData(h),m=JSON.parse(d),D=Nr.fromJSON(m);i.id=D.onlineId,i.apiMods=D.mods,i.statistics=D.statistics,i.maximumStatistics=D.maximumStatistics,i.clientVersion=D.clientVersion,i.rank=D.rank,D.userId>1&&(i.userId=D.userId)}return new ja(i,s)}catch{return new ja(i,null)}}}class Ri extends zr{constructor(){super(...arguments),this._originalColumn=0,this._column=0}get originalColumn(){return this._originalColumn}set originalColumn(e){this._originalColumn=e,this._column=e}get column(){return this._column}set column(e){this._column=e}get startX(){return this._column}get endX(){return this.startX}clone(){const e=super.clone();return e.originalColumn=this.originalColumn,e.column=this.column,e}}class gn extends Ri{}class cu extends gn{}class hu extends gn{}class id extends Ri{}class sd extends Uh{static*generateHoldTicks(e){if(e.tickInterval===0)return;const t=new cu;t.startTime=e.startTime,t.column=e.column,yield t;const r=e.tickInterval;let i=e.startTime+r;const s=e.endTime-r;for(;i<=s;){const u=new id;u.startTime=i,yield u,i+=r}const o=new hu;o.startTime=e.endTime,o.column=e.column,yield o}}class kn extends Ri{constructor(){super(...arguments),this.tickInterval=50,this.nodeSamples=[],this.endTime=0,this.hitType=le.Hold}get duration(){return this.endTime-this.startTime}get head(){const e=this.nestedHitObjects.find(t=>t instanceof cu);return e&&(e.startTime=this.startTime),e||null}get tail(){const e=this.nestedHitObjects.find(t=>t instanceof hu);return e&&(e.startTime=this.endTime),e||null}get column(){return this._column}set column(e){this._column=e,this.head&&(this.head.column=e),this.tail&&(this.tail.column=e)}applyDefaultsToSelf(e,t){super.applyDefaultsToSelf(e,t);const r=e.timingPointAt(this.startTime);this.tickInterval=r.beatLength/t.sliderTickRate}createNestedHitObjects(){this.nestedHitObjects=[];for(const e of sd.generateHoldTicks(this))this.nestedHitObjects.push(e)}clone(){const e=super.clone();return e.endTime=this.endTime,e.nodeSamples=this.nodeSamples.map(t=>t.map(r=>r.clone())),e.tickInterval=this.tickInterval,e}}class ad extends s0{}class od extends a0{}class du extends ru{constructor(){super(...arguments),this.multiplier=1}}class fu{constructor(){this.name="Dual Stages",this.acronym="DS",this.bitwise=N.KeyCoop,this.type=Xe.Conversion,this.multiplier=1,this.isRanked=!1,this.incompatibles=N.None}applyToConverter(e){e.isDual=!0}}class Ys extends o0{}class ud{constructor(){this.name="Fade In",this.acronym="FI",this.bitwise=N.FadeIn,this.type=Xe.DifficultyIncrease,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.Hidden|N.Flashlight}}class ld extends u0{constructor(){super(...arguments),this.multiplier=1,this.incompatibles=N.Hidden|N.FadeIn}}class mu extends l0{constructor(){super(...arguments),this.multiplier=.5}}class pu extends c0{constructor(){super(...arguments),this.multiplier=1}}class cd extends h0{constructor(){super(...arguments),this.multiplier=1,this.incompatibles=N.FadeIn|N.Flashlight}}class rn{constructor(){this.type=Xe.Conversion,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.KeyMod}applyToConverter(e){e.targetColumns=this.keyCount}}class gu extends rn{constructor(){super(...arguments),this.name="One Key",this.acronym="1K",this.bitwise=N.Key1,this.keyCount=1,this.incompatibles=N.KeyMod^N.Key1}}class _u extends rn{constructor(){super(...arguments),this.name="Two Keys",this.acronym="2K",this.bitwise=N.Key2,this.keyCount=2,this.incompatibles=N.KeyMod^N.Key2}}class Du extends rn{constructor(){super(...arguments),this.name="Three Keys",this.acronym="3K",this.bitwise=N.Key3,this.keyCount=3,this.incompatibles=N.KeyMod^N.Key3}}class bu extends rn{constructor(){super(...arguments),this.name="Four Keys",this.acronym="4K",this.bitwise=N.Key4,this.keyCount=4,this.incompatibles=N.KeyMod^N.Key4}}class Su extends rn{constructor(){super(...arguments),this.name="Five Keys",this.acronym="5K",this.bitwise=N.Key5,this.keyCount=5,this.incompatibles=N.KeyMod^N.Key5}}class yu extends rn{constructor(){super(...arguments),this.name="Six Keys",this.acronym="6K",this.bitwise=N.Key6,this.keyCount=6,this.incompatibles=N.KeyMod^N.Key6}}class wu extends rn{constructor(){super(...arguments),this.name="Seven Keys",this.acronym="7K",this.bitwise=N.Key7,this.keyCount=7,this.incompatibles=N.KeyMod^N.Key7}}class vu extends rn{constructor(){super(...arguments),this.name="Eight Keys",this.acronym="8K",this.bitwise=N.Key8,this.keyCount=8,this.incompatibles=N.KeyMod^N.Key8}}class Eu extends rn{constructor(){super(...arguments),this.name="Nine Keys",this.acronym="9K",this.bitwise=N.Key9,this.keyCount=9,this.incompatibles=N.KeyMod^N.Key9}}class hd{constructor(){this.name="Mirror",this.acronym="MR",this.bitwise=N.Mirror,this.type=Xe.Conversion,this.multiplier=1,this.isRanked=!0,this.incompatibles=N.None}applyToBeatmap(e){e.hitObjects.forEach(t=>{t.column=e.totalColumns-1-t.column})}}class dd extends m0{}class Au extends f0{}class fd extends g0{}class md extends d0{}class pd extends p0{}class gd{constructor(){this.name="Random",this.acronym="RD",this.bitwise=N.Random,this.type=Xe.Conversion,this.multiplier=1,this.isRanked=!1,this.incompatibles=N.None}applyToBeatmap(e){const t=[],r=[];for(let i=0;i<e.totalColumns;++i)t.push(Math.random()),r.push(i);r.sort((i,s)=>t[r.indexOf(i)]-t[r.indexOf(s)]),e.hitObjects.forEach(i=>i.column=r[i.column])}}class Li extends _0{get mode(){return 3}get _availableMods(){return[new dd,new Au,new Ys,new cd,new ud,new pu,new fd,new du,new mu,new md,new ld,new ad,new pd,new od,new gu,new _u,new Du,new bu,new Su,new yu,new wu,new vu,new Eu,new gd,new fu,new hd]}}class _d extends qh{constructor(e,t){super(),this.mods=new Li,this.stages=[],this.originalTotalColumns=0,this.hitObjects=[],this.stages.push(e),this.originalTotalColumns=t||e.columns}get mode(){return 3}get totalColumns(){return this.stages.reduce((e,t)=>e+t.columns,0)}get maxCombo(){return this.hitObjects.reduce((e,t)=>t instanceof gn?e+1:t instanceof kn?e+1+Math.trunc((t.endTime-t.startTime)/100):e,0)}get notes(){return this.hitObjects.filter(e=>e instanceof gn)}get holds(){return this.hitObjects.filter(e=>e instanceof kn)}}class Oi{constructor(e,t,r,i,s){this._conversionDiff=null,this.hitObject=e,this.beatmap=t,this.originalBeatmap=r,this.previousPattern=i,this.totalColumns=t.totalColumns,this.randomStart=t.totalColumns===8?1:0,this.rng=s}getColumn(e,t=!1){if(t&&this.totalColumns===8){const s=Math.round(7314285714285714e-9)/1e5,o=Math.floor(e/s);return Math.max(0,Math.min(o,6))+1}const r=Math.round(512/this.totalColumns*1e5)/1e5,i=Math.floor(e/r);return Math.max(0,Math.min(i,this.totalColumns-1))}getRandomNoteCount(e,t,r=0,i=0,s=0){if(e<0||e>1)throw new Error("p2 is not in range 0-1");if(t<0||t>1)throw new Error("p3 is not in range 0-1");if(r<0||r>1)throw new Error("p4 is not in range 0-1");if(i<0||i>1)throw new Error("p5 is not in range 0-1");if(s<0||s>1)throw new Error("p6 is not in range 0-1");const o=this.rng.nextDouble();return o>=1-s?6:o>=1-i?5:o>=1-r?4:o>=1-t?3:o>=1-e?2:1}get conversionDifficulty(){if(this._conversionDiff!==null)return this._conversionDiff;const e=this.originalBeatmap.hitObjects,t=e[0],r=e[e.length-1],i=t.startTime||0,o=(r.startTime||0)-i-this.originalBeatmap.totalBreakTime;let u=Math.trunc(o/1e3);u===0&&(u=1e4);const l=this.originalBeatmap.difficulty;return this._conversionDiff=Math.max(4,Math.min(l.approachRate,7)),this._conversionDiff+=l.drainRate,this._conversionDiff/=1.5,this._conversionDiff+=e.length/u*Math.fround(9),this._conversionDiff=Math.fround(this._conversionDiff/38*5)/1.15,this._conversionDiff=Math.min(this._conversionDiff,12),this._conversionDiff}findAvailableColumn(e,t){const r=t.patterns||[],i=t.lowerBound||this.randomStart,s=t.upperBound||this.totalColumns,o=t.nextColumn||(()=>this.getRandomColumn(i,s)),u=t.validate||(()=>!0),l=h=>u(h)!==!1&&!r.find(d=>d.columnHasObject(h));if(l(e))return e;let c=!1;for(let h=i;h<s&&(c=l(h),!c);++h);if(!c)throw new Error("There were not enough columns to complete conversion.");do e=o(e);while(!l(e));return e}getRandomColumn(e,t){return e=e||this.randomStart,t=t||this.totalColumns,this.rng.nextInt(e,t)}}var ne;(function(n){n[n.None=0]="None",n[n.ForceStack=1]="ForceStack",n[n.ForceNotStack=2]="ForceNotStack",n[n.KeepSingle=4]="KeepSingle",n[n.LowProbability=8]="LowProbability",n[n.Alternate=16]="Alternate",n[n.ForceSigSlider=32]="ForceSigSlider",n[n.ForceNotSlider=64]="ForceNotSlider",n[n.Gathered=128]="Gathered",n[n.Mirror=256]="Mirror",n[n.Reverse=512]="Reverse",n[n.Cycle=1024]="Cycle",n[n.Stair=2048]="Stair",n[n.ReverseStair=4096]="ReverseStair"})(ne||(ne={}));class $e{constructor(){this.hitObjects=[],this.containedColumns=new Set}columnHasObject(e){return this.containedColumns.has(e)}get columnsWithObjects(){return this.containedColumns.size}addHitObject(e){this.hitObjects.push(e),this.containedColumns.add(e.column)}addPatternHitObjects(e){this.hitObjects.push(...e.hitObjects),e.hitObjects.forEach(t=>{this.containedColumns.add(t.column)})}clear(){this.hitObjects.length=0,this.containedColumns.clear()}}class Fu extends Oi{constructor(e,t,r,i,s){super(e,t,r,i,s),this.convertType=ne.None,t.controlPoints.effectPointAt(e.startTime).kiai||(this.convertType=ne.LowProbability);const o=e,u=t.controlPoints.timingPointAt(e.startTime),l=t.controlPoints.difficultyPointAt(e.startTime),c=u.beatLength*l.bpmMultiplier;this.spanCount=o.repeats+1||1,this.startTime=Gt.round(e.startTime);const h=t.difficulty.sliderMultiplier;this.endTime=(o.path.distance||0)*c*this.spanCount*.01/h,this.endTime=Math.trunc(Math.floor(this.startTime+this.endTime));const d=this.endTime-this.startTime;this.segmentDuration=d/this.spanCount>>0}*generate(){const e=this.generatePattern();if(e.hitObjects.length===1)return yield e;const t=new $e,r=new $e;for(const i of e.hitObjects){let s=i.endTime;s=s||i.startTime,this.endTime!==Gt.round(s)?t.addHitObject(i):r.addHitObject(i)}yield t,yield r}generatePattern(){if(this.totalColumns===1){const e=new $e;return this.addToPattern(e,0,this.startTime,this.endTime),e}if(this.spanCount>1){if(this.segmentDuration<=90)return this.generateRandomHoldNotes(this.startTime,1);if(this.segmentDuration<=120)return this.convertType|=ne.ForceNotStack,this.generateRandomNotes(this.startTime,this.spanCount+1);if(this.segmentDuration<=160)return this.generateStair(this.startTime);if(this.segmentDuration<=200&&this.conversionDifficulty>3)return this.generateRandomMultipleNotes(this.startTime);if(this.endTime-this.startTime>=4e3)return this.generateNRandomNotes(this.startTime,.23,0,0);const e=this.totalColumns-1-this.randomStart;return this.segmentDuration>400&&this.spanCount<e?this.generateTiledHoldNotes(this.startTime):this.generateHoldAndNormalNotes(this.startTime)}if(this.segmentDuration<=110){this.previousPattern.columnsWithObjects<this.totalColumns?this.convertType|=ne.ForceNotStack:this.convertType&=~ne.ForceNotStack;const e=this.segmentDuration<80?1:2;return this.generateRandomNotes(this.startTime,e)}return this.conversionDifficulty>6.5?this.convertType&ne.LowProbability?this.generateNRandomNotes(this.startTime,.78,.3,0):this.generateNRandomNotes(this.startTime,.85,.36,.03):this.conversionDifficulty>4?this.convertType&ne.LowProbability?this.generateNRandomNotes(this.startTime,.43,.08,0):this.generateNRandomNotes(this.startTime,.56,.18,0):this.conversionDifficulty>2.5?this.convertType&ne.LowProbability?this.generateNRandomNotes(this.startTime,.3,0,0):this.generateNRandomNotes(this.startTime,.37,.08,0):this.convertType&ne.LowProbability?this.generateNRandomNotes(this.startTime,.17,0,0):this.generateNRandomNotes(this.startTime,.27,0,0)}generateRandomHoldNotes(e,t){const r=new $e,i=this.totalColumns-this.randomStart-this.previousPattern.columnsWithObjects;let s=this.getRandomColumn();for(let o=0,u=Math.min(i,t);o<u;++o){const l={patterns:[r,this.previousPattern]};s=this.findAvailableColumn(s,l),this.addToPattern(r,s,e,this.endTime)}for(let o=0,u=t-i;o<u;++o){const l={patterns:[r]};s=this.findAvailableColumn(s,l),this.addToPattern(r,s,e,this.endTime)}return r}generateRandomNotes(e,t){const r=new $e,i=this.hitObject.startX;let s=this.getColumn(i||0,!0);const o=!!(this.convertType&ne.ForceNotStack),u=this.previousPattern.columnsWithObjects<this.totalColumns;if(o&&u){const c={patterns:[this.previousPattern]};s=this.findAvailableColumn(s,c)}let l=s;for(let c=0;c<t;++c){this.addToPattern(r,s,e,e);const h={validate:d=>d!==l};e+=this.segmentDuration,s=this.findAvailableColumn(s,h),l=s}return r}generateStair(e){const t=new $e,r=this.hitObject.startX;let i=this.getColumn(r||0,!0),s=this.rng.nextDouble()>.5;for(let o=0;o<=this.spanCount;++o)this.addToPattern(t,i,e,e),e+=this.segmentDuration,s?i>=this.totalColumns-1?(s=!1,--i):++i:i<=this.randomStart?(s=!0,++i):--i;return t}generateRandomMultipleNotes(e){const t=new $e,r=this.totalColumns>=4&&this.totalColumns<=8,i=this.rng.nextInt(1,this.totalColumns-(r?1:0)),s=this.hitObject.startX;let o=this.getColumn(s||0,!0);for(let u=0;u<=this.spanCount;++u)this.addToPattern(t,o,e,e),o+=i,o>=this.totalColumns-this.randomStart&&(o=o-this.totalColumns-this.randomStart+(r?1:0)),o+=this.randomStart,this.totalColumns>2&&this.addToPattern(t,o,e,e),o=this.getRandomColumn(),e+=this.segmentDuration;return t}generateNRandomNotes(e,t,r,i){switch(this.totalColumns){case 2:t=0,r=0,i=0;break;case 3:t=Math.min(t,.1),r=0,i=0;break;case 4:t=Math.min(t,.3),r=Math.min(r,.04),i=0;break;case 5:t=Math.min(t,.34),r=Math.min(r,.1),i=Math.min(i,.03);break}const s=!!this.hitObject.samples.find(h),o=!!this.hitSamplesAt(this.startTime).find(h);!(this.convertType&ne.LowProbability)&&(s||o)&&(t=1);const c=this.getRandomNoteCount(t,r,i);return this.generateRandomHoldNotes(e,c);function h(d){return d.hitSound===se[se.Clap]||d.hitSound===se[se.Finish]}}generateTiledHoldNotes(e){const t=new $e,r=Math.min(this.spanCount,this.totalColumns),i=e+this.segmentDuration*this.spanCount,s=this.hitObject.startX;let o=this.getColumn(s||0,!0);const u=!!(this.convertType&ne.ForceNotStack),l=this.previousPattern.columnsWithObjects<this.totalColumns;if(u&&l){const c={patterns:[this.previousPattern]};o=this.findAvailableColumn(o,c)}for(let c=0;c<r;++c){const h={patterns:[t]};o=this.findAvailableColumn(o,h),this.addToPattern(t,o,e,i),e+=this.segmentDuration}return t}generateHoldAndNormalNotes(e){const t=new $e,r=this.hitObject.startX;let i=this.getColumn(r||0,!0);const s=!!(this.convertType&ne.ForceNotStack),o=this.previousPattern.columnsWithObjects<this.totalColumns;if(s&&o){const d={patterns:[this.previousPattern]};i=this.findAvailableColumn(i,d)}this.addToPattern(t,i,e,this.endTime);let u=this.getRandomColumn(),l=0;if(this.conversionDifficulty>6.5)l=this.getRandomNoteCount(.63,0);else if(this.conversionDifficulty>4){const d=this.totalColumns<6?.12:.45;l=this.getRandomNoteCount(d,0)}else if(this.conversionDifficulty>2.5){const d=this.totalColumns<6?0:.24;l=this.getRandomNoteCount(d,0)}l=Math.min(this.totalColumns-1,l);const c=!this.hitSamplesAt(e).find(d=>d.hitSound===se[se.Whistle]||d.hitSound===se[se.Finish]||d.hitSound===se[se.Clap]),h=new $e;for(let d=0;d<=this.spanCount;++d){if(!(c&&e===this.startTime))for(let m=0;m<l;++m){const D={validate:g=>g!==i,patterns:[h]};u=this.findAvailableColumn(u,D),this.addToPattern(h,u,e,e)}t.addPatternHitObjects(h),h.clear(),e+=this.segmentDuration}return t}hitSamplesAt(e){return this.nodeSamplesAt(e)[0]||this.hitObject.samples}nodeSamplesAt(e){if(!(this.hitObject.hitType&le.Slider))return[];const t=this.hitObject;let r=0;return this.segmentDuration&&(r=(e-this.startTime)/this.segmentDuration),r?t.nodeSamples.slice(r):t.nodeSamples}addToPattern(e,t,r,i){var s,o;if(r===i){const u=new gn,l=this.hitObject;u.startTime=r,u.originalColumn=t,u.hitType=le.Normal|this.hitObject.hitType&le.NewCombo,u.samples=this.hitSamplesAt(r),u.startPosition=(s=l?.startPosition)!==null&&s!==void 0?s:new ae(256,192),e.addHitObject(u)}else{const u=new kn,l=this.hitObject;u.startTime=r,u.endTime=i,u.originalColumn=t,u.hitType=le.Hold|this.hitObject.hitType&le.NewCombo,u.samples=this.hitSamplesAt(r),u.nodeSamples=this.nodeSamplesAt(r),u.startPosition=(o=l?.startPosition)!==null&&o!==void 0?o:new ae(256,192),e.addHitObject(u)}}}Fu.BASE_SCORING_DISTANCE=100;class Qa extends Oi{constructor(e,t,r,i,s){super(e,t,r,i,s),this.endTime=Math.trunc(e.endTime||0),this.convertType=i.columnsWithObjects===this.totalColumns?ne.None:ne.ForceNotStack}*generate(){const e=new $e,t=this.endTime-this.hitObject.startTime>=100;switch(this.totalColumns){case 8:{const r=s=>s.hitSound===se[se.Finish];if(!!this.hitObject.samples.find(r)&&this.endTime-this.hitObject.startTime<1e3){this.addToPattern(e,0,t);break}this.addToPattern(e,this.getRandomColumn(),t);break}default:this.addToPattern(e,this.getRandomColumn(0),t);break}yield e}getRandomColumn(e){const t=super.getRandomColumn(e);if(this.convertType&ne.ForceNotStack){const r={lowerBound:e,patterns:[this.previousPattern]};return this.findAvailableColumn(t,r)}return this.findAvailableColumn(t,{lowerBound:e})}addToPattern(e,t,r){var i,s,o;if(r){const u=new kn,l=this.hitObject;u.startTime=this.hitObject.startTime,u.endTime=this.endTime,u.originalColumn=t,u.hitType=le.Hold|this.hitObject.hitType&le.NewCombo,u.samples=this.hitObject.samples,u.nodeSamples=(i=this.hitObject.nodeSamples)!==null&&i!==void 0?i:[],u.startPosition=(s=l?.startPosition)!==null&&s!==void 0?s:new ae(256,192),e.addHitObject(u)}else{const u=new gn,l=this.hitObject;u.startTime=this.hitObject.startTime,u.originalColumn=t,u.hitType=le.Normal|this.hitObject.hitType&le.NewCombo,u.samples=this.hitObject.samples,u.startPosition=(o=l?.startPosition)!==null&&o!==void 0?o:new ae(256,192),e.addHitObject(u)}}}class Za extends Oi{constructor(e,t,r,i,s,o,u,l,c){super(e,t,r,i,s),this.stairType=ne.None,this.convertType=ne.None,this.stairType=c;const h=t.controlPoints.timingPointAt(e.startTime),d=t.controlPoints.effectPointAt(e.startTime),D=(e.startPosition||new ae(0,0)).fsubtract(u).flength(),g=e.startTime-o;if(g<=80?this.convertType|=ne.ForceNotStack|ne.KeepSingle:g<=95?this.convertType|=ne.ForceNotStack|ne.KeepSingle|c:g<=105?this.convertType|=ne.ForceNotStack|ne.LowProbability:g<=125?this.convertType|=ne.ForceNotStack:g<=135&&D<20?this.convertType|=ne.Cycle|ne.KeepSingle:g<=150&&D<20?this.convertType|=ne.ForceStack|ne.LowProbability:D<20&&l>=h.beatLength/2.5?this.convertType|=ne.Reverse|ne.LowProbability:l<h.beatLength/2.5||d.kiai||(this.convertType|=ne.LowProbability),!(this.convertType&ne.KeepSingle)){const F=!!e.samples.find(E=>E.hitSound===se[se.Finish]),T=!!e.samples.find(E=>E.hitSound===se[se.Clap]);F&&this.totalColumns!==8?this.convertType|=ne.Mirror:T&&(this.convertType|=ne.Gathered)}}*generate(){const e=this._generateCore(),t=!!(this.convertType&ne.Stair),r=!!(this.convertType&ne.ReverseStair);for(const i of e.hitObjects)t&&i.column===this.totalColumns-1&&(this.stairType=ne.ReverseStair),r&&i.column===this.randomStart&&(this.stairType=ne.Stair);yield e}_generateCore(){const e=new $e;if(this.totalColumns===1)return this.addToPattern(e,0),e;const t=this.previousPattern.hitObjects.length?this.previousPattern.hitObjects[0].column:0;if(!!(this.convertType&ne.Reverse)&&this.previousPattern.hitObjects.length){for(let c=this.randomStart;c<this.totalColumns;++c)if(this.previousPattern.columnHasObject(c)){const h=this.randomStart+this.totalColumns-c-1;this.addToPattern(e,h)}return e}const i=!!(this.convertType&ne.Cycle),s=this.previousPattern.hitObjects.length===1,o=this.totalColumns!==8||t!==0,u=this.totalColumns%2===0||t!==this.totalColumns/2;if(i&&s&&o&&u){const c=this.randomStart+this.totalColumns-t-1;return this.addToPattern(e,c),e}if(!!(this.convertType&ne.ForceStack)&&this.previousPattern.hitObjects.length){for(let c=this.randomStart;c<this.totalColumns;++c)this.previousPattern.columnHasObject(c)&&this.addToPattern(e,c);return e}if(this.previousPattern.hitObjects.length===1){if(this.convertType&ne.Stair){let c=t+1;return c===this.totalColumns&&(c=this.randomStart),this.addToPattern(e,c),e}if(this.convertType&ne.ReverseStair){let c=t-1;return c===this.randomStart-1&&(c=this.totalColumns-1),this.addToPattern(e,c),e}}return this.convertType&ne.KeepSingle?this.generateRandomNotes(1):this.convertType&ne.Mirror?this.conversionDifficulty>6.5?this.generateRandomPatternWithMirrored(.12,.38,.12):this.conversionDifficulty>4?this.generateRandomPatternWithMirrored(.12,.17,0):this.generateRandomPatternWithMirrored(.12,0,0):this.conversionDifficulty>6.5?this.convertType&ne.LowProbability?this.generateRandomPattern(.78,.42,0,0):this.generateRandomPattern(1,.62,0,0):this.conversionDifficulty>4?this.convertType&ne.LowProbability?this.generateRandomPattern(.35,.08,0,0):this.generateRandomPattern(.52,.15,0,0):this.conversionDifficulty>2?this.convertType&ne.LowProbability?this.generateRandomPattern(.18,0,0,0):this.generateRandomPattern(.45,0,0,0):this.generateRandomPattern(0,0,0,0)}generateRandomNotes(e){const t=u=>(this.convertType&ne.Gathered?++u===this.totalColumns&&(u=this.randomStart):u=this.getRandomColumn(),u),r=new $e,i=!(this.convertType&ne.ForceNotStack);if(!i){const u=this.totalColumns-this.randomStart-this.previousPattern.columnsWithObjects;e=Math.min(e,u)}const s=this.hitObject.startX;let o=this.getColumn(s||0,!0);for(let u=0;u<e;++u){if(i){const l={nextColumn:t,patterns:[r]};o=this.findAvailableColumn(o,l)}else{const l={nextColumn:t,patterns:[r,this.previousPattern]};o=this.findAvailableColumn(o,l)}this.addToPattern(r,o)}return r}hasSpecialColumn(){const e=r=>r.hitSound===se[se.Clap],t=r=>r.hitSound===se[se.Finish];return!!this.hitObject.samples.find(e)&&!!this.hitObject.samples.find(t)}generateRandomPattern(e,t,r,i){const s=new $e,o=this.getRandomNoteCount(e,t,r,i),u=this.generateRandomNotes(o);return s.addPatternHitObjects(u),this.randomStart>0&&this.hasSpecialColumn()&&this.addToPattern(s,0),s}generateRandomPatternWithMirrored(e,t,r){if(this.convertType&ne.ForceNotStack)return this.generateRandomPattern(1/Math.fround(2)+t/2,t,(t+r)/2,r);const i=new $e,[s,o]=this.getRandomNoteCountMirrored(e,t,r),u=Math.trunc((this.totalColumns%2?this.totalColumns-1:this.totalColumns)/2);let l=this.getRandomColumn(this.randomStart,u);const c={upperBound:u,patterns:[i]};for(let h=0;h<s;++h){l=this.findAvailableColumn(l,c);const d=this.randomStart+this.totalColumns-l-1;this.addToPattern(i,l),this.addToPattern(i,d)}return o&&this.addToPattern(i,Math.trunc(this.totalColumns/2)),this.randomStart>0&&this.hasSpecialColumn()&&this.addToPattern(i,0),i}getRandomNoteCount(e,t,r,i){switch(this.totalColumns){case 2:e=0,t=0,r=0,i=0;break;case 3:e=Math.min(e,.1),t=0,r=0,i=0;break;case 4:e=Math.min(e,.23),t=Math.min(t,.04),r=0,i=0;break;case 5:t=Math.min(t,.15),r=Math.min(r,.03),i=0;break}const s=o=>o.hitSound===se[se.Clap];return this.hitObject.samples.find(s)&&(e=1),super.getRandomNoteCount(e,t,r,i)}getRandomNoteCountMirrored(e,t,r){switch(this.totalColumns){case 2:e=0,t=0,r=0;break;case 3:e=Math.min(e,.03),t=0,r=0;break;case 4:e=0,t=1-Math.max((1-t)*2,.8),r=0;break;case 5:e=Math.min(e,.03),r=0;break;case 6:e=0,t=1-Math.max((1-t)*2,.5),r=1-Math.max((1-r)*2,.85);break}t=Math.max(0,Math.min(t,1)),r=Math.max(0,Math.min(r,1));const i=this.rng.nextDouble(),s=super.getRandomNoteCount(t,r),o=this.totalColumns%2===1&&s!==3&&i>1-e;return[s,o]}addToPattern(e,t){var r;const i=new gn,s=this.hitObject;i.startTime=this.hitObject.startTime,i.originalColumn=t,i.hitType=le.Normal|this.hitObject.hitType&le.NewCombo,i.samples=this.hitObject.samples,i.startPosition=(r=s?.startPosition)!==null&&r!==void 0?r:new ae(256,192),e.addHitObject(i)}}class Dd extends Oi{*generate(){var e,t,r;const i=this.hitObject.startX,s=this.getColumn(i||0),o=new $e,u=[this.hitObject.samples,[]];if(this.hitObject.hitType&le.Hold){const l=new kn,c=this.hitObject;l.startTime=this.hitObject.startTime,l.endTime=(e=this.hitObject.endTime)!==null&&e!==void 0?e:l.startTime,l.originalColumn=s,l.samples=this.hitObject.samples,l.hitType=le.Hold|this.hitObject.hitType&le.NewCombo,l.nodeSamples=l.nodeSamples||u,l.startPosition=(t=c?.startPosition)!==null&&t!==void 0?t:new ae(256,192),o.addHitObject(l)}else{const l=new gn,c=this.hitObject;l.startTime=this.hitObject.startTime,l.originalColumn=s,l.hitType=le.Normal|this.hitObject.hitType&le.NewCombo,l.samples=this.hitObject.samples,l.startPosition=(r=c?.startPosition)!==null&&r!==void 0?r:new ae(256,192),o.addHitObject(l)}yield o}}var Tr;(function(n){n[n.Even=0]="Even",n[n.Odd=1]="Odd",n[n.Special=2]="Special"})(Tr||(Tr={}));class yi{constructor(e){this.columns=e??0}isSpecialColumn(e){return this.columns%2===1&&this.columns/2===e}getTypeOfColumn(e){return this.isSpecialColumn(e)?Tr.Special:Math.min(e,this.columns-1-e)%2?Tr.Even:Tr.Odd}clone(){return new yi(this.columns)}}class ir extends Xh{constructor(){super(...arguments),this.originalRuleset=3,this.originalTargetColumns=0,this.targetColumns=0,this.isDual=!1,this._rng=null,this._prevNoteTimes=[],this._density=Xt.MAX_INT32,this._lastTime=0,this._lastPosition=new ae(0,0),this._lastPattern=new $e,this._lastStair=ne.Stair}canConvert(e){return e.hitObjects.every(t=>Number.isFinite(t.startX))}convertBeatmap(e){var t;e=(t=e.base)!==null&&t!==void 0?t:e,this.originalRuleset=e.originalMode,this._updateTargetColumns(e);const r=e.difficulty;let i=Gt.round(r.approachRate);i+=Gt.round(r.drainRate+r.circleSize)*20,i+=Math.trunc(r.overallDifficulty*41.2),this._rng=new Xt(Math.trunc(i)),this._converted=this.createBeatmap(),this._converted.general=e.general,this._converted.editor=e.editor,this._converted.difficulty=e.difficulty.clone(),this._converted.metadata=e.metadata,this._converted.events=e.events,this._converted.controlPoints=e.controlPoints,this._converted.fileFormat=e.fileFormat,this._converted.originalMode=e.originalMode,this._converted.base=e;for(const s of this.convertHitObjects(e))this._converted.hitObjects.push(s);return this._converted.hitObjects.forEach(s=>s.originalColumn=s.column),this._converted.hitObjects.sort((s,o)=>s.startTime-o.startTime),this._converted.difficulty.circleSize=this._converted.totalColumns,this._converted}*convertHitObjects(e){const t=e.hitObjects;for(const r of t){if(r instanceof Ri){yield r;continue}const i=this.originalRuleset===3?this._generateSpecific(r,e):this._generateConverted(r,e);for(const s of i)yield s}}*_generateSpecific(e,t){const r=this._rng,i=this._converted,s=this._lastPattern,o=new Dd(e,i,t,s,r);for(const u of o.generate()){this._lastPattern=u;for(const l of u.hitObjects)yield l}}*_generateConverted(e,t){const r=this._rng,i=this._converted,s=this._lastPattern;let o=null;if(e.path){const u=new Fu(e,i,t,s,r),l=e.startPosition;for(let c=0;c<=u.spanCount;++c){const h=e.startTime+u.segmentDuration*c;this._recordNote(h,l||new ae(0,0)),this._computeDensity(h)}o=u}else if(typeof e.endTime=="number"){const u=new Qa(e,i,t,s,r),l=e;this._recordNote(l.endTime,new ae(256,192)),this._computeDensity(l.endTime),o=u}else if(e.startPosition){this._computeDensity(e.startTime);const u=this._lastTime,l=this._lastPosition,c=this._density,h=this._lastStair,d=new Za(e,i,t,s,r,u,l,c,h),m=e.startPosition;this._recordNote(e.startTime,m),o=d}if(o!==null)for(const u of o.generate()){o instanceof Qa||(this._lastPattern=u),o instanceof Za&&(this._lastStair=o.stairType);for(const l of u.hitObjects)yield l}}_updateTargetColumns(e){const t=e.difficulty,r=e.hitObjects,i=Gt.round(t.circleSize),s=Gt.round(t.overallDifficulty);if(this.targetColumns){this.originalTargetColumns||(this.originalTargetColumns=this.targetColumns);return}if(this.originalRuleset===3)this.targetColumns=Math.trunc(Math.max(1,i)),this.targetColumns>ir.MAX_STAGE_KEYS&&(this.targetColumns/=2,this.isDual=!0);else{const l=r.filter(c=>c.endTime||c.path).length/r.length;l<.2?this.targetColumns=7:l<.3||i>=5?this.targetColumns=s>5?7:6:l>.6?this.targetColumns=s>4?5:4:this.targetColumns=Math.max(4,Math.min(s+1,7))}this.originalTargetColumns=this.targetColumns}_computeDensity(e){const t=ir.MAX_NOTES_FOR_DENSITY;this._prevNoteTimes.length===t&&this._prevNoteTimes.shift(),this._prevNoteTimes.push(e),this._prevNoteTimes.length>=2&&(this._density=(e-this._prevNoteTimes[0])/this._prevNoteTimes.length)}_recordNote(e,t){this._lastTime=e,this._lastPosition=t}createBeatmap(){const e=new yi(this.targetColumns),t=new _d(e,this.originalTargetColumns);if(this.isDual){const r=new yi;r.columns=this.targetColumns,t.stages.push(r)}return t}}ir.MAX_NOTES_FOR_DENSITY=7;ir.MAX_STAGE_KEYS=10;class bd extends Kh{}class $a extends Jh{constructor(){super(...arguments),this.greatHitWindow=0}}class eo extends Qh{constructor(e,t){super(e,t),this.difficultyPerformance=0,this.mods=e}}class Sd extends t0{constructor(e,t,r,i,s){super(e,t,r,i,s),this.baseObject=e}}class ft extends i0{constructor(e,t){super(e),this._skillMultiplier=1,this._strainDecayBase=1,this._individualStrain=0,this._overallStrain=1,this._startTimes=new Array(t).fill(0),this._endTimes=new Array(t).fill(0),this._individualStrains=new Array(t).fill(0)}_strainValueOf(e){const t=e,r=t.startTime,i=t.endTime,s=t.baseObject.column;let o=!1,u=Math.abs(i-r),l=1,c=0;const h=1;for(let d=0;d<this._endTimes.length;++d){const m=this._endTimes[d]-h>r,D=i-h>this._endTimes[d],g=this._endTimes[d]-h>i;o||(o=m&&D),g&&(l=1.25),u=Math.min(u,Math.abs(i-this._endTimes[d]))}return o&&(c=1/(1+Math.exp(.5*(ft.RELEASE_THRESHOLD-u)))),this._individualStrains[s]=ft._applyDecay(this._individualStrains[s],r-this._startTimes[s],ft.INDIVIDUAL_DECAY_BASE),this._individualStrains[s]+=2*l,this._individualStrain=t.deltaTime<=1?Math.max(this._individualStrain,this._individualStrains[s]):this._individualStrains[s],this._overallStrain=ft._applyDecay(this._overallStrain,e.deltaTime,ft.OVERALL_DECAY_BASE),this._overallStrain+=(1+c)*l,this._startTimes[s]=r,this._endTimes[s]=i,this._individualStrain+this._overallStrain-this._currentStrain}_calculateInitialStrain(e,t){var r,i,s,o;const u=ft._applyDecay(this._individualStrain,e-((i=(r=t.previous(0))===null||r===void 0?void 0:r.startTime)!==null&&i!==void 0?i:0),ft.INDIVIDUAL_DECAY_BASE),l=ft._applyDecay(this._overallStrain,e-((o=(s=t.previous(0))===null||s===void 0?void 0:s.startTime)!==null&&o!==void 0?o:0),ft.OVERALL_DECAY_BASE);return u+l}static _applyDecay(e,t,r){return e*Math.pow(r,t/1e3)}}ft.INDIVIDUAL_DECAY_BASE=.125;ft.OVERALL_DECAY_BASE=.3;ft.RELEASE_THRESHOLD=24;class Ii extends $h{constructor(e,t){var r;super(e,t),this._isForCurrentRuleset=e.originalMode===t.id,this._originalOverallDifficulty=((r=e.base)!==null&&r!==void 0?r:e).difficulty.overallDifficulty}_createDifficultyAttributes(e,t,r,i){if(e.hitObjects.length===0)return new $a(t,0);const s=r[0].difficultyValue*Ii.STAR_SCALING_FACTOR,o=new $a(t,s);return o.mods=t,o.maxCombo=e.hitObjects.reduce((u,l)=>l instanceof kn?u+1+Math.trunc((l.endTime-l.startTime)/100):u+1,0),o.greatHitWindow=Math.ceil(Math.trunc(this._getHitWindow300(t)*i)/i),o}_createDifficultyHitObjects(e,t){const r=e.hitObjects.slice(),i=(u,l)=>Gt.round(u.startTime)-Gt.round(l.startTime),s=bi.depthSort(r,i),o=[];for(let u=1;u<s.length;++u){const l=new Sd(s[u],s[u-1],t,o,o.length);o.push(l)}return o}_sortObjects(e){return e}_createSkills(e,t){var r;return[new ft(t,(r=e?.totalColumns)!==null&&r!==void 0?r:0)]}get difficultyMods(){const e=[new du,new mu,new Ys,new pu];return this._isForCurrentRuleset?e:[...e,new gu,new _u,new Du,new bu,new Su,new yu,new wu,new vu,new Eu,new fu]}_getHitWindow300(e){const t=r=>e.has(N.HardRock)?r/1.4:e.has(N.Easy)?r*1.4:r;if(this._isForCurrentRuleset){const r=Math.min(10,Math.max(0,10-this._originalOverallDifficulty));return t(34+3*r)}return Gt.round(this._originalOverallDifficulty)>4?t(34):t(47)}}Ii.STAR_SCALING_FACTOR=.018;class yd extends e0{constructor(e,t,r){super(e,t,r),this._mods=new Li,this._countPerfect=0,this._countGreat=0,this._countGood=0,this._countOk=0,this._countMeh=0,this._countMiss=0,this.attributes=t,this._addParams(t,r)}calculateAttributes(e,t){if(this._addParams(e,t),!this.attributes)return new eo(this._mods,0);let r=8;this._mods.any(Au)&&(r*=.75),this._mods.any(Ys)&&(r*=.5);const i=this._computeDifficultyValue(),s=i*r,o=new eo(this._mods,s);return o.difficultyPerformance=i,o}_computeDifficultyValue(){let e=Math.pow(Math.max(this.attributes.starRating-.15,.05),2.2);return e*=Math.max(0,5*this._customAccuracy-4),e*=1+.1*Math.min(1,this._totalHits/1500),e}_addParams(e,t){var r,i,s,o,u,l,c;t&&(this._mods=(r=t?.mods)!==null&&r!==void 0?r:this._mods,this._countPerfect=(i=t.statistics.get(k.Perfect))!==null&&i!==void 0?i:0,this._countGreat=(s=t.statistics.get(k.Great))!==null&&s!==void 0?s:0,this._countGood=(o=t.statistics.get(k.Good))!==null&&o!==void 0?o:0,this._countOk=(u=t.statistics.get(k.Ok))!==null&&u!==void 0?u:0,this._countMeh=(l=t.statistics.get(k.Meh))!==null&&l!==void 0?l:0,this._countMiss=(c=t.statistics.get(k.Miss))!==null&&c!==void 0?c:0),e&&(this.attributes=e)}get _totalHits(){return this._countPerfect+this._countOk+this._countGreat+this._countGood+this._countMeh+this._countMiss}get _customAccuracy(){const e=this._countPerfect,t=this._countGreat,r=this._countGood,i=this._countOk,s=this._countMeh,o=this._totalHits;return o?(e*320+t*300+r*200+i*100+s*50)/(o*320):0}}var xn;(function(n){n[n.Special1=1]="Special1",n[n.Special2=2]="Special2",n[n.Key1=10]="Key1",n[n.Key2=11]="Key2",n[n.Key3=12]="Key3",n[n.Key4=13]="Key4",n[n.Key5=14]="Key5",n[n.Key6=15]="Key6",n[n.Key7=16]="Key7",n[n.Key8=17]="Key8",n[n.Key9=18]="Key9",n[n.Key10=19]="Key10",n[n.Key11=20]="Key11",n[n.Key12=21]="Key12",n[n.Key13=22]="Key13",n[n.Key14=23]="Key14",n[n.Key15=24]="Key15",n[n.Key16=25]="Key16",n[n.Key17=26]="Key17",n[n.Key18=27]="Key18",n[n.Key19=28]="Key19",n[n.Key20=29]="Key20"})(xn||(xn={}));class to extends iu{constructor(){super(...arguments),this.actions=new Set}fromLegacy(e,t,r){var i;if(!r)throw new Error("Beatmap must be provided to convert osu!mania replay frames.");this.startTime=e.startTime,this.interval=e.interval;const s=r;let o=xn.Key1,u=xn.Special1,l=Math.trunc((i=e.mouseX)!==null&&i!==void 0?i:0),c=0;for(;l>0;){const h=this._isColumnAtIndexSpecial(s,c);(l&1)>0&&this.actions.add(h?u:o),h?u++:o++,c++,l>>=1}return this}toLegacy(e){if(!e)throw new Error("Beatmap must be provided to convert osu!mania replay frames.");const t=e;let r=0;for(const i of this.actions){if(i===xn.Special1){r|=1<<this._getSpecialColumnIndex(t,0);continue}if(i===xn.Special2){r|=1<<this._getSpecialColumnIndex(t,1);continue}let s=i-xn.Key1,o=0;for(;o<t.totalColumns;)if(!this._isColumnAtIndexSpecial(t,o)){if(s===0)break;s--,o++}r|=1<<o}return new Bi(this.startTime,this.interval,new ae(r,0),It.None)}_getSpecialColumnIndex(e,t){for(let r=0;r<e.totalColumns;++r)if(this._isColumnAtIndexSpecial(e,r)){if(t===0)return r;t--}throw new Error("Special key index is too high.")}_isColumnAtIndexSpecial(e,t){for(const r of e.stages){if(t>=r.columns){t-=r.columns;continue}return r.isSpecialColumn(t)}throw new Error("Column index is too high.")}}class wd extends b0{_createConvertibleReplayFrame(){return new to}_isConvertedReplayFrame(e){return e instanceof to}}class Pu extends S0{get id(){return 3}applyToBeatmap(e){return super.applyToBeatmap(e)}applyToBeatmapWithMods(e,t){return super.applyToBeatmapWithMods(e,t)}resetMods(e){return super.resetMods(e)}createModCombination(e){return new Li(e)}_createBeatmapProcessor(){return new bd}_createBeatmapConverter(){return new ir}_createReplayConverter(){return new wd}createDifficultyCalculator(e){return new Ii(e,this)}createPerformanceCalculator(e,t){return new yd(this,e,t)}}var Qi={exports:{}};const vd={},Ed=Object.freeze(Object.defineProperty({__proto__:null,default:vd},Symbol.toStringTag,{value:"Module"})),no=Lc(Ed);var ro;function Ad(){return ro||(ro=1,(function(n){(function(){var e="input is invalid type",t="finalize already called",r=typeof window=="object",i=r?window:{};i.JS_MD5_NO_WINDOW&&(r=!1);var s=!r&&typeof self=="object",o=!i.JS_MD5_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;o?i=Oc:s&&(i=self);var u=!i.JS_MD5_NO_COMMON_JS&&!0&&n.exports,l=!i.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),h=[128,32768,8388608,-2147483648],d=[0,8,16,24],m=["hex","array","digest","buffer","arrayBuffer","base64"],D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),g=[],F;if(l){var T=new ArrayBuffer(68);F=new Uint8Array(T),g=new Uint32Array(T)}var E=Array.isArray;(i.JS_MD5_NO_NODE_JS||!E)&&(E=function(_){return Object.prototype.toString.call(_)==="[object Array]"});var C=ArrayBuffer.isView;l&&(i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!C)&&(C=function(_){return typeof _=="object"&&_.buffer&&_.buffer.constructor===ArrayBuffer});var x=function(_){var A=typeof _;if(A==="string")return[_,!0];if(A!=="object"||_===null)throw new Error(e);if(l&&_.constructor===ArrayBuffer)return[new Uint8Array(_),!1];if(!E(_)&&!C(_))throw new Error(e);return[_,!1]},B=function(_){return function(A){return new K(!0).update(A)[_]()}},W=function(){var _=B("hex");o&&(_=j(_)),_.create=function(){return new K},_.update=function(S){return _.create().update(S)};for(var A=0;A<m.length;++A){var v=m[A];_[v]=B(v)}return _},j=function(_){var A=no,v=no.Buffer,S;v.from&&!i.JS_MD5_NO_BUFFER_FROM?S=v.from:S=function(I){return new v(I)};var O=function(I){if(typeof I=="string")return A.createHash("md5").update(I,"utf8").digest("hex");if(I==null)throw new Error(e);return I.constructor===ArrayBuffer&&(I=new Uint8Array(I)),E(I)||C(I)||I.constructor===v?A.createHash("md5").update(S(I)).digest("hex"):_(I)};return O},q=function(_){return function(A,v){return new re(A,!0).update(v)[_]()}},J=function(){var _=q("hex");_.create=function(S){return new re(S)},_.update=function(S,O){return _.create(S).update(O)};for(var A=0;A<m.length;++A){var v=m[A];_[v]=q(v)}return _};function K(_){if(_)g[0]=g[16]=g[1]=g[2]=g[3]=g[4]=g[5]=g[6]=g[7]=g[8]=g[9]=g[10]=g[11]=g[12]=g[13]=g[14]=g[15]=0,this.blocks=g,this.buffer8=F;else if(l){var A=new ArrayBuffer(68);this.buffer8=new Uint8Array(A),this.blocks=new Uint32Array(A)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}K.prototype.update=function(_){if(this.finalized)throw new Error(t);var A=x(_);_=A[0];for(var v=A[1],S,O=0,I,R=_.length,Y=this.blocks,fe=this.buffer8;O<R;){if(this.hashed&&(this.hashed=!1,Y[0]=Y[16],Y[16]=Y[1]=Y[2]=Y[3]=Y[4]=Y[5]=Y[6]=Y[7]=Y[8]=Y[9]=Y[10]=Y[11]=Y[12]=Y[13]=Y[14]=Y[15]=0),v)if(l)for(I=this.start;O<R&&I<64;++O)S=_.charCodeAt(O),S<128?fe[I++]=S:S<2048?(fe[I++]=192|S>>>6,fe[I++]=128|S&63):S<55296||S>=57344?(fe[I++]=224|S>>>12,fe[I++]=128|S>>>6&63,fe[I++]=128|S&63):(S=65536+((S&1023)<<10|_.charCodeAt(++O)&1023),fe[I++]=240|S>>>18,fe[I++]=128|S>>>12&63,fe[I++]=128|S>>>6&63,fe[I++]=128|S&63);else for(I=this.start;O<R&&I<64;++O)S=_.charCodeAt(O),S<128?Y[I>>>2]|=S<<d[I++&3]:S<2048?(Y[I>>>2]|=(192|S>>>6)<<d[I++&3],Y[I>>>2]|=(128|S&63)<<d[I++&3]):S<55296||S>=57344?(Y[I>>>2]|=(224|S>>>12)<<d[I++&3],Y[I>>>2]|=(128|S>>>6&63)<<d[I++&3],Y[I>>>2]|=(128|S&63)<<d[I++&3]):(S=65536+((S&1023)<<10|_.charCodeAt(++O)&1023),Y[I>>>2]|=(240|S>>>18)<<d[I++&3],Y[I>>>2]|=(128|S>>>12&63)<<d[I++&3],Y[I>>>2]|=(128|S>>>6&63)<<d[I++&3],Y[I>>>2]|=(128|S&63)<<d[I++&3]);else if(l)for(I=this.start;O<R&&I<64;++O)fe[I++]=_[O];else for(I=this.start;O<R&&I<64;++O)Y[I>>>2]|=_[O]<<d[I++&3];this.lastByteIndex=I,this.bytes+=I-this.start,I>=64?(this.start=I-64,this.hash(),this.hashed=!0):this.start=I}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},K.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var _=this.blocks,A=this.lastByteIndex;_[A>>>2]|=h[A&3],A>=56&&(this.hashed||this.hash(),_[0]=_[16],_[16]=_[1]=_[2]=_[3]=_[4]=_[5]=_[6]=_[7]=_[8]=_[9]=_[10]=_[11]=_[12]=_[13]=_[14]=_[15]=0),_[14]=this.bytes<<3,_[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},K.prototype.hash=function(){var _,A,v,S,O,I,R=this.blocks;this.first?(_=R[0]-680876937,_=(_<<7|_>>>25)-271733879<<0,S=(-1732584194^_&2004318071)+R[1]-117830708,S=(S<<12|S>>>20)+_<<0,v=(-271733879^S&(_^-271733879))+R[2]-1126478375,v=(v<<17|v>>>15)+S<<0,A=(_^v&(S^_))+R[3]-1316259209,A=(A<<22|A>>>10)+v<<0):(_=this.h0,A=this.h1,v=this.h2,S=this.h3,_+=(S^A&(v^S))+R[0]-680876936,_=(_<<7|_>>>25)+A<<0,S+=(v^_&(A^v))+R[1]-389564586,S=(S<<12|S>>>20)+_<<0,v+=(A^S&(_^A))+R[2]+606105819,v=(v<<17|v>>>15)+S<<0,A+=(_^v&(S^_))+R[3]-1044525330,A=(A<<22|A>>>10)+v<<0),_+=(S^A&(v^S))+R[4]-176418897,_=(_<<7|_>>>25)+A<<0,S+=(v^_&(A^v))+R[5]+1200080426,S=(S<<12|S>>>20)+_<<0,v+=(A^S&(_^A))+R[6]-1473231341,v=(v<<17|v>>>15)+S<<0,A+=(_^v&(S^_))+R[7]-45705983,A=(A<<22|A>>>10)+v<<0,_+=(S^A&(v^S))+R[8]+1770035416,_=(_<<7|_>>>25)+A<<0,S+=(v^_&(A^v))+R[9]-1958414417,S=(S<<12|S>>>20)+_<<0,v+=(A^S&(_^A))+R[10]-42063,v=(v<<17|v>>>15)+S<<0,A+=(_^v&(S^_))+R[11]-1990404162,A=(A<<22|A>>>10)+v<<0,_+=(S^A&(v^S))+R[12]+1804603682,_=(_<<7|_>>>25)+A<<0,S+=(v^_&(A^v))+R[13]-40341101,S=(S<<12|S>>>20)+_<<0,v+=(A^S&(_^A))+R[14]-1502002290,v=(v<<17|v>>>15)+S<<0,A+=(_^v&(S^_))+R[15]+1236535329,A=(A<<22|A>>>10)+v<<0,_+=(v^S&(A^v))+R[1]-165796510,_=(_<<5|_>>>27)+A<<0,S+=(A^v&(_^A))+R[6]-1069501632,S=(S<<9|S>>>23)+_<<0,v+=(_^A&(S^_))+R[11]+643717713,v=(v<<14|v>>>18)+S<<0,A+=(S^_&(v^S))+R[0]-373897302,A=(A<<20|A>>>12)+v<<0,_+=(v^S&(A^v))+R[5]-701558691,_=(_<<5|_>>>27)+A<<0,S+=(A^v&(_^A))+R[10]+38016083,S=(S<<9|S>>>23)+_<<0,v+=(_^A&(S^_))+R[15]-660478335,v=(v<<14|v>>>18)+S<<0,A+=(S^_&(v^S))+R[4]-405537848,A=(A<<20|A>>>12)+v<<0,_+=(v^S&(A^v))+R[9]+568446438,_=(_<<5|_>>>27)+A<<0,S+=(A^v&(_^A))+R[14]-1019803690,S=(S<<9|S>>>23)+_<<0,v+=(_^A&(S^_))+R[3]-187363961,v=(v<<14|v>>>18)+S<<0,A+=(S^_&(v^S))+R[8]+1163531501,A=(A<<20|A>>>12)+v<<0,_+=(v^S&(A^v))+R[13]-1444681467,_=(_<<5|_>>>27)+A<<0,S+=(A^v&(_^A))+R[2]-51403784,S=(S<<9|S>>>23)+_<<0,v+=(_^A&(S^_))+R[7]+1735328473,v=(v<<14|v>>>18)+S<<0,A+=(S^_&(v^S))+R[12]-1926607734,A=(A<<20|A>>>12)+v<<0,O=A^v,_+=(O^S)+R[5]-378558,_=(_<<4|_>>>28)+A<<0,S+=(O^_)+R[8]-2022574463,S=(S<<11|S>>>21)+_<<0,I=S^_,v+=(I^A)+R[11]+1839030562,v=(v<<16|v>>>16)+S<<0,A+=(I^v)+R[14]-35309556,A=(A<<23|A>>>9)+v<<0,O=A^v,_+=(O^S)+R[1]-1530992060,_=(_<<4|_>>>28)+A<<0,S+=(O^_)+R[4]+1272893353,S=(S<<11|S>>>21)+_<<0,I=S^_,v+=(I^A)+R[7]-155497632,v=(v<<16|v>>>16)+S<<0,A+=(I^v)+R[10]-1094730640,A=(A<<23|A>>>9)+v<<0,O=A^v,_+=(O^S)+R[13]+681279174,_=(_<<4|_>>>28)+A<<0,S+=(O^_)+R[0]-358537222,S=(S<<11|S>>>21)+_<<0,I=S^_,v+=(I^A)+R[3]-722521979,v=(v<<16|v>>>16)+S<<0,A+=(I^v)+R[6]+76029189,A=(A<<23|A>>>9)+v<<0,O=A^v,_+=(O^S)+R[9]-640364487,_=(_<<4|_>>>28)+A<<0,S+=(O^_)+R[12]-421815835,S=(S<<11|S>>>21)+_<<0,I=S^_,v+=(I^A)+R[15]+530742520,v=(v<<16|v>>>16)+S<<0,A+=(I^v)+R[2]-995338651,A=(A<<23|A>>>9)+v<<0,_+=(v^(A|~S))+R[0]-198630844,_=(_<<6|_>>>26)+A<<0,S+=(A^(_|~v))+R[7]+1126891415,S=(S<<10|S>>>22)+_<<0,v+=(_^(S|~A))+R[14]-1416354905,v=(v<<15|v>>>17)+S<<0,A+=(S^(v|~_))+R[5]-57434055,A=(A<<21|A>>>11)+v<<0,_+=(v^(A|~S))+R[12]+1700485571,_=(_<<6|_>>>26)+A<<0,S+=(A^(_|~v))+R[3]-1894986606,S=(S<<10|S>>>22)+_<<0,v+=(_^(S|~A))+R[10]-1051523,v=(v<<15|v>>>17)+S<<0,A+=(S^(v|~_))+R[1]-2054922799,A=(A<<21|A>>>11)+v<<0,_+=(v^(A|~S))+R[8]+1873313359,_=(_<<6|_>>>26)+A<<0,S+=(A^(_|~v))+R[15]-30611744,S=(S<<10|S>>>22)+_<<0,v+=(_^(S|~A))+R[6]-1560198380,v=(v<<15|v>>>17)+S<<0,A+=(S^(v|~_))+R[13]+1309151649,A=(A<<21|A>>>11)+v<<0,_+=(v^(A|~S))+R[4]-145523070,_=(_<<6|_>>>26)+A<<0,S+=(A^(_|~v))+R[11]-1120210379,S=(S<<10|S>>>22)+_<<0,v+=(_^(S|~A))+R[2]+718787259,v=(v<<15|v>>>17)+S<<0,A+=(S^(v|~_))+R[9]-343485551,A=(A<<21|A>>>11)+v<<0,this.first?(this.h0=_+1732584193<<0,this.h1=A-271733879<<0,this.h2=v-1732584194<<0,this.h3=S+271733878<<0,this.first=!1):(this.h0=this.h0+_<<0,this.h1=this.h1+A<<0,this.h2=this.h2+v<<0,this.h3=this.h3+S<<0)},K.prototype.hex=function(){this.finalize();var _=this.h0,A=this.h1,v=this.h2,S=this.h3;return c[_>>>4&15]+c[_&15]+c[_>>>12&15]+c[_>>>8&15]+c[_>>>20&15]+c[_>>>16&15]+c[_>>>28&15]+c[_>>>24&15]+c[A>>>4&15]+c[A&15]+c[A>>>12&15]+c[A>>>8&15]+c[A>>>20&15]+c[A>>>16&15]+c[A>>>28&15]+c[A>>>24&15]+c[v>>>4&15]+c[v&15]+c[v>>>12&15]+c[v>>>8&15]+c[v>>>20&15]+c[v>>>16&15]+c[v>>>28&15]+c[v>>>24&15]+c[S>>>4&15]+c[S&15]+c[S>>>12&15]+c[S>>>8&15]+c[S>>>20&15]+c[S>>>16&15]+c[S>>>28&15]+c[S>>>24&15]},K.prototype.toString=K.prototype.hex,K.prototype.digest=function(){this.finalize();var _=this.h0,A=this.h1,v=this.h2,S=this.h3;return[_&255,_>>>8&255,_>>>16&255,_>>>24&255,A&255,A>>>8&255,A>>>16&255,A>>>24&255,v&255,v>>>8&255,v>>>16&255,v>>>24&255,S&255,S>>>8&255,S>>>16&255,S>>>24&255]},K.prototype.array=K.prototype.digest,K.prototype.arrayBuffer=function(){this.finalize();var _=new ArrayBuffer(16),A=new Uint32Array(_);return A[0]=this.h0,A[1]=this.h1,A[2]=this.h2,A[3]=this.h3,_},K.prototype.buffer=K.prototype.arrayBuffer,K.prototype.base64=function(){for(var _,A,v,S="",O=this.array(),I=0;I<15;)_=O[I++],A=O[I++],v=O[I++],S+=D[_>>>2]+D[(_<<4|A>>>4)&63]+D[(A<<2|v>>>6)&63]+D[v&63];return _=O[I],S+=D[_>>>2]+D[_<<4&63]+"==",S};function re(_,A){var v,S=x(_);if(_=S[0],S[1]){var O=[],I=_.length,R=0,Y;for(v=0;v<I;++v)Y=_.charCodeAt(v),Y<128?O[R++]=Y:Y<2048?(O[R++]=192|Y>>>6,O[R++]=128|Y&63):Y<55296||Y>=57344?(O[R++]=224|Y>>>12,O[R++]=128|Y>>>6&63,O[R++]=128|Y&63):(Y=65536+((Y&1023)<<10|_.charCodeAt(++v)&1023),O[R++]=240|Y>>>18,O[R++]=128|Y>>>12&63,O[R++]=128|Y>>>6&63,O[R++]=128|Y&63);_=O}_.length>64&&(_=new K(!0).update(_).array());var fe=[],_e=[];for(v=0;v<64;++v){var Re=_[v]||0;fe[v]=92^Re,_e[v]=54^Re}K.call(this,A),this.update(_e),this.oKeyPad=fe,this.inner=!0,this.sharedMemory=A}re.prototype=new K,re.prototype.finalize=function(){if(K.prototype.finalize.call(this),this.inner){this.inner=!1;var _=this.array();K.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(_),K.prototype.finalize.call(this)}};var oe=W();oe.md5=oe,oe.md5.hmac=J(),u?n.exports=oe:i.md5=oe})()})(Qi)),Qi.exports}var Tu=Ad();const Fd=new Pu,io=new nd,Ni=Cs("beatmapStore",{state:()=>({items:[]}),actions:{async addBeatmap(n){const e=Tu.md5(n);if(await _i(e)||await Xo(e,n),!this.items.find(t=>t.md5===e)){const t=io.decodeFromString(n,{parseHitObjects:!1,parseStoryboard:!1});this.items.push({md5:e,title:t.metadata.titleUnicode,version:t.metadata.version,uploadedAt:new Date().toISOString()})}},async readBeatmap(n){const e=await _i(n);if(!e)throw new Error(`Beatmap with MD5 ${n} not found in storage.`);const t=io.decodeFromString(e,{parseStoryboard:!1});return Fd.applyToBeatmap(t)},async removeBeatmap(n){await Ko(n),this.items.splice(this.items.findIndex(e=>e.md5===n),1)},async clearAll(){for(const n of this.items)await this.removeBeatmap(n.md5);this.items=[]}},persist:!0}),Pd=new Pu,so=new rd;class Td{name="ScoreV2";acronym="V2";bitwise=N.ScoreV2;type=Xe.System;multiplier=1;isRanked=!1;incompatibles=N.None;isUserPlayable=!0}class Cd extends Li{get _availableMods(){return[...super._availableMods,new Td]}}const qs=Cs("replayStore",{state:()=>({items:[]}),actions:{async addReplay(n){const e=Tu.md5(n);if(await _i(e)||await Xo(e,n),!this.items.find(t=>t.replayMD5===e)){const t=await so.decodeFromBuffer(n,!1),r=new Cd(t.info.rawMods);this.items.push({replayMD5:e,beatmapMD5:t.info.beatmapHashMD5,player:t.info.username,score:t.info.totalScore,accuracy:t.info.accuracy,mods:r.acronyms,playedAt:t.info.date.toISOString(),uploadedAt:new Date().toISOString()})}},async readReplay(n,e){const t=await _i(n);if(!t)throw new Error(`Replay with MD5 ${n} not found in storage.`);const r=await so.decodeFromBuffer(t,!0),i=Pd.applyToReplay(r.replay,e);return{info:r.info,replay:i}},async removeReplay(n){await Ko(n),this.items.splice(this.items.findIndex(e=>e.replayMD5===n),1)},async clearAll(){for(const n of this.items)await this.removeReplay(n.replayMD5);this.items=[]}},persist:!0}),Js=Cs("stateStore",{state:()=>({selectedBeatmapMD5:null,selectedReplayMD5:null})}),Md=Dt({__name:"Upload",setup(n){const e=Ni(),t=qs();async function r(i){if(i.file.name.endsWith(".osu")){const s=await i.file.text();s&&await e.addBeatmap(s)}else if(i.file.name.endsWith(".osr")){const s=await i.file.arrayBuffer();s&&await t.addReplay(s)}}return(i,s)=>{const o=Nc,u=Ic;return ot(),en(u,{drag:"",multiple:"",accept:".osu,.osr","show-file-list":!1,"http-request":r},{default:Be(()=>[ge(o,{class:"el-icon--upload"},{default:Be(()=>[ge(vt(Gc))]),_:1}),s[0]||(s[0]=Kt("div",{class:"el-upload__text"},[fn(" Drop "),Kt("strong",null,".osu"),fn(" or "),Kt("strong",null,".osr"),fn(" files here or "),Kt("em",null,"click to upload")],-1))]),_:1})}}}),xd={class:"card-header"},Bd={class:"tree-label"},kd={class:"card-footer"},Rd=Dt({__name:"FileList",setup(n){const e=Ni(),t=qs(),r=Js(),i=Fi(()=>{const l=new Map;e.items.forEach(h=>{l.set(h.md5,{key:h.md5,label:`${h.title} [${h.version}]`,type:"beatmap",children:[]})});const c=[];return t.items.forEach(h=>{const d=h.mods&&h.mods.length>0?h.mods.join(""):"No Mod",m={key:h.replayMD5,label:`${h.player} [${d}] - ${h.playedAt}`,type:"replay"},D=l.get(h.beatmapMD5);D?(m.parent=D,D.children.push(m)):(m.label+=" (No Beatmap)",c.push(m))}),[...Array.from(l.values()),...c]});function s(l,c){l.type==="beatmap"?(r.selectedBeatmapMD5=l.key,r.selectedReplayMD5=null):l.type==="replay"&&(r.selectedBeatmapMD5=l.parent?.key||null,r.selectedReplayMD5=l.key)}function o(l,c){c.type==="beatmap"?(r.selectedBeatmapMD5===c.key&&(r.selectedBeatmapMD5=null,r.selectedReplayMD5=null),e.removeBeatmap(c.key)):c.type==="replay"&&(r.selectedReplayMD5===c.key&&(r.selectedReplayMD5=null),t.removeReplay(c.key))}function u(){r.selectedBeatmapMD5=null,r.selectedReplayMD5=null,e.clearAll(),t.clearAll()}return(l,c)=>{const h=Vc,d=Wc,m=Hc;return ot(),en(m,{"body-style":"padding: 0;"},{header:Be(()=>[Kt("div",xd,[c[1]||(c[1]=Kt("span",null,"Files",-1)),ge(h,{style:{float:"right"},type:"danger",link:"",onClick:u},{default:Be(()=>[...c[0]||(c[0]=[fn(" Clear All ",-1)])]),_:1})])]),footer:Be(()=>[Kt("div",kd," Total Beatmaps: "+qi(vt(e).items.length)+", Total Replays: "+qi(vt(t).items.length),1)]),default:Be(()=>[ge(d,{data:i.value,accordion:"","node-key":"key","highlight-current":"",onNodeClick:s},{default:Be(({node:D,data:g})=>[Kt("span",null,[ge(h,{style:{"margin-left":"4px"},type:"danger",link:"",onClick:F=>o(D,g)},{default:Be(()=>[...c[2]||(c[2]=[fn(" X ",-1)])]),_:1},8,["onClick"])]),Kt("span",Bd,qi(g.label),1)]),_:1},8,["data"])]),_:1})}}}),Ld=Dt({__name:"Sidebar",setup(n){return(e,t)=>(ot(),Rn(Pi,null,[ge(eh),ge(Md),ge(Rd)],64))}}),Od=Dt({__name:"App",setup(n){return(e,t)=>{const r=zc,i=Wo("RouterView"),s=jc,o=xs;return ot(),en(o,null,{default:Be(()=>[ge(r,{width:"500px"},{default:Be(()=>[ge(vt(Ld))]),_:1}),ge(s,null,{default:Be(()=>[ge(i)]),_:1})]),_:1})}}}),Gi=(n,e)=>{const t=n.__vccOpts||n;for(const[r,i]of e)t[r]=i;return t},Id=Gi(Od,[["__scopeId","data-v-f6179cf2"]]);function Nd(n,e){if(n==null)return;let t=n;for(let r=0;r<e.length;r++){if(t===void 0||t[e[r]]===void 0)return;if(t===null||t[e[r]]===null)return null;t=t[e[r]]}return t}function Qs(n,e,t){if(t.length===0)return e;const r=t[0];return t.length>1&&(e=Qs(typeof n!="object"||n===null||!Object.prototype.hasOwnProperty.call(n,r)?Number.isInteger(Number(t[1]))?[]:{}:n[r],e,Array.prototype.slice.call(t,1))),Number.isInteger(Number(r))&&Array.isArray(n)?n.slice()[r]:Object.assign({},n,{[r]:e})}function Cu(n,e){if(n==null||e.length===0)return n;if(e.length===1){if(n==null)return n;if(Number.isInteger(e[0])&&Array.isArray(n))return Array.prototype.slice.call(n,0).splice(e[0],1);const t={};for(const r in n)t[r]=n[r];return delete t[e[0]],t}if(n[e[0]]==null){if(Number.isInteger(e[0])&&Array.isArray(n))return Array.prototype.concat.call([],n);const t={};for(const r in n)t[r]=n[r];return t}return Qs(n,Cu(n[e[0]],Array.prototype.slice.call(e,1)),[e[0]])}function Mu(n,e){return e.map(t=>t.split(".")).map(t=>[t,Nd(n,t)]).filter(t=>t[1]!==void 0).reduce((t,r)=>Qs(t,r[1],r[0]),{})}function xu(n,e){return e.map(t=>t.split(".")).reduce((t,r)=>Cu(t,r),n)}function ao(n,{storage:e,serializer:t,key:r,debug:i,pick:s,omit:o,beforeHydrate:u,afterHydrate:l},c,h=!0){try{h&&u?.(c);const d=e.getItem(r);if(d){const m=t.deserialize(d),D=s?Mu(m,s):m,g=o?xu(D,o):D;n.$patch(g)}h&&l?.(c)}catch(d){i&&console.error("[pinia-plugin-persistedstate]",d)}}function oo(n,{storage:e,serializer:t,key:r,debug:i,pick:s,omit:o}){try{const u=s?Mu(n,s):n,l=o?xu(u,o):u,c=t.serialize(l);e.setItem(r,c)}catch(u){i&&console.error("[pinia-plugin-persistedstate]",u)}}function Gd(n,e){return typeof n=="function"?n(e):typeof n=="string"?n:e}function Hd(n,e,t){const{pinia:r,store:i,options:{persist:s=t}}=n;if(!s)return;if(!(i.$id in r.state.value)){const u=r._s.get(i.$id.replace("__hot:",""));u&&Promise.resolve().then(()=>u.$persist());return}const o=(Array.isArray(s)?s:s===!0?[{}]:[s]).map(e);i.$hydrate=({runHooks:u=!0}={})=>{o.forEach(l=>{ao(i,l,n,u)})},i.$persist=()=>{o.forEach(u=>{oo(i.$state,u)})},o.forEach(u=>{ao(i,u,n),i.$subscribe((l,c)=>oo(c,u),{detached:!0})})}function Wd(n={}){return function(e){Hd(e,t=>{const r=Gd(t.key,e.store.$id);return{key:(n.key?n.key:i=>i)(r),debug:t.debug??n.debug??!1,serializer:t.serializer??n.serializer??{serialize:i=>JSON.stringify(i),deserialize:i=>JSON.parse(i)},storage:t.storage??n.storage??window.localStorage,beforeHydrate:t.beforeHydrate??n.beforeHydrate,afterHydrate:t.afterHydrate??n.afterHydrate,pick:t.pick,omit:t.omit}},n.auto??!1)}}var Vd=Wd();const zd=Math.PI/180;function jd(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}const Bn=typeof global<"u"?global:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},X={_global:Bn,version:"10.0.12",isBrowser:jd(),isUnminified:/param/.test((function(n){}).toString()),dblClickWindow:400,getAngle(n){return X.angleDeg?n*zd:n},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return X.DD.isDragging},isTransforming(){var n,e;return(e=(n=X.Transformer)===null||n===void 0?void 0:n.isTransforming())!==null&&e!==void 0?e:!1},isDragReady(){return!!X.DD.node},releaseCanvasOnDestroy:!0,document:Bn.document,_injectGlobal(n){typeof Bn.Konva<"u"&&console.error("Several Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),Bn.Konva=n}},We=n=>{X[n.prototype.getClassName()]=n};X._injectGlobal(X);const Ud=`Konva.js unsupported environment.

Looks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.

To use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.

bash: npm install canvas
js: import "konva/canvas-backend";

or

bash: npm install skia-canvas
js: import "konva/skia-backend";
`,uo=()=>{if(typeof document>"u")throw new Error(Ud)};class gt{constructor(e=[1,0,0,1,0,0]){this.dirty=!1,this.m=e&&e.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new gt(this.m)}copyInto(e){e.m[0]=this.m[0],e.m[1]=this.m[1],e.m[2]=this.m[2],e.m[3]=this.m[3],e.m[4]=this.m[4],e.m[5]=this.m[5]}point(e){const t=this.m;return{x:t[0]*e.x+t[2]*e.y+t[4],y:t[1]*e.x+t[3]*e.y+t[5]}}translate(e,t){return this.m[4]+=this.m[0]*e+this.m[2]*t,this.m[5]+=this.m[1]*e+this.m[3]*t,this}scale(e,t){return this.m[0]*=e,this.m[1]*=e,this.m[2]*=t,this.m[3]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.m[0]*t+this.m[2]*r,s=this.m[1]*t+this.m[3]*r,o=this.m[0]*-r+this.m[2]*t,u=this.m[1]*-r+this.m[3]*t;return this.m[0]=i,this.m[1]=s,this.m[2]=o,this.m[3]=u,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(e,t){const r=this.m[0]+this.m[2]*t,i=this.m[1]+this.m[3]*t,s=this.m[2]+this.m[0]*e,o=this.m[3]+this.m[1]*e;return this.m[0]=r,this.m[1]=i,this.m[2]=s,this.m[3]=o,this}multiply(e){const t=this.m[0]*e.m[0]+this.m[2]*e.m[1],r=this.m[1]*e.m[0]+this.m[3]*e.m[1],i=this.m[0]*e.m[2]+this.m[2]*e.m[3],s=this.m[1]*e.m[2]+this.m[3]*e.m[3],o=this.m[0]*e.m[4]+this.m[2]*e.m[5]+this.m[4],u=this.m[1]*e.m[4]+this.m[3]*e.m[5]+this.m[5];return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=u,this}invert(){const e=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),t=this.m[3]*e,r=-this.m[1]*e,i=-this.m[2]*e,s=this.m[0]*e,o=e*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),u=e*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=t,this.m[1]=r,this.m[2]=i,this.m[3]=s,this.m[4]=o,this.m[5]=u,this}getMatrix(){return this.m}decompose(){const e=this.m[0],t=this.m[1],r=this.m[2],i=this.m[3],s=this.m[4],o=this.m[5],u=e*i-t*r,l={x:s,y:o,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||t!=0){const c=Math.sqrt(e*e+t*t);l.rotation=t>0?Math.acos(e/c):-Math.acos(e/c),l.scaleX=c,l.scaleY=u/c,l.skewX=(e*r+t*i)/u,l.skewY=0}else if(r!=0||i!=0){const c=Math.sqrt(r*r+i*i);l.rotation=Math.PI/2-(i>0?Math.acos(-r/c):-Math.acos(r/c)),l.scaleX=u/c,l.scaleY=c,l.skewX=0,l.skewY=(e*r+t*i)/u}return l.rotation=M._getRotation(l.rotation),l}}const Xd="[object Array]",Kd="[object Number]",Yd="[object String]",qd="[object Boolean]",Jd=Math.PI/180,Qd=180/Math.PI,pr="#",Zd="",$d="0",ef="Konva warning: ",lo="Konva error: ",tf="rgb(",Zi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},nf=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let ni=[],gr=null;const rf=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(n){setTimeout(n,60)},M={_isElement(n){return!!(n&&n.nodeType==1)},_isFunction(n){return!!(n&&n.constructor&&n.call&&n.apply)},_isPlainObject(n){return!!n&&n.constructor===Object},_isArray(n){return Object.prototype.toString.call(n)===Xd},_isNumber(n){return Object.prototype.toString.call(n)===Kd&&!isNaN(n)&&isFinite(n)},_isString(n){return Object.prototype.toString.call(n)===Yd},_isBoolean(n){return Object.prototype.toString.call(n)===qd},isObject(n){return n instanceof Object},isValidSelector(n){if(typeof n!="string")return!1;const e=n[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(n){return n===0||n>0?1:-1},requestAnimFrame(n){ni.push(n),ni.length===1&&rf(function(){const e=ni;ni=[],e.forEach(function(t){t()})})},createCanvasElement(){uo();const n=document.createElement("canvas");try{n.style=n.style||{}}catch{}return n},createImageElement(){return uo(),document.createElement("img")},_isInDocument(n){for(;n=n.parentNode;)if(n==document)return!0;return!1},_urlToImage(n,e){const t=M.createImageElement();t.onload=function(){e(t)},t.src=n},_rgbToHex(n,e,t){return((1<<24)+(n<<16)+(e<<8)+t).toString(16).slice(1)},_hexToRgb(n){n=n.replace(pr,Zd);const e=parseInt(n,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){let n=(Math.random()*16777215<<0).toString(16);for(;n.length<6;)n=$d+n;return pr+n},isCanvasFarblingActive(){if(gr!==null)return gr;if(typeof document>"u")return gr=!1,!1;const n=this.createCanvasElement();n.width=10,n.height=10;const e=n.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,10,10),e.fillStyle="#282828",e.fillRect(0,0,10,10);const t=e.getImageData(0,0,10,10).data;let r=!1;for(let i=0;i<100;i++)if(t[i*4]!==40||t[i*4+1]!==40||t[i*4+2]!==40||t[i*4+3]!==255){r=!0;break}return gr=r,this.releaseCanvas(n),gr},getHitColor(){const n=this.getRandomColor();return this.isCanvasFarblingActive()?this.getSnappedHexColor(n):n},getHitColorKey(n,e,t){return this.isCanvasFarblingActive()&&(n=Math.round(n/5)*5,e=Math.round(e/5)*5,t=Math.round(t/5)*5),pr+this._rgbToHex(n,e,t)},getSnappedHexColor(n){const e=this._hexToRgb(n);return pr+this._rgbToHex(Math.round(e.r/5)*5,Math.round(e.g/5)*5,Math.round(e.b/5)*5)},getRGB(n){let e;return n in Zi?(e=Zi[n],{r:e[0],g:e[1],b:e[2]}):n[0]===pr?this._hexToRgb(n.substring(1)):n.substr(0,4)===tf?(e=nf.exec(n.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA(n){return n=n||"black",M._namedColorToRBA(n)||M._hex3ColorToRGBA(n)||M._hex4ColorToRGBA(n)||M._hex6ColorToRGBA(n)||M._hex8ColorToRGBA(n)||M._rgbColorToRGBA(n)||M._rgbaColorToRGBA(n)||M._hslColorToRGBA(n)},_namedColorToRBA(n){const e=Zi[n.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(n){if(n.indexOf("rgb(")===0){n=n.match(/rgb\(([^)]+)\)/)[1];const e=n.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(n){if(n.indexOf("rgba(")===0){n=n.match(/rgba\(([^)]+)\)/)[1];const e=n.split(/ *, */).map((t,r)=>t.slice(-1)==="%"?r===3?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(n){if(n[0]==="#"&&n.length===9)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:parseInt(n.slice(7,9),16)/255}},_hex6ColorToRGBA(n){if(n[0]==="#"&&n.length===7)return{r:parseInt(n.slice(1,3),16),g:parseInt(n.slice(3,5),16),b:parseInt(n.slice(5,7),16),a:1}},_hex4ColorToRGBA(n){if(n[0]==="#"&&n.length===5)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:parseInt(n[4]+n[4],16)/255}},_hex3ColorToRGBA(n){if(n[0]==="#"&&n.length===4)return{r:parseInt(n[1]+n[1],16),g:parseInt(n[2]+n[2],16),b:parseInt(n[3]+n[3],16),a:1}},_hslColorToRGBA(n){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(n)){const[e,...t]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(n),r=Number(t[0])/360,i=Number(t[1])/100,s=Number(t[2])/100;let o,u,l;if(i===0)return l=s*255,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};s<.5?o=s*(1+i):o=s+i-s*i;const c=2*s-o,h=[0,0,0];for(let d=0;d<3;d++)u=r+1/3*-(d-1),u<0&&u++,u>1&&u--,6*u<1?l=c+(o-c)*6*u:2*u<1?l=o:3*u<2?l=c+(o-c)*(2/3-u)*6:l=c,h[d]=l*255;return{r:Math.round(h[0]),g:Math.round(h[1]),b:Math.round(h[2]),a:1}}},haveIntersection(n,e){return!(e.x>n.x+n.width||e.x+e.width<n.x||e.y>n.y+n.height||e.y+e.height<n.y)},cloneObject(n){const e={};for(const t in n)this._isPlainObject(n[t])?e[t]=this.cloneObject(n[t]):this._isArray(n[t])?e[t]=this.cloneArray(n[t]):e[t]=n[t];return e},cloneArray(n){return n.slice(0)},degToRad(n){return n*Jd},radToDeg(n){return n*Qd},_degToRad(n){return M.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),M.degToRad(n)},_radToDeg(n){return M.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),M.radToDeg(n)},_getRotation(n){return X.angleDeg?M.radToDeg(n):n},_capitalize(n){return n.charAt(0).toUpperCase()+n.slice(1)},throw(n){throw new Error(lo+n)},error(n){console.error(lo+n)},warn(n){X.showWarnings&&console.warn(ef+n)},each(n,e){for(const t in n)e(t,n[t])},_inRange(n,e,t){return e<=n&&n<t},_getProjectionToSegment(n,e,t,r,i,s){let o,u,l;const c=(n-t)*(n-t)+(e-r)*(e-r);if(c==0)o=n,u=e,l=(i-t)*(i-t)+(s-r)*(s-r);else{const h=((i-n)*(t-n)+(s-e)*(r-e))/c;h<0?(o=n,u=e,l=(n-i)*(n-i)+(e-s)*(e-s)):h>1?(o=t,u=r,l=(t-i)*(t-i)+(r-s)*(r-s)):(o=n+h*(t-n),u=e+h*(r-e),l=(o-i)*(o-i)+(u-s)*(u-s))}return[o,u,l]},_getProjectionToLine(n,e,t){const r=M.cloneObject(n);let i=Number.MAX_VALUE;return e.forEach(function(s,o){if(!t&&o===e.length-1)return;const u=e[(o+1)%e.length],l=M._getProjectionToSegment(s.x,s.y,u.x,u.y,n.x,n.y),c=l[0],h=l[1],d=l[2];d<i&&(r.x=c,r.y=h,i=d)}),r},_prepareArrayForTween(n,e,t){const r=[],i=[];if(n.length>e.length){const o=e;e=n,n=o}for(let o=0;o<n.length;o+=2)r.push({x:n[o],y:n[o+1]});for(let o=0;o<e.length;o+=2)i.push({x:e[o],y:e[o+1]});const s=[];return i.forEach(function(o){const u=M._getProjectionToLine(o,r,t);s.push(u.x),s.push(u.y)}),s},_prepareToStringify(n){let e;n.visitedByCircularReferenceRemoval=!0;for(const t in n)if(n.hasOwnProperty(t)&&n[t]&&typeof n[t]=="object"){if(e=Object.getOwnPropertyDescriptor(n,t),n[t].visitedByCircularReferenceRemoval||M._isElement(n[t]))if(e.configurable)delete n[t];else return null;else if(M._prepareToStringify(n[t])===null)if(e.configurable)delete n[t];else return null}return delete n.visitedByCircularReferenceRemoval,n},_assign(n,e){for(const t in e)n[t]=e[t];return n},_getFirstPointerId(n){return n.touches?n.changedTouches[0].identifier:n.pointerId||999},releaseCanvas(...n){X.releaseCanvasOnDestroy&&n.forEach(e=>{e.width=0,e.height=0})},drawRoundedRectPath(n,e,t,r){let i=e<0?e:0,s=t<0?t:0;e=Math.abs(e),t=Math.abs(t);let o=0,u=0,l=0,c=0;typeof r=="number"?o=u=l=c=Math.min(r,e/2,t/2):(o=Math.min(r[0]||0,e/2,t/2),u=Math.min(r[1]||0,e/2,t/2),c=Math.min(r[2]||0,e/2,t/2),l=Math.min(r[3]||0,e/2,t/2)),n.moveTo(i+o,s),n.lineTo(i+e-u,s),n.arc(i+e-u,s+u,u,Math.PI*3/2,0,!1),n.lineTo(i+e,s+t-c),n.arc(i+e-c,s+t-c,c,0,Math.PI/2,!1),n.lineTo(i+l,s+t),n.arc(i+l,s+t-l,l,Math.PI/2,Math.PI,!1),n.lineTo(i,s+o),n.arc(i+o,s+o,o,Math.PI,Math.PI*3/2,!1)},drawRoundedPolygonPath(n,e,t,r,i){r=Math.abs(r);for(let s=0;s<t;s++){const o=e[(s-1+t)%t],u=e[s],l=e[(s+1)%t],c={x:u.x-o.x,y:u.y-o.y},h={x:l.x-u.x,y:l.y-u.y},d=Math.hypot(c.x,c.y),m=Math.hypot(h.x,h.y);let D;typeof i=="number"?D=i:D=s<i.length?i[s]:0,D=r*Math.cos(Math.PI/t)*Math.min(1,D/r*2);const F={x:c.x/d,y:c.y/d},T={x:h.x/m,y:h.y/m},E={x:u.x-F.x*D,y:u.y-F.y*D},C={x:u.x+T.x*D,y:u.y+T.y*D};s===0?n.moveTo(E.x,E.y):n.lineTo(E.x,E.y),n.arcTo(u.x,u.y,C.x,C.y,D)}}};function sf(n){const e=[],t=n.length,r=M;for(let i=0;i<t;i++){let s=n[i];r._isNumber(s)?s=Math.round(s*1e3)/1e3:r._isString(s)||(s=s+""),e.push(s)}return e}const co=",",af="(",of=")",uf="([",lf="])",cf=";",hf="()",df="=",ho=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],ff=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"],mf=100;let ri=null;function fo(){if(ri!==null)return ri;try{const e=M.createCanvasElement().getContext("2d");return e?!!e&&"filter"in e:(ri=!1,!1)}catch{return ri=!1,!1}}class Hi{constructor(e){this.canvas=e,X.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(e){e.fillEnabled()&&this._fill(e)}_fill(e){}strokeShape(e){e.hasStroke()&&this._stroke(e)}_stroke(e){}fillStrokeShape(e){e.attrs.fillAfterStrokeEnabled?(this.strokeShape(e),this.fillShape(e)):(this.fillShape(e),this.strokeShape(e))}getTrace(e,t){let r=this.traceArr,i=r.length,s="",o,u,l,c;for(o=0;o<i;o++)u=r[o],l=u.method,l?(c=u.args,s+=l,e?s+=hf:M._isArray(c[0])?s+=uf+c.join(co)+lf:(t&&(c=c.map(h=>typeof h=="number"?Math.floor(h):h)),s+=af+c.join(co)+of)):(s+=u.property,e||(s+=df+u.val)),s+=cf;return s}clearTrace(){this.traceArr=[]}_trace(e){let t=this.traceArr,r;t.push(e),r=t.length,r>=mf&&t.shift()}reset(){const e=this.getCanvas().getPixelRatio();this.setTransform(1*e,0,0,1*e,0,0)}getCanvas(){return this.canvas}clear(e){const t=this.getCanvas();e?this.clearRect(e.x||0,e.y||0,e.width||0,e.height||0):this.clearRect(0,0,t.getWidth()/t.pixelRatio,t.getHeight()/t.pixelRatio)}_applyLineCap(e){const t=e.attrs.lineCap;t&&this.setAttr("lineCap",t)}_applyOpacity(e){const t=e.getAbsoluteOpacity();t!==1&&this.setAttr("globalAlpha",t)}_applyLineJoin(e){const t=e.attrs.lineJoin;t&&this.setAttr("lineJoin",t)}_applyMiterLimit(e){const t=e.attrs.miterLimit;t!=null&&this.setAttr("miterLimit",t)}setAttr(e,t){this._context[e]=t}arc(e,t,r,i,s,o){this._context.arc(e,t,r,i,s,o)}arcTo(e,t,r,i,s){this._context.arcTo(e,t,r,i,s)}beginPath(){this._context.beginPath()}bezierCurveTo(e,t,r,i,s,o){this._context.bezierCurveTo(e,t,r,i,s,o)}clearRect(e,t,r,i){this._context.clearRect(e,t,r,i)}clip(...e){this._context.clip.apply(this._context,e)}closePath(){this._context.closePath()}createImageData(e,t){const r=arguments;if(r.length===2)return this._context.createImageData(e,t);if(r.length===1)return this._context.createImageData(e)}createLinearGradient(e,t,r,i){return this._context.createLinearGradient(e,t,r,i)}createPattern(e,t){return this._context.createPattern(e,t)}createRadialGradient(e,t,r,i,s,o){return this._context.createRadialGradient(e,t,r,i,s,o)}drawImage(e,t,r,i,s,o,u,l,c){const h=arguments,d=this._context;h.length===3?d.drawImage(e,t,r):h.length===5?d.drawImage(e,t,r,i,s):h.length===9&&d.drawImage(e,t,r,i,s,o,u,l,c)}ellipse(e,t,r,i,s,o,u,l){this._context.ellipse(e,t,r,i,s,o,u,l)}isPointInPath(e,t,r,i){return r?this._context.isPointInPath(r,e,t,i):this._context.isPointInPath(e,t,i)}fill(...e){this._context.fill.apply(this._context,e)}fillRect(e,t,r,i){this._context.fillRect(e,t,r,i)}strokeRect(e,t,r,i){this._context.strokeRect(e,t,r,i)}fillText(e,t,r,i){i?this._context.fillText(e,t,r,i):this._context.fillText(e,t,r)}measureText(e){return this._context.measureText(e)}getImageData(e,t,r,i){return this._context.getImageData(e,t,r,i)}lineTo(e,t){this._context.lineTo(e,t)}moveTo(e,t){this._context.moveTo(e,t)}rect(e,t,r,i){this._context.rect(e,t,r,i)}roundRect(e,t,r,i,s){this._context.roundRect(e,t,r,i,s)}putImageData(e,t,r){this._context.putImageData(e,t,r)}quadraticCurveTo(e,t,r,i){this._context.quadraticCurveTo(e,t,r,i)}restore(){this._context.restore()}rotate(e){this._context.rotate(e)}save(){this._context.save()}scale(e,t){this._context.scale(e,t)}setLineDash(e){this._context.setLineDash?this._context.setLineDash(e):"mozDash"in this._context?this._context.mozDash=e:"webkitLineDash"in this._context&&(this._context.webkitLineDash=e)}getLineDash(){return this._context.getLineDash()}setTransform(e,t,r,i,s,o){this._context.setTransform(e,t,r,i,s,o)}stroke(e){e?this._context.stroke(e):this._context.stroke()}strokeText(e,t,r,i){this._context.strokeText(e,t,r,i)}transform(e,t,r,i,s,o){this._context.transform(e,t,r,i,s,o)}translate(e,t){this._context.translate(e,t)}_enableTrace(){let e=this,t=ho.length,r=this.setAttr,i,s;const o=function(u){let l=e[u],c;e[u]=function(){return s=sf(Array.prototype.slice.call(arguments,0)),c=l.apply(e,arguments),e._trace({method:u,args:s}),c}};for(i=0;i<t;i++)o(ho[i]);e.setAttr=function(){r.apply(e,arguments);const u=arguments[0];let l=arguments[1];(u==="shadowOffsetX"||u==="shadowOffsetY"||u==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),e._trace({property:u,val:l})}}_applyGlobalCompositeOperation(e){const t=e.attrs.globalCompositeOperation;!t||t==="source-over"||this.setAttr("globalCompositeOperation",t)}}ff.forEach(function(n){Object.defineProperty(Hi.prototype,n,{get(){return this._context[n]},set(e){this._context[n]=e}})});class pf extends Hi{constructor(e,{willReadFrequently:t=!1}={}){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:t})}_fillColor(e){const t=e.fill();this.setAttr("fillStyle",t),e._fillFunc(this)}_fillPattern(e){this.setAttr("fillStyle",e._getFillPattern()),e._fillFunc(this)}_fillLinearGradient(e){const t=e._getLinearGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fillRadialGradient(e){const t=e._getRadialGradient();t&&(this.setAttr("fillStyle",t),e._fillFunc(this))}_fill(e){const t=e.fill(),r=e.getFillPriority();if(t&&r==="color"){this._fillColor(e);return}const i=e.getFillPatternImage();if(i&&r==="pattern"){this._fillPattern(e);return}const s=e.getFillLinearGradientColorStops();if(s&&r==="linear-gradient"){this._fillLinearGradient(e);return}const o=e.getFillRadialGradientColorStops();if(o&&r==="radial-gradient"){this._fillRadialGradient(e);return}t?this._fillColor(e):i?this._fillPattern(e):s?this._fillLinearGradient(e):o&&this._fillRadialGradient(e)}_strokeLinearGradient(e){const t=e.getStrokeLinearGradientStartPoint(),r=e.getStrokeLinearGradientEndPoint(),i=e.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(t.x,t.y,r.x,r.y);if(i){for(let o=0;o<i.length;o+=2)s.addColorStop(i[o],i[o+1]);this.setAttr("strokeStyle",s)}}_stroke(e){const t=e.dash(),r=e.getStrokeScaleEnabled();if(e.hasStroke()){if(!r){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e),t&&e.dashEnabled()&&(this.setLineDash(t),this.setAttr("lineDashOffset",e.dashOffset())),this.setAttr("lineWidth",e.strokeWidth()),e.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),e.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(e):this.setAttr("strokeStyle",e.stroke()),e._strokeFunc(this),r||this.restore()}}_applyShadow(e){var t,r,i;const s=(t=e.getShadowRGBA())!==null&&t!==void 0?t:"black",o=(r=e.getShadowBlur())!==null&&r!==void 0?r:5,u=(i=e.getShadowOffset())!==null&&i!==void 0?i:{x:0,y:0},l=e.getAbsoluteScale(),c=this.canvas.getPixelRatio(),h=l.x*c,d=l.y*c;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",o*Math.min(Math.abs(h),Math.abs(d))),this.setAttr("shadowOffsetX",u.x*h),this.setAttr("shadowOffsetY",u.y*d)}}class gf extends Hi{constructor(e){super(e),this._context=e._canvas.getContext("2d",{willReadFrequently:!0})}_fill(e){this.save(),this.setAttr("fillStyle",e.colorKey),e._fillFuncHit(this),this.restore()}strokeShape(e){e.hasHitStroke()&&this._stroke(e)}_stroke(e){if(e.hasHitStroke()){const t=e.getStrokeScaleEnabled();if(!t){this.save();const s=this.getCanvas().getPixelRatio();this.setTransform(s,0,0,s,0,0)}this._applyLineCap(e);const r=e.hitStrokeWidth(),i=r==="auto"?e.strokeWidth():r;this.setAttr("lineWidth",i),this.setAttr("strokeStyle",e.colorKey),e._strokeFuncHit(this),t||this.restore()}}}let ii;function _f(){if(ii)return ii;const n=M.createCanvasElement(),e=n.getContext("2d");return ii=(function(){const t=X._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/r})(),M.releaseCanvas(n),ii}class Zs{constructor(e){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const r=(e||{}).pixelRatio||X.pixelRatio||_f();this.pixelRatio=r,this._canvas=M.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(e){const t=this.pixelRatio;this.pixelRatio=e,this.setSize(this.getWidth()/t,this.getHeight()/t)}setWidth(e){this.width=this._canvas.width=e*this.pixelRatio,this._canvas.style.width=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}setHeight(e){this.height=this._canvas.height=e*this.pixelRatio,this._canvas.style.height=e+"px";const t=this.pixelRatio;this.getContext()._context.scale(t,t)}getWidth(){return this.width}getHeight(){return this.height}setSize(e,t){this.setWidth(e||0),this.setHeight(t||0)}toDataURL(e,t){try{return this._canvas.toDataURL(e,t)}catch{try{return this._canvas.toDataURL()}catch(i){return M.error("Unable to get data URL. "+i.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class dn extends Zs{constructor(e={width:0,height:0,willReadFrequently:!1}){super(e),this.context=new pf(this,{willReadFrequently:e.willReadFrequently}),this.setSize(e.width,e.height)}}class $s extends Zs{constructor(e={width:0,height:0}){super(e),this.hitCanvas=!0,this.context=new gf(this),this.setSize(e.width,e.height)}}const Fe={get isDragging(){let n=!1;return Fe._dragElements.forEach(e=>{e.dragStatus==="dragging"&&(n=!0)}),n},justDragged:!1,get node(){let n;return Fe._dragElements.forEach(e=>{n=e.node}),n},_dragElements:new Map,_drag(n){const e=[];Fe._dragElements.forEach((t,r)=>{const{node:i}=t,s=i.getStage();s.setPointersPositions(n),t.pointerId===void 0&&(t.pointerId=M._getFirstPointerId(n));const o=s._changedPointerPositions.find(u=>u.id===t.pointerId);if(o){if(t.dragStatus!=="dragging"){const u=i.dragDistance();if(Math.max(Math.abs(o.x-t.startPointerPos.x),Math.abs(o.y-t.startPointerPos.y))<u||(i.startDrag({evt:n}),!i.isDragging()))return}i._setDragPosition(n,t),e.push(i)}}),e.forEach(t=>{t.fire("dragmove",{type:"dragmove",target:t,evt:n},!0)})},_endDragBefore(n){const e=[];Fe._dragElements.forEach(t=>{const{node:r}=t,i=r.getStage();if(n&&i.setPointersPositions(n),!i._changedPointerPositions.find(u=>u.id===t.pointerId))return;(t.dragStatus==="dragging"||t.dragStatus==="stopped")&&(Fe.justDragged=!0,X._mouseListenClick=!1,X._touchListenClick=!1,X._pointerListenClick=!1,t.dragStatus="stopped");const o=t.node.getLayer()||t.node instanceof X.Stage&&t.node;o&&e.indexOf(o)===-1&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(n){Fe._dragElements.forEach((e,t)=>{e.dragStatus==="stopped"&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:n},!0),e.dragStatus!=="dragging"&&Fe._dragElements.delete(t)})}};X.isBrowser&&(window.addEventListener("mouseup",Fe._endDragBefore,!0),window.addEventListener("touchend",Fe._endDragBefore,!0),window.addEventListener("touchcancel",Fe._endDragBefore,!0),window.addEventListener("mousemove",Fe._drag),window.addEventListener("touchmove",Fe._drag),window.addEventListener("mouseup",Fe._endDragAfter,!1),window.addEventListener("touchend",Fe._endDragAfter,!1),window.addEventListener("touchcancel",Fe._endDragAfter,!1));function Dn(n){return M._isString(n)?'"'+n+'"':Object.prototype.toString.call(n)==="[object Number]"||M._isBoolean(n)?n:Object.prototype.toString.call(n)}function Bu(n){return n>255?255:n<0?0:Math.round(n)}function U(){if(X.isUnminified)return function(n,e){return M._isNumber(n)||M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),n}}function Wi(n){if(X.isUnminified)return function(e,t){let r=M._isNumber(e),i=M._isArray(e)&&e.length==n;return!r&&!i&&M.warn(Dn(e)+' is a not valid value for "'+t+'" attribute. The value should be a number or Array<number>('+n+")"),e}}function ea(){if(X.isUnminified)return function(n,e){return M._isNumber(n)||n==="auto"||M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),n}}function Ln(){if(X.isUnminified)return function(n,e){return M._isString(n)||M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),n}}function ku(){if(X.isUnminified)return function(n,e){const t=M._isString(n),r=Object.prototype.toString.call(n)==="[object CanvasGradient]"||n&&n.addColorStop;return t||r||M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),n}}function Df(){if(X.isUnminified)return function(n,e){const t=Int8Array?Object.getPrototypeOf(Int8Array):null;return t&&n instanceof t||(M._isArray(n)?n.forEach(function(r){M._isNumber(r)||M.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),n}}function Bt(){if(X.isUnminified)return function(n,e){return n===!0||n===!1||M.warn(Dn(n)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),n}}function bf(n){if(X.isUnminified)return function(e,t){return e==null||M.isObject(e)||M.warn(Dn(e)+' is a not valid value for "'+t+'" attribute. The value should be an object with properties '+n),e}}const _r="get",Dr="set",y={addGetterSetter(n,e,t,r,i){y.addGetter(n,e,t),y.addSetter(n,e,r,i),y.addOverloadedGetterSetter(n,e)},addGetter(n,e,t){const r=_r+M._capitalize(e);n.prototype[r]=n.prototype[r]||function(){const i=this.attrs[e];return i===void 0?t:i}},addSetter(n,e,t,r){const i=Dr+M._capitalize(e);n.prototype[i]||y.overWriteSetter(n,e,t,r)},overWriteSetter(n,e,t,r){const i=Dr+M._capitalize(e);n.prototype[i]=function(s){return t&&s!==void 0&&s!==null&&(s=t.call(this,s,e)),this._setAttr(e,s),r&&r.call(this),this}},addComponentsGetterSetter(n,e,t,r,i){const s=t.length,o=M._capitalize,u=_r+o(e),l=Dr+o(e);n.prototype[u]=function(){const h={};for(let d=0;d<s;d++){const m=t[d];h[m]=this.getAttr(e+o(m))}return h};const c=bf(t);n.prototype[l]=function(h){const d=this.attrs[e];r&&(h=r.call(this,h,e)),c&&c.call(this,h,e);for(const m in h)h.hasOwnProperty(m)&&this._setAttr(e+o(m),h[m]);return h||t.forEach(m=>{this._setAttr(e+o(m),void 0)}),this._fireChangeEvent(e,d,h),i&&i.call(this),this},y.addOverloadedGetterSetter(n,e)},addOverloadedGetterSetter(n,e){const t=M._capitalize(e),r=Dr+t,i=_r+t;n.prototype[e]=function(){return arguments.length?(this[r](arguments[0]),this):this[i]()}},addDeprecatedGetterSetter(n,e,t,r){M.error("Adding deprecated "+e);const i=_r+M._capitalize(e),s=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[i]=function(){M.error(s);const o=this.attrs[e];return o===void 0?t:o},y.addSetter(n,e,r,function(){M.error(s)}),y.addOverloadedGetterSetter(n,e)},backCompat(n,e){M.each(e,function(t,r){const i=n.prototype[r],s=_r+M._capitalize(t),o=Dr+M._capitalize(t);function u(){i.apply(this,arguments),M.error('"'+t+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}n.prototype[t]=u,n.prototype[s]=u,n.prototype[o]=u})},afterSetFilter(){this._filterUpToDate=!1}};function Sf(n){const e=/(\w+)\(([^)]+)\)/g;let t;for(;(t=e.exec(n))!==null;){const[,r,i]=t;switch(r){case"blur":{const s=parseFloat(i.replace("px",""));return function(o){this.blurRadius(s*.5);const u=X.Filters;u&&u.Blur&&u.Blur.call(this,o)}}case"brightness":{const s=i.includes("%")?parseFloat(i)/100:parseFloat(i);return function(o){this.brightness(s);const u=X.Filters;u&&u.Brightness&&u.Brightness.call(this,o)}}case"contrast":{const s=parseFloat(i);return function(o){const u=100*(Math.sqrt(s)-1);this.contrast(u);const l=X.Filters;l&&l.Contrast&&l.Contrast.call(this,o)}}case"grayscale":return function(s){const o=X.Filters;o&&o.Grayscale&&o.Grayscale.call(this,s)};case"sepia":return function(s){const o=X.Filters;o&&o.Sepia&&o.Sepia.call(this,s)};case"invert":return function(s){const o=X.Filters;o&&o.Invert&&o.Invert.call(this,s)};default:M.warn(`CSS filter "${r}" is not supported in fallback mode. Consider using function filters for better compatibility.`);break}}return()=>{}}const pi="absoluteOpacity",si="allEventListeners",jt="absoluteTransform",mo="absoluteScale",Fn="canvas",yf="Change",wf="children",vf="konva",ms="listening",Ef="mouseenter",Af="mouseleave",Ff="pointerenter",Pf="pointerleave",Tf="touchenter",Cf="touchleave",po="set",go="Shape",gi=" ",_o="stage",cn="transform",Mf="Stage",ps="visible",xf=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(gi);let Bf=1;class z{constructor(e){this._id=Bf++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(e),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(e){(e===cn||e===jt)&&this._cache.get(e)?this._cache.get(e).dirty=!0:e?this._cache.delete(e):this._cache.clear()}_getCache(e,t){let r=this._cache.get(e);return(r===void 0||(e===cn||e===jt)&&r.dirty===!0)&&(r=t.call(this),this._cache.set(e,r)),r}_calculate(e,t,r){if(!this._attachedDepsListeners.get(e)){const i=t.map(s=>s+"Change.konva").join(gi);this.on(i,()=>{this._clearCache(e)}),this._attachedDepsListeners.set(e,!0)}return this._getCache(e,r)}_getCanvasCache(){return this._cache.get(Fn)}_clearSelfAndDescendantCache(e){this._clearCache(e),e===jt&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Fn)){const{scene:e,filter:t,hit:r,buffer:i}=this._cache.get(Fn);M.releaseCanvas(e,t,r,i),this._cache.delete(Fn)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(e){const t=e||{};let r={};(t.x===void 0||t.y===void 0||t.width===void 0||t.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let i=Math.ceil(t.width||r.width),s=Math.ceil(t.height||r.height),o=t.pixelRatio,u=t.x===void 0?Math.floor(r.x):t.x,l=t.y===void 0?Math.floor(r.y):t.y,c=t.offset||0,h=t.drawBorder||!1,d=t.hitCanvasPixelRatio||1;if(!i||!s){M.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const m=Math.abs(Math.round(r.x)-u)>.5?1:0,D=Math.abs(Math.round(r.y)-l)>.5?1:0;i+=c*2+m,s+=c*2+D,u-=c,l-=c;const g=new dn({pixelRatio:o,width:i,height:s}),F=new dn({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),T=new $s({pixelRatio:d,width:i,height:s}),E=g.getContext(),C=T.getContext(),x=new dn({width:g.width/g.pixelRatio+Math.abs(u),height:g.height/g.pixelRatio+Math.abs(l),pixelRatio:g.pixelRatio}),B=x.getContext();return T.isCache=!0,g.isCache=!0,this._cache.delete(Fn),this._filterUpToDate=!1,t.imageSmoothingEnabled===!1&&(g.getContext()._context.imageSmoothingEnabled=!1,F.getContext()._context.imageSmoothingEnabled=!1),E.save(),C.save(),B.save(),E.translate(-u,-l),C.translate(-u,-l),B.translate(-u,-l),x.x=u,x.y=l,this._isUnderCache=!0,this._clearSelfAndDescendantCache(pi),this._clearSelfAndDescendantCache(mo),this.drawScene(g,this,x),this.drawHit(T,this),this._isUnderCache=!1,E.restore(),C.restore(),h&&(E.save(),E.beginPath(),E.rect(0,0,i,s),E.closePath(),E.setAttr("strokeStyle","red"),E.setAttr("lineWidth",5),E.stroke(),E.restore()),this._cache.set(Fn,{scene:g,filter:F,hit:T,buffer:x,x:u,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(Fn)}getClientRect(e){throw new Error('abstract "getClientRect" method call')}_transformedRect(e,t){const r=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}];let i=1/0,s=1/0,o=-1/0,u=-1/0;const l=this.getAbsoluteTransform(t);return r.forEach(function(c){const h=l.point(c);i===void 0&&(i=o=h.x,s=u=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),o=Math.max(o,h.x),u=Math.max(u,h.y)}),{x:i,y:s,width:o-i,height:u-s}}_drawCachedSceneCanvas(e){e.save(),e._applyOpacity(this),e._applyGlobalCompositeOperation(this);const t=this._getCanvasCache();e.translate(t.x,t.y);const r=this._getCachedSceneCanvas(),i=r.pixelRatio;e.drawImage(r._canvas,0,0,r.width/i,r.height/i),e.restore()}_drawCachedHitCanvas(e){const t=this._getCanvasCache(),r=t.hit;e.save(),e.translate(t.x,t.y),e.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),e.restore()}_getCachedSceneCanvas(){let e=this.filters(),t=this._getCanvasCache(),r=t.scene,i=t.filter,s=i.getContext(),o,u,l,c;if(!e||e.length===0)return r;if(this._filterUpToDate)return i;let h=!0;for(let m=0;m<e.length;m++)if(typeof e[m]=="string"&&fo(),typeof e[m]!="string"||!fo()){h=!1;break}const d=r.pixelRatio;if(i.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio),h){const m=e.join(" ");return s.save(),s.setAttr("filter",m),s.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),s.restore(),this._filterUpToDate=!0,i}try{for(o=e.length,s.clear(),s.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),u=s.getImageData(0,0,i.getWidth(),i.getHeight()),l=0;l<o;l++)c=e[l],typeof c=="string"&&(c=Sf(c)),c.call(this,u),s.putImageData(u,0,0)}catch(m){M.error("Unable to apply filter. "+m.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,i}on(e,t){if(this._cache&&this._cache.delete(si),arguments.length===3)return this._delegate.apply(this,arguments);const r=e.split(gi);for(let i=0;i<r.length;i++){const o=r[i].split("."),u=o[0],l=o[1]||"";this.eventListeners[u]||(this.eventListeners[u]=[]),this.eventListeners[u].push({name:l,handler:t})}return this}off(e,t){let r=(e||"").split(gi),i=r.length,s,o,u,l,c,h;if(this._cache&&this._cache.delete(si),!e)for(o in this.eventListeners)this._off(o);for(s=0;s<i;s++)if(u=r[s],l=u.split("."),c=l[0],h=l[1],c)this.eventListeners[c]&&this._off(c,h,t);else for(o in this.eventListeners)this._off(o,h,t);return this}dispatchEvent(e){const t={target:this,type:e.type,evt:e};return this.fire(e.type,t),this}addEventListener(e,t){return this.on(e,function(r){t.call(this,r.evt)}),this}removeEventListener(e){return this.off(e),this}_delegate(e,t,r){const i=this;this.on(e,function(s){const o=s.target.findAncestors(t,!0,i);for(let u=0;u<o.length;u++)s=M.cloneObject(s),s.currentTarget=o[u],r.call(o[u],s)})}remove(){return this.isDragging()&&this.stopDrag(),Fe._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(jt),this._clearSelfAndDescendantCache(pi),this._clearSelfAndDescendantCache(mo),this._clearSelfAndDescendantCache(_o),this._clearSelfAndDescendantCache(ps),this._clearSelfAndDescendantCache(ms)}_remove(){this._clearCaches();const e=this.getParent();e&&e.children&&(e.children.splice(this.index,1),e._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(e){const t="get"+M._capitalize(e);return M._isFunction(this[t])?this[t]():this.attrs[e]}getAncestors(){let e=this.getParent(),t=[];for(;e;)t.push(e),e=e.getParent();return t}getAttrs(){return this.attrs||{}}setAttrs(e){return this._batchTransformChanges(()=>{let t,r;if(!e)return this;for(t in e)t!==wf&&(r=po+M._capitalize(t),M._isFunction(this[r])?this[r](e[t]):this._setAttr(t,e[t]))}),this}isListening(){return this._getCache(ms,this._isListening)}_isListening(e){if(!this.listening())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isListening(e):!0}isVisible(){return this._getCache(ps,this._isVisible)}_isVisible(e){if(!this.visible())return!1;const r=this.getParent();return r&&r!==e&&this!==e?r._isVisible(e):!0}shouldDrawHit(e,t=!1){if(e)return this._isVisible(e)&&this._isListening(e);const r=this.getLayer();let i=!1;Fe._dragElements.forEach(o=>{o.dragStatus==="dragging"&&(o.node.nodeType==="Stage"||o.node.getLayer()===r)&&(i=!0)});const s=!t&&!X.hitOnDragEnabled&&(i||X.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let e=this.getDepth(),t=this,r=0,i,s,o,u;function l(h){for(i=[],s=h.length,o=0;o<s;o++)u=h[o],r++,u.nodeType!==go&&(i=i.concat(u.getChildren().slice())),u._id===t._id&&(o=s);i.length>0&&i[0].getDepth()<=e&&l(i)}const c=this.getStage();return t.nodeType!==Mf&&c&&l(c.getChildren()),r}getDepth(){let e=0,t=this.parent;for(;t;)e++,t=t.parent;return e}_batchTransformChanges(e){this._batchingTransformChange=!0,e(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(cn),this._clearSelfAndDescendantCache(jt)),this._needClearTransformCache=!1}setPosition(e){return this._batchTransformChanges(()=>{this.x(e.x),this.y(e.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const e=this.getStage();if(!e)return null;const t=e.getPointerPosition();if(!t)return null;const r=this.getAbsoluteTransform().copy();return r.invert(),r.point(t)}getAbsolutePosition(e){let t=!1,r=this.parent;for(;r;){if(r.isCached()){t=!0;break}r=r.parent}t&&!e&&(e=!0);const i=this.getAbsoluteTransform(e).getMatrix(),s=new gt,o=this.offset();return s.m=i.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(e){const{x:t,y:r,...i}=this._clearTransform();this.attrs.x=t,this.attrs.y=r,this._clearCache(cn);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(e.x,e.y),e={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(i),this.setPosition({x:e.x,y:e.y}),this._clearCache(cn),this._clearSelfAndDescendantCache(jt),this}_setTransform(e){let t;for(t in e)this.attrs[t]=e[t]}_clearTransform(){const e={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,e}move(e){let t=e.x,r=e.y,i=this.x(),s=this.y();return t!==void 0&&(i+=t),r!==void 0&&(s+=r),this.setPosition({x:i,y:s}),this}_eachAncestorReverse(e,t){let r=[],i=this.getParent(),s,o;if(!(t&&t._id===this._id)){for(r.unshift(this);i&&(!t||i._id!==t._id);)r.unshift(i),i=i.parent;for(s=r.length,o=0;o<s;o++)e(r[o])}}rotate(e){return this.rotation(this.rotation()+e),this}moveToTop(){if(!this.parent)return M.warn("Node has no parent. moveToTop function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return M.warn("Node has no parent. moveUp function is ignored."),!1;const e=this.index,t=this.parent.getChildren().length;return e<t-1?(this.parent.children.splice(e,1),this.parent.children.splice(e+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return M.warn("Node has no parent. moveDown function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.splice(e-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return M.warn("Node has no parent. moveToBottom function is ignored."),!1;const e=this.index;return e>0?(this.parent.children.splice(e,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(e){if(!this.parent)return M.warn("Node has no parent. zIndex parameter is ignored."),this;(e<0||e>=this.parent.children.length)&&M.warn("Unexpected value "+e+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const t=this.index;return this.parent.children.splice(t,1),this.parent.children.splice(e,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(pi,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let e=this.opacity();const t=this.getParent();return t&&!t._isUnderCache&&(e*=t.getAbsoluteOpacity()),e}moveTo(e){return this.getParent()!==e&&(this._remove(),e.add(this)),this}toObject(){let e=this.getAttrs(),t,r,i,s,o;const u={attrs:{},className:this.getClassName()};for(t in e)r=e[t],o=M.isObject(r)&&!M._isPlainObject(r)&&!M._isArray(r),!o&&(i=typeof this[t]=="function"&&this[t],delete e[t],s=i?i.call(this):null,e[t]=r,s!==r&&(u.attrs[t]=r));return M._prepareToStringify(u)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(e,t,r){const i=[];t&&this._isMatch(e)&&i.push(this);let s=this.parent;for(;s;){if(s===r)return i;s._isMatch(e)&&i.push(s),s=s.parent}return i}isAncestorOf(e){return!1}findAncestor(e,t,r){return this.findAncestors(e,t,r)[0]}_isMatch(e){if(!e)return!1;if(typeof e=="function")return e(this);let t=e.replace(/ /g,"").split(","),r=t.length,i,s;for(i=0;i<r;i++)if(s=t[i],M.isValidSelector(s)||(M.warn('Selector "'+s+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),M.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),M.warn("Konva is awesome, right?")),s.charAt(0)==="#"){if(this.id()===s.slice(1))return!0}else if(s.charAt(0)==="."){if(this.hasName(s.slice(1)))return!0}else if(this.className===s||this.nodeType===s)return!0;return!1}getLayer(){const e=this.getParent();return e?e.getLayer():null}getStage(){return this._getCache(_o,this._getStage)}_getStage(){const e=this.getParent();return e?e.getStage():null}fire(e,t={},r){return t.target=t.target||this,r?this._fireAndBubble(e,t):this._fire(e,t),this}getAbsoluteTransform(e){return e?this._getAbsoluteTransform(e):this._getCache(jt,this._getAbsoluteTransform)}_getAbsoluteTransform(e){let t;if(e)return t=new gt,this._eachAncestorReverse(function(r){const i=r.transformsEnabled();i==="all"?t.multiply(r.getTransform()):i==="position"&&t.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},e),t;{t=this._cache.get(jt)||new gt,this.parent?this.parent.getAbsoluteTransform().copyInto(t):t.reset();const r=this.transformsEnabled();if(r==="all")t.multiply(this.getTransform());else if(r==="position"){const i=this.attrs.x||0,s=this.attrs.y||0,o=this.attrs.offsetX||0,u=this.attrs.offsetY||0;t.translate(i-o,s-u)}return t.dirty=!1,t}}getAbsoluteScale(e){let t=this;for(;t;)t._isUnderCache&&(e=t),t=t.getParent();const i=this.getAbsoluteTransform(e).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(cn,this._getTransform)}_getTransform(){var e,t;const r=this._cache.get(cn)||new gt;r.reset();const i=this.x(),s=this.y(),o=X.getAngle(this.rotation()),u=(e=this.attrs.scaleX)!==null&&e!==void 0?e:1,l=(t=this.attrs.scaleY)!==null&&t!==void 0?t:1,c=this.attrs.skewX||0,h=this.attrs.skewY||0,d=this.attrs.offsetX||0,m=this.attrs.offsetY||0;return(i!==0||s!==0)&&r.translate(i,s),o!==0&&r.rotate(o),(c!==0||h!==0)&&r.skew(c,h),(u!==1||l!==1)&&r.scale(u,l),(d!==0||m!==0)&&r.translate(-1*d,-1*m),r.dirty=!1,r}clone(e){let t=M.cloneObject(this.attrs),r,i,s,o,u;for(r in e)t[r]=e[r];const l=new this.constructor(t);for(r in this.eventListeners)for(i=this.eventListeners[r],s=i.length,o=0;o<s;o++)u=i[o],u.name.indexOf(vf)<0&&(l.eventListeners[r]||(l.eventListeners[r]=[]),l.eventListeners[r].push(u));return l}_toKonvaCanvas(e){e=e||{};const t=this.getClientRect(),r=this.getStage(),i=e.x!==void 0?e.x:Math.floor(t.x),s=e.y!==void 0?e.y:Math.floor(t.y),o=e.pixelRatio||1,u=new dn({width:e.width||Math.ceil(t.width)||(r?r.width():0),height:e.height||Math.ceil(t.height)||(r?r.height():0),pixelRatio:o}),l=u.getContext(),c=new dn({width:u.width/u.pixelRatio+Math.abs(i),height:u.height/u.pixelRatio+Math.abs(s),pixelRatio:u.pixelRatio});return e.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(i||s)&&l.translate(-1*i,-1*s),this.drawScene(u,void 0,c),l.restore(),u}toCanvas(e){return this._toKonvaCanvas(e)._canvas}toDataURL(e){e=e||{};const t=e.mimeType||null,r=e.quality||null,i=this._toKonvaCanvas(e).toDataURL(t,r);return e.callback&&e.callback(i),i}toImage(e){return new Promise((t,r)=>{try{const i=e?.callback;i&&delete e.callback,M._urlToImage(this.toDataURL(e),function(s){t(s),i?.(s)})}catch(i){r(i)}})}toBlob(e){return new Promise((t,r)=>{try{const i=e?.callback;i&&delete e.callback,this.toCanvas(e).toBlob(s=>{t(s),i?.(s)},e?.mimeType,e?.quality)}catch(i){r(i)}})}setSize(e){return this.width(e.width),this.height(e.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():X.dragDistance}_off(e,t,r){let i=this.eventListeners[e],s,o,u;for(s=0;s<i.length;s++)if(o=i[s].name,u=i[s].handler,(o!=="konva"||t==="konva")&&(!t||o===t)&&(!r||r===u)){if(i.splice(s,1),i.length===0){delete this.eventListeners[e];break}s--}}_fireChangeEvent(e,t,r){this._fire(e+yf,{oldVal:t,newVal:r})}addName(e){if(!this.hasName(e)){const t=this.name(),r=t?t+" "+e:e;this.name(r)}return this}hasName(e){if(!e)return!1;const t=this.name();return t?(t||"").split(/\s/g).indexOf(e)!==-1:!1}removeName(e){const t=(this.name()||"").split(/\s/g),r=t.indexOf(e);return r!==-1&&(t.splice(r,1),this.name(t.join(" "))),this}setAttr(e,t){const r=this[po+M._capitalize(e)];return M._isFunction(r)?r.call(this,t):this._setAttr(e,t),this}_requestDraw(){if(X.autoDrawEnabled){const e=this.getLayer()||this.getStage();e?.batchDraw()}}_setAttr(e,t){const r=this.attrs[e];r===t&&!M.isObject(t)||(t==null?delete this.attrs[e]:this.attrs[e]=t,this._shouldFireChangeEvents&&this._fireChangeEvent(e,r,t),this._requestDraw())}_setComponentAttr(e,t,r){let i;r!==void 0&&(i=this.attrs[e],i||(this.attrs[e]=this.getAttr(e)),this.attrs[e][t]=r,this._fireChangeEvent(e,i,r))}_fireAndBubble(e,t,r){t&&this.nodeType===go&&(t.target=this);const i=[Ef,Af,Ff,Pf,Tf,Cf];if(!(i.indexOf(e)!==-1&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r))){this._fire(e,t);const o=i.indexOf(e)!==-1&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(t&&!t.cancelBubble||!t)&&this.parent&&this.parent.isListening()&&!o&&(r&&r.parent?this._fireAndBubble.call(this.parent,e,t,r):this._fireAndBubble.call(this.parent,e,t))}}_getProtoListeners(e){var t,r,i;const s=(t=this._cache.get(si))!==null&&t!==void 0?t:{};let o=s?.[e];if(o===void 0){o=[];let u=Object.getPrototypeOf(this);for(;u;){const l=(i=(r=u.eventListeners)===null||r===void 0?void 0:r[e])!==null&&i!==void 0?i:[];o.push(...l),u=Object.getPrototypeOf(u)}s[e]=o,this._cache.set(si,s)}return o}_fire(e,t){t=t||{},t.currentTarget=this,t.type=e;const r=this._getProtoListeners(e);if(r)for(let s=0;s<r.length;s++)r[s].handler.call(this,t);const i=this.eventListeners[e];if(i)for(let s=0;s<i.length;s++)i[s].handler.call(this,t)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(e){const t=e?e.pointerId:void 0,r=this.getStage(),i=this.getAbsolutePosition();if(!r)return;const s=r._getPointerById(t)||r._changedPointerPositions[0]||i;Fe._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-i.x,y:s.y-i.y},dragStatus:"ready",pointerId:t})}startDrag(e,t=!0){Fe._dragElements.has(this._id)||this._createDragElement(e);const r=Fe._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:e&&e.evt},t)}_setDragPosition(e,t){const r=this.getStage()._getPointerById(t.pointerId);if(!r)return;let i={x:r.x-t.offset.x,y:r.y-t.offset.y};const s=this.dragBoundFunc();if(s!==void 0){const o=s.call(this,i,e);o?i=o:M.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==i.x||this._lastPos.y!==i.y)&&(this.setAbsolutePosition(i),this._requestDraw()),this._lastPos=i}stopDrag(e){const t=Fe._dragElements.get(this._id);t&&(t.dragStatus="stopped"),Fe._endDragBefore(e),Fe._endDragAfter(e)}setDraggable(e){this._setAttr("draggable",e),this._dragChange()}isDragging(){const e=Fe._dragElements.get(this._id);return e?e.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(e){if(!(!(e.evt.button!==void 0)||X.dragButtons.indexOf(e.evt.button)>=0)||this.isDragging())return;let i=!1;Fe._dragElements.forEach(s=>{this.isAncestorOf(s.node)&&(i=!0)}),i||this._createDragElement(e)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=Fe._dragElements.get(this._id),r=t&&t.dragStatus==="dragging",i=t&&t.dragStatus==="ready";r?this.stopDrag():i&&Fe._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(e={x:0,y:0}){const t=this.getStage();if(!t)return!1;const r={x:-e.x,y:-e.y,width:t.width()+2*e.x,height:t.height()+2*e.y};return M.haveIntersection(r,this.getClientRect())}static create(e,t){return M._isString(e)&&(e=JSON.parse(e)),this._createNode(e,t)}static _createNode(e,t){let r=z.prototype.getClassName.call(e),i=e.children,s,o,u;t&&(e.attrs.container=t),X[r]||(M.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const l=X[r];if(s=new l(e.attrs),i)for(o=i.length,u=0;u<o;u++)s.add(z._createNode(i[u]));return s}}z.prototype.nodeType="Node";z.prototype._attrsAffectingSize=[];z.prototype.eventListeners={};z.prototype.on.call(z.prototype,xf,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(cn),this._clearSelfAndDescendantCache(jt)});z.prototype.on.call(z.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ps)});z.prototype.on.call(z.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(ms)});z.prototype.on.call(z.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(pi)});const ke=y.addGetterSetter;ke(z,"zIndex");ke(z,"absolutePosition");ke(z,"position");ke(z,"x",0,U());ke(z,"y",0,U());ke(z,"globalCompositeOperation","source-over",Ln());ke(z,"opacity",1,U());ke(z,"name","",Ln());ke(z,"id","",Ln());ke(z,"rotation",0,U());y.addComponentsGetterSetter(z,"scale",["x","y"]);ke(z,"scaleX",1,U());ke(z,"scaleY",1,U());y.addComponentsGetterSetter(z,"skew",["x","y"]);ke(z,"skewX",0,U());ke(z,"skewY",0,U());y.addComponentsGetterSetter(z,"offset",["x","y"]);ke(z,"offsetX",0,U());ke(z,"offsetY",0,U());ke(z,"dragDistance",void 0,U());ke(z,"width",0,U());ke(z,"height",0,U());ke(z,"listening",!0,Bt());ke(z,"preventDefault",!0,Bt());ke(z,"filters",void 0,function(n){return this._filterUpToDate=!1,n});ke(z,"visible",!0,Bt());ke(z,"transformsEnabled","all",Ln());ke(z,"size");ke(z,"dragBoundFunc");ke(z,"draggable",!1,Bt());y.backCompat(z,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class _t extends z{constructor(){super(...arguments),this.children=[]}getChildren(e){const t=this.children||[];return e?t.filter(e):t}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(e=>{e.parent=null,e.index=0,e.destroy()}),this.children=[],this._requestDraw(),this}add(...e){if(e.length===0)return this;if(e.length>1){for(let r=0;r<e.length;r++)this.add(e[r]);return this}const t=e[0];return t.getParent()?(t.moveTo(this),this):(this._validateAdd(t),t.index=this.getChildren().length,t.parent=this,t._clearCaches(),this.getChildren().push(t),this._fire("add",{child:t}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(e){return this._generalFind(e,!1)}findOne(e){const t=this._generalFind(e,!0);return t.length>0?t[0]:void 0}_generalFind(e,t){const r=[];return this._descendants(i=>{const s=i._isMatch(e);return s&&r.push(i),!!(s&&t)}),r}_descendants(e){let t=!1;const r=this.getChildren();for(const i of r){if(t=e(i),t)return!0;if(i.hasChildren()&&(t=i._descendants(e),t))return!0}return!1}toObject(){const e=z.prototype.toObject.call(this);return e.children=[],this.getChildren().forEach(t=>{e.children.push(t.toObject())}),e}isAncestorOf(e){let t=e.getParent();for(;t;){if(t._id===this._id)return!0;t=t.getParent()}return!1}clone(e){const t=z.prototype.clone.call(this,e);return this.getChildren().forEach(function(r){t.add(r.clone())}),t}getAllIntersections(e){const t=[];return this.find("Shape").forEach(r=>{r.isVisible()&&r.intersects(e)&&t.push(r)}),t}_clearSelfAndDescendantCache(e){var t;super._clearSelfAndDescendantCache(e),!this.isCached()&&((t=this.children)===null||t===void 0||t.forEach(function(r){r._clearSelfAndDescendantCache(e)}))}_setChildrenIndices(){var e;(e=this.children)===null||e===void 0||e.forEach(function(t,r){t.index=r}),this._requestDraw()}drawScene(e,t,r){const i=this.getLayer(),s=e||i&&i.getCanvas(),o=s&&s.getContext(),u=this._getCanvasCache(),l=u&&u.scene,c=s&&s.isCache;if(!this.isVisible()&&!c)return this;if(l){o.save();const h=this.getAbsoluteTransform(t).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",s,t,r);return this}drawHit(e,t){if(!this.shouldDrawHit(t))return this;const r=this.getLayer(),i=e||r&&r.hitCanvas,s=i&&i.getContext(),o=this._getCanvasCache();if(o&&o.hit){s.save();const l=this.getAbsoluteTransform(t).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",i,t);return this}_drawChildren(e,t,r,i){var s;const o=t&&t.getContext(),u=this.clipWidth(),l=this.clipHeight(),c=this.clipFunc(),h=typeof u=="number"&&typeof l=="number"||c,d=r===this;if(h){o.save();const D=this.getAbsoluteTransform(r);let g=D.getMatrix();o.transform(g[0],g[1],g[2],g[3],g[4],g[5]),o.beginPath();let F;if(c)F=c.call(this,o,this);else{const T=this.clipX(),E=this.clipY();o.rect(T||0,E||0,u,l)}o.clip.apply(o,F),g=D.copy().invert().getMatrix(),o.transform(g[0],g[1],g[2],g[3],g[4],g[5])}const m=!d&&this.globalCompositeOperation()!=="source-over"&&e==="drawScene";m&&(o.save(),o._applyGlobalCompositeOperation(this)),(s=this.children)===null||s===void 0||s.forEach(function(D){D[e](t,r,i)}),m&&o.restore(),h&&o.restore()}getClientRect(e={}){var t;const r=e.skipTransform,i=e.relativeTo;let s,o,u,l,c={x:1/0,y:1/0,width:0,height:0};const h=this;(t=this.children)===null||t===void 0||t.forEach(function(D){if(!D.visible())return;const g=D.getClientRect({relativeTo:h,skipShadow:e.skipShadow,skipStroke:e.skipStroke});g.width===0&&g.height===0||(s===void 0?(s=g.x,o=g.y,u=g.x+g.width,l=g.y+g.height):(s=Math.min(s,g.x),o=Math.min(o,g.y),u=Math.max(u,g.x+g.width),l=Math.max(l,g.y+g.height)))});const d=this.find("Shape");let m=!1;for(let D=0;D<d.length;D++)if(d[D]._isVisible(this)){m=!0;break}return m&&s!==void 0?c={x:s,y:o,width:u-s,height:l-o}:c={x:0,y:0,width:0,height:0},r?c:this._transformedRect(c,i)}}y.addComponentsGetterSetter(_t,"clip",["x","y","width","height"]);y.addGetterSetter(_t,"clipX",void 0,U());y.addGetterSetter(_t,"clipY",void 0,U());y.addGetterSetter(_t,"clipWidth",void 0,U());y.addGetterSetter(_t,"clipHeight",void 0,U());y.addGetterSetter(_t,"clipFunc");const Wr=new Map,Ru=X._global.PointerEvent!==void 0;function $i(n){return Wr.get(n)}function ta(n){return{evt:n,pointerId:n.pointerId}}function Lu(n,e){return Wr.get(n)===e}function Ou(n,e){Cr(n),e.getStage()&&(Wr.set(n,e),Ru&&e._fire("gotpointercapture",ta(new PointerEvent("gotpointercapture"))))}function Cr(n,e){const t=Wr.get(n);if(!t)return;const r=t.getStage();r&&r.content,Wr.delete(n),Ru&&t._fire("lostpointercapture",ta(new PointerEvent("lostpointercapture")))}const kf="Stage",Rf="string",Do="px",Lf="mouseout",Iu="mouseleave",Nu="mouseover",Gu="mouseenter",Hu="mousemove",Wu="mousedown",Vu="mouseup",yr="pointermove",wr="pointerdown",Zn="pointerup",vr="pointercancel",Of="lostpointercapture",ai="pointerout",Er="pointerleave",oi="pointerover",ui="pointerenter",gs="contextmenu",zu="touchstart",ju="touchend",Uu="touchmove",Xu="touchcancel",_s="wheel",If=5,Nf=[[Gu,"_pointerenter"],[Wu,"_pointerdown"],[Hu,"_pointermove"],[Vu,"_pointerup"],[Iu,"_pointerleave"],[zu,"_pointerdown"],[Uu,"_pointermove"],[ju,"_pointerup"],[Xu,"_pointercancel"],[Nu,"_pointerover"],[_s,"_wheel"],[gs,"_contextmenu"],[wr,"_pointerdown"],[yr,"_pointermove"],[Zn,"_pointerup"],[vr,"_pointercancel"],[Er,"_pointerleave"],[Of,"_lostpointercapture"]],es={mouse:{[ai]:Lf,[Er]:Iu,[oi]:Nu,[ui]:Gu,[yr]:Hu,[wr]:Wu,[Zn]:Vu,[vr]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[ai]:"touchout",[Er]:"touchleave",[oi]:"touchover",[ui]:"touchenter",[yr]:Uu,[wr]:zu,[Zn]:ju,[vr]:Xu,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[ai]:ai,[Er]:Er,[oi]:oi,[ui]:ui,[yr]:yr,[wr]:wr,[Zn]:Zn,[vr]:vr,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},Ar=n=>n.indexOf("pointer")>=0?"pointer":n.indexOf("touch")>=0?"touch":"mouse",Yn=n=>{const e=Ar(n);if(e==="pointer")return X.pointerEventsEnabled&&es.pointer;if(e==="touch")return es.touch;if(e==="mouse")return es.mouse};function bo(n={}){return(n.clipFunc||n.clipWidth||n.clipHeight)&&M.warn("Stage does not support clipping. Please use clip for Layers or Groups."),n}const Gf="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);",Mr=[];class Vi extends _t{constructor(e){super(bo(e)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),Mr.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{bo(this.attrs)}),this._checkVisibility()}_validateAdd(e){const t=e.getType()==="Layer",r=e.getType()==="FastLayer";t||r||M.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const e=this.visible()?"":"none";this.content.style.display=e}setContainer(e){if(typeof e===Rf){let t;if(e.charAt(0)==="."){const r=e.slice(1);e=document.getElementsByClassName(r)[0]}else e.charAt(0)!=="#"?t=e:t=e.slice(1),e=document.getElementById(t);if(!e)throw"Can not find container in document with id "+t}return this._setAttr("container",e),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),e.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const e=this.children,t=e.length;for(let r=0;r<t;r++)e[r].clear();return this}clone(e){return e||(e={}),e.container=typeof document<"u"&&document.createElement("div"),_t.prototype.clone.call(this,e)}destroy(){super.destroy();const e=this.content;e&&M._isInDocument(e)&&this.container().removeChild(e);const t=Mr.indexOf(this);return t>-1&&Mr.splice(t,1),M.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const e=this._pointerPositions[0]||this._changedPointerPositions[0];return e?{x:e.x,y:e.y}:(M.warn(Gf),null)}_getPointerById(e){return this._pointerPositions.find(t=>t.id===e)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(e){e={...e},e.x=e.x||0,e.y=e.y||0,e.width=e.width||this.width(),e.height=e.height||this.height();const t=new dn({width:e.width,height:e.height,pixelRatio:e.pixelRatio||1}),r=t.getContext()._context,i=this.children;return(e.x||e.y)&&r.translate(-1*e.x,-1*e.y),i.forEach(function(s){if(!s.isVisible())return;const o=s._toKonvaCanvas(e);r.drawImage(o._canvas,e.x,e.y,o.getWidth()/o.getPixelRatio(),o.getHeight()/o.getPixelRatio())}),t}getIntersection(e){if(!e)return null;const t=this.children,r=t.length,i=r-1;for(let s=i;s>=0;s--){const o=t[s].getIntersection(e);if(o)return o}return null}_resizeDOM(){const e=this.width(),t=this.height();this.content&&(this.content.style.width=e+Do,this.content.style.height=t+Do),this.bufferCanvas.setSize(e,t),this.bufferHitCanvas.setSize(e,t),this.children.forEach(r=>{r.setSize({width:e,height:t}),r.draw()})}add(e,...t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}super.add(e);const r=this.children.length;return r>If&&M.warn("The stage has "+r+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),e.setSize({width:this.width(),height:this.height()}),e.draw(),X.isBrowser&&this.content.appendChild(e.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(e){return Lu(e,this)}setPointerCapture(e){Ou(e,this)}releaseCapture(e){Cr(e)}getLayers(){return this.children}_bindContentEvents(){X.isBrowser&&Nf.forEach(([e,t])=>{this.content.addEventListener(e,r=>{this[t](r)},{passive:!1})})}_pointerenter(e){this.setPointersPositions(e);const t=Yn(e.type);t&&this._fire(t.pointerenter,{evt:e,target:this,currentTarget:this})}_pointerover(e){this.setPointersPositions(e);const t=Yn(e.type);t&&this._fire(t.pointerover,{evt:e,target:this,currentTarget:this})}_getTargetShape(e){let t=this[e+"targetShape"];return t&&!t.getStage()&&(t=null),t}_pointerleave(e){const t=Yn(e.type),r=Ar(e.type);if(!t)return;this.setPointersPositions(e);const i=this._getTargetShape(r),s=!(X.isDragging()||X.isTransforming())||X.hitOnDragEnabled;i&&s?(i._fireAndBubble(t.pointerout,{evt:e}),i._fireAndBubble(t.pointerleave,{evt:e}),this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this[r+"targetShape"]=null):s&&(this._fire(t.pointerleave,{evt:e,target:this,currentTarget:this}),this._fire(t.pointerout,{evt:e,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(e){const t=Yn(e.type),r=Ar(e.type);if(!t)return;this.setPointersPositions(e);let i=!1;this._changedPointerPositions.forEach(s=>{const o=this.getIntersection(s);if(Fe.justDragged=!1,X["_"+r+"ListenClick"]=!0,!o||!o.isListening()){this[r+"ClickStartShape"]=void 0;return}X.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[r+"ClickStartShape"]=o,o._fireAndBubble(t.pointerdown,{evt:e,pointerId:s.id}),i=!0;const u=e.type.indexOf("touch")>=0;o.preventDefault()&&e.cancelable&&u&&e.preventDefault()}),i||this._fire(t.pointerdown,{evt:e,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(e){const t=Yn(e.type),r=Ar(e.type);if(!t)return;const i=e.type.indexOf("touch")>=0||e.pointerType==="touch";if(X.isDragging()&&Fe.node.preventDefault()&&e.cancelable&&i&&e.preventDefault(),this.setPointersPositions(e),!(!(X.isDragging()||X.isTransforming())||X.hitOnDragEnabled))return;const o={};let u=!1;const l=this._getTargetShape(r);this._changedPointerPositions.forEach(c=>{const h=$i(c.id)||this.getIntersection(c),d=c.id,m={evt:e,pointerId:d},D=l!==h;if(D&&l&&(l._fireAndBubble(t.pointerout,{...m},h),l._fireAndBubble(t.pointerleave,{...m},h)),h){if(o[h._id])return;o[h._id]=!0}h&&h.isListening()?(u=!0,D&&(h._fireAndBubble(t.pointerover,{...m},l),h._fireAndBubble(t.pointerenter,{...m},l),this[r+"targetShape"]=h),h._fireAndBubble(t.pointermove,{...m})):l&&(this._fire(t.pointerover,{evt:e,target:this,currentTarget:this,pointerId:d}),this[r+"targetShape"]=null)}),u||this._fire(t.pointermove,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(e){const t=Yn(e.type),r=Ar(e.type);if(!t)return;this.setPointersPositions(e);const i=this[r+"ClickStartShape"],s=this[r+"ClickEndShape"],o={};let u=!1;this._changedPointerPositions.forEach(l=>{const c=$i(l.id)||this.getIntersection(l);if(c){if(c.releaseCapture(l.id),o[c._id])return;o[c._id]=!0}const h=l.id,d={evt:e,pointerId:h};let m=!1;X["_"+r+"InDblClickWindow"]?(m=!0,clearTimeout(this[r+"DblTimeout"])):Fe.justDragged||(X["_"+r+"InDblClickWindow"]=!0,clearTimeout(this[r+"DblTimeout"])),this[r+"DblTimeout"]=setTimeout(function(){X["_"+r+"InDblClickWindow"]=!1},X.dblClickWindow),c&&c.isListening()?(u=!0,this[r+"ClickEndShape"]=c,c._fireAndBubble(t.pointerup,{...d}),X["_"+r+"ListenClick"]&&i&&i===c&&(c._fireAndBubble(t.pointerclick,{...d}),m&&s&&s===c&&c._fireAndBubble(t.pointerdblclick,{...d}))):(this[r+"ClickEndShape"]=null,u||(this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),u=!0),X["_"+r+"ListenClick"]&&this._fire(t.pointerclick,{evt:e,target:this,currentTarget:this,pointerId:h}),m&&this._fire(t.pointerdblclick,{evt:e,target:this,currentTarget:this,pointerId:h}))}),u||this._fire(t.pointerup,{evt:e,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),X["_"+r+"ListenClick"]=!1,e.cancelable&&r!=="touch"&&r!=="pointer"&&e.preventDefault()}_contextmenu(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(gs,{evt:e}):this._fire(gs,{evt:e,target:this,currentTarget:this})}_wheel(e){this.setPointersPositions(e);const t=this.getIntersection(this.getPointerPosition());t&&t.isListening()?t._fireAndBubble(_s,{evt:e}):this._fire(_s,{evt:e,target:this,currentTarget:this})}_pointercancel(e){this.setPointersPositions(e);const t=$i(e.pointerId)||this.getIntersection(this.getPointerPosition());t&&t._fireAndBubble(Zn,ta(e)),Cr(e.pointerId)}_lostpointercapture(e){Cr(e.pointerId)}setPointersPositions(e){const t=this._getContentPosition();let r=null,i=null;e=e||window.event,e.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(e.touches,s=>{this._pointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})}),Array.prototype.forEach.call(e.changedTouches||e.touches,s=>{this._changedPointerPositions.push({id:s.identifier,x:(s.clientX-t.left)/t.scaleX,y:(s.clientY-t.top)/t.scaleY})})):(r=(e.clientX-t.left)/t.scaleX,i=(e.clientY-t.top)/t.scaleY,this.pointerPos={x:r,y:i},this._pointerPositions=[{x:r,y:i,id:M._getFirstPointerId(e)}],this._changedPointerPositions=[{x:r,y:i,id:M._getFirstPointerId(e)}])}_setPointerPosition(e){M.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(e)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const e=this.content.getBoundingClientRect();return{top:e.top,left:e.left,scaleX:e.width/this.content.clientWidth||1,scaleY:e.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new dn({width:this.width(),height:this.height()}),this.bufferHitCanvas=new $s({pixelRatio:1,width:this.width(),height:this.height()}),!X.isBrowser)return;const e=this.container();if(!e)throw"Stage has no container. A container is required.";e.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),e.appendChild(this.content),this._resizeDOM()}cache(){return M.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(e){e.batchDraw()}),this}}Vi.prototype.nodeType=kf;We(Vi);y.addGetterSetter(Vi,"container");X.isBrowser&&document.addEventListener("visibilitychange",()=>{Mr.forEach(n=>{n.batchDraw()})});const Ku="hasShadow",Yu="shadowRGBA",qu="patternImage",Ju="linearGradient",Qu="radialGradient";let li;function ts(){return li||(li=M.createCanvasElement().getContext("2d"),li)}const xr={};function Hf(n){const e=this.attrs.fillRule;e?n.fill(e):n.fill()}function Wf(n){n.stroke()}function Vf(n){const e=this.attrs.fillRule;e?n.fill(e):n.fill()}function zf(n){n.stroke()}function jf(){this._clearCache(Ku)}function Uf(){this._clearCache(Yu)}function Xf(){this._clearCache(qu)}function Kf(){this._clearCache(Ju)}function Yf(){this._clearCache(Qu)}class V extends z{constructor(e){super(e);let t,r=0;for(;t=M.getHitColor(),!(t&&!(t in xr));)if(r++,r>=1e4){M.warn("Failed to find a unique color key for a shape. Konva may work incorrectly. Most likely your browser is using canvas farbling. Consider disabling it."),t=M.getRandomColor();break}this.colorKey=t,xr[t]=this}getContext(){return M.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return M.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Ku,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(qu,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=ts().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const r=new gt;r.translate(this.fillPatternX(),this.fillPatternY()),r.rotate(X.getAngle(this.fillPatternRotation())),r.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),r.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=r.getMatrix(),s=typeof DOMMatrix>"u"?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(s)}return t}}_getLinearGradient(){return this._getCache(Ju,this.__getLinearGradient)}__getLinearGradient(){const e=this.fillLinearGradientColorStops();if(e){const t=ts(),r=this.fillLinearGradientStartPoint(),i=this.fillLinearGradientEndPoint(),s=t.createLinearGradient(r.x,r.y,i.x,i.y);for(let o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}_getRadialGradient(){return this._getCache(Qu,this.__getRadialGradient)}__getRadialGradient(){const e=this.fillRadialGradientColorStops();if(e){const t=ts(),r=this.fillRadialGradientStartPoint(),i=this.fillRadialGradientEndPoint(),s=t.createRadialGradient(r.x,r.y,this.fillRadialGradientStartRadius(),i.x,i.y,this.fillRadialGradientEndRadius());for(let o=0;o<e.length;o+=2)s.addColorStop(e[o],e[o+1]);return s}}getShadowRGBA(){return this._getCache(Yu,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const e=M.colorToRGBA(this.shadowColor());if(e)return"rgba("+e.r+","+e.g+","+e.b+","+e.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const e=this.hitStrokeWidth();return e==="auto"?this.hasStroke():this.strokeEnabled()&&!!e}intersects(e){const t=this.getStage();if(!t)return!1;const r=t.bufferHitCanvas;return r.getContext().clear(),this.drawHit(r,void 0,!0),r.context.getImageData(Math.round(e.x),Math.round(e.y),1,1).data[3]>0}destroy(){return z.prototype.destroy.call(this),delete xr[this.colorKey],delete this.colorKey,this}_useBufferCanvas(e){var t;if(!((t=this.attrs.perfectDrawEnabled)!==null&&t!==void 0?t:!0))return!1;const i=e||this.hasFill(),s=this.hasStroke(),o=this.getAbsoluteOpacity()!==1;if(i&&s&&o)return!0;const u=this.hasShadow(),l=this.shadowForStrokeEnabled();return!!(i&&s&&u&&l)}setStrokeHitEnabled(e){M.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),e?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){const e=this.size();return{x:this._centroid?-e.width/2:0,y:this._centroid?-e.height/2:0,width:e.width,height:e.height}}getClientRect(e={}){let t=!1,r=this.getParent();for(;r;){if(r.isCached()){t=!0;break}r=r.getParent()}const i=e.skipTransform,s=e.relativeTo||t&&this.getStage()||void 0,o=this.getSelfRect(),l=!e.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,c=o.width+l,h=o.height+l,d=!e.skipShadow&&this.hasShadow(),m=d?this.shadowOffsetX():0,D=d?this.shadowOffsetY():0,g=c+Math.abs(m),F=h+Math.abs(D),T=d&&this.shadowBlur()||0,E=g+T*2,C=F+T*2,x={width:E,height:C,x:-(l/2+T)+Math.min(m,0)+o.x,y:-(l/2+T)+Math.min(D,0)+o.y};return i?x:this._transformedRect(x,s)}drawScene(e,t,r){const i=this.getLayer(),s=e||i.getCanvas(),o=s.getContext(),u=this._getCanvasCache(),l=this.getSceneFunc(),c=this.hasShadow();let h;const d=t===this;if(!this.isVisible()&&!d)return this;if(u){o.save();const m=this.getAbsoluteTransform(t).getMatrix();return o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedSceneCanvas(o),o.restore(),this}if(!l)return this;if(o.save(),this._useBufferCanvas()){h=this.getStage();const m=r||h.bufferCanvas,D=m.getContext();D.clear(),D.save(),D._applyLineJoin(this),D._applyMiterLimit(this);const g=this.getAbsoluteTransform(t).getMatrix();D.transform(g[0],g[1],g[2],g[3],g[4],g[5]),l.call(this,D,this),D.restore();const F=m.pixelRatio;c&&o._applyShadow(this),d||(o._applyOpacity(this),o._applyGlobalCompositeOperation(this)),o.drawImage(m._canvas,m.x||0,m.y||0,m.width/F,m.height/F)}else{if(o._applyLineJoin(this),o._applyMiterLimit(this),!d){const m=this.getAbsoluteTransform(t).getMatrix();o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),o._applyOpacity(this),o._applyGlobalCompositeOperation(this)}c&&o._applyShadow(this),l.call(this,o,this)}return o.restore(),this}drawHit(e,t,r=!1){if(!this.shouldDrawHit(t,r))return this;const i=this.getLayer(),s=e||i.hitCanvas,o=s&&s.getContext(),u=this.hitFunc()||this.sceneFunc(),l=this._getCanvasCache(),c=l&&l.hit;if(this.colorKey||M.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),c){o.save();const d=this.getAbsoluteTransform(t).getMatrix();return o.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!u)return this;if(o.save(),o._applyLineJoin(this),o._applyMiterLimit(this),!(this===t)){const d=this.getAbsoluteTransform(t).getMatrix();o.transform(d[0],d[1],d[2],d[3],d[4],d[5])}return u.call(this,o,this),o.restore(),this}drawHitFromCache(e=0){const t=this._getCanvasCache(),r=this._getCachedSceneCanvas(),i=t.hit,s=i.getContext(),o=i.getWidth(),u=i.getHeight();s.clear(),s.drawImage(r._canvas,0,0,o,u);try{const l=s.getImageData(0,0,o,u),c=l.data,h=c.length,d=M._hexToRgb(this.colorKey);for(let m=0;m<h;m+=4)c[m+3]>e?(c[m]=d.r,c[m+1]=d.g,c[m+2]=d.b,c[m+3]=255):c[m+3]=0;s.putImageData(l,0,0)}catch(l){M.error("Unable to draw hit graph from cached scene canvas. "+l.message)}return this}hasPointerCapture(e){return Lu(e,this)}setPointerCapture(e){Ou(e,this)}releaseCapture(e){Cr(e)}}V.prototype._fillFunc=Hf;V.prototype._strokeFunc=Wf;V.prototype._fillFuncHit=Vf;V.prototype._strokeFuncHit=zf;V.prototype._centroid=!1;V.prototype.nodeType="Shape";We(V);V.prototype.eventListeners={};V.prototype.on.call(V.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",jf);V.prototype.on.call(V.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Uf);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",Xf);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",Kf);V.prototype.on.call(V.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",Yf);y.addGetterSetter(V,"stroke",void 0,ku());y.addGetterSetter(V,"strokeWidth",2,U());y.addGetterSetter(V,"fillAfterStrokeEnabled",!1);y.addGetterSetter(V,"hitStrokeWidth","auto",ea());y.addGetterSetter(V,"strokeHitEnabled",!0,Bt());y.addGetterSetter(V,"perfectDrawEnabled",!0,Bt());y.addGetterSetter(V,"shadowForStrokeEnabled",!0,Bt());y.addGetterSetter(V,"lineJoin");y.addGetterSetter(V,"lineCap");y.addGetterSetter(V,"miterLimit");y.addGetterSetter(V,"sceneFunc");y.addGetterSetter(V,"hitFunc");y.addGetterSetter(V,"dash");y.addGetterSetter(V,"dashOffset",0,U());y.addGetterSetter(V,"shadowColor",void 0,Ln());y.addGetterSetter(V,"shadowBlur",0,U());y.addGetterSetter(V,"shadowOpacity",1,U());y.addComponentsGetterSetter(V,"shadowOffset",["x","y"]);y.addGetterSetter(V,"shadowOffsetX",0,U());y.addGetterSetter(V,"shadowOffsetY",0,U());y.addGetterSetter(V,"fillPatternImage");y.addGetterSetter(V,"fill",void 0,ku());y.addGetterSetter(V,"fillPatternX",0,U());y.addGetterSetter(V,"fillPatternY",0,U());y.addGetterSetter(V,"fillLinearGradientColorStops");y.addGetterSetter(V,"strokeLinearGradientColorStops");y.addGetterSetter(V,"fillRadialGradientStartRadius",0);y.addGetterSetter(V,"fillRadialGradientEndRadius",0);y.addGetterSetter(V,"fillRadialGradientColorStops");y.addGetterSetter(V,"fillPatternRepeat","repeat");y.addGetterSetter(V,"fillEnabled",!0);y.addGetterSetter(V,"strokeEnabled",!0);y.addGetterSetter(V,"shadowEnabled",!0);y.addGetterSetter(V,"dashEnabled",!0);y.addGetterSetter(V,"strokeScaleEnabled",!0);y.addGetterSetter(V,"fillPriority","color");y.addComponentsGetterSetter(V,"fillPatternOffset",["x","y"]);y.addGetterSetter(V,"fillPatternOffsetX",0,U());y.addGetterSetter(V,"fillPatternOffsetY",0,U());y.addComponentsGetterSetter(V,"fillPatternScale",["x","y"]);y.addGetterSetter(V,"fillPatternScaleX",1,U());y.addGetterSetter(V,"fillPatternScaleY",1,U());y.addComponentsGetterSetter(V,"fillLinearGradientStartPoint",["x","y"]);y.addComponentsGetterSetter(V,"strokeLinearGradientStartPoint",["x","y"]);y.addGetterSetter(V,"fillLinearGradientStartPointX",0);y.addGetterSetter(V,"strokeLinearGradientStartPointX",0);y.addGetterSetter(V,"fillLinearGradientStartPointY",0);y.addGetterSetter(V,"strokeLinearGradientStartPointY",0);y.addComponentsGetterSetter(V,"fillLinearGradientEndPoint",["x","y"]);y.addComponentsGetterSetter(V,"strokeLinearGradientEndPoint",["x","y"]);y.addGetterSetter(V,"fillLinearGradientEndPointX",0);y.addGetterSetter(V,"strokeLinearGradientEndPointX",0);y.addGetterSetter(V,"fillLinearGradientEndPointY",0);y.addGetterSetter(V,"strokeLinearGradientEndPointY",0);y.addComponentsGetterSetter(V,"fillRadialGradientStartPoint",["x","y"]);y.addGetterSetter(V,"fillRadialGradientStartPointX",0);y.addGetterSetter(V,"fillRadialGradientStartPointY",0);y.addComponentsGetterSetter(V,"fillRadialGradientEndPoint",["x","y"]);y.addGetterSetter(V,"fillRadialGradientEndPointX",0);y.addGetterSetter(V,"fillRadialGradientEndPointY",0);y.addGetterSetter(V,"fillPatternRotation",0);y.addGetterSetter(V,"fillRule",void 0,Ln());y.backCompat(V,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const qf="beforeDraw",Jf="draw",Zu=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Qf=Zu.length;class On extends _t{constructor(e){super(e),this.canvas=new dn,this.hitCanvas=new $s({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(e){return this.getContext().clear(e),this.getHitCanvas().getContext().clear(e),this}setZIndex(e){super.setZIndex(e);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),e<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[e+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){z.prototype.moveToTop.call(this);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!z.prototype.moveUp.call(this))return!1;const t=this.getStage();return!t||!t.content?!1:(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(z.prototype.moveDown.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(z.prototype.moveToBottom.call(this)){const e=this.getStage();if(e){const t=e.children;e.content&&(e.content.removeChild(this.getNativeCanvasElement()),e.content.insertBefore(this.getNativeCanvasElement(),t[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const e=this.getNativeCanvasElement();return z.prototype.remove.call(this),e&&e.parentNode&&M._isInDocument(e)&&e.parentNode.removeChild(e),this}getStage(){return this.parent}setSize({width:e,height:t}){return this.canvas.setSize(e,t),this.hitCanvas.setSize(e,t),this._setSmoothEnabled(),this}_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&M.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(e){return e={...e},e.width=e.width||this.getWidth(),e.height=e.height||this.getHeight(),e.x=e.x!==void 0?e.x:this.x(),e.y=e.y!==void 0?e.y:this.y(),z.prototype._toKonvaCanvas.call(this,e)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){M.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){M.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,M.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(e){if(!this.isListening()||!this.isVisible())return null;let t=1,r=!1;for(;;){for(let i=0;i<Qf;i++){const s=Zu[i],o=this._getIntersection({x:e.x+s.x*t,y:e.y+s.y*t}),u=o.shape;if(u)return u;if(r=!!o.antialiased,!o.antialiased)break}if(r)t+=1;else return null}}_getIntersection(e){const t=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(e.x*t),Math.round(e.y*t),1,1).data,i=r[3];if(i===255){const s=M.getHitColorKey(r[0],r[1],r[2]),o=xr[s];return o?{shape:o}:{antialiased:!0}}else if(i>0)return{antialiased:!0};return{}}drawScene(e,t,r){const i=this.getLayer(),s=e||i&&i.getCanvas();return this._fire(qf,{node:this}),this.clearBeforeDraw()&&s.getContext().clear(),_t.prototype.drawScene.call(this,s,t,r),this._fire(Jf,{node:this}),this}drawHit(e,t){const r=this.getLayer(),i=e||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),_t.prototype.drawHit.call(this,i,t),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(e){M.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(e)}getHitGraphEnabled(e){return M.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const e=this.parent;!!this.hitCanvas._canvas.parentNode?e.content.removeChild(this.hitCanvas._canvas):e.content.appendChild(this.hitCanvas._canvas)}destroy(){return M.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}On.prototype.nodeType="Layer";We(On);y.addGetterSetter(On,"imageSmoothingEnabled",!0);y.addGetterSetter(On,"clearBeforeDraw",!0);y.addGetterSetter(On,"hitGraphEnabled",!0,Bt());class na extends On{constructor(e){super(e),this.listening(!1),M.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}na.prototype.nodeType="FastLayer";We(na);class sr extends _t{_validateAdd(e){const t=e.getType();t!=="Group"&&t!=="Shape"&&M.throw("You may only add groups and shapes to groups.")}}sr.prototype.nodeType="Group";We(sr);const ns=(function(){return Bn.performance&&Bn.performance.now?function(){return Bn.performance.now()}:function(){return new Date().getTime()}})();class wt{constructor(e,t){this.id=wt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:ns(),frameRate:0},this.func=e,this.setLayers(t)}setLayers(e){let t=[];return e&&(t=Array.isArray(e)?e:[e]),this.layers=t,this}getLayers(){return this.layers}addLayer(e){const t=this.layers,r=t.length;for(let i=0;i<r;i++)if(t[i]._id===e._id)return!1;return this.layers.push(e),!0}isRunning(){const t=wt.animations,r=t.length;for(let i=0;i<r;i++)if(t[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=ns(),wt._addAnimation(this),this}stop(){return wt._removeAnimation(this),this}_updateFrameObject(e){this.frame.timeDiff=e-this.frame.lastTime,this.frame.lastTime=e,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(e){this.animations.push(e),this._handleAnimation()}static _removeAnimation(e){const t=e.id,r=this.animations,i=r.length;for(let s=0;s<i;s++)if(r[s].id===t){this.animations.splice(s,1);break}}static _runFrames(){const e={},t=this.animations;for(let r=0;r<t.length;r++){const i=t[r],s=i.layers,o=i.func;i._updateFrameObject(ns());const u=s.length;let l;if(o?l=o.call(i,i.frame)!==!1:l=!0,!!l)for(let c=0;c<u;c++){const h=s[c];h._id!==void 0&&(e[h._id]=h)}}for(const r in e)e.hasOwnProperty(r)&&e[r].batchDraw()}static _animationLoop(){const e=wt;e.animations.length?(e._runFrames(),M.requestAnimFrame(e._animationLoop)):e.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,M.requestAnimFrame(this._animationLoop))}}wt.animations=[];wt.animIdCounter=0;wt.animRunning=!1;const Zf={node:1,duration:1,easing:1,onFinish:1,yoyo:1},$f=1,So=2,yo=3,wo=["fill","stroke","shadowColor"];let e1=0;class t1{constructor(e,t,r,i,s,o,u){this.prop=e,this.propFunc=t,this.begin=i,this._pos=i,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=u,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=r,this._change=s-this.begin,this.pause()}fire(e){const t=this[e];t&&t()}setTime(e){e>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():e<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=e,this.update())}getTime(){return this._time}setPosition(e){this.prevPos=this._pos,this.propFunc(e),this._pos=e}getPosition(e){return e===void 0&&(e=this._time),this.func(e,this.begin,this._change,this.duration)}play(){this.state=So,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=yo,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(e){this.pause(),this._time=e,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const e=this.getTimer()-this._startTime;this.state===So?this.setTime(e):this.state===yo&&this.setTime(this.duration-e)}pause(){this.state=$f,this.fire("onPause")}getTimer(){return new Date().getTime()}}class Le{constructor(e){const t=this,r=e.node,i=r._id,s=e.easing||Br.Linear,o=!!e.yoyo;let u,l;typeof e.duration>"u"?u=.3:e.duration===0?u=.001:u=e.duration,this.node=r,this._id=e1++;const c=r.getLayer()||(r instanceof X.Stage?r.getLayers():null);c||M.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new wt(function(){t.tween.onEnterFrame()},c),this.tween=new t1(l,function(h){t._tweenFunc(h)},s,0,1,u*1e3,o),this._addListeners(),Le.attrs[i]||(Le.attrs[i]={}),Le.attrs[i][this._id]||(Le.attrs[i][this._id]={}),Le.tweens[i]||(Le.tweens[i]={});for(l in e)Zf[l]===void 0&&this._addAttr(l,e[l]);this.reset(),this.onFinish=e.onFinish,this.onReset=e.onReset,this.onUpdate=e.onUpdate}_addAttr(e,t){const r=this.node,i=r._id;let s,o,u,l,c;const h=Le.tweens[i][e];h&&delete Le.attrs[i][h][e];let d=r.getAttr(e);if(M._isArray(t))if(s=[],o=Math.max(t.length,d.length),e==="points"&&t.length!==d.length&&(t.length>d.length?(l=d,d=M._prepareArrayForTween(d,t,r.closed())):(u=t,t=M._prepareArrayForTween(t,d,r.closed()))),e.indexOf("fill")===0)for(let m=0;m<o;m++)if(m%2===0)s.push(t[m]-d[m]);else{const D=M.colorToRGBA(d[m]);c=M.colorToRGBA(t[m]),d[m]=D,s.push({r:c.r-D.r,g:c.g-D.g,b:c.b-D.b,a:c.a-D.a})}else for(let m=0;m<o;m++)s.push(t[m]-d[m]);else wo.indexOf(e)!==-1?(d=M.colorToRGBA(d),c=M.colorToRGBA(t),s={r:c.r-d.r,g:c.g-d.g,b:c.b-d.b,a:c.a-d.a}):s=t-d;Le.attrs[i][this._id][e]={start:d,diff:s,end:t,trueEnd:u,trueStart:l},Le.tweens[i][e]=this._id}_tweenFunc(e){const t=this.node,r=Le.attrs[t._id][this._id];let i,s,o,u,l,c,h,d;for(i in r){if(s=r[i],o=s.start,u=s.diff,d=s.end,M._isArray(o))if(l=[],h=Math.max(o.length,d.length),i.indexOf("fill")===0)for(c=0;c<h;c++)c%2===0?l.push((o[c]||0)+u[c]*e):l.push("rgba("+Math.round(o[c].r+u[c].r*e)+","+Math.round(o[c].g+u[c].g*e)+","+Math.round(o[c].b+u[c].b*e)+","+(o[c].a+u[c].a*e)+")");else for(c=0;c<h;c++)l.push((o[c]||0)+u[c]*e);else wo.indexOf(i)!==-1?l="rgba("+Math.round(o.r+u.r*e)+","+Math.round(o.g+u.g*e)+","+Math.round(o.b+u.b*e)+","+(o.a+u.a*e)+")":l=o+u*e;t.setAttr(i,l)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const e=this.node,t=Le.attrs[e._id][this._id];t.points&&t.points.trueEnd&&e.setAttr("points",t.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const e=this.node,t=Le.attrs[e._id][this._id];t.points&&t.points.trueStart&&e.points(t.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(e){return this.tween.seek(e*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const e=this.node._id,t=this._id,r=Le.tweens[e];this.pause(),this.anim&&this.anim.stop();for(const i in r)delete Le.tweens[e][i];delete Le.attrs[e][t],Le.tweens[e]&&(Object.keys(Le.tweens[e]).length===0&&delete Le.tweens[e],Object.keys(Le.attrs[e]).length===0&&delete Le.attrs[e])}}Le.attrs={};Le.tweens={};z.prototype.to=function(n){const e=n.onFinish;n.node=this,n.onFinish=function(){this.destroy(),e&&e()},new Le(n).play()};const Br={BackEaseIn(n,e,t,r){return t*(n/=r)*n*((1.70158+1)*n-1.70158)+e},BackEaseOut(n,e,t,r){return t*((n=n/r-1)*n*((1.70158+1)*n+1.70158)+1)+e},BackEaseInOut(n,e,t,r){let i=1.70158;return(n/=r/2)<1?t/2*(n*n*(((i*=1.525)+1)*n-i))+e:t/2*((n-=2)*n*(((i*=1.525)+1)*n+i)+2)+e},ElasticEaseIn(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r)===1?e+t:(s||(s=r*.3),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),-(i*Math.pow(2,10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s))+e)},ElasticEaseOut(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r)===1?e+t:(s||(s=r*.3),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),i*Math.pow(2,-10*n)*Math.sin((n*r-o)*(2*Math.PI)/s)+t+e)},ElasticEaseInOut(n,e,t,r,i,s){let o=0;return n===0?e:(n/=r/2)===2?e+t:(s||(s=r*(.3*1.5)),!i||i<Math.abs(t)?(i=t,o=s/4):o=s/(2*Math.PI)*Math.asin(t/i),n<1?-.5*(i*Math.pow(2,10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s))+e:i*Math.pow(2,-10*(n-=1))*Math.sin((n*r-o)*(2*Math.PI)/s)*.5+t+e)},BounceEaseOut(n,e,t,r){return(n/=r)<1/2.75?t*(7.5625*n*n)+e:n<2/2.75?t*(7.5625*(n-=1.5/2.75)*n+.75)+e:n<2.5/2.75?t*(7.5625*(n-=2.25/2.75)*n+.9375)+e:t*(7.5625*(n-=2.625/2.75)*n+.984375)+e},BounceEaseIn(n,e,t,r){return t-Br.BounceEaseOut(r-n,0,t,r)+e},BounceEaseInOut(n,e,t,r){return n<r/2?Br.BounceEaseIn(n*2,0,t,r)*.5+e:Br.BounceEaseOut(n*2-r,0,t,r)*.5+t*.5+e},EaseIn(n,e,t,r){return t*(n/=r)*n+e},EaseOut(n,e,t,r){return-t*(n/=r)*(n-2)+e},EaseInOut(n,e,t,r){return(n/=r/2)<1?t/2*n*n+e:-t/2*(--n*(n-2)-1)+e},StrongEaseIn(n,e,t,r){return t*(n/=r)*n*n*n*n+e},StrongEaseOut(n,e,t,r){return t*((n=n/r-1)*n*n*n*n+1)+e},StrongEaseInOut(n,e,t,r){return(n/=r/2)<1?t/2*n*n*n*n*n+e:t/2*((n-=2)*n*n*n*n+2)+e},Linear(n,e,t,r){return t*n/r+e}},vo=M._assign(X,{Util:M,Transform:gt,Node:z,Container:_t,Stage:Vi,stages:Mr,Layer:On,FastLayer:na,Group:sr,DD:Fe,Shape:V,shapes:xr,Animation:wt,Tween:Le,Easings:Br,Context:Hi,Canvas:Zs});class sn extends V{_sceneFunc(e){const t=X.getAngle(this.angle()),r=this.clockwise();e.beginPath(),e.arc(0,0,this.outerRadius(),0,t,r),e.arc(0,0,this.innerRadius(),t,0,!r),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}getSelfRect(){const e=this.innerRadius(),t=this.outerRadius(),r=this.clockwise(),i=X.getAngle(r?360-this.angle():this.angle()),s=Math.cos(Math.min(i,Math.PI)),o=1,u=Math.sin(Math.min(Math.max(Math.PI,i),3*Math.PI/2)),l=Math.sin(Math.min(i,Math.PI/2)),c=s*(s>0?e:t),h=o*t,d=u*(u>0?e:t),m=l*(l>0?t:e);return{x:c,y:r?-1*m:d,width:h-c,height:m-d}}}sn.prototype._centroid=!0;sn.prototype.className="Arc";sn.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"];We(sn);y.addGetterSetter(sn,"innerRadius",0,U());y.addGetterSetter(sn,"outerRadius",0,U());y.addGetterSetter(sn,"angle",0,U());y.addGetterSetter(sn,"clockwise",!1,Bt());function Ds(n,e,t,r,i,s,o){const u=Math.sqrt(Math.pow(t-n,2)+Math.pow(r-e,2)),l=Math.sqrt(Math.pow(i-t,2)+Math.pow(s-r,2)),c=o*u/(u+l),h=o*l/(u+l),d=t-c*(i-n),m=r-c*(s-e),D=t+h*(i-n),g=r+h*(s-e);return[d,m,D,g]}function Eo(n,e){const t=n.length,r=[];for(let i=2;i<t-2;i+=2){const s=Ds(n[i-2],n[i-1],n[i],n[i+1],n[i+2],n[i+3],e);isNaN(s[0])||(r.push(s[0]),r.push(s[1]),r.push(n[i]),r.push(n[i+1]),r.push(s[2]),r.push(s[3]))}return r}class an extends V{constructor(e){super(e),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(e){const t=this.points(),r=t.length,i=this.tension(),s=this.closed(),o=this.bezier();if(!r)return;let u=0;if(e.beginPath(),e.moveTo(t[0],t[1]),i!==0&&r>4){const l=this.getTensionPoints(),c=l.length;for(u=s?0:4,s||e.quadraticCurveTo(l[0],l[1],l[2],l[3]);u<c-2;)e.bezierCurveTo(l[u++],l[u++],l[u++],l[u++],l[u++],l[u++]);s||e.quadraticCurveTo(l[c-2],l[c-1],t[r-2],t[r-1])}else if(o)for(u=2;u<r;)e.bezierCurveTo(t[u++],t[u++],t[u++],t[u++],t[u++],t[u++]);else for(u=2;u<r;u+=2)e.lineTo(t[u],t[u+1]);s?(e.closePath(),e.fillStrokeShape(this)):e.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Eo(this.points(),this.tension())}_getTensionPointsClosed(){const e=this.points(),t=e.length,r=this.tension(),i=Ds(e[t-2],e[t-1],e[0],e[1],e[2],e[3],r),s=Ds(e[t-4],e[t-3],e[t-2],e[t-1],e[0],e[1],r),o=Eo(e,r);return[i[2],i[3]].concat(o).concat([s[0],s[1],e[t-2],e[t-1],s[2],s[3],i[0],i[1],e[0],e[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let e=this.points();if(e.length<4)return{x:e[0]||0,y:e[1]||0,width:0,height:0};this.tension()!==0?e=[e[0],e[1],...this._getTensionPoints(),e[e.length-2],e[e.length-1]]:e=this.points();let t=e[0],r=e[0],i=e[1],s=e[1],o,u;for(let l=0;l<e.length/2;l++)o=e[l*2],u=e[l*2+1],t=Math.min(t,o),r=Math.max(r,o),i=Math.min(i,u),s=Math.max(s,u);return{x:t,y:i,width:r-t,height:s-i}}}an.prototype.className="Line";an.prototype._attrsAffectingSize=["points","bezier","tension"];We(an);y.addGetterSetter(an,"closed",!1);y.addGetterSetter(an,"bezier",!1);y.addGetterSetter(an,"tension",0,U());y.addGetterSetter(an,"points",[],Df());const n1=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],r1=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],i1=[[1],[1,1],[1,2,1],[1,3,3,1]],Ao=(n,e,t)=>{let r,i;const o=t/2;r=0;for(let u=0;u<20;u++)i=o*n1[20][u]+o,r+=r1[20][u]*s1(n,e,i);return o*r},Fo=(n,e,t)=>{t===void 0&&(t=1);const r=n[0]-2*n[1]+n[2],i=e[0]-2*e[1]+e[2],s=2*n[1]-2*n[0],o=2*e[1]-2*e[0],u=4*(r*r+i*i),l=4*(r*s+i*o),c=s*s+o*o;if(u===0)return t*Math.sqrt(Math.pow(n[2]-n[0],2)+Math.pow(e[2]-e[0],2));const h=l/(2*u),d=c/u,m=t+h,D=d-h*h,g=m*m+D>0?Math.sqrt(m*m+D):0,F=h*h+D>0?Math.sqrt(h*h+D):0,T=h+Math.sqrt(h*h+D)!==0?D*Math.log(Math.abs((m+g)/(h+F))):0;return Math.sqrt(u)/2*(m*g-h*F+T)};function s1(n,e,t){const r=bs(1,t,n),i=bs(1,t,e),s=r*r+i*i;return Math.sqrt(s)}const bs=(n,e,t)=>{const r=t.length-1;let i,s;if(r===0)return 0;if(n===0){s=0;for(let o=0;o<=r;o++)s+=i1[r][o]*Math.pow(1-e,r-o)*Math.pow(e,o)*t[o];return s}else{i=new Array(r);for(let o=0;o<r;o++)i[o]=r*(t[o+1]-t[o]);return bs(n-1,e,i)}},Po=(n,e,t)=>{let r=1,i=n/e,s=(n-t(i))/e,o=0;for(;r>.001;){const u=t(i+s),l=Math.abs(n-u)/e;if(l<r)r=l,i+=s;else{const c=t(i-s),h=Math.abs(n-c)/e;h<r?(r=h,i-=s):s/=2}if(o++,o>500)break}return i};class Oe extends V{constructor(e){super(e),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Oe.parsePathData(this.data()),this.pathLength=Oe.getPathLength(this.dataArray)}_sceneFunc(e){const t=this.dataArray;e.beginPath();let r=!1;for(let i=0;i<t.length;i++){const s=t[i].command,o=t[i].points;switch(s){case"L":e.lineTo(o[0],o[1]);break;case"M":e.moveTo(o[0],o[1]);break;case"C":e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":const u=o[0],l=o[1],c=o[2],h=o[3],d=o[4],m=o[5],D=o[6],g=o[7],F=c>h?c:h,T=c>h?1:c/h,E=c>h?h/c:1;e.translate(u,l),e.rotate(D),e.scale(T,E),e.arc(0,0,F,d,d+m,1-g),e.scale(1/T,1/E),e.rotate(-D),e.translate(-u,-l);break;case"z":r=!0,e.closePath();break}}!r&&!this.hasFill()?e.strokeShape(this):e.fillStrokeShape(this)}getSelfRect(){let e=[];this.dataArray.forEach(function(l){if(l.command==="A"){const c=l.points[4],h=l.points[5],d=l.points[4]+h;let m=Math.PI/180;if(Math.abs(c-d)<m&&(m=Math.abs(c-d)),h<0)for(let D=c-m;D>d;D-=m){const g=Oe.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],D,0);e.push(g.x,g.y)}else for(let D=c+m;D<d;D+=m){const g=Oe.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],D,0);e.push(g.x,g.y)}}else if(l.command==="C")for(let c=0;c<=1;c+=.01){const h=Oe.getPointOnCubicBezier(c,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);e.push(h.x,h.y)}else e=e.concat(l.points)});let t=e[0],r=e[0],i=e[1],s=e[1],o,u;for(let l=0;l<e.length/2;l++)o=e[l*2],u=e[l*2+1],isNaN(o)||(t=Math.min(t,o),r=Math.max(r,o)),isNaN(u)||(i=Math.min(i,u),s=Math.max(s,u));return{x:t,y:i,width:r-t,height:s-i}}getLength(){return this.pathLength}getPointAtLength(e){return Oe.getPointAtLengthOfDataArray(e,this.dataArray)}static getLineLength(e,t,r,i){return Math.sqrt((r-e)*(r-e)+(i-t)*(i-t))}static getPathLength(e){let t=0;for(let r=0;r<e.length;++r)t+=e[r].pathLength;return t}static getPointAtLengthOfDataArray(e,t){let r,i=0,s=t.length;if(!s)return null;for(;i<s&&e>t[i].pathLength;)e-=t[i].pathLength,++i;if(i===s)return r=t[i-1].points.slice(-2),{x:r[0],y:r[1]};if(e<.01)return t[i].command==="M"?(r=t[i].points.slice(0,2),{x:r[0],y:r[1]}):{x:t[i].start.x,y:t[i].start.y};const o=t[i],u=o.points;switch(o.command){case"L":return Oe.getPointOnLine(e,o.start.x,o.start.y,u[0],u[1]);case"C":return Oe.getPointOnCubicBezier(Po(e,Oe.getPathLength(t),F=>Ao([o.start.x,u[0],u[2],u[4]],[o.start.y,u[1],u[3],u[5]],F)),o.start.x,o.start.y,u[0],u[1],u[2],u[3],u[4],u[5]);case"Q":return Oe.getPointOnQuadraticBezier(Po(e,Oe.getPathLength(t),F=>Fo([o.start.x,u[0],u[2]],[o.start.y,u[1],u[3]],F)),o.start.x,o.start.y,u[0],u[1],u[2],u[3]);case"A":const l=u[0],c=u[1],h=u[2],d=u[3],m=u[5],D=u[6];let g=u[4];return g+=m*e/o.pathLength,Oe.getPointOnEllipticalArc(l,c,h,d,g,D)}return null}static getPointOnLine(e,t,r,i,s,o,u){o=o??t,u=u??r;const l=this.getLineLength(t,r,i,s);if(l<1e-10)return{x:t,y:r};if(i===t)return{x:o,y:u+(s>r?e:-e)};const c=(s-r)/(i-t),h=Math.sqrt(e*e/(1+c*c))*(i<t?-1:1),d=c*h;if(Math.abs(u-r-c*(o-t))<1e-10)return{x:o+h,y:u+d};const m=((o-t)*(i-t)+(u-r)*(s-r))/(l*l),D=t+m*(i-t),g=r+m*(s-r),F=this.getLineLength(o,u,D,g),T=Math.sqrt(e*e-F*F),E=Math.sqrt(T*T/(1+c*c))*(i<t?-1:1),C=c*E;return{x:D+E,y:g+C}}static getPointOnCubicBezier(e,t,r,i,s,o,u,l,c){function h(T){return T*T*T}function d(T){return 3*T*T*(1-T)}function m(T){return 3*T*(1-T)*(1-T)}function D(T){return(1-T)*(1-T)*(1-T)}const g=l*h(e)+o*d(e)+i*m(e)+t*D(e),F=c*h(e)+u*d(e)+s*m(e)+r*D(e);return{x:g,y:F}}static getPointOnQuadraticBezier(e,t,r,i,s,o,u){function l(D){return D*D}function c(D){return 2*D*(1-D)}function h(D){return(1-D)*(1-D)}const d=o*l(e)+i*c(e)+t*h(e),m=u*l(e)+s*c(e)+r*h(e);return{x:d,y:m}}static getPointOnEllipticalArc(e,t,r,i,s,o){const u=Math.cos(o),l=Math.sin(o),c={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:e+(c.x*u-c.y*l),y:t+(c.x*l+c.y*u)}}static parsePathData(e){if(!e)return[];let t=e;const r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];t=t.replace(new RegExp(" ","g"),",");for(let d=0;d<r.length;d++)t=t.replace(new RegExp(r[d],"g"),"|"+r[d]);const i=t.split("|"),s=[],o=[];let u=0,l=0;const c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let h;for(let d=1;d<i.length;d++){let m=i[d],D=m.charAt(0);for(m=m.slice(1),o.length=0;h=c.exec(m);)o.push(h[0]);let g=[],F=D==="A"||D==="a"?0:-1;for(let T=0,E=o.length;T<E;T++){const C=o[T];if(C==="00"){g.push(0,0),F>=0&&(F+=2,F>=7&&(F-=7));continue}if(F>=0){if(F===3){if(/^[01]{2}\d+(?:\.\d+)?$/.test(C)){g.push(parseInt(C[0],10)),g.push(parseInt(C[1],10)),g.push(parseFloat(C.slice(2))),F+=3,F>=7&&(F-=7);continue}if(C==="11"||C==="10"||C==="01"){g.push(parseInt(C[0],10)),g.push(parseInt(C[1],10)),F+=2,F>=7&&(F-=7);continue}if(C==="0"||C==="1"){g.push(parseInt(C,10)),F+=1,F>=7&&(F-=7);continue}}else if(F===4){if(/^[01]\d+(?:\.\d+)?$/.test(C)){g.push(parseInt(C[0],10)),g.push(parseFloat(C.slice(1))),F+=2,F>=7&&(F-=7);continue}if(C==="0"||C==="1"){g.push(parseInt(C,10)),F+=1,F>=7&&(F-=7);continue}}const x=parseFloat(C);isNaN(x)?g.push(0):g.push(x),F+=1,F>=7&&(F-=7)}else{const x=parseFloat(C);isNaN(x)?g.push(0):g.push(x)}}for(;g.length>0&&!isNaN(g[0]);){let T="",E=[];const C=u,x=l;let B,W,j,q,J,K,re,oe,_,A;switch(D){case"l":u+=g.shift(),l+=g.shift(),T="L",E.push(u,l);break;case"L":u=g.shift(),l=g.shift(),E.push(u,l);break;case"m":const v=g.shift(),S=g.shift();if(u+=v,l+=S,T="M",s.length>2&&s[s.length-1].command==="z"){for(let O=s.length-2;O>=0;O--)if(s[O].command==="M"){u=s[O].points[0]+v,l=s[O].points[1]+S;break}}E.push(u,l),D="l";break;case"M":u=g.shift(),l=g.shift(),T="M",E.push(u,l),D="L";break;case"h":u+=g.shift(),T="L",E.push(u,l);break;case"H":u=g.shift(),T="L",E.push(u,l);break;case"v":l+=g.shift(),T="L",E.push(u,l);break;case"V":l=g.shift(),T="L",E.push(u,l);break;case"C":E.push(g.shift(),g.shift(),g.shift(),g.shift()),u=g.shift(),l=g.shift(),E.push(u,l);break;case"c":E.push(u+g.shift(),l+g.shift(),u+g.shift(),l+g.shift()),u+=g.shift(),l+=g.shift(),T="C",E.push(u,l);break;case"S":W=u,j=l,B=s[s.length-1],B.command==="C"&&(W=u+(u-B.points[2]),j=l+(l-B.points[3])),E.push(W,j,g.shift(),g.shift()),u=g.shift(),l=g.shift(),T="C",E.push(u,l);break;case"s":W=u,j=l,B=s[s.length-1],B.command==="C"&&(W=u+(u-B.points[2]),j=l+(l-B.points[3])),E.push(W,j,u+g.shift(),l+g.shift()),u+=g.shift(),l+=g.shift(),T="C",E.push(u,l);break;case"Q":E.push(g.shift(),g.shift()),u=g.shift(),l=g.shift(),E.push(u,l);break;case"q":E.push(u+g.shift(),l+g.shift()),u+=g.shift(),l+=g.shift(),T="Q",E.push(u,l);break;case"T":W=u,j=l,B=s[s.length-1],B.command==="Q"&&(W=u+(u-B.points[0]),j=l+(l-B.points[1])),u=g.shift(),l=g.shift(),T="Q",E.push(W,j,u,l);break;case"t":W=u,j=l,B=s[s.length-1],B.command==="Q"&&(W=u+(u-B.points[0]),j=l+(l-B.points[1])),u+=g.shift(),l+=g.shift(),T="Q",E.push(W,j,u,l);break;case"A":q=g.shift(),J=g.shift(),K=g.shift(),re=g.shift(),oe=g.shift(),_=u,A=l,u=g.shift(),l=g.shift(),T="A",E=this.convertEndpointToCenterParameterization(_,A,u,l,re,oe,q,J,K);break;case"a":q=g.shift(),J=g.shift(),K=g.shift(),re=g.shift(),oe=g.shift(),_=u,A=l,u+=g.shift(),l+=g.shift(),T="A",E=this.convertEndpointToCenterParameterization(_,A,u,l,re,oe,q,J,K);break}s.push({command:T||D,points:E,start:{x:C,y:x},pathLength:this.calcLength(C,x,T||D,E)})}(D==="z"||D==="Z")&&s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(e,t,r,i){let s,o,u,l;const c=Oe;switch(r){case"L":return c.getLineLength(e,t,i[0],i[1]);case"C":return Ao([e,i[0],i[2],i[4]],[t,i[1],i[3],i[5]],1);case"Q":return Fo([e,i[0],i[2]],[t,i[1],i[3]],1);case"A":s=0;const h=i[4],d=i[5],m=i[4]+d;let D=Math.PI/180;if(Math.abs(h-m)<D&&(D=Math.abs(h-m)),o=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],h,0),d<0)for(l=h-D;l>m;l-=D)u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),o=u;else for(l=h+D;l<m;l+=D)u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],l,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),o=u;return u=c.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],m,0),s+=c.getLineLength(o.x,o.y,u.x,u.y),s}return 0}static convertEndpointToCenterParameterization(e,t,r,i,s,o,u,l,c){const h=c*(Math.PI/180),d=Math.cos(h)*(e-r)/2+Math.sin(h)*(t-i)/2,m=-1*Math.sin(h)*(e-r)/2+Math.cos(h)*(t-i)/2,D=d*d/(u*u)+m*m/(l*l);D>1&&(u*=Math.sqrt(D),l*=Math.sqrt(D));let g=Math.sqrt((u*u*(l*l)-u*u*(m*m)-l*l*(d*d))/(u*u*(m*m)+l*l*(d*d)));s===o&&(g*=-1),isNaN(g)&&(g=0);const F=g*u*m/l,T=g*-l*d/u,E=(e+r)/2+Math.cos(h)*F-Math.sin(h)*T,C=(t+i)/2+Math.sin(h)*F+Math.cos(h)*T,x=function(re){return Math.sqrt(re[0]*re[0]+re[1]*re[1])},B=function(re,oe){return(re[0]*oe[0]+re[1]*oe[1])/(x(re)*x(oe))},W=function(re,oe){return(re[0]*oe[1]<re[1]*oe[0]?-1:1)*Math.acos(B(re,oe))},j=W([1,0],[(d-F)/u,(m-T)/l]),q=[(d-F)/u,(m-T)/l],J=[(-1*d-F)/u,(-1*m-T)/l];let K=W(q,J);return B(q,J)<=-1&&(K=Math.PI),B(q,J)>=1&&(K=0),o===0&&K>0&&(K=K-2*Math.PI),o===1&&K<0&&(K=K+2*Math.PI),[E,C,u,l,j,K,h,o]}}Oe.prototype.className="Path";Oe.prototype._attrsAffectingSize=["data"];We(Oe);y.addGetterSetter(Oe,"data");class In extends an{_sceneFunc(e){super._sceneFunc(e);const t=Math.PI*2,r=this.points();let i=r;const s=this.tension()!==0&&r.length>4;s&&(i=this.getTensionPoints());const o=this.pointerLength(),u=r.length;let l,c;if(s){const m=[i[i.length-4],i[i.length-3],i[i.length-2],i[i.length-1],r[u-2],r[u-1]],D=Oe.calcLength(i[i.length-4],i[i.length-3],"C",m),g=Oe.getPointOnQuadraticBezier(Math.min(1,1-o/D),m[0],m[1],m[2],m[3],m[4],m[5]);l=r[u-2]-g.x,c=r[u-1]-g.y}else l=r[u-2]-r[u-4],c=r[u-1]-r[u-3];const h=(Math.atan2(c,l)+t)%t,d=this.pointerWidth();this.pointerAtEnding()&&(e.save(),e.beginPath(),e.translate(r[u-2],r[u-1]),e.rotate(h),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e)),this.pointerAtBeginning()&&(e.save(),e.beginPath(),e.translate(r[0],r[1]),s?(l=(i[0]+i[2])/2-r[0],c=(i[1]+i[3])/2-r[1]):(l=r[2]-r[0],c=r[3]-r[1]),e.rotate((Math.atan2(-c,-l)+t)%t),e.moveTo(0,0),e.lineTo(-o,d/2),e.lineTo(-o,-d/2),e.closePath(),e.restore(),this.__fillStroke(e))}__fillStroke(e){const t=this.dashEnabled();t&&(this.attrs.dashEnabled=!1,e.setLineDash([])),e.fillStrokeShape(this),t&&(this.attrs.dashEnabled=!0)}getSelfRect(){const e=super.getSelfRect(),t=this.pointerWidth()/2;return{x:e.x,y:e.y-t,width:e.width,height:e.height+t*2}}}In.prototype.className="Arrow";We(In);y.addGetterSetter(In,"pointerLength",10,U());y.addGetterSetter(In,"pointerWidth",10,U());y.addGetterSetter(In,"pointerAtBeginning",!1);y.addGetterSetter(In,"pointerAtEnding",!0);class or extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius()!==e/2&&this.radius(e/2)}setHeight(e){this.radius()!==e/2&&this.radius(e/2)}}or.prototype._centroid=!0;or.prototype.className="Circle";or.prototype._attrsAffectingSize=["radius"];We(or);y.addGetterSetter(or,"radius",0,U());class bn extends V{_sceneFunc(e){const t=this.radiusX(),r=this.radiusY();e.beginPath(),e.save(),t!==r&&e.scale(1,r/t),e.arc(0,0,t,0,Math.PI*2,!1),e.restore(),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(e){this.radiusX(e/2)}setHeight(e){this.radiusY(e/2)}}bn.prototype.className="Ellipse";bn.prototype._centroid=!0;bn.prototype._attrsAffectingSize=["radiusX","radiusY"];We(bn);y.addComponentsGetterSetter(bn,"radius",["x","y"]);y.addGetterSetter(bn,"radiusX",0,U());y.addGetterSetter(bn,"radiusY",0,U());class bt extends V{constructor(e){super(e),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const e=this.image();e&&e.complete||e&&e.readyState===4||e&&e.addEventListener&&e.addEventListener("load",this._loadListener)}_removeImageLoad(e){e&&e.removeEventListener&&e.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const e=!!this.cornerRadius(),t=this.hasShadow();return e&&t?!0:super._useBufferCanvas(!0)}_sceneFunc(e){const t=this.getWidth(),r=this.getHeight(),i=this.cornerRadius(),s=this.attrs.image;let o;if(s){const u=this.attrs.cropWidth,l=this.attrs.cropHeight;u&&l?o=[s,this.cropX(),this.cropY(),u,l,0,0,t,r]:o=[s,0,0,t,r]}(this.hasFill()||this.hasStroke()||i)&&(e.beginPath(),i?M.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)),s&&(i&&e.clip(),e.drawImage.apply(e,o))}_hitFunc(e){const t=this.width(),r=this.height(),i=this.cornerRadius();e.beginPath(),i?M.drawRoundedRectPath(e,t,r,i):e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}getWidth(){var e,t,r;return(r=(e=this.attrs.width)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.width)!==null&&r!==void 0?r:0}getHeight(){var e,t,r;return(r=(e=this.attrs.height)!==null&&e!==void 0?e:(t=this.image())===null||t===void 0?void 0:t.height)!==null&&r!==void 0?r:0}static fromURL(e,t,r=null){const i=M.createImageElement();i.onload=function(){const s=new bt({image:i});t(s)},i.onerror=r,i.crossOrigin="Anonymous",i.src=e}}bt.prototype.className="Image";bt.prototype._attrsAffectingSize=["image"];We(bt);y.addGetterSetter(bt,"cornerRadius",0,Wi(4));y.addGetterSetter(bt,"image");y.addComponentsGetterSetter(bt,"crop",["x","y","width","height"]);y.addGetterSetter(bt,"cropX",0,U());y.addGetterSetter(bt,"cropY",0,U());y.addGetterSetter(bt,"cropWidth",0,U());y.addGetterSetter(bt,"cropHeight",0,U());const $u=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],a1="Change.konva",o1="none",Ss="up",ys="right",ws="down",vs="left",u1=$u.length;class ra extends sr{constructor(e){super(e),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(e){let t=this,r;const i=function(){t._sync()};for(r=0;r<u1;r++)e.on($u[r]+a1,i)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let e=this.getText(),t=this.getTag(),r,i,s,o,u,l,c;if(e&&t){switch(r=e.width(),i=e.height(),s=t.pointerDirection(),o=t.pointerWidth(),c=t.pointerHeight(),u=0,l=0,s){case Ss:u=r/2,l=-1*c;break;case ys:u=r+o,l=i/2;break;case ws:u=r/2,l=i+c;break;case vs:u=-1*o,l=i/2;break}t.setAttrs({x:-1*u,y:-1*l,width:r,height:i}),e.setAttrs({x:-1*u,y:-1*l})}}}ra.prototype.className="Label";We(ra);class Nn extends V{_sceneFunc(e){const t=this.width(),r=this.height(),i=this.pointerDirection(),s=this.pointerWidth(),o=this.pointerHeight(),u=this.cornerRadius();let l=0,c=0,h=0,d=0;typeof u=="number"?l=c=h=d=Math.min(u,t/2,r/2):(l=Math.min(u[0]||0,t/2,r/2),c=Math.min(u[1]||0,t/2,r/2),d=Math.min(u[2]||0,t/2,r/2),h=Math.min(u[3]||0,t/2,r/2)),e.beginPath(),e.moveTo(l,0),i===Ss&&(e.lineTo((t-s)/2,0),e.lineTo(t/2,-1*o),e.lineTo((t+s)/2,0)),e.lineTo(t-c,0),e.arc(t-c,c,c,Math.PI*3/2,0,!1),i===ys&&(e.lineTo(t,(r-o)/2),e.lineTo(t+s,r/2),e.lineTo(t,(r+o)/2)),e.lineTo(t,r-d),e.arc(t-d,r-d,d,0,Math.PI/2,!1),i===ws&&(e.lineTo((t+s)/2,r),e.lineTo(t/2,r+o),e.lineTo((t-s)/2,r)),e.lineTo(h,r),e.arc(h,r-h,h,Math.PI/2,Math.PI,!1),i===vs&&(e.lineTo(0,(r+o)/2),e.lineTo(-1*s,r/2),e.lineTo(0,(r-o)/2)),e.lineTo(0,l),e.arc(l,l,l,Math.PI,Math.PI*3/2,!1),e.closePath(),e.fillStrokeShape(this)}getSelfRect(){let e=0,t=0,r=this.pointerWidth(),i=this.pointerHeight(),s=this.pointerDirection(),o=this.width(),u=this.height();return s===Ss?(t-=i,u+=i):s===ws?u+=i:s===vs?(e-=r*1.5,o+=r):s===ys&&(o+=r*1.5),{x:e,y:t,width:o,height:u}}}Nn.prototype.className="Tag";We(Nn);y.addGetterSetter(Nn,"pointerDirection",o1);y.addGetterSetter(Nn,"pointerWidth",0,U());y.addGetterSetter(Nn,"pointerHeight",0,U());y.addGetterSetter(Nn,"cornerRadius",0,Wi(4));class jr extends V{_sceneFunc(e){const t=this.cornerRadius(),r=this.width(),i=this.height();e.beginPath(),t?M.drawRoundedRectPath(e,r,i,t):e.rect(0,0,r,i),e.closePath(),e.fillStrokeShape(this)}}jr.prototype.className="Rect";We(jr);y.addGetterSetter(jr,"cornerRadius",0,Wi(4));class Sn extends V{_sceneFunc(e){const t=this._getPoints(),r=this.radius(),i=this.sides(),s=this.cornerRadius();if(e.beginPath(),s)M.drawRoundedPolygonPath(e,t,i,r,s);else{e.moveTo(t[0].x,t[0].y);for(let o=1;o<t.length;o++)e.lineTo(t[o].x,t[o].y)}e.closePath(),e.fillStrokeShape(this)}_getPoints(){const e=this.attrs.sides,t=this.attrs.radius||0,r=[];for(let i=0;i<e;i++)r.push({x:t*Math.sin(i*2*Math.PI/e),y:-1*t*Math.cos(i*2*Math.PI/e)});return r}getSelfRect(){const e=this._getPoints();let t=e[0].x,r=e[0].x,i=e[0].y,s=e[0].y;return e.forEach(o=>{t=Math.min(t,o.x),r=Math.max(r,o.x),i=Math.min(i,o.y),s=Math.max(s,o.y)}),{x:t,y:i,width:r-t,height:s-i}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}Sn.prototype.className="RegularPolygon";Sn.prototype._centroid=!0;Sn.prototype._attrsAffectingSize=["radius"];We(Sn);y.addGetterSetter(Sn,"radius",0,U());y.addGetterSetter(Sn,"sides",0,U());y.addGetterSetter(Sn,"cornerRadius",0,Wi(4));const To=Math.PI*2;class Gn extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.innerRadius(),0,To,!1),e.moveTo(this.outerRadius(),0),e.arc(0,0,this.outerRadius(),To,0,!0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}Gn.prototype.className="Ring";Gn.prototype._centroid=!0;Gn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];We(Gn);y.addGetterSetter(Gn,"innerRadius",0,U());y.addGetterSetter(Gn,"outerRadius",0,U());class Ht extends V{constructor(e){super(e),this._updated=!0,this.anim=new wt(()=>{const t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(e){const t=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[t],o=this.frameOffsets(),u=s[i+0],l=s[i+1],c=s[i+2],h=s[i+3],d=this.image();if((this.hasFill()||this.hasStroke())&&(e.beginPath(),e.rect(0,0,c,h),e.closePath(),e.fillStrokeShape(this)),d)if(o){const m=o[t],D=r*2;e.drawImage(d,u,l,c,h,m[D+0],m[D+1],c,h)}else e.drawImage(d,u,l,c,h,0,0,c,h)}_hitFunc(e){const t=this.animation(),r=this.frameIndex(),i=r*4,s=this.animations()[t],o=this.frameOffsets(),u=s[i+2],l=s[i+3];if(e.beginPath(),o){const c=o[t],h=r*2;e.rect(c[h+0],c[h+1],u,l)}else e.rect(0,0,u,l);e.closePath(),e.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const e=this;this.interval=setInterval(function(){e._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const e=this.getLayer();this.anim.setLayers(e),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const e=this.frameIndex(),t=this.animation(),r=this.animations(),i=r[t],s=i.length/4;e<s-1?this.frameIndex(e+1):this.frameIndex(0)}}Ht.prototype.className="Sprite";We(Ht);y.addGetterSetter(Ht,"animation");y.addGetterSetter(Ht,"animations");y.addGetterSetter(Ht,"frameOffsets");y.addGetterSetter(Ht,"image");y.addGetterSetter(Ht,"frameIndex",0,U());y.addGetterSetter(Ht,"frameRate",17,U());y.backCompat(Ht,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class yn extends V{_sceneFunc(e){const t=this.innerRadius(),r=this.outerRadius(),i=this.numPoints();e.beginPath(),e.moveTo(0,0-r);for(let s=1;s<i*2;s++){const o=s%2===0?r:t,u=o*Math.sin(s*Math.PI/i),l=-1*o*Math.cos(s*Math.PI/i);e.lineTo(u,l)}e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(e){this.outerRadius(e/2)}setHeight(e){this.outerRadius(e/2)}}yn.prototype.className="Star";yn.prototype._centroid=!0;yn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];We(yn);y.addGetterSetter(yn,"numPoints",5,U());y.addGetterSetter(yn,"innerRadius",0,U());y.addGetterSetter(yn,"outerRadius",0,U());function hn(n){return[...n].reduce((e,t,r,i)=>{if(new RegExp("\\p{Emoji}","u").test(t)){const s=i[r+1];s&&new RegExp("\\p{Emoji_Modifier}|\\u200D","u").test(s)?(e.push(t+s),i[r+1]=""):e.push(t)}else new RegExp("\\p{Regional_Indicator}{2}","u").test(t+(i[r+1]||""))?e.push(t+i[r+1]):r>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(t)?e[e.length-1]+=t:t&&e.push(t);return e},[])}const qn="auto",l1="center",el="inherit",br="justify",c1="Change.konva",h1="2d",Co="-",tl="left",d1="text",f1="Text",m1="top",p1="bottom",Mo="middle",nl="normal",g1="px ",ci=" ",_1="right",xo="rtl",D1="word",b1="char",Bo="none",rs="",rl=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],S1=rl.length;function y1(n){return n.split(",").map(e=>{e=e.trim();const t=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!r&&(e=`"${e}"`),e}).join(", ")}let hi;function is(){return hi||(hi=M.createCanvasElement().getContext(h1),hi)}function w1(n){n.fillText(this._partialText,this._partialTextX,this._partialTextY)}function v1(n){n.setAttr("miterLimit",2),n.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function E1(n){return n=n||{},!n.fillLinearGradientColorStops&&!n.fillRadialGradientColorStops&&!n.fillPatternImage&&(n.fill=n.fill||"black"),n}class Ge extends V{constructor(e){super(E1(e)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<S1;t++)this.on(rl[t]+c1,this._setTextData);this._setTextData()}_sceneFunc(e){var t,r;const i=this.textArr,s=i.length;if(!this.text())return;let o=this.padding(),u=this.fontSize(),l=this.lineHeight()*u,c=this.verticalAlign(),h=this.direction(),d=0,m=this.align(),D=this.getWidth(),g=this.letterSpacing(),F=this.charRenderFunc(),T=this.fill(),E=this.textDecoration(),C=E.indexOf("underline")!==-1,x=E.indexOf("line-through")!==-1,B;h=h===el?e.direction:h;let W=l/2,j=Mo;if(!X.legacyTextRendering){const q=this.measureSize("M");j="alphabetic";const J=(t=q.fontBoundingBoxAscent)!==null&&t!==void 0?t:q.actualBoundingBoxAscent,K=(r=q.fontBoundingBoxDescent)!==null&&r!==void 0?r:q.actualBoundingBoxDescent;W=(J-K)/2+l/2}for(h===xo&&e.setAttr("direction",h),e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",j),e.setAttr("textAlign",tl),c===Mo?d=(this.getHeight()-s*l-o*2)/2:c===p1&&(d=this.getHeight()-s*l-o*2),e.translate(o,d+o),B=0;B<s;B++){let q=0,J=0;const K=i[B],re=K.text,oe=K.width,_=K.lastInParagraph;if(e.save(),m===_1?q+=D-oe-o*2:m===l1&&(q+=(D-oe-o*2)/2),C){e.save(),e.beginPath();const v=X.legacyTextRendering?Math.round(u/2):Math.round(u/4),S=q,O=W+J+v;e.moveTo(S,O);const I=m===br&&!_?D-o*2:oe;e.lineTo(S+Math.round(I),O),e.lineWidth=u/15;const R=this._getLinearGradient();e.strokeStyle=R||T,e.stroke(),e.restore()}const A=q;if(h!==xo&&(g!==0||m===br||F)){const v=re.split(" ").length-1,S=hn(re);for(let O=0;O<S.length;O++){const I=S[O];if(I===" "&&!_&&m===br&&(q+=(D-o*2-oe)/v),this._partialTextX=q,this._partialTextY=W+J,this._partialText=I,F){e.save();const Y=i.slice(0,B).reduce((_e,Re)=>_e+hn(Re.text).length,0),fe=O+Y;F({char:I,index:fe,x:q,y:W+J,lineIndex:B,column:O,isLastInLine:_,width:this.measureSize(I).width,context:e})}e.fillStrokeShape(this),F&&e.restore(),q+=this.measureSize(I).width+g}}else g!==0&&e.setAttr("letterSpacing",`${g}px`),this._partialTextX=q,this._partialTextY=W+J,this._partialText=re,e.fillStrokeShape(this);if(x){e.save(),e.beginPath();const v=X.legacyTextRendering?0:-Math.round(u/4),S=A;e.moveTo(S,W+J+v);const O=m===br&&!_?D-o*2:oe;e.lineTo(S+Math.round(O),W+J+v),e.lineWidth=u/15;const I=this._getLinearGradient();e.strokeStyle=I||T,e.stroke(),e.restore()}e.restore(),s>1&&(W+=l)}}_hitFunc(e){const t=this.getWidth(),r=this.getHeight();e.beginPath(),e.rect(0,0,t,r),e.closePath(),e.fillStrokeShape(this)}setText(e){const t=M._isString(e)?e:e==null?"":e+"";return this._setAttr(d1,t),this}getWidth(){return this.attrs.width===qn||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===qn||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return M.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(e){var t,r,i,s,o,u,l,c,h,d,m;let D=is(),g=this.fontSize(),F;D.save(),D.font=this._getContextFont(),F=D.measureText(e),D.restore();const T=g/100;return{actualBoundingBoxAscent:(t=F.actualBoundingBoxAscent)!==null&&t!==void 0?t:71.58203125*T,actualBoundingBoxDescent:(r=F.actualBoundingBoxDescent)!==null&&r!==void 0?r:0,actualBoundingBoxLeft:(i=F.actualBoundingBoxLeft)!==null&&i!==void 0?i:-7.421875*T,actualBoundingBoxRight:(s=F.actualBoundingBoxRight)!==null&&s!==void 0?s:75.732421875*T,alphabeticBaseline:(o=F.alphabeticBaseline)!==null&&o!==void 0?o:0,emHeightAscent:(u=F.emHeightAscent)!==null&&u!==void 0?u:100*T,emHeightDescent:(l=F.emHeightDescent)!==null&&l!==void 0?l:-20*T,fontBoundingBoxAscent:(c=F.fontBoundingBoxAscent)!==null&&c!==void 0?c:91*T,fontBoundingBoxDescent:(h=F.fontBoundingBoxDescent)!==null&&h!==void 0?h:21*T,hangingBaseline:(d=F.hangingBaseline)!==null&&d!==void 0?d:72.80000305175781*T,ideographicBaseline:(m=F.ideographicBaseline)!==null&&m!==void 0?m:-21*T,width:F.width,height:g}}_getContextFont(){return this.fontStyle()+ci+this.fontVariant()+ci+(this.fontSize()+g1)+y1(this.fontFamily())}_addTextLine(e){this.align()===br&&(e=e.trim());const r=this._getTextWidth(e);return this.textArr.push({text:e,width:r,lastInParagraph:!1})}_getTextWidth(e){const t=this.letterSpacing(),r=e.length;return is().measureText(e).width+t*r}_setTextData(){let e=this.text().split(`
`),t=+this.fontSize(),r=0,i=this.lineHeight()*t,s=this.attrs.width,o=this.attrs.height,u=s!==qn&&s!==void 0,l=o!==qn&&o!==void 0,c=this.padding(),h=s-c*2,d=o-c*2,m=0,D=this.wrap(),g=D!==Bo,F=D!==b1&&g,T=this.ellipsis();this.textArr=[],is().font=this._getContextFont();const E=T?this._getTextWidth(rs):0;for(let C=0,x=e.length;C<x;++C){let B=e[C],W=this._getTextWidth(B);if(u&&W>h)for(;B.length>0;){let j=0,q=hn(B).length,J="",K=0;for(;j<q;){const re=j+q>>>1,oe=hn(B),_=oe.slice(0,re+1).join(""),A=this._getTextWidth(_);(T&&l&&m+i>d?A+E:A)<=h?(j=re+1,J=_,K=A):q=re}if(J){if(F){const _=hn(B),A=hn(J),v=_[A.length],S=v===ci||v===Co;let O;if(S&&K<=h)O=A.length;else{const I=A.lastIndexOf(ci),R=A.lastIndexOf(Co);O=Math.max(I,R)+1}O>0&&(j=O,J=_.slice(0,j).join(""),K=this._getTextWidth(J))}if(J=J.trimRight(),this._addTextLine(J),r=Math.max(r,K),m+=i,this._shouldHandleEllipsis(m)){this._tryToAddEllipsisToLastLine();break}if(B=hn(B).slice(j).join("").trimLeft(),B.length>0&&(W=this._getTextWidth(B),W<=h)){this._addTextLine(B),m+=i,r=Math.max(r,W);break}}else break}else this._addTextLine(B),m+=i,r=Math.max(r,W),this._shouldHandleEllipsis(m)&&C<x-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&m+i>d)break}this.textHeight=t,this.textWidth=r}_shouldHandleEllipsis(e){const t=+this.fontSize(),r=this.lineHeight()*t,i=this.attrs.height,s=i!==qn&&i!==void 0,o=this.padding(),u=i-o*2;return!(this.wrap()!==Bo)||s&&e+r>u}_tryToAddEllipsisToLastLine(){const e=this.attrs.width,t=e!==qn&&e!==void 0,r=this.padding(),i=e-r*2,s=this.ellipsis(),o=this.textArr[this.textArr.length-1];!o||!s||(t&&(this._getTextWidth(o.text+rs)<i||(o.text=o.text.slice(0,o.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(o.text+rs))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const e=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,t=this.hasShadow();return e&&t?!0:super._useBufferCanvas()}}Ge.prototype._fillFunc=w1;Ge.prototype._strokeFunc=v1;Ge.prototype.className=f1;Ge.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];We(Ge);y.overWriteSetter(Ge,"width",ea());y.overWriteSetter(Ge,"height",ea());y.addGetterSetter(Ge,"direction",el);y.addGetterSetter(Ge,"fontFamily","Arial");y.addGetterSetter(Ge,"fontSize",12,U());y.addGetterSetter(Ge,"fontStyle",nl);y.addGetterSetter(Ge,"fontVariant",nl);y.addGetterSetter(Ge,"padding",0,U());y.addGetterSetter(Ge,"align",tl);y.addGetterSetter(Ge,"verticalAlign",m1);y.addGetterSetter(Ge,"lineHeight",1,U());y.addGetterSetter(Ge,"wrap",D1);y.addGetterSetter(Ge,"ellipsis",!1,Bt());y.addGetterSetter(Ge,"letterSpacing",0,U());y.addGetterSetter(Ge,"text","",Ln());y.addGetterSetter(Ge,"textDecoration","");y.addGetterSetter(Ge,"charRenderFunc",void 0);const A1="",il="normal";function sl(n){n.fillText(this.partialText,0,0)}function al(n){n.strokeText(this.partialText,0,0)}class qe extends V{constructor(e){super(e),this.dummyCanvas=M.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Oe.getPathLength(this.dataArray)}_getPointAtLength(e){if(!this.attrs.data)return null;const t=this.pathLength;return e>t?null:Oe.getPointAtLengthOfDataArray(e,this.dataArray)}_readDataAttribute(){this.dataArray=Oe.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(e){e.setAttr("font",this._getContextFont()),e.setAttr("textBaseline",this.textBaseline()),e.setAttr("textAlign","left"),e.save();const t=this.textDecoration(),r=this.fill(),i=this.fontSize(),s=this.glyphInfo,o=t.indexOf("underline")!==-1,u=t.indexOf("line-through")!==-1;o&&e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),this.partialText=s[l].text,e.fillStrokeShape(this),o&&(l===0&&e.moveTo(0,i/2+1),e.lineTo(s[l].width,i/2+1)),e.restore()}if(o&&(e.strokeStyle=r,e.lineWidth=i/20,e.stroke()),u){e.beginPath();for(let l=0;l<s.length;l++){e.save();const c=s[l].p0;e.translate(c.x,c.y),e.rotate(s[l].rotation),l===0&&e.moveTo(0,0),e.lineTo(s[l].width,0),e.restore()}e.strokeStyle=r,e.lineWidth=i/20,e.stroke()}e.restore()}_hitFunc(e){e.beginPath();const t=this.glyphInfo;if(t.length>=1){const r=t[0].p0;e.moveTo(r.x,r.y)}for(let r=0;r<t.length;r++){const i=t[r].p1;e.lineTo(i.x,i.y)}e.setAttr("lineWidth",this.fontSize()),e.setAttr("strokeStyle",this.colorKey),e.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return M.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(e){return Ge.prototype.setText.call(this,e)}_getContextFont(){return Ge.prototype._getContextFont.call(this)}_getTextSize(e){const r=this.dummyCanvas.getContext("2d");r.save(),r.font=this._getContextFont();const i=r.measureText(e);return r.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const e=hn(this.text()),t=[];let r=0;for(let d=0;d<e.length;d++)t.push({char:e[d],width:this._getTextSize(e[d]).width}),r+=t[d].width;const{height:i}=this._getTextSize(this.attrs.text);if(this.textWidth=r,this.textHeight=i,this.glyphInfo=[],!this.attrs.data)return null;const s=this.letterSpacing(),o=this.align(),u=this.kerningFunc(),l=Math.max(this.textWidth+((this.attrs.text||"").length-1)*s,0);let c=0;o==="center"&&(c=Math.max(0,this.pathLength/2-l/2)),o==="right"&&(c=Math.max(0,this.pathLength-l));let h=c;for(let d=0;d<t.length;d++){const m=this._getPointAtLength(h);if(!m)return;const D=t[d].char;let g=t[d].width+s;if(D===" "&&o==="justify"){const B=this.text().split(" ").length-1;g+=(this.pathLength-l)/B}const F=this._getPointAtLength(h+g);if(!F)return;const T=Oe.getLineLength(m.x,m.y,F.x,F.y);let E=0;if(u)try{E=u(t[d-1].char,D)*this.fontSize()}catch{E=0}m.x+=E,F.x+=E,this.textWidth+=E;const C=Oe.getPointOnLine(E+T/2,m.x,m.y,F.x,F.y),x=Math.atan2(F.y-m.y,F.x-m.x);this.glyphInfo.push({transposeX:C.x,transposeY:C.y,text:e[d],rotation:x,p0:m,p1:F,width:T}),h+=g}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const e=[];this.glyphInfo.forEach(function(c){e.push(c.p0.x),e.push(c.p0.y),e.push(c.p1.x),e.push(c.p1.y)});let t=e[0]||0,r=e[0]||0,i=e[1]||0,s=e[1]||0,o,u;for(let c=0;c<e.length/2;c++)o=e[c*2],u=e[c*2+1],t=Math.min(t,o),r=Math.max(r,o),i=Math.min(i,u),s=Math.max(s,u);const l=this.fontSize();return{x:t-l/2,y:i-l/2,width:r-t+l,height:s-i+l}}destroy(){return M.releaseCanvas(this.dummyCanvas),super.destroy()}}qe.prototype._fillFunc=sl;qe.prototype._strokeFunc=al;qe.prototype._fillFuncHit=sl;qe.prototype._strokeFuncHit=al;qe.prototype.className="TextPath";qe.prototype._attrsAffectingSize=["text","fontSize","data"];We(qe);y.addGetterSetter(qe,"data");y.addGetterSetter(qe,"fontFamily","Arial");y.addGetterSetter(qe,"fontSize",12,U());y.addGetterSetter(qe,"fontStyle",il);y.addGetterSetter(qe,"align","left");y.addGetterSetter(qe,"letterSpacing",0,U());y.addGetterSetter(qe,"textBaseline","middle");y.addGetterSetter(qe,"fontVariant",il);y.addGetterSetter(qe,"text",A1);y.addGetterSetter(qe,"textDecoration","");y.addGetterSetter(qe,"kerningFunc",void 0);const ol="tr-konva",F1=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(n=>n+`.${ol}`).join(" "),ko="nodesRect",P1=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange","draggableChange"],T1={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},C1="ontouchstart"in X._global;function M1(n,e,t){if(n==="rotater")return t;e+=M.degToRad(T1[n]||0);const r=(M.radToDeg(e)%360+360)%360;return M._inRange(r,315+22.5,360)||M._inRange(r,0,22.5)?"ns-resize":M._inRange(r,45-22.5,45+22.5)?"nesw-resize":M._inRange(r,90-22.5,90+22.5)?"ew-resize":M._inRange(r,135-22.5,135+22.5)?"nwse-resize":M._inRange(r,180-22.5,180+22.5)?"ns-resize":M._inRange(r,225-22.5,225+22.5)?"nesw-resize":M._inRange(r,270-22.5,270+22.5)?"ew-resize":M._inRange(r,315-22.5,315+22.5)?"nwse-resize":(M.error("Transformer has unknown angle for cursor detection: "+r),"pointer")}const wi=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function x1(n){return{x:n.x+n.width/2*Math.cos(n.rotation)+n.height/2*Math.sin(-n.rotation),y:n.y+n.height/2*Math.cos(n.rotation)+n.width/2*Math.sin(n.rotation)}}function ul(n,e,t){const r=t.x+(n.x-t.x)*Math.cos(e)-(n.y-t.y)*Math.sin(e),i=t.y+(n.x-t.x)*Math.sin(e)+(n.y-t.y)*Math.cos(e);return{...n,rotation:n.rotation+e,x:r,y:i}}function B1(n,e){const t=x1(n);return ul(n,e,t)}function k1(n,e,t){let r=e;for(let i=0;i<n.length;i++){const s=X.getAngle(n[i]),o=Math.abs(s-e)%(Math.PI*2);Math.min(o,Math.PI*2-o)<t&&(r=s)}return r}let Es=0;class De extends sr{constructor(e){super(e),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(F1,this.update),this.getNode()&&this.update()}attachTo(e){return this.setNode(e),this}setNode(e){return M.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([e])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return ol+this._id}setNodes(e=[]){this._nodes&&this._nodes.length&&this.detach();const t=e.filter(i=>i.isAncestorOf(this)?(M.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);return this._nodes=e=t,e.length===1&&this.useSingleNodeRotation()?this.rotation(e[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(i=>{const s=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()};if(i._attrsAffectingSize.length){const o=i._attrsAffectingSize.map(u=>u+"Change."+this._getEventNamespace()).join(" ");i.on(o,s)}i.on(P1.map(o=>o+`.${this._getEventNamespace()}`).join(" "),s),i.on(`absoluteTransformChange.${this._getEventNamespace()}`,s),this._proxyDrag(i)}),this._resetTransformCache(),this.findOne(".top-left")&&this.update(),this}_proxyDrag(e){let t;e.on(`dragstart.${this._getEventNamespace()}`,r=>{t=e.getAbsolutePosition(),!this.isDragging()&&e!==this.findOne(".back")&&this.startDrag(r,!1)}),e.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!t)return;const i=e.getAbsolutePosition(),s=i.x-t.x,o=i.y-t.y;this.nodes().forEach(u=>{if(u===e||u.isDragging())return;const l=u.getAbsolutePosition();u.setAbsolutePosition({x:l.x+s,y:l.y+o}),u.startDrag(r)}),t=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(e=>{e.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(ko),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(ko,this.__getNodeRect)}__getNodeShape(e,t=this.rotation(),r){const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=e.getAbsoluteScale(r),o=e.getAbsolutePosition(r),u=i.x*s.x-e.offsetX()*s.x,l=i.y*s.y-e.offsetY()*s.y,c=(X.getAngle(e.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),h={x:o.x+u*Math.cos(c)+l*Math.sin(-c),y:o.y+l*Math.cos(c)+u*Math.sin(c),width:i.width*s.x,height:i.height*s.y,rotation:c};return ul(h,-X.getAngle(t),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(c=>{const h=c.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),d=[{x:h.x,y:h.y},{x:h.x+h.width,y:h.y},{x:h.x+h.width,y:h.y+h.height},{x:h.x,y:h.y+h.height}],m=c.getAbsoluteTransform();d.forEach(function(D){const g=m.point(D);t.push(g)})});const r=new gt;r.rotate(-X.getAngle(this.rotation()));let i=1/0,s=1/0,o=-1/0,u=-1/0;t.forEach(function(c){const h=r.point(c);i===void 0&&(i=o=h.x,s=u=h.y),i=Math.min(i,h.x),s=Math.min(s,h.y),o=Math.max(o,h.x),u=Math.max(u,h.y)}),r.invert();const l=r.point({x:i,y:s});return{x:l.x,y:l.y,width:o-i,height:u-s,rotation:X.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),wi.forEach(e=>{this._createAnchor(e)}),this._createAnchor("rotater")}_createAnchor(e){const t=new jr({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:e+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:C1?10:"auto"}),r=this;t.on("mousedown touchstart",function(i){r._handleMouseDown(i)}),t.on("dragstart",i=>{t.stopDrag(),i.cancelBubble=!0}),t.on("dragend",i=>{i.cancelBubble=!0}),t.on("mouseenter",()=>{const i=X.getAngle(this.rotation()),s=this.rotateAnchorCursor(),o=M1(e,i,s);t.getStage().content&&(t.getStage().content.style.cursor=o),this._cursorChange=!0}),t.on("mouseout",()=>{t.getStage().content&&(t.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(t)}_createBack(){const e=new V({name:"back",width:0,height:0,sceneFunc(t,r){const i=r.getParent(),s=i.padding();t.beginPath(),t.rect(-s,-s,r.width()+s*2,r.height()+s*2),t.moveTo(r.width()/2,-s),i.rotateEnabled()&&i.rotateLineVisible()&&t.lineTo(r.width()/2,-i.rotateAnchorOffset()*M._sign(r.height())-s),t.fillStrokeShape(r)},hitFunc:(t,r)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();t.beginPath(),t.rect(-i,-i,r.width()+i*2,r.height()+i*2),t.fillStrokeShape(r)}});this.add(e),this._proxyDrag(e),e.on("dragstart",t=>{t.cancelBubble=!0}),e.on("dragmove",t=>{t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(e){if(this._transforming)return;this._movingAnchorName=e.target.name().split(" ")[0];const t=this._getNodeRect(),r=t.width,i=t.height,s=Math.sqrt(Math.pow(r,2)+Math.pow(i,2));this.sin=Math.abs(i/s),this.cos=Math.abs(r/s),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const o=e.target.getAbsolutePosition(),u=e.target.getStage().getPointerPosition();this._anchorDragOffset={x:u.x-o.x,y:u.y-o.y},Es++,this._fire("transformstart",{evt:e.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:e.evt,target:l})})}_handleMouseMove(e){let t,r,i;const s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(e);const u=o.getPointerPosition();let l={x:u.x-this._anchorDragOffset.x,y:u.y-this._anchorDragOffset.y};const c=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(c,l,e)),s.setAbsolutePosition(l);const h=s.getAbsolutePosition();if(c.x===h.x&&c.y===h.y)return;if(this._movingAnchorName==="rotater"){const C=this._getNodeRect();t=s.x()-C.width/2,r=-s.y()+C.height/2;let x=Math.atan2(-r,t)+Math.PI/2;C.height<0&&(x-=Math.PI);const W=X.getAngle(this.rotation())+x,j=X.getAngle(this.rotationSnapTolerance()),J=k1(this.rotationSnaps(),W,j)-C.rotation,K=B1(C,J);this._fitNodesInto(K,e);return}const d=this.shiftBehavior();let m;d==="inverted"?m=this.keepRatio()&&!e.shiftKey:d==="none"?m=this.keepRatio():m=this.keepRatio()||e.shiftKey;let D=this.centeredScaling()||e.altKey;if(this._movingAnchorName==="top-left"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};i=Math.sqrt(Math.pow(C.x-s.x(),2)+Math.pow(C.y-s.y(),2));const x=this.findOne(".top-left").x()>C.x?-1:1,B=this.findOne(".top-left").y()>C.y?-1:1;t=i*this.cos*x,r=i*this.sin*B,this.findOne(".top-left").x(C.x-t),this.findOne(".top-left").y(C.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(s.y());else if(this._movingAnchorName==="top-right"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};i=Math.sqrt(Math.pow(s.x()-C.x,2)+Math.pow(C.y-s.y(),2));const x=this.findOne(".top-right").x()<C.x?-1:1,B=this.findOne(".top-right").y()>C.y?-1:1;t=i*this.cos*x,r=i*this.sin*B,this.findOne(".top-right").x(C.x+t),this.findOne(".top-right").y(C.y-r)}var g=s.position();this.findOne(".top-left").y(g.y),this.findOne(".bottom-right").x(g.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(s.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(s.x());else if(this._movingAnchorName==="bottom-left"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};i=Math.sqrt(Math.pow(C.x-s.x(),2)+Math.pow(s.y()-C.y,2));const x=C.x<s.x()?-1:1,B=s.y()<C.y?-1:1;t=i*this.cos*x,r=i*this.sin*B,s.x(C.x-t),s.y(C.y+r)}g=s.position(),this.findOne(".top-left").x(g.x),this.findOne(".bottom-right").y(g.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(s.y());else if(this._movingAnchorName==="bottom-right"){if(m){const C=D?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};i=Math.sqrt(Math.pow(s.x()-C.x,2)+Math.pow(s.y()-C.y,2));const x=this.findOne(".bottom-right").x()<C.x?-1:1,B=this.findOne(".bottom-right").y()<C.y?-1:1;t=i*this.cos*x,r=i*this.sin*B,this.findOne(".bottom-right").x(C.x+t),this.findOne(".bottom-right").y(C.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(D=this.centeredScaling()||e.altKey,D){const C=this.findOne(".top-left"),x=this.findOne(".bottom-right"),B=C.x(),W=C.y(),j=this.getWidth()-x.x(),q=this.getHeight()-x.y();x.move({x:-B,y:-W}),C.move({x:j,y:q})}const F=this.findOne(".top-left").getAbsolutePosition();t=F.x,r=F.y;const T=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),E=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:t,y:r,width:T,height:E,rotation:X.getAngle(this.rotation())},e)}_handleMouseUp(e){this._removeEvents(e)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(e){var t;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const r=this.getNode();Es--,this._fire("transformend",{evt:e,target:r}),(t=this.getLayer())===null||t===void 0||t.batchDraw(),r&&this._nodes.forEach(i=>{var s;i._fire("transformend",{evt:e,target:i}),(s=i.getLayer())===null||s===void 0||s.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(e,t){const r=this._getNodeRect(),i=1;if(M._inRange(e.width,-this.padding()*2-i,i)){this.update();return}if(M._inRange(e.height,-this.padding()*2-i,i)){this.update();return}const s=new gt;if(s.rotate(X.getAngle(this.rotation())),this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("left")>=0){const m=s.point({x:-this.padding()*2,y:0});e.x+=m.x,e.y+=m.y,e.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y}else if(this._movingAnchorName&&e.width<0&&this._movingAnchorName.indexOf("right")>=0){const m=s.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.width+=this.padding()*2}if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("top")>=0){const m=s.point({x:0,y:-this.padding()*2});e.x+=m.x,e.y+=m.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}else if(this._movingAnchorName&&e.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const m=s.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=m.x,this._anchorDragOffset.y-=m.y,e.height+=this.padding()*2}if(this.boundBoxFunc()){const m=this.boundBoxFunc()(r,e);m?e=m:M.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const o=1e7,u=new gt;u.translate(r.x,r.y),u.rotate(r.rotation),u.scale(r.width/o,r.height/o);const l=new gt,c=e.width/o,h=e.height/o;this.flipEnabled()===!1?(l.translate(e.x,e.y),l.rotate(e.rotation),l.translate(e.width<0?e.width:0,e.height<0?e.height:0),l.scale(Math.abs(c),Math.abs(h))):(l.translate(e.x,e.y),l.rotate(e.rotation),l.scale(c,h));const d=l.multiply(u.invert());this._nodes.forEach(m=>{var D;if(!m.getStage())return;const g=m.getParent().getAbsoluteTransform(),F=m.getTransform().copy();F.translate(m.offsetX(),m.offsetY());const T=new gt;T.multiply(g.copy().invert()).multiply(d).multiply(g).multiply(F);const E=T.decompose();m.setAttrs(E),(D=m.getLayer())===null||D===void 0||D.batchDraw()}),this.rotation(M._getRotation(e.rotation)),this._nodes.forEach(m=>{this._fire("transform",{evt:t,target:m}),m._fire("transform",{evt:t,target:m})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(e,t){this.findOne(e).setAttrs(t)}update(){var e;const t=this._getNodeRect();this.rotation(M._getRotation(t.rotation));const r=t.width,i=t.height,s=this.enabledAnchors(),o=this.resizeEnabled(),u=this.padding(),l=this.anchorSize(),c=this.find("._anchor");c.forEach(d=>{d.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+u,offsetY:l/2+u,visible:o&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:l/2+u,visible:o&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:l/2-u,offsetY:l/2+u,visible:o&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:i/2,offsetX:l/2+u,visible:o&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:i/2,offsetX:l/2-u,visible:o&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:i,offsetX:l/2+u,offsetY:l/2-u,visible:o&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:i,offsetY:l/2-u,visible:o&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:i,offsetX:l/2-u,offsetY:l/2-u,visible:o&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*M._sign(i)-u,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:i,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),draggable:this.nodes().some(d=>d.draggable()),x:0,y:0});const h=this.anchorStyleFunc();h&&c.forEach(d=>{h(d)}),(e=this.getLayer())===null||e===void 0||e.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const e=this.findOne("."+this._movingAnchorName);e&&e.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),sr.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return z.prototype.toObject.call(this)}clone(e){return z.prototype.clone.call(this,e)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}De.isTransforming=()=>Es>0;function R1(n){return n instanceof Array||M.warn("enabledAnchors value should be an array"),n instanceof Array&&n.forEach(function(e){wi.indexOf(e)===-1&&M.warn("Unknown anchor name: "+e+". Available names are: "+wi.join(", "))}),n||[]}De.prototype.className="Transformer";We(De);y.addGetterSetter(De,"enabledAnchors",wi,R1);y.addGetterSetter(De,"flipEnabled",!0,Bt());y.addGetterSetter(De,"resizeEnabled",!0);y.addGetterSetter(De,"anchorSize",10,U());y.addGetterSetter(De,"rotateEnabled",!0);y.addGetterSetter(De,"rotateLineVisible",!0);y.addGetterSetter(De,"rotationSnaps",[]);y.addGetterSetter(De,"rotateAnchorOffset",50,U());y.addGetterSetter(De,"rotateAnchorCursor","crosshair");y.addGetterSetter(De,"rotationSnapTolerance",5,U());y.addGetterSetter(De,"borderEnabled",!0);y.addGetterSetter(De,"anchorStroke","rgb(0, 161, 255)");y.addGetterSetter(De,"anchorStrokeWidth",1,U());y.addGetterSetter(De,"anchorFill","white");y.addGetterSetter(De,"anchorCornerRadius",0,U());y.addGetterSetter(De,"borderStroke","rgb(0, 161, 255)");y.addGetterSetter(De,"borderStrokeWidth",1,U());y.addGetterSetter(De,"borderDash");y.addGetterSetter(De,"keepRatio",!0);y.addGetterSetter(De,"shiftBehavior","default");y.addGetterSetter(De,"centeredScaling",!1);y.addGetterSetter(De,"ignoreStroke",!1);y.addGetterSetter(De,"padding",0,U());y.addGetterSetter(De,"nodes");y.addGetterSetter(De,"node");y.addGetterSetter(De,"boundBoxFunc");y.addGetterSetter(De,"anchorDragBoundFunc");y.addGetterSetter(De,"anchorStyleFunc");y.addGetterSetter(De,"shouldOverdrawWholeArea",!1);y.addGetterSetter(De,"useSingleNodeRotation",!0);y.backCompat(De,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class on extends V{_sceneFunc(e){e.beginPath(),e.arc(0,0,this.radius(),0,X.getAngle(this.angle()),this.clockwise()),e.lineTo(0,0),e.closePath(),e.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(e){this.radius(e/2)}setHeight(e){this.radius(e/2)}}on.prototype.className="Wedge";on.prototype._centroid=!0;on.prototype._attrsAffectingSize=["radius"];We(on);y.addGetterSetter(on,"radius",0,U());y.addGetterSetter(on,"angle",0,U());y.addGetterSetter(on,"clockwise",!1);y.backCompat(on,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});function Ro(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}const L1=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],O1=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function I1(n,e){const t=n.data,r=n.width,i=n.height;let s,o,u,l,c,h,d,m,D,g,F,T,E,C,x,B,W,j,q,J;const K=e+e+1,re=r-1,oe=i-1,_=e+1,A=_*(_+1)/2,v=new Ro,S=L1[e],O=O1[e];let I=null,R=v,Y=null,fe=null;for(let _e=1;_e<K;_e++)R=R.next=new Ro,_e===_&&(I=R);R.next=v,u=o=0;for(let _e=0;_e<i;_e++){T=E=C=x=l=c=h=d=0,m=_*(B=t[o]),D=_*(W=t[o+1]),g=_*(j=t[o+2]),F=_*(q=t[o+3]),l+=A*B,c+=A*W,h+=A*j,d+=A*q,R=v;for(let Re=0;Re<_;Re++)R.r=B,R.g=W,R.b=j,R.a=q,R=R.next;for(let Re=1;Re<_;Re++)s=o+((re<Re?re:Re)<<2),l+=(R.r=B=t[s])*(J=_-Re),c+=(R.g=W=t[s+1])*J,h+=(R.b=j=t[s+2])*J,d+=(R.a=q=t[s+3])*J,T+=B,E+=W,C+=j,x+=q,R=R.next;Y=v,fe=I;for(let Re=0;Re<r;Re++)t[o+3]=q=d*S>>O,q!==0?(q=255/q,t[o]=(l*S>>O)*q,t[o+1]=(c*S>>O)*q,t[o+2]=(h*S>>O)*q):t[o]=t[o+1]=t[o+2]=0,l-=m,c-=D,h-=g,d-=F,m-=Y.r,D-=Y.g,g-=Y.b,F-=Y.a,s=u+((s=Re+e+1)<re?s:re)<<2,T+=Y.r=t[s],E+=Y.g=t[s+1],C+=Y.b=t[s+2],x+=Y.a=t[s+3],l+=T,c+=E,h+=C,d+=x,Y=Y.next,m+=B=fe.r,D+=W=fe.g,g+=j=fe.b,F+=q=fe.a,T-=B,E-=W,C-=j,x-=q,fe=fe.next,o+=4;u+=r}for(let _e=0;_e<r;_e++){E=C=x=T=c=h=d=l=0,o=_e<<2,m=_*(B=t[o]),D=_*(W=t[o+1]),g=_*(j=t[o+2]),F=_*(q=t[o+3]),l+=A*B,c+=A*W,h+=A*j,d+=A*q,R=v;for(let Me=0;Me<_;Me++)R.r=B,R.g=W,R.b=j,R.a=q,R=R.next;let Re=r;for(let Me=1;Me<=e;Me++)o=Re+_e<<2,l+=(R.r=B=t[o])*(J=_-Me),c+=(R.g=W=t[o+1])*J,h+=(R.b=j=t[o+2])*J,d+=(R.a=q=t[o+3])*J,T+=B,E+=W,C+=j,x+=q,R=R.next,Me<oe&&(Re+=r);o=_e,Y=v,fe=I;for(let Me=0;Me<i;Me++)s=o<<2,t[s+3]=q=d*S>>O,q>0?(q=255/q,t[s]=(l*S>>O)*q,t[s+1]=(c*S>>O)*q,t[s+2]=(h*S>>O)*q):t[s]=t[s+1]=t[s+2]=0,l-=m,c-=D,h-=g,d-=F,m-=Y.r,D-=Y.g,g-=Y.b,F-=Y.a,s=_e+((s=Me+_)<oe?s:oe)*r<<2,l+=T+=Y.r=t[s],c+=E+=Y.g=t[s+1],h+=C+=Y.b=t[s+2],d+=x+=Y.a=t[s+3],Y=Y.next,m+=B=fe.r,D+=W=fe.g,g+=j=fe.b,F+=q=fe.a,T-=B,E-=W,C-=j,x-=q,fe=fe.next,o+=r}}const N1=function(e){const t=Math.round(this.blurRadius());t>0&&I1(e,t)};y.addGetterSetter(z,"blurRadius",0,U(),y.afterSetFilter);const G1=function(n){const e=this.brightness()*255,t=n.data,r=t.length;for(let i=0;i<r;i+=4)t[i]+=e,t[i+1]+=e,t[i+2]+=e};y.addGetterSetter(z,"brightness",0,U(),y.afterSetFilter);const H1=function(n){const e=this.brightness(),t=n.data,r=t.length;for(let i=0;i<r;i+=4)t[i]=Math.min(255,t[i]*e),t[i+1]=Math.min(255,t[i+1]*e),t[i+2]=Math.min(255,t[i+2]*e)},W1=function(n){const e=Math.pow((this.contrast()+100)/100,2),t=n.data,r=t.length;let i=150,s=150,o=150;for(let u=0;u<r;u+=4)i=t[u],s=t[u+1],o=t[u+2],i/=255,i-=.5,i*=e,i+=.5,i*=255,s/=255,s-=.5,s*=e,s+=.5,s*=255,o/=255,o-=.5,o*=e,o+=.5,o*=255,i=i<0?0:i>255?255:i,s=s<0?0:s>255?255:s,o=o<0?0:o>255?255:o,t[u]=i,t[u+1]=s,t[u+2]=o};y.addGetterSetter(z,"contrast",0,U(),y.afterSetFilter);const V1=function(n){var e,t,r,i,s,o,u,l,c;const h=n.data,d=n.width,m=n.height,D=Math.min(1,Math.max(0,(t=(e=this.embossStrength)===null||e===void 0?void 0:e.call(this))!==null&&t!==void 0?t:.5)),g=Math.min(1,Math.max(0,(i=(r=this.embossWhiteLevel)===null||r===void 0?void 0:r.call(this))!==null&&i!==void 0?i:.5)),T=(u={"top-left":315,top:270,"top-right":225,right:180,"bottom-right":135,bottom:90,"bottom-left":45,left:0}[(o=(s=this.embossDirection)===null||s===void 0?void 0:s.call(this))!==null&&o!==void 0?o:"top-left"])!==null&&u!==void 0?u:315,E=!!((c=(l=this.embossBlend)===null||l===void 0?void 0:l.call(this))!==null&&c!==void 0&&c),C=D*10,x=g*255,B=T*Math.PI/180,W=Math.cos(B),j=Math.sin(B),q=128/1020*C,J=new Uint8ClampedArray(h),K=new Float32Array(d*m);for(let v=0,S=0;S<h.length;S+=4,v++)K[v]=.2126*J[S]+.7152*J[S+1]+.0722*J[S+2];const re=[-1,0,1,-2,0,2,-1,0,1],oe=[-1,-2,-1,0,0,0,1,2,1],_=[-d-1,-d,-d+1,-1,0,1,d-1,d,d+1],A=v=>v<0?0:v>255?255:v;for(let v=1;v<m-1;v++)for(let S=1;S<d-1;S++){const O=v*d+S;let I=0,R=0;I+=K[O+_[0]]*re[0],R+=K[O+_[0]]*oe[0],I+=K[O+_[1]]*re[1],R+=K[O+_[1]]*oe[1],I+=K[O+_[2]]*re[2],R+=K[O+_[2]]*oe[2],I+=K[O+_[3]]*re[3],R+=K[O+_[3]]*oe[3],I+=K[O+_[5]]*re[5],R+=K[O+_[5]]*oe[5],I+=K[O+_[6]]*re[6],R+=K[O+_[6]]*oe[6],I+=K[O+_[7]]*re[7],R+=K[O+_[7]]*oe[7],I+=K[O+_[8]]*re[8],R+=K[O+_[8]]*oe[8];const Y=W*I+j*R,fe=A(x+Y*q),_e=O*4;if(E){const Re=fe-x;h[_e]=A(J[_e]+Re),h[_e+1]=A(J[_e+1]+Re),h[_e+2]=A(J[_e+2]+Re),h[_e+3]=J[_e+3]}else h[_e]=h[_e+1]=h[_e+2]=fe,h[_e+3]=J[_e+3]}for(let v=0;v<d;v++){let S=v*4,O=((m-1)*d+v)*4;h[S]=J[S],h[S+1]=J[S+1],h[S+2]=J[S+2],h[S+3]=J[S+3],h[O]=J[O],h[O+1]=J[O+1],h[O+2]=J[O+2],h[O+3]=J[O+3]}for(let v=1;v<m-1;v++){let S=v*d*4,O=(v*d+(d-1))*4;h[S]=J[S],h[S+1]=J[S+1],h[S+2]=J[S+2],h[S+3]=J[S+3],h[O]=J[O],h[O+1]=J[O+1],h[O+2]=J[O+2],h[O+3]=J[O+3]}return n};y.addGetterSetter(z,"embossStrength",.5,U(),y.afterSetFilter);y.addGetterSetter(z,"embossWhiteLevel",.5,U(),y.afterSetFilter);y.addGetterSetter(z,"embossDirection","top-left",void 0,y.afterSetFilter);y.addGetterSetter(z,"embossBlend",!1,void 0,y.afterSetFilter);function ss(n,e,t,r,i){const s=t-e,o=i-r;if(s===0)return r+o/2;if(o===0)return r;let u=(n-e)/s;return u=o*u+r,u}const z1=function(n){const e=n.data,t=e.length;let r=e[0],i=r,s,o=e[1],u=o,l,c=e[2],h=c,d;const m=this.enhance();if(m===0)return;for(let x=0;x<t;x+=4)s=e[x+0],s<r?r=s:s>i&&(i=s),l=e[x+1],l<o?o=l:l>u&&(u=l),d=e[x+2],d<c?c=d:d>h&&(h=d);i===r&&(i=255,r=0),u===o&&(u=255,o=0),h===c&&(h=255,c=0);let D,g,F,T,E,C;if(m>0)D=i+m*(255-i),g=r-m*(r-0),F=u+m*(255-u),T=o-m*(o-0),E=h+m*(255-h),C=c-m*(c-0);else{const x=(i+r)*.5;D=i+m*(i-x),g=r+m*(r-x);const B=(u+o)*.5;F=u+m*(u-B),T=o+m*(o-B);const W=(h+c)*.5;E=h+m*(h-W),C=c+m*(c-W)}for(let x=0;x<t;x+=4)e[x+0]=ss(e[x+0],r,i,g,D),e[x+1]=ss(e[x+1],o,u,T,F),e[x+2]=ss(e[x+2],c,h,C,E)};y.addGetterSetter(z,"enhance",0,U(),y.afterSetFilter);const j1=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const i=.34*e[r]+.5*e[r+1]+.16*e[r+2];e[r]=i,e[r+1]=i,e[r+2]=i}};y.addGetterSetter(z,"hue",0,U(),y.afterSetFilter);y.addGetterSetter(z,"saturation",0,U(),y.afterSetFilter);y.addGetterSetter(z,"luminance",0,U(),y.afterSetFilter);const U1=function(n){const e=n.data,t=e.length,r=1,i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=this.luminance()*127,u=r*i*Math.cos(s*Math.PI/180),l=r*i*Math.sin(s*Math.PI/180),c=.299*r+.701*u+.167*l,h=.587*r-.587*u+.33*l,d=.114*r-.114*u-.497*l,m=.299*r-.299*u-.328*l,D=.587*r+.413*u+.035*l,g=.114*r-.114*u+.293*l,F=.299*r-.3*u+1.25*l,T=.587*r-.586*u-1.05*l,E=.114*r+.886*u-.2*l;let C,x,B,W;for(let j=0;j<t;j+=4)C=e[j+0],x=e[j+1],B=e[j+2],W=e[j+3],e[j+0]=c*C+h*x+d*B+o,e[j+1]=m*C+D*x+g*B+o,e[j+2]=F*C+T*x+E*B+o,e[j+3]=W},X1=function(n){const e=n.data,t=e.length,r=Math.pow(2,this.value()),i=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=r*i*Math.cos(s*Math.PI/180),u=r*i*Math.sin(s*Math.PI/180),l=.299*r+.701*o+.167*u,c=.587*r-.587*o+.33*u,h=.114*r-.114*o-.497*u,d=.299*r-.299*o-.328*u,m=.587*r+.413*o+.035*u,D=.114*r-.114*o+.293*u,g=.299*r-.3*o+1.25*u,F=.587*r-.586*o-1.05*u,T=.114*r+.886*o-.2*u;for(let E=0;E<t;E+=4){const C=e[E+0],x=e[E+1],B=e[E+2],W=e[E+3];e[E+0]=l*C+c*x+h*B,e[E+1]=d*C+m*x+D*B,e[E+2]=g*C+F*x+T*B,e[E+3]=W}};y.addGetterSetter(z,"hue",0,U(),y.afterSetFilter);y.addGetterSetter(z,"saturation",0,U(),y.afterSetFilter);y.addGetterSetter(z,"value",0,U(),y.afterSetFilter);const K1=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]},Y1=function(n,e,t){const r=n.data,i=e.data,s=n.width,o=n.height,u=t.polarCenterX||s/2,l=t.polarCenterY||o/2;let c=Math.sqrt(u*u+l*l),h=s-u,d=o-l;const m=Math.sqrt(h*h+d*d);c=m>c?m:c;const D=o,g=s,F=360/g*Math.PI/180;for(let T=0;T<g;T+=1){const E=Math.sin(T*F),C=Math.cos(T*F);for(let x=0;x<D;x+=1){h=Math.floor(u+c*x/D*C),d=Math.floor(l+c*x/D*E);let B=(d*s+h)*4;const W=r[B+0],j=r[B+1],q=r[B+2],J=r[B+3];B=(T+x*s)*4,i[B+0]=W,i[B+1]=j,i[B+2]=q,i[B+3]=J}}},q1=function(n,e,t){const r=n.data,i=e.data,s=n.width,o=n.height,u=t.polarCenterX||s/2,l=t.polarCenterY||o/2;let c=Math.sqrt(u*u+l*l),h=s-u,d=o-l;const m=Math.sqrt(h*h+d*d);c=m>c?m:c;const D=o,g=s,F=0;let T,E;for(h=0;h<s;h+=1)for(d=0;d<o;d+=1){const C=h-u,x=d-l,B=Math.sqrt(C*C+x*x)*D/c;let W=(Math.atan2(x,C)*180/Math.PI+360+F)%360;W=W*g/360,T=Math.floor(W),E=Math.floor(B);let j=(E*s+T)*4;const q=r[j+0],J=r[j+1],K=r[j+2],re=r[j+3];j=(d*s+h)*4,i[j+0]=q,i[j+1]=J,i[j+2]=K,i[j+3]=re}},J1=function(n){const e=n.width,t=n.height;let r,i,s,o,u,l,c,h,d,m,D=Math.round(this.kaleidoscopePower());const g=Math.round(this.kaleidoscopeAngle()),F=Math.floor(e*(g%360)/360);if(D<1)return;const T=M.createCanvasElement();T.width=e,T.height=t;const E=T.getContext("2d").getImageData(0,0,e,t);M.releaseCanvas(T),Y1(n,E,{polarCenterX:e/2,polarCenterY:t/2});let C=e/Math.pow(2,D);for(;C<=8;)C=C*2,D-=1;C=Math.ceil(C);let x=C,B=0,W=x,j=1;for(F+C>e&&(B=x,W=0,j=-1),i=0;i<t;i+=1)for(r=B;r!==W;r+=j)s=Math.round(r+F)%e,d=(e*i+s)*4,u=E.data[d+0],l=E.data[d+1],c=E.data[d+2],h=E.data[d+3],m=(e*i+r)*4,E.data[m+0]=u,E.data[m+1]=l,E.data[m+2]=c,E.data[m+3]=h;for(i=0;i<t;i+=1)for(x=Math.floor(C),o=0;o<D;o+=1){for(r=0;r<x+1;r+=1)d=(e*i+r)*4,u=E.data[d+0],l=E.data[d+1],c=E.data[d+2],h=E.data[d+3],m=(e*i+x*2-r-1)*4,E.data[m+0]=u,E.data[m+1]=l,E.data[m+2]=c,E.data[m+3]=h;x*=2}q1(E,n,{})};y.addGetterSetter(z,"kaleidoscopePower",2,U(),y.afterSetFilter);y.addGetterSetter(z,"kaleidoscopeAngle",0,U(),y.afterSetFilter);function di(n,e,t){let r=(t*n.width+e)*4;const i=[];return i.push(n.data[r++],n.data[r++],n.data[r++],n.data[r++]),i}function Sr(n,e){return Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2))}function Q1(n){const e=[0,0,0];for(let t=0;t<n.length;t++)e[0]+=n[t][0],e[1]+=n[t][1],e[2]+=n[t][2];return e[0]/=n.length,e[1]/=n.length,e[2]/=n.length,e}function Z1(n,e){const t=di(n,0,0),r=di(n,n.width-1,0),i=di(n,0,n.height-1),s=di(n,n.width-1,n.height-1),o=e||10;if(Sr(t,r)<o&&Sr(r,s)<o&&Sr(s,i)<o&&Sr(i,t)<o){const u=Q1([r,t,s,i]),l=[];for(let c=0;c<n.width*n.height;c++){const h=Sr(u,[n.data[c*4],n.data[c*4+1],n.data[c*4+2]]);l[c]=h<o?0:255}return l}}function $1(n,e){for(let t=0;t<n.width*n.height;t++)n.data[4*t+3]=e[t]}function em(n,e,t){const r=[1,1,1,1,0,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,g=l+m-s;if(D>=0&&D<t&&g>=0&&g<e){const F=D*e+g,T=r[d*i+m];h+=n[F]*T}}o[c]=h===2040?255:0}return o}function tm(n,e,t){const r=[1,1,1,1,1,1,1,1,1],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,g=l+m-s;if(D>=0&&D<t&&g>=0&&g<e){const F=D*e+g,T=r[d*i+m];h+=n[F]*T}}o[c]=h>=1020?255:0}return o}function nm(n,e,t){const r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],i=Math.round(Math.sqrt(r.length)),s=Math.floor(i/2),o=[];for(let u=0;u<t;u++)for(let l=0;l<e;l++){const c=u*e+l;let h=0;for(let d=0;d<i;d++)for(let m=0;m<i;m++){const D=u+d-s,g=l+m-s;if(D>=0&&D<t&&g>=0&&g<e){const F=D*e+g,T=r[d*i+m];h+=n[F]*T}}o[c]=h}return o}const rm=function(n){const e=this.threshold();let t=Z1(n,e);return t&&(t=em(t,n.width,n.height),t=tm(t,n.width,n.height),t=nm(t,n.width,n.height),$1(n,t)),n};y.addGetterSetter(z,"threshold",0,U(),y.afterSetFilter);const im=function(n){const e=this.noise()*255,t=n.data,r=t.length,i=e/2;for(let s=0;s<r;s+=4)t[s+0]+=i-2*i*Math.random(),t[s+1]+=i-2*i*Math.random(),t[s+2]+=i-2*i*Math.random()};y.addGetterSetter(z,"noise",.2,U(),y.afterSetFilter);const sm=function(n){let e=Math.ceil(this.pixelSize()),t=n.width,r=n.height,i=Math.ceil(t/e),s=Math.ceil(r/e),o=n.data;if(e<=0){M.error("pixelSize value can not be <= 0");return}for(let u=0;u<i;u+=1)for(let l=0;l<s;l+=1){let c=0,h=0,d=0,m=0;const D=u*e,g=D+e,F=l*e,T=F+e;let E=0;for(let C=D;C<g;C+=1)if(!(C>=t))for(let x=F;x<T;x+=1){if(x>=r)continue;const B=(t*x+C)*4;c+=o[B+0],h+=o[B+1],d+=o[B+2],m+=o[B+3],E+=1}c=c/E,h=h/E,d=d/E,m=m/E;for(let C=D;C<g;C+=1)if(!(C>=t))for(let x=F;x<T;x+=1){if(x>=r)continue;const B=(t*x+C)*4;o[B+0]=c,o[B+1]=h,o[B+2]=d,o[B+3]=m}}};y.addGetterSetter(z,"pixelSize",8,U(),y.afterSetFilter);const am=function(n){const e=Math.round(this.levels()*254)+1,t=n.data,r=t.length,i=255/e;for(let s=0;s<r;s+=1)t[s]=Math.floor(t[s]/i)*i};y.addGetterSetter(z,"levels",.5,U(),y.afterSetFilter);const om=function(n){const e=n.data,t=e.length,r=this.red(),i=this.green(),s=this.blue();for(let o=0;o<t;o+=4){const u=(.34*e[o]+.5*e[o+1]+.16*e[o+2])/255;e[o]=u*r,e[o+1]=u*i,e[o+2]=u*s,e[o+3]=e[o+3]}};y.addGetterSetter(z,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});y.addGetterSetter(z,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});y.addGetterSetter(z,"blue",0,Bu,y.afterSetFilter);const um=function(n){const e=n.data,t=e.length,r=this.red(),i=this.green(),s=this.blue(),o=this.alpha();for(let u=0;u<t;u+=4){const l=1-o;e[u]=r*o+e[u]*l,e[u+1]=i*o+e[u+1]*l,e[u+2]=s*o+e[u+2]*l}};y.addGetterSetter(z,"red",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});y.addGetterSetter(z,"green",0,function(n){return this._filterUpToDate=!1,n>255?255:n<0?0:Math.round(n)});y.addGetterSetter(z,"blue",0,Bu,y.afterSetFilter);y.addGetterSetter(z,"alpha",1,function(n){return this._filterUpToDate=!1,n>1?1:n<0?0:n});const lm=function(n){const e=n.data,t=e.length;for(let r=0;r<t;r+=4){const i=e[r+0],s=e[r+1],o=e[r+2];e[r+0]=Math.min(255,i*.393+s*.769+o*.189),e[r+1]=Math.min(255,i*.349+s*.686+o*.168),e[r+2]=Math.min(255,i*.272+s*.534+o*.131)}},cm=function(n){const t=n.data;for(let r=0;r<t.length;r+=4){const i=t[r],s=t[r+1],o=t[r+2];.2126*i+.7152*s+.0722*o>=128&&(t[r]=255-i,t[r+1]=255-s,t[r+2]=255-o)}return n},hm=function(n){const e=this.threshold()*255,t=n.data,r=t.length;for(let i=0;i<r;i+=1)t[i]=t[i]<e?0:255};y.addGetterSetter(z,"threshold",.5,U(),y.afterSetFilter);const Se=vo.Util._assign(vo,{Arc:sn,Arrow:In,Circle:or,Ellipse:bn,Image:bt,Label:ra,Tag:Nn,Line:an,Path:Oe,Rect:jr,RegularPolygon:Sn,Ring:Gn,Sprite:Ht,Star:yn,Text:Ge,TextPath:qe,Transformer:De,Wedge:on,Filters:{Blur:N1,Brightness:H1,Brighten:G1,Contrast:W1,Emboss:V1,Enhance:z1,Grayscale:j1,HSL:U1,HSV:X1,Invert:K1,Kaleidoscope:J1,Mask:rm,Noise:im,Pixelate:sm,Posterize:am,RGB:om,RGBA:um,Sepia:lm,Solarize:cm,Threshold:hm}});function vi(n){if(!Se.autoDrawEnabled){const e=n.getLayer()||n.getStage();e&&e.batchDraw()}}const Lo={key:!0,style:!0,elm:!0,isRootInsert:!0},as=".vue-konva-event";function ll(n,e,t,r){const i=n.__konvaNode,s={};let o=!1;for(let u in t){if(Lo.hasOwnProperty(u))continue;const l=u.slice(0,2)==="on",c=t[u]!==e[u];if(l&&c){let h=u.slice(2).toLowerCase();h.slice(0,7)==="content"&&(h="content"+h.slice(7,1).toUpperCase()+h.slice(8)),i?.off(h+as,t[u])}!e.hasOwnProperty(u)&&i?.setAttr(u,void 0)}for(let u in e){if(Lo.hasOwnProperty(u))continue;let l=u.slice(0,2)==="on";const c=t[u]!==e[u];if(l&&c){let h=u.slice(2).toLowerCase();h.slice(0,7)==="content"&&(h="content"+h.slice(7,1).toUpperCase()+h.slice(8)),e[u]&&(i?.off(h+as),i?.on(h+as,e[u]))}!l&&(e[u]!==t[u]||r&&e[u]!==i?.getAttr(u))&&(o=!0,s[u]=e[u])}o&&i&&(i.setAttrs(s),vi(i))}const dm="V";function fm(n){function e(t){return t?.__konvaNode?t:t?.parent?e(t.parent):(console.error("vue-konva error: Can not find parent node"),null)}return e(n.parent)}function cl(n){return n.component?n.component.__konvaNode||cl(n.component.subTree):null}function mm(n){const{el:e,component:t}=n,r=cl(n);if(e?.tagName&&t&&!r){const i=e.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${i}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return r}function pm(n){const e=i=>!!i&&typeof i=="object"&&"component"in i,t=i=>Array.isArray(i),r=i=>e(i)?[i,...r(i.children)]:t(i)?i.flatMap(r):[];return r(n.children)}function hl(n,e){const t=pm(n),r=[];t.forEach(s=>{const o=mm(s);o&&r.push(o)});let i=!1;r.forEach((s,o)=>{s.getZIndex()!==o&&(s.setZIndex(o),i=!0)}),i&&vi(e)}const gm=Se.default?.Stage||Se.Stage,_m=Dt({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(n,{attrs:e,slots:t,expose:r}){const i=zo();if(!i)return;const s=Vo({}),o=qt(null),u=new gm({width:n.config.width,height:n.config.height,container:document.createElement("div")});i.__konvaNode=u,h();function l(){return i?.__konvaNode}function c(){return i?.__konvaNode}function h(){if(!i)return;const d=s||{},m={...e,...n.config};ll(i,m,d,n.__useStrictMode),Object.assign(s,m)}return Ti(()=>{o.value&&(o.value.innerHTML="",u.container(o.value)),h()}),Uo(()=>{h(),hl(i.subTree,u)}),Ms(()=>{u.destroy()}),nr(()=>n.config,h,{deep:!0}),r({getStage:c,getNode:l}),()=>jo("div",{ref:o,style:e?.style},t.default?.())}}),Dm=".vue-konva-event",bm={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function Ve(n,e){return Dt({name:n,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(t,{attrs:r,slots:i,expose:s}){const o=zo();if(!o)return;const u=Vo({}),l=new e;o.__konvaNode=l,o.vnode.__konvaNode=l,d();function c(){return o?.__konvaNode}function h(){return o?.__konvaNode}function d(){if(!o)return;const D={};for(const T in o?.vnode.props)T.slice(0,2)==="on"&&(D[T]=o.vnode.props[T]);const g=u||{},F={...r,...t.config,...D};ll(o,F,g,t.__useStrictMode),Object.assign(u,F)}Ti(()=>{const D=fm(o)?.__konvaNode;D&&"add"in D&&D.add(l),vi(l)}),Pc(()=>{vi(l),l.destroy(),l.off(Dm)}),Uo(()=>{d(),hl(o.subTree,l)}),nr(()=>t.config,d,{deep:!0}),s({getStage:h,getNode:c});const m=bm.hasOwnProperty(n);return()=>m?jo("template",{},i.default?.()):null}})}const ze=Se.default||Se,Sm=Ve("Arc",ze.Arc),ym=Ve("Arrow",ze.Arrow),wm=Ve("Circle",ze.Circle),vm=Ve("Ellipse",ze.Ellipse),Em=Ve("FastLayer",ze.FastLayer),Am=Ve("Group",ze.Group),Fm=Ve("Image",ze.Image),Pm=Ve("Label",ze.Label),Tm=Ve("Layer",ze.Layer),Cm=Ve("Line",ze.Line),Mm=Ve("Path",ze.Path),xm=Ve("Rect",ze.Rect),Bm=Ve("RegularPolygon",ze.RegularPolygon),km=Ve("Ring",ze.Ring),Rm=Ve("Shape",ze.Shape),Lm=Ve("Sprite",ze.Sprite),Om=Ve("Star",ze.Star),Im=Ve("Tag",ze.Tag),Nm=Ve("Text",ze.Text),Gm=Ve("TextPath",ze.TextPath),Hm=Ve("Transformer",ze.Transformer),Wm=Ve("Wedge",ze.Wedge),Vm=Object.freeze(Object.defineProperty({__proto__:null,Arc:Sm,Arrow:ym,Circle:wm,Ellipse:vm,FastLayer:Em,Group:Am,Image:Fm,Label:Pm,Layer:Tm,Line:Cm,Path:Mm,Rect:xm,RegularPolygon:Bm,Ring:km,Shape:Rm,Sprite:Lm,Star:Om,Tag:Im,Text:Nm,TextPath:Gm,Transformer:Hm,Wedge:Wm},Symbol.toStringTag,{value:"Module"})),zm={install:(n,e)=>{const t=e?.prefix||dm,r=e?.customNodes?Object.entries(e.customNodes).map(([i,s])=>Ve(i,s)):[];[_m,...Object.values(Vm),...r].forEach(i=>{n.component(`${t}${i.name}`,i)})}},jm={};function Um(n,e){return null}const Xm=Gi(jm,[["render",Um]]);function As(n){return{keys:n.totalColumns,od:n.difficulty.overallDifficulty,notes:n.hitObjects.map(e=>({start:e.startTime,end:e instanceof kn?e.endTime:void 0,column:e.column})),timingPoints:n.controlPoints.timingPoints.map(e=>({time:e.startTime,bpm:e.bpm,meter:e.timeSignature}))}}function Km(n,e){return e.map(t=>({time:t.startTime,keyStates:Array.from({length:n},(r,i)=>t.actions.has(i+10))}))}const Ym=["#FFFFFF","#5EAEFF","#FFEC5E","#FF3F00"],qm={1:[0],2:[0,0],3:[0,1,0],4:[0,1,1,0],5:[0,1,2,1,0],6:[0,1,0,0,1,0],7:[0,1,0,2,0,1,0],8:[0,1,0,2,2,0,1,0],9:[3,0,1,0,2,0,1,0,3],10:[3,0,1,0,2,2,0,1,0,3],12:[3,1,0,1,0,2,2,0,1,0,1,3],14:[3,0,1,0,1,0,2,2,0,1,0,1,0,3],16:[3,1,0,1,0,1,0,2,2,0,1,0,1,0,1,3],18:[3,0,1,0,1,0,1,0,2,2,0,1,0,1,0,1,0,3]};function Jm(n=Ym,e=qm){return(t,r)=>{const i=e[t];if(!i)throw new Error(`Unsupported keys: ${t}`);const s=i[r.column];if(s===void 0)throw new Error(`Invalid column: ${r.column} for ${t}K`);return n[s]}}const Qm={background:{enabled:!0,color:"#000000",createElement:e2},note:{width:20,height:6,rx:2,bodyWidth:10,bodyColor:"#CCCCCC",colorSelector:Jm(),createElement:t2},time:{start:"auto",end:"auto",scale:.1,direction:"up"},barline:{strokeWidth:1,color:"#85F000",createElement:n2},axis:{width:30,minute:{color:"#FF3F00",strokeWidth:2,fontSize:18},second:{color:"#FFFFFF",strokeWidth:1,fontSize:18},createElement:i2},strip:{mode:"num",num:8,time:3e4,ratio:1.5},layout:{margin:[10,10],finalScale:1,targetSize:void 0}};function Zm(n,e){let o=e.time.start==="auto"?Math.max(0,n.timingPoints[0].time):e.time.start,u=e.time.end==="auto"?n.notes.reduce((C,x)=>Math.max(C,x.end??x.start),o):e.time.end;u+=e.note.height/e.time.scale;const l=C=>{const x=n.keys*e.note.width+e.axis.width,B=(u-o)*e.time.scale/C,W=C*x,j=B;return[x,B,W,j,e.layout.margin[0]*2+W,e.layout.margin[1]*2+j]};let c;if(e.strip.mode==="num"){if(e.strip.num===void 0)throw new Error('Strip num must be specified when strip mode is "num"');if(e.strip.num<=0||e.strip.num>50)throw new Error("Invalid strip.num: must be in (0, 50]");c=e.strip.num}else if(e.strip.mode==="time"){if(e.strip.time===void 0)throw new Error('Strip time must be specified when strip mode is "time"');if(e.strip.time<=0)throw new Error("Invalid strip.time: must be a positive number");if(c=Math.ceil((u-o)/e.strip.time),c=Math.min(c,50),c<=0)throw new Error("Computed strip number is zero; check strip.time and time range");u=o+c*e.strip.time}else if(e.strip.mode==="ratio"){if(e.strip.ratio===void 0)throw new Error('Strip ratio must be specified when strip mode is "ratio"');if(e.strip.ratio<=0)throw new Error("Invalid strip.ratio: must be a positive number");if(e.strip.ratio>20)throw new Error("strip.ratio is too large; maximum allowed is 20");c=1;let C=0;for(;c<=50;){const[,,,,x,B]=l(c),W=x/B;if(W>=e.strip.ratio){e.strip.ratio-C<W-e.strip.ratio&&(c-=1);break}c++,C=W}}else throw new Error(`Unsupported strip mode: ${e.strip.mode}`);let[h,d,m,D,g,F]=l(c),T=e.layout.finalScale,E=[...e.layout.margin];if(e.layout.targetSize){let[C,x]=e.layout.targetSize;if(C<32||C>2e4||x<32||x>2e4)throw new Error("layout.targetSize dimensions must be within [32, 20000]");const B=C/g,W=x/F;T=Math.min(T,B,W),E[0]=Math.max(E[0],(C/T-m)/2),E[1]=Math.max(E[1],(x/T-D)/2),g=E[0]*2+m,F=E[1]*2+D}return{beatmap:n,...e,time:{start:o,end:u,scale:e.time.scale,direction:e.time.direction},strip:{num:c,width:h,height:d},margin:E,totalWidth:g,totalHeight:F,finalScale:T}}function dl(n,e){const t={...n};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r],s=n[r];i!==void 0&&(typeof i=="object"&&i!==null&&!Array.isArray(i)&&typeof s=="object"&&s!==null&&!Array.isArray(s)?t[r]=dl(s,i):t[r]=i)}return t}function os(n){return Array.from({length:n},(e,t)=>t)}function $m(n,e={}){const t=Zm(n,dl(Qm,e)),r=n.notes.flatMap(d=>t.note.createElement(t,d)),i=r2(n.timingPoints,t.time.start,t.time.end).flatMap(d=>t.barline.createElement(t,d)),s=os(Math.floor(t.time.end/1e3)).filter(d=>d*1e3>=t.time.start).flatMap(d=>t.axis.createElement(t,d*1e3)),o=os(t.strip.num).flatMap(d=>s2(t,d)),u=os(t.strip.num).flatMap(d=>a2(t,d)),l=t.background.enabled?t.background.createElement(t):[],c=t.time.direction==="up"?-t.finalScale:t.finalScale,h=t.time.direction==="up"?-t.totalHeight+t.margin[1]:t.margin[1];return`<svg xmlns="http://www.w3.org/2000/svg" width="${t.totalWidth*t.finalScale}" height="${t.totalHeight*t.finalScale}">
  <defs>
    <g id="origin">
      <g id="notes">
        ${r.join(`
        `)}
      </g>
      <g id="barlines">
        ${i.join(`
        `)}
      </g>
      <g id="axis">
        ${s.join(`
        `)}
      </g>
    </g>
    <g id="clip-paths">
      ${o.join(`
      `)}
    </g>
  </defs>
  ${l.join(`
  `)}
  <g transform="scale(${t.finalScale}, ${c}) translate(${t.margin[0]}, ${h})">
    ${u.join(`
    `)}
  </g>
</svg>`}function e2(n){return[`<rect width="100%" height="100%" fill="${n.background.color}" />`]}function t2(n,e){const t=e.column*n.note.width,r=(e.start-n.time.start)*n.time.scale,i=r-n.note.height/2,s=n.note.width,o=n.note.colorSelector(n.beatmap.keys,e),u=[`<rect x="${t}" y="${i}" width="${s}" height="${n.note.height}" rx="${n.note.rx}" fill="${o}" />`];if(e.end){const l=t+(s-n.note.bodyWidth)/2,c=r+n.note.height/2,h=n.note.bodyWidth,d=(e.end-e.start)*n.time.scale-n.note.height,m=n.note.bodyColor??o;d>0&&u.push(`<rect x="${l}" y="${c}" width="${h}" height="${d}" fill="${m}" />`)}return u}function n2(n,e){const t=(e-n.time.start)*n.time.scale,r=n.beatmap.keys*n.note.width,i=n.barline.strokeWidth;return[`<line x1="0" y1="${t}" x2="${r}" y2="${t}" stroke="${n.barline.color}" stroke-width="${i}" />`]}function r2(n,e,t){const r=[...n].sort((s,o)=>s.time-o.time),i=[];for(let s=0;s<r.length;s++){const o=r[s],u=s<r.length-1?r[s+1].time:t,l=6e4/o.bpm*o.meter;for(let c=o.time;c<u&&c<=t;c+=l)c>=e&&i.push(c)}return i}function i2(n,e){const t=n.beatmap.keys*n.note.width,r=(e-n.time.start)*n.time.scale,i=Math.floor(e/6e4),s=Math.floor(e%6e4/1e3),o=s===0?n.axis.minute:n.axis.second,u=s===0?`${i}`:`${s}`,{color:l,strokeWidth:c,fontSize:h}=o,d=n.time.direction==="up"?-r:r,m=n.time.direction==="up"?"scale(1, -1)":"";return[`<line x1="${t}" y1="${r}" x2="${t+n.axis.width/5}" y2="${r}" stroke="${l}" stroke-width="${c}" />`,`<text x="${t+n.axis.width/2}" y="${d}" fill="${l}" font-size="${h}" text-anchor="middle" dominant-baseline="middle" transform="${m}">${u}</text>`]}function s2(n,e){const t=e*n.strip.height;return[`<clipPath id="strip-${e}">`,`  <rect x="0" y="${t}" width="${n.strip.width}" height="${n.strip.height}" />`,"</clipPath>"]}function a2(n,e){return[`<use href="#origin" transform="translate(${e*n.strip.width}, ${-e*n.strip.height})" clip-path="url(#strip-${e})" />`]}const o2=["innerHTML"],u2=Dt({__name:"ManiaSvg",props:{beatmap:{},options:{}},setup(n){const e=n,t=Fi(()=>$m(e.beatmap,e.options));return(r,i)=>(ot(),Rn("div",{innerHTML:t.value},null,8,o2))}});var l2=/[\u1680\u2000-\u200A\u202F\u205F\u3000]/,c2=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,h2=/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF9\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDE00-\uDE3E\uDE47\uDE50-\uDE83\uDE86-\uDE99\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/,us={Space_Separator:l2,ID_Start:c2,ID_Continue:h2},je={isSpaceSeparator(n){return typeof n=="string"&&us.Space_Separator.test(n)},isIdStartChar(n){return typeof n=="string"&&(n>="a"&&n<="z"||n>="A"&&n<="Z"||n==="$"||n==="_"||us.ID_Start.test(n))},isIdContinueChar(n){return typeof n=="string"&&(n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9"||n==="$"||n==="_"||n===""||n===""||us.ID_Continue.test(n))},isDigit(n){return typeof n=="string"&&/[0-9]/.test(n)},isHexDigit(n){return typeof n=="string"&&/[0-9A-Fa-f]/.test(n)}};let Fs,lt,Yt,Ei,_n,xt,Ze,ia,kr;var d2=function(e,t){Fs=String(e),lt="start",Yt=[],Ei=0,_n=1,xt=0,Ze=void 0,ia=void 0,kr=void 0;do Ze=f2(),g2[lt]();while(Ze.type!=="eof");return typeof t=="function"?Ps({"":kr},"",t):kr};function Ps(n,e,t){const r=n[e];if(r!=null&&typeof r=="object")if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=String(i),o=Ps(r,s,t);o===void 0?delete r[s]:Object.defineProperty(r,s,{value:o,writable:!0,enumerable:!0,configurable:!0})}else for(const i in r){const s=Ps(r,i,t);s===void 0?delete r[i]:Object.defineProperty(r,i,{value:s,writable:!0,enumerable:!0,configurable:!0})}return t.call(n,e,r)}let ce,ue,Fr,Ut,pe;function f2(){for(ce="default",ue="",Fr=!1,Ut=1;;){pe=$t();const n=fl[ce]();if(n)return n}}function $t(){if(Fs[Ei])return String.fromCodePoint(Fs.codePointAt(Ei))}function G(){const n=$t();return n===`
`?(_n++,xt=0):n?xt+=n.length:xt++,n&&(Ei+=n.length),n}const fl={default(){switch(pe){case"	":case"\v":case"\f":case" ":case"":case"\uFEFF":case`
`:case"\r":case"\u2028":case"\u2029":G();return;case"/":G(),ce="comment";return;case void 0:return G(),Ie("eof")}if(je.isSpaceSeparator(pe)){G();return}return fl[lt]()},comment(){switch(pe){case"*":G(),ce="multiLineComment";return;case"/":G(),ce="singleLineComment";return}throw Ne(G())},multiLineComment(){switch(pe){case"*":G(),ce="multiLineCommentAsterisk";return;case void 0:throw Ne(G())}G()},multiLineCommentAsterisk(){switch(pe){case"*":G();return;case"/":G(),ce="default";return;case void 0:throw Ne(G())}G(),ce="multiLineComment"},singleLineComment(){switch(pe){case`
`:case"\r":case"\u2028":case"\u2029":G(),ce="default";return;case void 0:return G(),Ie("eof")}G()},value(){switch(pe){case"{":case"[":return Ie("punctuator",G());case"n":return G(),Pn("ull"),Ie("null",null);case"t":return G(),Pn("rue"),Ie("boolean",!0);case"f":return G(),Pn("alse"),Ie("boolean",!1);case"-":case"+":G()==="-"&&(Ut=-1),ce="sign";return;case".":ue=G(),ce="decimalPointLeading";return;case"0":ue=G(),ce="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":ue=G(),ce="decimalInteger";return;case"I":return G(),Pn("nfinity"),Ie("numeric",1/0);case"N":return G(),Pn("aN"),Ie("numeric",NaN);case'"':case"'":Fr=G()==='"',ue="",ce="string";return}throw Ne(G())},identifierNameStartEscape(){if(pe!=="u")throw Ne(G());G();const n=Ts();switch(n){case"$":case"_":break;default:if(!je.isIdStartChar(n))throw Oo();break}ue+=n,ce="identifierName"},identifierName(){switch(pe){case"$":case"_":case"":case"":ue+=G();return;case"\\":G(),ce="identifierNameEscape";return}if(je.isIdContinueChar(pe)){ue+=G();return}return Ie("identifier",ue)},identifierNameEscape(){if(pe!=="u")throw Ne(G());G();const n=Ts();switch(n){case"$":case"_":case"":case"":break;default:if(!je.isIdContinueChar(n))throw Oo();break}ue+=n,ce="identifierName"},sign(){switch(pe){case".":ue=G(),ce="decimalPointLeading";return;case"0":ue=G(),ce="zero";return;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":ue=G(),ce="decimalInteger";return;case"I":return G(),Pn("nfinity"),Ie("numeric",Ut*(1/0));case"N":return G(),Pn("aN"),Ie("numeric",NaN)}throw Ne(G())},zero(){switch(pe){case".":ue+=G(),ce="decimalPoint";return;case"e":case"E":ue+=G(),ce="decimalExponent";return;case"x":case"X":ue+=G(),ce="hexadecimal";return}return Ie("numeric",Ut*0)},decimalInteger(){switch(pe){case".":ue+=G(),ce="decimalPoint";return;case"e":case"E":ue+=G(),ce="decimalExponent";return}if(je.isDigit(pe)){ue+=G();return}return Ie("numeric",Ut*Number(ue))},decimalPointLeading(){if(je.isDigit(pe)){ue+=G(),ce="decimalFraction";return}throw Ne(G())},decimalPoint(){switch(pe){case"e":case"E":ue+=G(),ce="decimalExponent";return}if(je.isDigit(pe)){ue+=G(),ce="decimalFraction";return}return Ie("numeric",Ut*Number(ue))},decimalFraction(){switch(pe){case"e":case"E":ue+=G(),ce="decimalExponent";return}if(je.isDigit(pe)){ue+=G();return}return Ie("numeric",Ut*Number(ue))},decimalExponent(){switch(pe){case"+":case"-":ue+=G(),ce="decimalExponentSign";return}if(je.isDigit(pe)){ue+=G(),ce="decimalExponentInteger";return}throw Ne(G())},decimalExponentSign(){if(je.isDigit(pe)){ue+=G(),ce="decimalExponentInteger";return}throw Ne(G())},decimalExponentInteger(){if(je.isDigit(pe)){ue+=G();return}return Ie("numeric",Ut*Number(ue))},hexadecimal(){if(je.isHexDigit(pe)){ue+=G(),ce="hexadecimalInteger";return}throw Ne(G())},hexadecimalInteger(){if(je.isHexDigit(pe)){ue+=G();return}return Ie("numeric",Ut*Number(ue))},string(){switch(pe){case"\\":G(),ue+=m2();return;case'"':if(Fr)return G(),Ie("string",ue);ue+=G();return;case"'":if(!Fr)return G(),Ie("string",ue);ue+=G();return;case`
`:case"\r":throw Ne(G());case"\u2028":case"\u2029":_2(pe);break;case void 0:throw Ne(G())}ue+=G()},start(){switch(pe){case"{":case"[":return Ie("punctuator",G())}ce="value"},beforePropertyName(){switch(pe){case"$":case"_":ue=G(),ce="identifierName";return;case"\\":G(),ce="identifierNameStartEscape";return;case"}":return Ie("punctuator",G());case'"':case"'":Fr=G()==='"',ce="string";return}if(je.isIdStartChar(pe)){ue+=G(),ce="identifierName";return}throw Ne(G())},afterPropertyName(){if(pe===":")return Ie("punctuator",G());throw Ne(G())},beforePropertyValue(){ce="value"},afterPropertyValue(){switch(pe){case",":case"}":return Ie("punctuator",G())}throw Ne(G())},beforeArrayValue(){if(pe==="]")return Ie("punctuator",G());ce="value"},afterArrayValue(){switch(pe){case",":case"]":return Ie("punctuator",G())}throw Ne(G())},end(){throw Ne(G())}};function Ie(n,e){return{type:n,value:e,line:_n,column:xt}}function Pn(n){for(const e of n){if($t()!==e)throw Ne(G());G()}}function m2(){switch($t()){case"b":return G(),"\b";case"f":return G(),"\f";case"n":return G(),`
`;case"r":return G(),"\r";case"t":return G(),"	";case"v":return G(),"\v";case"0":if(G(),je.isDigit($t()))throw Ne(G());return"\0";case"x":return G(),p2();case"u":return G(),Ts();case`
`:case"\u2028":case"\u2029":return G(),"";case"\r":return G(),$t()===`
`&&G(),"";case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":throw Ne(G());case void 0:throw Ne(G())}return G()}function p2(){let n="",e=$t();if(!je.isHexDigit(e)||(n+=G(),e=$t(),!je.isHexDigit(e)))throw Ne(G());return n+=G(),String.fromCodePoint(parseInt(n,16))}function Ts(){let n="",e=4;for(;e-- >0;){const t=$t();if(!je.isHexDigit(t))throw Ne(G());n+=G()}return String.fromCodePoint(parseInt(n,16))}const g2={start(){if(Ze.type==="eof")throw Tn();ls()},beforePropertyName(){switch(Ze.type){case"identifier":case"string":ia=Ze.value,lt="afterPropertyName";return;case"punctuator":fi();return;case"eof":throw Tn()}},afterPropertyName(){if(Ze.type==="eof")throw Tn();lt="beforePropertyValue"},beforePropertyValue(){if(Ze.type==="eof")throw Tn();ls()},beforeArrayValue(){if(Ze.type==="eof")throw Tn();if(Ze.type==="punctuator"&&Ze.value==="]"){fi();return}ls()},afterPropertyValue(){if(Ze.type==="eof")throw Tn();switch(Ze.value){case",":lt="beforePropertyName";return;case"}":fi()}},afterArrayValue(){if(Ze.type==="eof")throw Tn();switch(Ze.value){case",":lt="beforeArrayValue";return;case"]":fi()}},end(){}};function ls(){let n;switch(Ze.type){case"punctuator":switch(Ze.value){case"{":n={};break;case"[":n=[];break}break;case"null":case"boolean":case"numeric":case"string":n=Ze.value;break}if(kr===void 0)kr=n;else{const e=Yt[Yt.length-1];Array.isArray(e)?e.push(n):Object.defineProperty(e,ia,{value:n,writable:!0,enumerable:!0,configurable:!0})}if(n!==null&&typeof n=="object")Yt.push(n),Array.isArray(n)?lt="beforeArrayValue":lt="beforePropertyName";else{const e=Yt[Yt.length-1];e==null?lt="end":Array.isArray(e)?lt="afterArrayValue":lt="afterPropertyValue"}}function fi(){Yt.pop();const n=Yt[Yt.length-1];n==null?lt="end":Array.isArray(n)?lt="afterArrayValue":lt="afterPropertyValue"}function Ne(n){return Ai(n===void 0?`JSON5: invalid end of input at ${_n}:${xt}`:`JSON5: invalid character '${ml(n)}' at ${_n}:${xt}`)}function Tn(){return Ai(`JSON5: invalid end of input at ${_n}:${xt}`)}function Oo(){return xt-=5,Ai(`JSON5: invalid identifier character at ${_n}:${xt}`)}function _2(n){console.warn(`JSON5: '${ml(n)}' in strings is not valid ECMAScript; consider escaping`)}function ml(n){const e={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};if(e[n])return e[n];if(n<" "){const t=n.charCodeAt(0).toString(16);return"\\x"+("00"+t).substring(t.length)}return n}function Ai(n){const e=new SyntaxError(n);return e.lineNumber=_n,e.columnNumber=xt,e}var D2=function(e,t,r){const i=[];let s="",o,u,l="",c;if(t!=null&&typeof t=="object"&&!Array.isArray(t)&&(r=t.space,c=t.quote,t=t.replacer),typeof t=="function")u=t;else if(Array.isArray(t)){o=[];for(const F of t){let T;typeof F=="string"?T=F:(typeof F=="number"||F instanceof String||F instanceof Number)&&(T=String(F)),T!==void 0&&o.indexOf(T)<0&&o.push(T)}}return r instanceof Number?r=Number(r):r instanceof String&&(r=String(r)),typeof r=="number"?r>0&&(r=Math.min(10,Math.floor(r)),l="          ".substr(0,r)):typeof r=="string"&&(l=r.substr(0,10)),h("",{"":e});function h(F,T){let E=T[F];switch(E!=null&&(typeof E.toJSON5=="function"?E=E.toJSON5(F):typeof E.toJSON=="function"&&(E=E.toJSON(F))),u&&(E=u.call(T,F,E)),E instanceof Number?E=Number(E):E instanceof String?E=String(E):E instanceof Boolean&&(E=E.valueOf()),E){case null:return"null";case!0:return"true";case!1:return"false"}if(typeof E=="string")return d(E);if(typeof E=="number")return String(E);if(typeof E=="object")return Array.isArray(E)?g(E):m(E)}function d(F){const T={"'":.1,'"':.2},E={"'":"\\'",'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\v":"\\v","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};let C="";for(let B=0;B<F.length;B++){const W=F[B];switch(W){case"'":case'"':T[W]++,C+=W;continue;case"\0":if(je.isDigit(F[B+1])){C+="\\x00";continue}}if(E[W]){C+=E[W];continue}if(W<" "){let j=W.charCodeAt(0).toString(16);C+="\\x"+("00"+j).substring(j.length);continue}C+=W}const x=c||Object.keys(T).reduce((B,W)=>T[B]<T[W]?B:W);return C=C.replace(new RegExp(x,"g"),E[x]),x+C+x}function m(F){if(i.indexOf(F)>=0)throw TypeError("Converting circular structure to JSON5");i.push(F);let T=s;s=s+l;let E=o||Object.keys(F),C=[];for(const B of E){const W=h(B,F);if(W!==void 0){let j=D(B)+":";l!==""&&(j+=" "),j+=W,C.push(j)}}let x;if(C.length===0)x="{}";else{let B;if(l==="")B=C.join(","),x="{"+B+"}";else{let W=`,
`+s;B=C.join(W),x=`{
`+s+B+`,
`+T+"}"}}return i.pop(),s=T,x}function D(F){if(F.length===0)return d(F);const T=String.fromCodePoint(F.codePointAt(0));if(!je.isIdStartChar(T))return d(F);for(let E=T.length;E<F.length;E++)if(!je.isIdContinueChar(String.fromCodePoint(F.codePointAt(E))))return d(F);return F}function g(F){if(i.indexOf(F)>=0)throw TypeError("Converting circular structure to JSON5");i.push(F);let T=s;s=s+l;let E=[];for(let x=0;x<F.length;x++){const B=h(String(x),F);E.push(B!==void 0?B:"null")}let C;if(E.length===0)C="[]";else if(l==="")C="["+E.join(",")+"]";else{let x=`,
`+s,B=E.join(x);C=`[
`+s+B+`,
`+T+"]"}return i.pop(),s=T,C}};const b2={parse:d2,stringify:D2};var S2=b2;const pl=Dt({__name:"OptionsEditor",props:{template:{}},emits:["update"],setup(n,{emit:e}){const t=n,r=e,i=qt(null);let s=null;function o(u){try{const l=S2.parse(u.state.doc.toString());r("update",l)}catch{Uc.error("Invalid JSON5 format. Please correct the errors.")}}return Ti(()=>{i.value&&(s=new Ga({extensions:[Zc,$c(),Ga.domEventHandlers({blur:(u,l)=>o(l)})],parent:i.value,doc:t.template}))}),Ms(()=>{s?.destroy(),s=null}),(u,l)=>(ot(),Rn("div",{ref_key:"editorContainer",ref:i},null,512))}}),y2=`// JSON5, not TypeScript
{
  background: {
    /** Whether to render background */
    //enabled: true,
    /** Background color of the SVG */
    //color: '#000000',
  },
  note: {
    /** Width of each column in px */
    //width: 20,
    /** Height of regular notes in px */
    //height: 6,
    /** Corner radius in px */
    //rx: 2,
    /** Width of long note body in px */
    //bodyWidth: 10,
    /** Color of the long note body */
    //bodyColor: '#CCCCCC' as string | undefined,
  },
  time: {
    /** Start time in ms */
    //start: 'auto' as 'auto' | number,
    /** End time in ms */
    //end: 'auto' as 'auto' | number,
    /** Vertical scale: px per ms */
    //scale: 0.1,
    /** Time direction: 'up' (bottom to top) or 'down' (top to bottom) */
    //direction: 'up' as 'up' | 'down',
  },
  barline: {
    /** Stroke width of bar lines in px */
    //strokeWidth: 1,
    //color: '#85F000', // green
  },
  axis: {
    /** Width of the axis area in px */
    //width: 30,
    /** Style for labels at whole minutes (e.g., 1:00, 2:00) */
    minute: {
      //color: '#FF3F00',
      //strokeWidth: 2,
      //fontSize: 18,
    },
    /** Style for second labels */
    second: {
      //color: '#FFFFFF',
      //strokeWidth: 1,
      //fontSize: 18,
    },
  },
  strip: {
    /**
     * Layout mode for strips
     * - 'num': specify number of strips
     * - 'time': specify time duration per strip
     * - 'ratio': specify target aspect ratio (width / height) to auto-calculate strip count (approximate)
    */
    //mode: 'num' as 'num' | 'time' | 'ratio',
    /** Number of vertical strips to divide the timeline */
    //num: 8 as number | undefined,
    /** Time duration per strip in ms */
    //time: 30000 as number | undefined,
    /** Target aspect ratio (width / height), actual ratio may vary slightly */
    //ratio: 1.5 as number | undefined,
  },
  layout: {
    /**
     * Margin around the entire SVG in px [horizontal, vertical]
     * When targetSize is set, this value serves as the minimum margin
     * and will be automatically adjusted to meet the target size requirements
     */
    //margin: [10, 10] as [number, number],
    /**
     * Maximum scale factor applied to the entire SVG
     * When targetSize is set:
     * - Will be automatically reduced (if needed) to prevent content from exceeding targetSize
     * - After scaling, margin will be adjusted to exactly meet targetSize requirements
     */
    //finalScale: 1.0 as number,
    /**
     * Target size [width, height] for the final SVG
     * When set, the SVG will be adjusted to fit this size by:
     * 1. Reducing finalScale (if needed) to prevent content from exceeding targetSize
     * 2. Adjusting margin (using the margin value as minimum) to exactly meet targetSize
     */
    //targetSize: undefined as [number, number] | undefined,
  },
}`,w2=Dt({__name:"Svg",setup(n){const e=Ni(),t=Js(),r=y2;let i=qt(null),s=qt({});return nr(()=>t.selectedBeatmapMD5,async o=>{if(o){const u=await e.readBeatmap(o);i.value=As(u)}else i.value=null},{immediate:!0}),(o,u)=>{const l=Bs,c=xs;return ot(),en(c,null,{default:Be(()=>[vt(i)?(ot(),Rn(Pi,{key:0},[ge(u2,{beatmap:vt(i),options:vt(s)},null,8,["beatmap","options"]),ge(pl,{class:"editor",template:vt(r),onUpdate:u[0]||(u[0]=h=>Tc(s)?s.value=h:s=h)},null,8,["template"])],64)):(ot(),en(l,{key:1,description:"Select a beatmap to view"}))]),_:1})}}}),v2=Gi(w2,[["__scopeId","data-v-4141ff72"]]);function E2(n){const e=n.notes.sort((s,o)=>s.start-o.start),t=Array.from({length:n.keys},()=>[]);for(const s of e)t[s.column].push(s);const r=t.map(()=>0),i=s=>({peek:()=>r[s]<t[s].length?t[s][r[s]]:null,pop:()=>{if(r[s]<t[s].length){const o=t[s][r[s]];return r[s]++,o}return null}});return t.map((s,o)=>i(o))}function*A2(n){if(n.length===0)return;const e=n[0].keyStates.length;let t=Array.from({length:e},()=>!1),r=n[0].time,i=0;for(;i<n.length;){const s=n[i];s.time>r?(yield{time:r,keyStates:t},r++):(yield s,t=s.keyStates,i++)}}function*F2(n,e="replay"){const t=n[0].keyStates.length,r=e==="ms"?A2(n):n;let i=Array.from({length:t},()=>!1);for(const s of r){const o={time:s.time,actions:[]};for(let u=0;u<t;u++){const l=i[u]?s.keyStates[u]?"hold":"release":s.keyStates[u]?"press":"none";o.actions.push(l)}i=s.keyStates,yield o}}const Io=[1,1,2/3,1/3,1/6,0],gl=["Perfect","Great","Good","Ok","Meh","Miss"];function P2(n,e="nm"){const t=[16,64-3*n,97-3*n,127-3*n,151-3*n,188-3*n],r=e==="ez"?1.4:e==="hr"?1/1.4:1;return t.map(i=>i*r)}function T2(n){return n.map((e,t)=>t===0?e*1.2:t===1?e*1.1:e)}function cs(n,e){for(let t=0;t<3;t++)if(n>=-e[t]&&n<=e[t])return t;for(let t=3;t<e.length;t++)if(n>=-e[t]&&n<=e[3]-1)return t;return null}function C2(n,e){const t={...n,result:-1,actions:[]},r=n.end===void 0?e:T2(e);let i=!1,s=!1,o=null;const u=d=>{if(!i&&(i=n.end===void 0?d>n.start+r[3]-1:o===null&&(t.actions.length>0&&d>n.end+r[3]-1||t.actions.length===0&&d>n.start+r[3]-1),i))return t.result<0&&(t.result=5),t},l=d=>{if(!i)if(n.end===void 0){let m=cs(d-n.start,r);if(m!==null)return i=!0,t.result=m,t.actions.push(d),t}else d>=n.start-r[5]&&d<=n.end+r[3]-1&&(o=d<n.start-r[4]?n.end-1:d,t.actions.push(d))},c=d=>{if(d<-r[4])return 5;const m=cs(o-n.start,r)??4,D=(Math.abs(o-n.start)+Math.abs(d))/2,g=cs(D,r)??4;return Math.max(m,g,s?2:0)};return{note:n,get isProcessed(){return i},onFrame:u,onHit:l,onRelease:d=>{if(n.end===void 0||i||o===null)return;const m=d-n.end;if(m<-r[4]){t.result=c(m),t.actions.push(d),s=!0,o=null;return}i=!0;const D=c(m);return t.result=D,t.actions.push(d),t}}}function M2(n,e){let t=null;const r=o=>{if(t===null||t.isProcessed&&o>=t.note.start){const u=n.pop();u&&(t=C2(u,e))}};return{onFrame:o=>{if(r(o),t)return t.onFrame(o)},onAction:(o,u)=>{if(r(o),t){if(u==="press")return t.onHit(o);if(u==="release")return t.onRelease(o)}}}}function x2(n,e,t="nm",r="replay"){const i=E2(n),s=P2(n.od,t),o=i.map(c=>M2(c,s)),u=F2(e,r),l=[];for(const c of u)for(let h=0;h<n.keys;h++){const d=o[h],m=d.onFrame(c.time);m&&l.push(m);const D=c.actions[h],g=d.onAction(c.time,D);g&&l.push(g)}return l}function _l(n,e){const t={...n};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r],s=n[r];i!==void 0&&(typeof i=="object"&&i!==null&&!Array.isArray(i)&&typeof s=="object"&&s!==null&&!Array.isArray(s)?t[r]=_l(s,i):t[r]=i)}return t}function B2(){const n=[];return{emit:()=>n.forEach(e=>e()),subscribe:e=>(n.push(e),()=>{const t=n.indexOf(e);t>=0&&n.splice(t,1)})}}function hs(n,e,t){return Math.min(Math.max(n,e),t)}function k2(){return{canvas:{width:"auto",height:930},background:{enabled:!0,color:"#000000",createElement:void 0},beatmap:{keys:7,od:8,duration:"auto",notes:[],timingPoints:[]},note:{width:40,height:12,rx:2,bodyWidth:20,bodyColor:"#CCCCCC",selectColor:void 0,createElement:void 0},replay:{color:"#FF0000",width:4,frames:[],mod:"nm",selectLevels:[0,1,2,3,4,5],useFrameActions:!1,createElement:void 0},barline:{strokeWidth:1,color:"#85F000",createElement:void 0},axis:{width:30,minute:{color:"#FF3F00",strokeWidth:2,fontSize:18},second:{color:"#FFFFFF",strokeWidth:1,fontSize:18},createElement:void 0},scroll:{width:80,window:{min:2e3,max:2e4,default:5e3},nps:{countTails:!0,color:"#FF99CC",createElement:void 0}},tooltip:{enabled:!0,format:void 0}}}function No(n){if(n.note.width==="auto"&&n.canvas.width==="auto")throw new Error('Cannot set both note.width and stage.width to "auto"');let e=n.beatmap.notes.map(o=>({...o,result:-1,actions:[]})),t=6e4;if(e.length>0){const o=e.reduce((u,l)=>Math.max(u,l.end??l.start),0);t=Math.ceil(o/1e3)*1e3,n.replay.frames.length>0&&(e=x2(n.beatmap,n.replay.frames,n.replay.mod))}const r=n.note.width==="auto"?(n.canvas.width-n.scroll.width-n.axis.width)/n.beatmap.keys:n.note.width,i=n.canvas.width==="auto"?n.beatmap.keys*n.note.width+n.scroll.width+n.axis.width:n.canvas.width,s={startTime:0,endTime:n.scroll.window.default,onChange:B2()};return{...n,canvas:{...n.canvas,width:i},beatmap:{...n.beatmap,notes:e,duration:t},note:{...n.note,width:r},state:s}}function R2(n,e){if(e.destroyChildren(),n.background.enabled){n.background.createElement??=L2;const i=n.background.createElement(n);e.add(i)}const t=N2(n);e.add(t.rect),n.scroll.nps.createElement??=I2;const r=n.scroll.nps.createElement(n);e.add(r),e.add(t.group),e.batchDraw()}function L2(n){return new Se.Rect({x:0,y:0,width:n.canvas.width,height:n.canvas.height,fill:n.background.color,listening:!1})}function O2(n,e=!1){const t=Array.from({length:n.duration/1e3},()=>0);for(const r of n.notes)t[Math.floor(r.start/1e3)]++,e&&r.end!==void 0&&t[Math.floor(r.end/1e3)]++;return t}function I2(n){const e=O2(n.beatmap,n.scroll.nps.countTails),t=Math.max(...e,1),r=n.canvas.height/e.length,i=Math.min(2,r/8),s=new Se.Group({x:0,y:0});for(let o=0;o<e.length;o++){const u=e[o]/t*n.scroll.width,l=new Se.Rect({x:n.scroll.width-u,y:n.canvas.height-r*(o+1)+i/2,width:u,height:r-i,fill:n.scroll.nps.color});l.setAttr("getData",()=>({name:"NPS",time:o*1e3,nps:e[o]})),s.add(l)}return s}function Go(n){const e=n.state.endTime-n.state.startTime,t=n.canvas.height*(e/n.beatmap.duration),r=n.canvas.height-n.state.startTime/n.beatmap.duration*n.canvas.height;return{topY:r-t,bottomY:r,height:t}}function mi(n,e,t){const r=n.beatmap.duration*(t-e)/n.canvas.height,i=n.beatmap.duration*(n.canvas.height-t)/n.canvas.height;n.state.startTime=i,n.state.endTime=i+r,n.state.onChange.emit()}function N2(n){const e=Go(n),t=n.canvas.height*(n.scroll.window.min/n.beatmap.duration),r=n.canvas.height*(n.scroll.window.max/n.beatmap.duration),i=10,s=new Se.Group({x:0,y:0}),o=new Se.Rect({x:0,y:0,width:n.scroll.width,height:n.canvas.height,fill:"rgba(0, 0, 0, 0)"}),u=new Se.Rect({x:0,y:e.topY,width:n.scroll.width,height:e.height,fill:"rgba(255, 255, 255, 0.2)",stroke:"#FFFFFF",strokeWidth:2,draggable:!0,dragBoundFunc:function(h){return{x:this.absolutePosition().x,y:hs(h.y,0,n.canvas.height-this.height())}}});u.setAttr("getData",()=>({name:"Window",start:Math.round(n.state.startTime),end:Math.round(n.state.endTime)}));const l=new Se.Rect({x:0,y:e.topY-i/2,width:n.scroll.width,height:i,fill:"rgba(255, 255, 255, 0.5)",draggable:!0,dragBoundFunc:function(h){const d=u.y()+u.height(),m=hs(h.y+i/2,d-r,d-t);return{x:this.absolutePosition().x,y:Math.max(m,0)-i/2}}}),c=new Se.Rect({x:0,y:e.bottomY-i/2,width:n.scroll.width,height:i,fill:"rgba(255, 255, 255, 0.5)",draggable:!0,dragBoundFunc:function(h){const d=u.y(),m=hs(h.y+i/2,d+t,d+r);return{x:this.absolutePosition().x,y:Math.min(m,n.canvas.height)-i/2}}});return o.on("click",()=>{const h=o.getRelativePointerPosition();if(h){console.log(h);const{height:d}=Go(n);let m,D;h.y<d/2?(m=Math.max(h.y-d/2,0),D=m+d):(D=Math.min(h.y+d/2,n.canvas.height),m=D-d),mi(n,m,D),u.y(m),l.y(m-i/2),c.y(D-i/2)}}),l.on("dragmove",()=>{const h=l.y()+i/2,d=u.y()+u.height(),m=d-h;u.y(h),u.height(m),mi(n,h,d)}),c.on("dragmove",()=>{const h=c.y()+i/2,d=u.y(),m=h-d;u.height(m),mi(n,d,h)}),u.on("dragmove",()=>{const h=u.y(),d=h+u.height();l.y(h-i/2),c.y(d-i/2),mi(n,h,d)}),l.on("mouseenter",()=>{document.body.style.cursor="ns-resize"}),l.on("mouseleave",()=>{document.body.style.cursor="default"}),c.on("mouseenter",()=>{document.body.style.cursor="ns-resize"}),c.on("mouseleave",()=>{document.body.style.cursor="default"}),u.on("mouseenter",()=>{document.body.style.cursor="move"}),u.on("mouseleave",()=>{document.body.style.cursor="default"}),s.add(u),s.add(l),s.add(c),{group:s,rect:o}}const G2=["#FFFFFF","#5EAEFF","#FFEC5E","#FF3F00"],H2={1:[0],2:[0,0],3:[0,1,0],4:[0,1,1,0],5:[0,1,2,1,0],6:[0,1,0,0,1,0],7:[0,1,0,2,0,1,0],8:[0,1,0,2,2,0,1,0],9:[3,0,1,0,2,0,1,0,3],10:[3,0,1,0,2,2,0,1,0,3],12:[3,1,0,1,0,2,2,0,1,0,1,3],14:[3,0,1,0,1,0,2,2,0,1,0,1,0,3],16:[3,1,0,1,0,1,0,2,2,0,1,0,1,0,1,3],18:[3,0,1,0,1,0,1,0,2,2,0,1,0,1,0,1,0,3]};function W2(n=G2,e=H2){return(t,r)=>{const i=e[t];if(!i)throw new Error(`Unsupported keys: ${t}`);const s=i[r.column];if(s===void 0)throw new Error(`Invalid column: ${r.column} for ${t}K`);return n[s]}}function Ho(n,e){e.destroyChildren(),n.barline.createElement??=Dl;const t=z2(n);e.add(t),n.note.selectColor??=W2(),n.note.createElement??=Sl,n.replay.createElement??=sa;const r=U2(n);if(e.add(r),n.replay.useFrameActions){const s=K2(n);e.add(s)}n.axis.createElement??=bl;const i=j2(n);e.add(i),e.batchDraw()}function ar(n,e){const t=n.canvas.height/(n.state.endTime-n.state.startTime);return n.canvas.height-(e-n.state.startTime)*t}function V2(n,e,t){const r=[...n].sort((s,o)=>s.time-o.time),i=[];for(let s=0;s<r.length;s++){const o=r[s],u=s<r.length-1?r[s+1].time:t,c=6e4/o.bpm*o.meter;for(let h=o.time;h<u&&h<=t;h+=c)h>=e&&i.push(h)}return i}function Dl(n,e){const t=ar(n,e);return new Se.Line({points:[0,t,n.canvas.width-n.scroll.width-n.axis.width,t],stroke:n.barline.color,strokeWidth:n.barline.strokeWidth})}function z2(n){const e=new Se.Group({x:n.scroll.width,y:0}),t=V2(n.beatmap.timingPoints,0,n.beatmap.duration);for(const r of t){if(r<n.state.startTime||r>n.state.endTime)continue;const i=Dl(n,r);e.add(i)}return e}function bl(n,e){const t=ar(n,e),r=Math.floor(e/6e4),i=Math.floor(e%6e4/1e3),s=i===0?n.axis.minute:n.axis.second,o=i===0?`${r}`:`${i}`,u=new Se.Group,l=new Se.Line({points:[0,t,n.axis.width-s.fontSize-8,t],stroke:s.color,strokeWidth:1}),c=new Se.Text({x:n.axis.width-s.fontSize-5,y:t-s.fontSize/2,text:o,fontSize:s.fontSize,fill:s.color});return u.add(l),u.add(c),u}function j2(n){const e=n.scroll.width+n.beatmap.keys*n.note.width,t=new Se.Group({x:e,y:0});for(let r=1e3;r<n.beatmap.duration;r+=1e3){if(r<n.state.startTime||r>n.state.endTime)continue;const i=bl(n,r);t.add(i)}return t}function Sl(n,e){const t=e.column*n.note.width,r=ar(n,e.start),i=n.note.selectColor(n.beatmap.keys,e),s=new Se.Group,o=new Se.Rect({x:t,y:r-n.note.height/2,width:n.note.width,height:n.note.height,fill:i,cornerRadius:n.note.rx}),u=()=>({name:"Note",start:e.start,end:e.end,result:e.result!==-1?gl[e.result]:void 0,actions:e.actions.length>0?e.actions:void 0});if(o.setAttr("getData",u),s.add(o),e.end){const l=ar(n,e.end),c=new Se.Rect({x:t+(n.note.width-n.note.bodyWidth)/2,y:l,width:n.note.bodyWidth,height:r-l-n.note.height/2,fill:n.note.bodyColor??i});s.add(c),c.setAttr("getData",u)}return s}function U2(n){const e=new Se.Group({x:n.scroll.width,y:0}),t=n.note.height/n.canvas.height*(n.state.endTime-n.state.startTime);for(const r of n.beatmap.notes){const i=r.end??r.start+t;r.start>n.state.endTime||i<n.state.startTime||e.add(Sl(n,r))}for(const r of n.beatmap.notes)if(!n.replay.useFrameActions&&r.result!==-1&&n.replay.selectLevels.includes(r.result)&&r.actions.length>0)for(let i=0;i<r.actions.length;i+=2){const s={column:r.column,start:r.actions[i],end:i+1<r.actions.length?r.actions[i+1]:void 0};e.add(sa(n,s))}return e}function*X2(n){const e=n[0].keyStates.length,t=Array.from({length:e},()=>null);for(const r of n)for(let i=0;i<e;i++){const s=r.keyStates[i],o=t[i];s&&o===null?t[i]=r.time:!s&&o!==null&&(t[i]=null,yield{column:i,start:o,end:r.time})}}function sa(n,e){const t=e.column*n.note.width,r=ar(n,e.start),i=n.note.width/4,s=[[t+i,r,t+i*3,r]];if(e.end){const u=ar(n,e.end);s.push([t+i*2,r,t+i*2,u])}const o=new Se.Group;for(const u of s){const l=new Se.Line({points:u,stroke:n.replay.color,strokeWidth:n.replay.width});l.setAttr("getData",()=>({name:"Key",start:e.start,end:e.end})),o.add(l)}return o}function K2(n){const e=new Se.Group({x:n.scroll.width,y:0});if(n.replay.frames.length===0)return e;for(const t of X2(n.replay.frames))(t.end??t.start)<n.state.startTime||t.start>n.state.endTime||e.add(sa(n,t));return e}function Y2(n,e){if(e.destroyChildren(),n.tooltip.enabled){n.tooltip.format??=J2;const t=Q2();e.add(t),e.batchDraw(),n.state.onChange.subscribe(()=>{t.hide()}),e.getStage()?.off("click"),e.getStage()?.on("click",r=>{const i=r.target,s=q2(i);if(s){const o=n.tooltip.format(s);t.getText().text(o);const u=e.getRelativePointerPosition();u&&t.position({x:u.x,y:u.y}),t.show()}else t.hide();e.batchDraw()})}}function q2(n){if(typeof n.getAttr=="function"){const e=n.getAttr("getData");return typeof e=="function"?e():e!==void 0?e:void 0}}function J2(n){const e=t=>Object.entries(t).filter(([r,i])=>i!==void 0).reduce((r,[i,s])=>(i==="name"||i==="title"?r.unshift(`${s}`):Array.isArray(s)?s.length<=2?r.push(`${i}: [${s.join(", ")}]`):(r.push(`${i}: [`),r.push(...s.map(o=>`  ${o},`)),r.push("]")):typeof s=="object"?(r.push(`${i}: {`),r.push(...e(s).map(o=>`  ${o}`)),r.push("}")):r.push(`${i}: ${s}`),r),[]);return e(n).join(`
`)}function Q2(n){const e=new Se.Label({opacity:.75,visible:!1});return e.add(new Se.Tag({fill:"#ffffff",pointerDirection:"down",pointerWidth:10,pointerHeight:10,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOffsetX:3,shadowOffsetY:3,shadowOpacity:.3})),e.add(new Se.Text({text:"",fontSize:14,padding:5,fill:"#000000"})),e}function Z2(n){const e=new Se.Stage({container:n}),t=new Se.Layer;e.add(t);const r=new Se.Layer;e.add(r);const i=new Se.Layer;e.add(i);let s=k2(),o=No(s);return{setOptions:h=>{s=_l(s,h),o=No(s)},render:()=>{e.width(o.canvas.width),e.height(o.canvas.height),R2(o,t),o.state.onChange.subscribe(()=>{Ho(o,r)}),Ho(o,r),Y2(o,i)},destroy:()=>{e.destroy()},getContext:()=>o}}const $2=Dt({__name:"ManiaPanel",props:{options:{}},emits:["update"],setup(n,{emit:e}){const t=n,r=e,i=qt(null);let s=null,o=null;const u=qt(0);return nr([()=>t.options,u],([l,c])=>{s&&(s.setOptions(l),s.setOptions({canvas:{height:Math.max(c,500)}}),s.render(),r("update",s.getContext()))},{deep:!0}),Ti(()=>{const l=i.value;if(!l)return;s=Z2(l);const c=()=>{i.value&&s&&(u.value=i.value.clientHeight)};c(),o=new ResizeObserver(()=>{c()}),o.observe(l)}),Ms(()=>{o?.disconnect(),o=null,s?.destroy(),s=null}),(l,c)=>(ot(),Rn("div",{ref_key:"panelContainer",ref:i},null,512))}}),ep=`// JSON5, not TypeScript
{
  canvas: {
    /** Total width of the canvas in px */
    // width: 'auto' as 'auto' | number,
    /** Total height of the canvas in px */
    // height: 930,
  },
  background: {
    /** Whether to render background */
    // enabled: true,
    /** Background color */
    // color: '#000000', // black
  },
  beatmap: {
    /** Number of columns (keys) */
    // keys: 7,
    /** Overall Difficulty */
    // od: 8,
    /** Duration of the beatmap in milliseconds */
    // duration: 'auto' as 'auto' | number,
  },
  note: {
    /** Width of each column in px */
    // width: 40 as 'auto' | number,
    /** Height of regular notes in px */
    // height: 12,
    /** Corner radius in px */
    // rx: 2,
    /** Width of long note body in px */
    // bodyWidth: 20,
    /** Color of the long note body */
    // bodyColor: '#CCCCCC' as string | undefined,
  },
  replay: {
    /** Color of the replay cursor */
    // color: '#FF0000', // red
    /** Width of the replay cursor in px */
    // width: 4,
    /** Levels to render from note results */
    // selectLevels: [0, 1, 2, 3, 4, 5],
    /** Render key action from replay frames rather than notes result */
    // useFrameActions: false,
  },
  barline: {
    /** Stroke width of bar lines in px */
    // strokeWidth: 1,
    /** Color of the bar lines */
    // color: '#85F000', // green
  },
  axis: {
    /** Width of the axis area in px */
    // width: 30,
    /** Style for labels at whole minutes (e.g., 1:00, 2:00) */
    minute: {
      // color: '#FF3F00',
      // strokeWidth: 2,
      // fontSize: 18,
    },
    /** Style for second labels */
    second: {
      // color: '#FFFFFF',
      // strokeWidth: 1,
      // fontSize: 18,
    },
  },
  scroll: {
    /** Width of the scrollbar in px */
    // width: 80,
    /** Time window for the scrollbar in milliseconds */
    window: {
      // min: 2000, // ms
      // max: 20000, // ms
      // default: 5000, // ms
    },
    /** NPS (notes-per-second) histogram rendered as the scrollbar background */
    nps: {
      /** Whether to count note tails in NPS calculation */
      // countTails: true,
      /** Color of the NPS bars */
      // color: '#FF99CC',
    },
  },
  tooltip: {
    /** Whether to show tooltips on notes */
    // enabled: true,
  },
}
`,tp=Dt({__name:"ResultTable",props:{notes:{}},setup(n){const e=n,t=Fi(()=>{if(e.notes.length===0||e.notes[0].result===-1)return null;const i=gl.map(c=>({name:c,rice:0,ln:0,total:0}));let s=0,o=0,u=0,l=0;for(const c of e.notes)c.end===void 0?i[c.result].rice+=1:i[c.result].ln+=1,i[c.result].total+=1,s+=Io[c.result],o++,c.result<Io.length-1?(l+=1,l>u&&(u=l)):l=0;return{counts:i,totalHits:o,accuracy:o>0?s/o:0,maxCombo:u}}),r=i=>`${(i*100).toFixed(2)}%`;return(i,s)=>{const o=Kc,u=Xc,l=qc,c=Yc,h=Bs;return t.value?(ot(),Rn(Pi,{key:0},[ge(u,{gutter:20},{default:Be(()=>[ge(vt(Na),null,{default:Be(()=>[ge(o,{title:"Accuracy",value:t.value.accuracy,formatter:r},null,8,["value"])]),_:1}),ge(vt(Na),null,{default:Be(()=>[ge(o,{title:"Max Combo",value:t.value.maxCombo},null,8,["value"])]),_:1})]),_:1}),ge(c,{data:t.value.counts,border:"","show-summary":""},{default:Be(()=>[ge(l,{prop:"name",label:"Result"}),ge(l,{prop:"rice",label:"Rice Notes"}),ge(l,{prop:"ln",label:"Long Notes"}),ge(l,{prop:"total",label:"Total"})]),_:1},8,["data"])],64)):(ot(),en(h,{key:1,description:"No results to display"}))}}}),np=Dt({__name:"Panel",setup(n){const e=Ni(),t=qs(),r=Js(),i=ep,s=qt("options"),o=qt({}),u=qt([]);function l(c){const h=c.beatmap.notes;h.length>0&&h[0].result!==-1?u.value=h:u.value=[]}return nr(()=>r.selectedBeatmapMD5,async c=>{if(!c)return;const h=await e.readBeatmap(c),d=As(h);o.value={beatmap:d,replay:{frames:[]}}}),nr(()=>r.selectedReplayMD5,async c=>{if(!c)return;const h=await e.readBeatmap(r.selectedBeatmapMD5),d=As(h),m={beatmap:d,replay:{frames:[],mod:"nm"}};if(c){const g=(await t.readReplay(c,h)).replay.frames;m.replay.frames=Km(d.keys,g);const F=t.items.find(T=>T.replayMD5===c).mods;m.replay.mod=F.includes("EZ")?"ez":F.includes("HR")?"hr":"nm"}o.value=m}),(c,h)=>{const d=Jc,m=Qc,D=Bs,g=xs;return ot(),en(g,null,{default:Be(()=>[vt(r).selectedBeatmapMD5?(ot(),Rn(Pi,{key:0},[ge($2,{options:o.value,onUpdate:l},null,8,["options"]),ge(m,{type:"border-card",modelValue:s.value,"onUpdate:modelValue":h[1]||(h[1]=F=>s.value=F)},{default:Be(()=>[ge(d,{label:"Options",name:"options"},{default:Be(()=>[ge(pl,{template:vt(i),onUpdate:h[0]||(h[0]=F=>o.value=F)},null,8,["template"])]),_:1}),ge(d,{label:"Stats",name:"stats"},{default:Be(()=>[ge(tp,{notes:u.value},null,8,["notes"])]),_:1})]),_:1},8,["modelValue"])],64)):(ot(),en(D,{key:1,description:"Select a beatmap or replay to view"}))]),_:1})}}}),rp=Gi(np,[["__scopeId","data-v-b03580c2"]]),ip=[{path:"/",redirect:"/panel"},{path:"/home",component:Xm},{path:"/svg",component:v2},{path:"/panel",component:rp}],sp=Cc({history:Mc(),routes:ip}),yl=xc();yl.use(Vd);const zi=Bc(Id);zi.use(yl);zi.use(zm);zi.use(sp);zi.mount("#app");
